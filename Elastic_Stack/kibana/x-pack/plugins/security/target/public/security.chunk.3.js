/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[3],{237:function(e,t,i){switch(window.__kbnThemeTag__){case"v7dark":return i(238);case"v7light":return i(240);case"v8dark":return i(242);case"v8light":return i(244)}},238:function(e,t,i){var s=i(15),a=i(239);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},239:function(e,t,i){(t=i(16)(!1)).push([e.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}\n",""]),e.exports=t},240:function(e,t,i){var s=i(15),a=i(241);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},241:function(e,t,i){(t=i(16)(!1)).push([e.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}\n",""]),e.exports=t},242:function(e,t,i){var s=i(15),a=i(243);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},243:function(e,t,i){(t=i(16)(!1)).push([e.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}\n",""]),e.exports=t},244:function(e,t,i){var s=i(15),a=i(245);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},245:function(e,t,i){(t=i(16)(!1)).push([e.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}\n",""]),e.exports=t},246:function(e,t,i){switch(window.__kbnThemeTag__){case"v7dark":return i(247);case"v7light":return i(249);case"v8dark":return i(251);case"v8light":return i(253)}},247:function(e,t,i){var s=i(15),a=i(248);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},248:function(e,t,i){(t=i(16)(!1)).push([e.i,".subFeaturePrivilegeExpandedRegion{background-color:#25262E;padding-left:40px;padding-top:8px}\n",""]),e.exports=t},249:function(e,t,i){var s=i(15),a=i(250);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},250:function(e,t,i){(t=i(16)(!1)).push([e.i,".subFeaturePrivilegeExpandedRegion{background-color:#F5F7FA;padding-left:40px;padding-top:8px}\n",""]),e.exports=t},251:function(e,t,i){var s=i(15),a=i(252);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},252:function(e,t,i){(t=i(16)(!1)).push([e.i,".subFeaturePrivilegeExpandedRegion{background-color:#25262E;padding-left:40px;padding-top:8px}\n",""]),e.exports=t},253:function(e,t,i){var s=i(15),a=i(254);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},254:function(e,t,i){(t=i(16)(!1)).push([e.i,".subFeaturePrivilegeExpandedRegion{background-color:#F5F7FA;padding-left:40px;padding-top:8px}\n",""]),e.exports=t},255:function(e,t,i){switch(window.__kbnThemeTag__){case"v7dark":return i(256);case"v7light":return i(258);case"v8dark":return i(260);case"v8light":return i(262)}},256:function(e,t,i){var s=i(15),a=i(257);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},257:function(e,t,i){(t=i(16)(!1)).push([e.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}\n",""]),e.exports=t},258:function(e,t,i){var s=i(15),a=i(259);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},259:function(e,t,i){(t=i(16)(!1)).push([e.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}\n",""]),e.exports=t},260:function(e,t,i){var s=i(15),a=i(261);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},261:function(e,t,i){(t=i(16)(!1)).push([e.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}\n",""]),e.exports=t},262:function(e,t,i){var s=i(15),a=i(263);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},263:function(e,t,i){(t=i(16)(!1)).push([e.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}\n",""]),e.exports=t},264:function(e,t,i){switch(window.__kbnThemeTag__){case"v7dark":return i(265);case"v7light":return i(267);case"v8dark":return i(269);case"v8light":return i(271)}},265:function(e,t,i){var s=i(15),a=i(266);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},266:function(e,t,i){(t=i(16)(!1)).push([e.i,".secSpacesPopoverList__buttonText{font-size:12px}\n",""]),e.exports=t},267:function(e,t,i){var s=i(15),a=i(268);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},268:function(e,t,i){(t=i(16)(!1)).push([e.i,".secSpacesPopoverList__buttonText{font-size:12px}\n",""]),e.exports=t},269:function(e,t,i){var s=i(15),a=i(270);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},270:function(e,t,i){(t=i(16)(!1)).push([e.i,".secSpacesPopoverList__buttonText{font-size:12px}\n",""]),e.exports=t},271:function(e,t,i){var s=i(15),a=i(272);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},272:function(e,t,i){(t=i(16)(!1)).push([e.i,".secSpacesPopoverList__buttonText{font-size:12px}\n",""]),e.exports=t},273:function(e,t,i){switch(window.__kbnThemeTag__){case"v7dark":return i(274);case"v7light":return i(276);case"v8dark":return i(278);case"v8light":return i(280)}},274:function(e,t,i){var s=i(15),a=i(275);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},275:function(e,t,i){(t=i(16)(!1)).push([e.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#25262E}\n",""]),e.exports=t},276:function(e,t,i){var s=i(15),a=i(277);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},277:function(e,t,i){(t=i(16)(!1)).push([e.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#F5F7FA}\n",""]),e.exports=t},278:function(e,t,i){var s=i(15),a=i(279);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},279:function(e,t,i){(t=i(16)(!1)).push([e.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#25262E}\n",""]),e.exports=t},280:function(e,t,i){var s=i(15),a=i(281);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};s(a,r);e.exports=a.locals||{}},281:function(e,t,i){(t=i(16)(!1)).push([e.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#F5F7FA}\n",""]),e.exports=t},302:function(e,t,i){"use strict";i.r(t),i.d(t,"EditRolePage",(function(){return G}));var s=i(24),a=i.n(s),r=i(4),l=i(3),n=i.n(l),o=i(2),c=i(8),u=i(10),d=i(25),g=i(1),p=i.n(g),h=i(48),b=i(17),v=i.n(b);class kibana_privilege_KibanaPrivilege{constructor(e,t=[]){this.id=e,this.actions=t}get name(){return v.a.upperFirst(this.id)}grantsPrivilege(e){return this.checkActions(this.actions,e.actions).hasAllRequested}checkActions(e,t){const i=t.filter((t=>!e.includes(t)));return{missing:i,hasAllRequested:e.length>0&&t.length>0&&0===i.length}}}class primary_feature_privilege_PrimaryFeaturePrivilege extends kibana_privilege_KibanaPrivilege{constructor(e,t,i=[]){super(e,i),this.config=t,this.actions=i}isMinimalFeaturePrivilege(){return this.id.startsWith("minimal_")}getMinimalPrivilegeId(){return this.isMinimalFeaturePrivilege()?this.id:`minimal_${this.id}`}}class sub_feature_privilege_SubFeaturePrivilege extends kibana_privilege_KibanaPrivilege{constructor(e,t=[]){super(e.id,t),this.subPrivilegeConfig=e,this.actions=t}get name(){return this.subPrivilegeConfig.name}}class sub_feature_privilege_group_SubFeaturePrivilegeGroup{constructor(e,t={}){this.config=e,this.actionMapping=t}get groupType(){return this.config.groupType}get privileges(){return this.config.privileges.map((e=>new sub_feature_privilege_SubFeaturePrivilege(e,this.actionMapping[e.id]||[])))}}class secured_sub_feature_SecuredSubFeature extends h.SubFeature{constructor(e,t={}){super(e),p()(this,"privileges",void 0),this.actionMapping=t,this.privileges=[];for(const e of this.privilegeIterator())this.privileges.push(e)}getPrivilegeGroups(){return this.privilegeGroups.map((e=>new sub_feature_privilege_group_SubFeaturePrivilegeGroup(e,this.actionMapping)))}*privilegeIterator({predicate:e=(()=>!0)}={}){for(const t of this.privilegeGroups)yield*t.privileges.map((e=>new sub_feature_privilege_SubFeaturePrivilege(e,this.actionMapping[e.id]))).filter((t=>e(t,this)))}}class secured_feature_SecuredFeature extends h.KibanaFeature{constructor(e,t={}){var i,s,a,r;super(e),p()(this,"primaryFeaturePrivileges",void 0),p()(this,"minimalPrimaryFeaturePrivileges",void 0),p()(this,"subFeaturePrivileges",void 0),p()(this,"securedSubFeatures",void 0),this.primaryFeaturePrivileges=Object.entries(this.config.privileges||{}).map((([e,i])=>new primary_feature_privilege_PrimaryFeaturePrivilege(e,i,t[e]))),null!==(i=null===(s=this.config.subFeatures)||void 0===s?void 0:s.length)&&void 0!==i&&i?this.minimalPrimaryFeaturePrivileges=Object.entries(this.config.privileges||{}).map((([e,i])=>new primary_feature_privilege_PrimaryFeaturePrivilege(`minimal_${e}`,i,t[`minimal_${e}`]))):this.minimalPrimaryFeaturePrivileges=[],this.securedSubFeatures=null!==(a=null===(r=this.config.subFeatures)||void 0===r?void 0:r.map((e=>new secured_sub_feature_SecuredSubFeature(e,t))))&&void 0!==a?a:[],this.subFeaturePrivileges=this.securedSubFeatures.reduce(((e,t)=>[...e,...t.privilegeIterator()]),[])}getPrivilegesTooltip(){return this.config.privilegesTooltip}getAllPrivileges(){return[...this.primaryFeaturePrivileges,...this.minimalPrimaryFeaturePrivileges,...this.subFeaturePrivileges]}getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:e}={includeMinimalFeaturePrivileges:!1}){return e?[this.primaryFeaturePrivileges,this.minimalPrimaryFeaturePrivileges].flat():[...this.primaryFeaturePrivileges]}getMinimalFeaturePrivileges(){return[...this.minimalPrimaryFeaturePrivileges]}getSubFeaturePrivileges(){return[...this.subFeaturePrivileges]}getSubFeatures(){return[...this.securedSubFeatures]}}var m=i(26);class privilege_collection_PrivilegeCollection{constructor(e){p()(this,"actions",void 0),this.actions=new Set(e.reduce(((e,t)=>[...e,...t.actions]),[]))}grantsPrivilege(e){return this.checkActions(this.actions,e.actions).hasAllRequested}checkActions(e,t){const i=t.filter((t=>!e.has(t)));return{missing:i,hasAllRequested:e.size>0&&t.length>0&&0===i.length}}}function x(e){return new Map(Object.entries(e).map((e=>function(e){const[t,i]=e;return[t,new kibana_privilege_KibanaPrivilege(t,i)]}(e))))}class kibana_privileges_KibanaPrivileges{constructor(e,t){p()(this,"global",void 0),p()(this,"spaces",void 0),p()(this,"feature",void 0),this.global=x(e.global),this.spaces=x(e.space),this.feature=new Map(t.map((t=>{const i=e.features[t.id];return[t.id,new secured_feature_SecuredFeature(t.toRaw(),i)]})))}getBasePrivileges(e){return Object(m.a)(e)?Array.from(this.global.values()):Array.from(this.spaces.values())}getSecuredFeature(e){return this.feature.get(e)}getSecuredFeatures(){return Array.from(this.feature.values())}createCollectionFromRoleKibanaPrivileges(e){const t=e=>t=>e.includes(t.id),i=e.map((e=>[this.getBasePrivileges(e).filter(t(e.base)),Object.entries(e.feature).map((([e,i])=>this.getFeaturePrivileges(e).filter(t(i))))].flat(2))).flat();return new privilege_collection_PrivilegeCollection(i)}getFeaturePrivileges(e){var t,i;return null!==(t=null===(i=this.getSecuredFeature(e))||void 0===i?void 0:i.getAllPrivileges())&&void 0!==t?t:[]}}var j=i(0);class delete_role_button_DeleteRoleButton extends l.Component{constructor(...e){super(...e),p()(this,"state",{showModal:!1}),p()(this,"maybeShowModal",(()=>this.state.showModal?Object(j.jsx)(r.EuiConfirmModal,{title:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deleteRoleTitle",defaultMessage:"Delete Role"}),onCancel:this.closeModal,onConfirm:this.onConfirmDelete,cancelButtonText:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.cancelButtonLabel",defaultMessage:"No, don't delete"}),confirmButtonText:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.confirmButtonLabel",defaultMessage:"Yes, delete role"}),buttonColor:"danger"},Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deletingRoleConfirmationText",defaultMessage:"Are you sure you want to delete this role?"})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deletingRoleWarningText",defaultMessage:"This action cannot be undone!"}))):null)),p()(this,"closeModal",(()=>{this.setState({showModal:!1})})),p()(this,"showModal",(()=>{this.setState({showModal:!0})})),p()(this,"onConfirmDelete",(()=>{this.closeModal(),this.props.onDelete()}))}render(){return this.props.canDelete?Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiButtonEmpty,{color:"danger",onClick:this.showModal},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deleteRoleButtonLabel",defaultMessage:"Delete role"})),this.maybeShowModal()):null}}i(237);class collapsible_panel_CollapsiblePanel extends l.Component{constructor(e){super(e),p()(this,"state",{collapsed:!1}),p()(this,"getTitle",(()=>Object(j.jsx)(r.EuiFlexGroup,{alignItems:"baseline",gutterSize:"s",responsive:!1},Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(r.EuiTitle,null,Object(j.jsx)("h2",null,this.props.iconType&&Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiIcon,{type:this.props.iconType,size:"xl",className:"collapsiblePanel__logo"})," "),this.props.title))),Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(r.EuiLink,{"data-test-subj":"showHidePrivilege",onClick:this.toggleCollapsed},this.state.collapsed?Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.collapsiblePanel.showLinkText",defaultMessage:"show"}):Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.collapsiblePanel.hideLinkText",defaultMessage:"hide"})))))),p()(this,"getForm",(()=>this.state.collapsed?null:Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiSpacer,null),this.props.children))),p()(this,"toggleCollapsed",(()=>{this.setState({collapsed:!this.state.collapsed})})),this.state={collapsed:e.initiallyCollapsed||!1}}render(){return Object(j.jsx)(r.EuiPanel,{hasShadow:!1,hasBorder:!0},this.getTitle(),this.getForm())}}class cluster_privileges_ClusterPrivileges extends l.Component{constructor(...e){super(...e),p()(this,"buildComboBox",(e=>{const t=this.props.role,i=e.map((e=>({label:e}))),s=(t.elasticsearch.cluster||[]).map((e=>({label:e})));return Object(j.jsx)(r.EuiFlexItem,{key:"clusterPrivs"},Object(j.jsx)(r.EuiComboBox,{"data-test-subj":"cluster-privileges-combobox",options:i,selectedOptions:s,onChange:this.onClusterPrivilegesChange,onCreateOption:this.onCreateCustomPrivilege,isDisabled:Object(d.h)(t)}))})),p()(this,"onClusterPrivilegesChange",(e=>{this.props.onChange(e.map((e=>e.label)))})),p()(this,"onCreateCustomPrivilege",(e=>{this.props.onChange([...this.props.role.elasticsearch.cluster,e])})),p()(this,"getAvailableClusterPrivileges",(()=>{const e=[...this.props.builtinClusterPrivileges,...this.props.role.elasticsearch.cluster];return v.a.uniq(e)}))}render(){const e=this.getAvailableClusterPrivileges();return Object(j.jsx)(r.EuiFlexGroup,null,this.buildComboBox(e))}}const P=e=>e.label,f=e=>({label:e});class index_privilege_form_IndexPrivilegeForm extends l.Component{constructor(e){super(e),p()(this,"isFieldListLoading",!1),p()(this,"getPrivilegeForm",(()=>Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiFlexGroup,null,Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiFormRow,a()({label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.indicesFormRowLabel",defaultMessage:"Indices"}),fullWidth:!0},this.props.validator.validateIndexPrivilege(this.props.indexPrivilege)),Object(j.jsx)(r.EuiComboBox,{"data-test-subj":`indicesInput${this.props.formIndex}`,options:this.props.indexPatterns.map(f),selectedOptions:this.props.indexPrivilege.names.map(f),onCreateOption:this.onCreateIndexPatternOption,onChange:this.onIndexPatternsChange,isDisabled:this.props.isRoleReadOnly}))),Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiFormRow,{label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.privilegesFormRowLabel",defaultMessage:"Privileges"}),fullWidth:!0},Object(j.jsx)(r.EuiComboBox,{"data-test-subj":`privilegesInput${this.props.formIndex}`,options:this.props.availableIndexPrivileges.map(f),selectedOptions:this.props.indexPrivilege.privileges.map(f),onChange:this.onPrivilegeChange,onCreateOption:this.onCreateCustomPrivilege,isDisabled:this.props.isRoleReadOnly})))),Object(j.jsx)(r.EuiSpacer,null),this.getFieldLevelControls(),this.getGrantedDocumentsControl()))),p()(this,"loadFLSOptions",((e,t=!1)=>{(t||!this.isFieldListLoading&&0!==e.length)&&(this.isFieldListLoading=!0,this.setState({isFieldListLoading:!0}),this.props.indicesAPIClient.getFields(e.join(",")).then((e=>{this.isFieldListLoading=!1,this.setState({flsOptions:e,isFieldListLoading:!1})})).catch((()=>{this.isFieldListLoading=!1,this.setState({flsOptions:[],isFieldListLoading:!1})})))})),p()(this,"getFieldLevelControls",(()=>{const{allowFieldLevelSecurity:e,allowDocumentLevelSecurity:t,indexPrivilege:i,isRoleReadOnly:s}=this.props;if(!e)return null;const{grant:a,except:o}=this.getFieldSecurity(i);return Object(j.jsx)(n.a.Fragment,null,Object(j.jsx)(r.EuiFlexGroup,{direction:"column"},!s&&Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiSwitch,{"data-test-subj":`restrictFieldsQuery${this.props.formIndex}`,label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantFieldPrivilegesLabel",defaultMessage:"Grant access to specific fields"}),compressed:!0,checked:this.state.fieldSecurityExpanded,onChange:this.toggleFieldSecurity})),this.state.fieldSecurityExpanded&&Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiFlexGroup,null,Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiFormRow,{label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantedFieldsFormRowLabel",defaultMessage:"Granted fields"}),fullWidth:!0,className:"indexPrivilegeForm__grantedFieldsRow",helpText:s||0!==a.length?void 0:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantedFieldsFormRowHelpText",defaultMessage:"If no fields are granted, then users assigned to this role will not be able to see any data for this index."})},Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiComboBox,{"data-test-subj":`fieldInput${this.props.formIndex}`,options:this.state.flsOptions.map(f),selectedOptions:a.map(f),onCreateOption:this.onCreateGrantedField,onChange:this.onGrantedFieldsChange,isDisabled:this.props.isRoleReadOnly,async:!0,isLoading:this.state.isFieldListLoading})))),Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiFormRow,{label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.deniedFieldsFormRowLabel",defaultMessage:"Denied fields"}),fullWidth:!0,className:"indexPrivilegeForm__deniedFieldsRow"},Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiComboBox,{"data-test-subj":`deniedFieldInput${this.props.formIndex}`,options:this.state.flsOptions.map(f),selectedOptions:o.map(f),onCreateOption:this.onCreateDeniedField,onChange:this.onDeniedFieldsChange,isDisabled:s,async:!0,isLoading:this.state.isFieldListLoading}))))))),t&&Object(j.jsx)(r.EuiSpacer,null))})),p()(this,"getGrantedDocumentsControl",(()=>{var e;const{allowDocumentLevelSecurity:t,indexPrivilege:i,isRoleReadOnly:s}=this.props;return t?Object(j.jsx)(r.EuiFlexGroup,{direction:"column"},!this.props.isRoleReadOnly&&Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiSwitch,{"data-test-subj":`restrictDocumentsQuery${this.props.formIndex}`,label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.grantReadPrivilegesLabel",defaultMessage:"Grant read privileges to specific documents"}),compressed:!0,checked:this.state.queryExpanded,onChange:this.toggleDocumentQuery,disabled:s})),this.state.queryExpanded&&Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiFormRow,{label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.grantedDocumentsQueryFormRowLabel",defaultMessage:"Granted documents query"}),fullWidth:!0,"data-test-subj":`queryInput${this.props.formIndex}`},Object(j.jsx)(u.CodeEditorField,{languageId:"xjson",width:"100%",fullWidth:!0,height:this.state.documentQueryEditorHeight,"aria-label":o.i18n.translate("xpack.security.management.editRole.indexPrivilegeForm.grantedDocumentsQueryEditorAriaLabel",{defaultMessage:"Granted documents query editor"}),value:null!==(e=i.query)&&void 0!==e?e:"",onChange:this.onQueryChange,options:{readOnly:this.props.isRoleReadOnly,minimap:{enabled:!1},renderValidationDecorations:i.query?"editable":"off"},editorDidMount:this.editorDidMount})))):null})),p()(this,"editorDidMount",(e=>{const t=()=>{const t=Math.min(1e3,Math.max(100,e.getContentHeight()));this.setState({documentQueryEditorHeight:`${t}px`})};e.onDidContentSizeChange(t),t()})),p()(this,"toggleDocumentQuery",(()=>{const e=this.state.queryExpanded,t=!e;this.setState({queryExpanded:!this.state.queryExpanded,documentQuery:e?this.props.indexPrivilege.query:this.state.documentQuery}),e&&this.props.onChange({...this.props.indexPrivilege,query:""}),t&&!this.props.indexPrivilege.query&&this.state.documentQuery&&this.props.onChange({...this.props.indexPrivilege,query:this.state.documentQuery})})),p()(this,"toggleFieldSecurity",(()=>{const e=this.state.fieldSecurityExpanded,t=!e,{grant:i,except:s}=this.getFieldSecurity(this.props.indexPrivilege);this.setState({fieldSecurityExpanded:!this.state.fieldSecurityExpanded,grantedFields:e?i:this.state.grantedFields,exceptedFields:e?s:this.state.exceptedFields}),e&&this.props.onChange({...this.props.indexPrivilege,field_security:{grant:["*"],except:[]}});const a=this.isFieldSecurityConfigured(this.props.indexPrivilege),r=this.state.exceptedFields.length>0||this.state.grantedFields.length>0;t&&this.loadFLSOptions(this.props.indexPrivilege.names),t&&!a&&r&&this.props.onChange({...this.props.indexPrivilege,field_security:{grant:this.state.grantedFields,except:this.state.exceptedFields}})})),p()(this,"onCreateIndexPatternOption",(e=>{const t=this.props.indexPrivilege.names.concat([e]);this.props.onChange({...this.props.indexPrivilege,names:t}),this.state.fieldSecurityExpanded&&this.loadFLSOptions(t,!0)})),p()(this,"onIndexPatternsChange",(e=>{const t=e.map(P);this.props.onChange({...this.props.indexPrivilege,names:t}),this.state.fieldSecurityExpanded&&this.loadFLSOptions(t,!0)})),p()(this,"onPrivilegeChange",(e=>{this.props.onChange({...this.props.indexPrivilege,privileges:e.map(P)})})),p()(this,"onCreateCustomPrivilege",(e=>{this.props.onChange({...this.props.indexPrivilege,privileges:[...this.props.indexPrivilege.privileges,e]})})),p()(this,"onQueryChange",(e=>{this.props.onChange({...this.props.indexPrivilege,query:e})})),p()(this,"onCreateGrantedField",(e=>{if(!this.props.indexPrivilege.field_security||!this.props.indexPrivilege.field_security.grant)return;const t=this.props.indexPrivilege.field_security.grant.concat([e]);this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,grant:t}})})),p()(this,"onGrantedFieldsChange",(e=>{this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,grant:e.map(P)}})})),p()(this,"onCreateDeniedField",(e=>{if(!this.props.indexPrivilege.field_security||!this.props.indexPrivilege.field_security.except)return;const t=this.props.indexPrivilege.field_security.except.concat([e]);this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,except:t}})})),p()(this,"onDeniedFieldsChange",(e=>{this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,except:e.map(P)}})})),p()(this,"getFieldSecurity",(e=>{const{grant:t=[],except:i=[]}=e.field_security||{};return{grant:t,except:i}})),p()(this,"isFieldSecurityConfigured",(e=>{const{grant:t,except:i}=this.getFieldSecurity(e);return i.length>0||t.length>0&&!v.a.isEqual(t,["*"])}));const{grant:t,except:i}=this.getFieldSecurity(e.indexPrivilege);this.state={queryExpanded:!!e.indexPrivilege.query,fieldSecurityExpanded:this.isFieldSecurityConfigured(e.indexPrivilege),grantedFields:t,exceptedFields:i,documentQuery:e.indexPrivilege.query,documentQueryEditorHeight:"100px",isFieldListLoading:!1,flsOptions:[]}}componentDidMount(){this.state.fieldSecurityExpanded&&this.props.allowFieldLevelSecurity&&this.loadFLSOptions(this.props.indexPrivilege.names)}render(){return Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiHorizontalRule,null),Object(j.jsx)(r.EuiFlexGroup,{className:"index-privilege-form"},Object(j.jsx)(r.EuiFlexItem,null,this.getPrivilegeForm()),!this.props.isRoleReadOnly&&Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(r.EuiFormRow,{hasEmptyLabelSpace:!0},Object(j.jsx)(r.EuiButtonIcon,{"aria-label":o.i18n.translate("xpack.security.management.editRole.indexPrivilegeForm.deleteSpacePrivilegeAriaLabel",{defaultMessage:"Delete index privilege"}),color:"danger",onClick:this.props.onDelete,iconType:"trash"})))))}}class index_privileges_IndexPrivileges extends l.Component{constructor(e){super(e),p()(this,"addIndexPrivilege",(()=>{const{role:e}=this.props,t=[...e.elasticsearch.indices,{names:[],privileges:[],field_security:{grant:["*"]}}];this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:t}})})),p()(this,"onIndexPrivilegeChange",(e=>t=>{const{role:i}=this.props,{indices:s}=i.elasticsearch,a=[...s];a[e]=t,this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:a}})})),p()(this,"onIndexPrivilegeDelete",(e=>()=>{const{role:t}=this.props,i=[...t.elasticsearch.indices];i.splice(e,1),this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:i}})})),p()(this,"isPlaceholderPrivilege",(e=>0===e.names.length)),this.state={availableFields:{}}}render(){const{indices:e=[]}=this.props.role.elasticsearch,{indexPatterns:t,license:i,availableIndexPrivileges:s,indicesAPIClient:r}=this.props,{allowRoleDocumentLevelSecurity:n,allowRoleFieldLevelSecurity:o}=i.getFeatures(),c={indexPatterns:t,indicesAPIClient:r,allowDocumentLevelSecurity:n||!Object(d.g)(this.props.role),allowFieldLevelSecurity:o||!Object(d.g)(this.props.role),isRoleReadOnly:Object(d.h)(this.props.role)},u=e.map(((e,t)=>Object(j.jsx)(index_privilege_form_IndexPrivilegeForm,a()({key:t},c,{formIndex:t,validator:this.props.validator,availableIndexPrivileges:s,indexPrivilege:e,onChange:this.onIndexPrivilegeChange(t),onDelete:this.onIndexPrivilegeDelete(t)}))));return Object(j.jsx)(l.Fragment,null,u)}}class elasticsearch_privileges_ElasticsearchPrivileges extends l.Component{constructor(...e){super(...e),p()(this,"getForm",(()=>{const{role:e,indicesAPIClient:t,docLinks:i,validator:s,onChange:a,editable:n,indexPatterns:u,license:d,builtinESPrivileges:g}=this.props,p={role:e,indicesAPIClient:t,validator:s,indexPatterns:u,license:d,onChange:a,availableIndexPrivileges:g.index};return Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiDescribedFormGroup,{title:Object(j.jsx)("h3",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.clusterPrivilegesTitle",defaultMessage:"Cluster privileges"})),description:Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.manageRoleActionsDescription",defaultMessage:"Manage the actions this role can perform against your cluster. "}),this.learnMore(i.links.security.clusterPrivileges))},Object(j.jsx)(r.EuiFormRow,{fullWidth:!0,hasEmptyLabelSpace:!0},Object(j.jsx)(cluster_privileges_ClusterPrivileges,{role:this.props.role,onChange:this.onClusterPrivilegesChange,builtinClusterPrivileges:g.cluster}))),Object(j.jsx)(r.EuiSpacer,null),Object(j.jsx)(r.EuiDescribedFormGroup,{title:Object(j.jsx)("h3",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.runAsPrivilegesTitle",defaultMessage:"Run As privileges"})),description:Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.howToBeSubmittedOnBehalfOfOtherUsersDescription",defaultMessage:"Allow requests to be submitted on the behalf of other users. "}),this.learnMore(i.links.security.runAsPrivilege))},Object(j.jsx)(r.EuiFormRow,{hasEmptyLabelSpace:!0},Object(j.jsx)(r.EuiComboBox,{placeholder:this.props.editable?o.i18n.translate("xpack.security.management.editRole.elasticSearchPrivileges.addUserTitle",{defaultMessage:"Add a userâ€¦"}):void 0,options:this.props.runAsUsers.map((e=>({id:e,label:e,isGroupLabelOption:!1}))),selectedOptions:this.props.role.elasticsearch.run_as.map((e=>({label:e}))),onCreateOption:this.onCreateRunAsOption,onChange:this.onRunAsUserChange,isDisabled:!n}))),Object(j.jsx)(r.EuiSpacer,null),Object(j.jsx)(r.EuiTitle,{size:"xs"},Object(j.jsx)("h3",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.indexPrivilegesTitle",defaultMessage:"Index privileges"}))),Object(j.jsx)(r.EuiSpacer,{size:"s"}),Object(j.jsx)(r.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.controlAccessToClusterDataDescription",defaultMessage:"Control access to the data in your cluster. "}),this.learnMore(i.links.security.indicesPrivileges))),Object(j.jsx)(index_privileges_IndexPrivileges,p),Object(j.jsx)(r.EuiHorizontalRule,null),this.props.editable&&Object(j.jsx)(r.EuiButton,{iconType:"plusInCircle",onClick:this.addIndexPrivilege},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.addIndexPrivilegesButtonLabel",defaultMessage:"Add index privilege"})))})),p()(this,"learnMore",(e=>Object(j.jsx)(r.EuiLink,{className:"editRole__learnMore",href:e,target:"_blank"},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.learnMoreLinkText",defaultMessage:"Learn more"})))),p()(this,"addIndexPrivilege",(()=>{const{role:e}=this.props,t=[...e.elasticsearch.indices,{names:[],privileges:[],field_security:{grant:["*"]}}];this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:t}})})),p()(this,"onClusterPrivilegesChange",(e=>{const t={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,cluster:e}};this.props.onChange(t)})),p()(this,"onRunAsUserChange",(e=>{const t={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,run_as:e.map((e=>e.label))}};this.props.onChange(t)})),p()(this,"onCreateRunAsOption",(e=>{const t=this.props.role.elasticsearch.run_as.concat(e),i={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,run_as:t}};this.props.onChange(i)}))}render(){return Object(j.jsx)(collapsible_panel_CollapsiblePanel,{iconType:"logoElasticsearch",title:"Elasticsearch"},this.getForm())}}const F="none",O="custom";i(246);const y=({feature:e})=>{let t=null;if(e.getPrivilegesTooltip()){const i=Object(j.jsx)(r.EuiText,null,Object(j.jsx)("p",null,e.getPrivilegesTooltip()));t=Object(j.jsx)(r.EuiIconTip,{iconProps:{className:"eui-alignTop"},type:"iInCircle",color:"subdued",content:i})}return Object(j.jsx)("span",{"data-test-subj":"featureTableCell"},e.name," ",t)};i(255);class change_all_privileges_ChangeAllPrivilegesControl extends l.Component{constructor(...e){super(...e),p()(this,"state",{isPopoverOpen:!1}),p()(this,"onSelectPrivilege",(e=>{this.props.onChange(e),this.setState({isPopoverOpen:!1})})),p()(this,"onButtonClick",(()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})})),p()(this,"closePopover",(()=>{this.setState({isPopoverOpen:!1})}))}render(){const e=Object(j.jsx)(r.EuiLink,{onClick:this.onButtonClick,className:"secPrivilegeFeatureChangeAllLink","data-test-subj":"changeAllPrivilegesButton"},Object(j.jsx)(r.EuiText,{size:"xs"},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.changeAllPrivilegesLink",defaultMessage:"Bulk actions"})," ",Object(j.jsx)(r.EuiIcon,{size:"s",type:"arrowDown"}))),t=this.props.privileges.map((e=>Object(j.jsx)(r.EuiContextMenuItem,{key:e.id,"data-test-subj":`changeAllPrivileges-${e.id}`,onClick:()=>{this.onSelectPrivilege(e.id)},disabled:this.props.disabled},v.a.upperFirst(e.id))));return t.push(Object(j.jsx)(r.EuiContextMenuItem,{key:F,"data-test-subj":"changeAllPrivileges-none",onClick:()=>{this.onSelectPrivilege(F)},disabled:this.props.disabled},v.a.upperFirst(F))),Object(j.jsx)(r.EuiPopover,{id:"changeAllFeaturePrivilegesPopover",button:e,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(j.jsx)(r.EuiContextMenuPanel,{items:t}))}}const S=e=>{const t=e.subFeature.getPrivilegeGroups().filter((e=>e.privileges.length>0));return 0===t.length?null:Object(j.jsx)(r.EuiFlexGroup,null,Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiText,{size:"s"},e.subFeature.name)),Object(j.jsx)(r.EuiFlexItem,null,t.map((function(t,i){switch(t.groupType){case"independent":return function(t,i){return Object(j.jsx)("div",{key:i},t.privileges.map((t=>{const i=e.privilegeCalculator.isIndependentSubFeaturePrivilegeGranted(e.featureId,t.id,e.privilegeIndex);return Object(j.jsx)(r.EuiCheckbox,{key:t.id,id:`${e.featureId}_${t.id}`,label:t.name,"data-test-subj":"independentSubFeaturePrivilegeControl",onChange:i=>{const{checked:s}=i.target;s?e.onChange([...e.selectedFeaturePrivileges,t.id]):e.onChange(e.selectedFeaturePrivileges.filter((e=>e!==t.id)))},checked:i,disabled:e.disabled,compressed:!0})})))}(t,i);case"mutually_exclusive":return function(t,i){var s;const a=e.privilegeCalculator.getSelectedMutuallyExclusiveSubFeaturePrivilege(e.featureId,t,e.privilegeIndex),l=[...t.privileges.map(((t,i)=>({id:t.id,label:t.name,isDisabled:e.disabled})))];return l.push({id:F,label:"None",isDisabled:e.disabled}),Object(j.jsx)(r.EuiButtonGroup,{key:i,buttonSize:"compressed","data-test-subj":"mutexSubFeaturePrivilegeControl",options:l,idSelected:null!==(s=null==a?void 0:a.id)&&void 0!==s?s:F,isDisabled:e.disabled,onChange:i=>{const s=e.selectedFeaturePrivileges.filter((e=>!t.privileges.some((t=>t.id===e))));i===F?e.onChange(s):e.onChange([...s,i])},legend:o.i18n.translate("xpack.security.management.editRole.subFeatureForm.controlLegendText",{defaultMessage:"{subFeatureName} sub-feature privilege",values:{subFeatureName:e.subFeature.name}})})}(t,i);default:throw new Error(`Unsupported privilege group type: ${t.groupType}`)}}))))},C=({feature:e,onChange:t,privilegeIndex:i,privilegeCalculator:s,selectedFeaturePrivileges:a,disabled:n})=>{const[o,u]=Object(l.useState)((()=>e.getMinimalFeaturePrivileges().some((e=>a.includes(e.id)))));Object(l.useEffect)((()=>{!e.getMinimalFeaturePrivileges().some((e=>a.includes(e.id)))&&o&&u(!1)}),[e,o,a]);return Object(j.jsx)(r.EuiFlexGroup,{direction:"column"},Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiSwitch,{label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.featureTable.customizeSubFeaturePrivilegesSwitchLabel",defaultMessage:"Customize sub-feature privileges"}),checked:o,onChange:a=>{t(e.id,s.updateSelectedFeaturePrivilegesForCustomization(e.id,i,a.target.checked)),u(a.target.checked)},"data-test-subj":"customizeSubFeaturePrivileges",disabled:n||!s.canCustomizeSubFeaturePrivileges(e.id,i)})),e.getSubFeatures().map((l=>Object(j.jsx)(r.EuiFlexItem,{key:l.name},Object(j.jsx)(S,{privilegeCalculator:s,privilegeIndex:i,featureId:e.id,subFeature:l,onChange:i=>t(e.id,i),selectedFeaturePrivileges:a,disabled:n||!o})))))};class feature_table_FeatureTable extends l.Component{constructor(e){super(e),p()(this,"featureCategories",new Map),p()(this,"renderPrivilegeControlsForFeature",(e=>{const t=(t,i,s)=>{var a;const{canCustomizeSubFeaturePrivileges:l}=this.props,n=e.getSubFeaturePrivileges().length>0;return Object(j.jsx)(r.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(j.jsx)(r.EuiFlexItem,{grow:!1},s),Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiAccordion,{id:`featurePrivilegeControls_${e.id}`,"data-test-subj":"featurePrivilegeControls",buttonContent:t,extraAction:i,forceState:l&&n?void 0:"closed",arrowDisplay:l&&n?"left":"none"},Object(j.jsx)("div",{className:"subFeaturePrivilegeExpandedRegion"},Object(j.jsx)(C,{feature:e,privilegeIndex:this.props.privilegeIndex,onChange:this.props.onChange,privilegeCalculator:this.props.privilegeCalculator,selectedFeaturePrivileges:null!==(a=this.props.role.kibana[this.props.privilegeIndex].feature[e.id])&&void 0!==a?a:[],disabled:this.props.disabled})))))},i=e.getPrimaryFeaturePrivileges();if(e.reserved&&0===i.length){return t(Object(j.jsx)(n.a.Fragment,null,Object(j.jsx)(r.EuiIcon,{type:"empty",size:"l"})," ",Object(j.jsx)(y,{feature:e})),Object(j.jsx)(r.EuiText,{style:{maxWidth:200},size:"xs","data-test-subj":"reservedFeatureDescription"},e.reserved.description),Object(j.jsx)(r.EuiIcon,{type:"empty"}))}if(0===i.length)return null;const s=this.props.privilegeCalculator.getDisplayedPrimaryFeaturePrivilegeId(e.id,this.props.privilegeIndex),a=i.map((t=>({id:`${e.id}_${t.id}`,label:t.name,isDisabled:this.props.disabled})));a.push({id:`${e.id}_none`,label:"None",isDisabled:this.props.disabled});let l=Object(j.jsx)(r.EuiIconTip,{type:"empty",content:null});this.props.privilegeCalculator.hasCustomizedSubFeaturePrivileges(e.id,this.props.privilegeIndex)&&(l=Object(j.jsx)(r.EuiIconTip,{type:"alert",content:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.featureTable.privilegeCustomizationTooltip",defaultMessage:"Feature has customized sub-feature privileges. Expand this row for more information."})}));const{canCustomizeSubFeaturePrivileges:u}=this.props,d=e.getSubFeaturePrivileges().length>0,g=u&&d;return t(Object(j.jsx)(n.a.Fragment,null,!g&&Object(j.jsx)(r.EuiIcon,{type:"empty",size:"l"})," ",Object(j.jsx)(y,{feature:e})),Object(j.jsx)(r.EuiButtonGroup,{name:`featurePrivilege_${e.id}`,"data-test-subj":"primaryFeaturePrivilegeControl",isFullWidth:!0,options:a,idSelected:`${e.id}_${null!=s?s:F}`,onChange:this.onChange(e.id),legend:o.i18n.translate("xpack.security.management.editRole.featureTable.actionLegendText",{defaultMessage:"{featureName} feature privilege",values:{featureName:e.name}}),style:{minWidth:200}}),l)})),p()(this,"onChange",(e=>t=>{const i=t.substr(`${e}_`.length);i===F?this.props.onChange(e,[]):this.props.onChange(e,[i])})),p()(this,"onChangeAllFeaturePrivileges",(e=>{e===F?this.props.onChangeAll([]):this.props.onChangeAll([e])})),p()(this,"getCategoryHelpText",(e=>{if("management"===e.id)return o.i18n.translate("xpack.security.management.editRole.featureTable.managementCategoryHelpText",{defaultMessage:"Access to Stack Management is determined by both Elasticsearch and Kibana privileges, and cannot be explicitly disabled."})})),e.kibanaPrivileges.getSecuredFeatures().filter((e=>null!=e.privileges||null!=e.reserved)).forEach((e=>{this.featureCategories.has(e.category.id)||this.featureCategories.set(e.category.id,[]),this.featureCategories.get(e.category.id).push(e)}))}render(){const e=this.props.kibanaPrivileges.getBasePrivileges(this.props.role.kibana[this.props.privilegeIndex]),t=[];return this.featureCategories.forEach((e=>{var i;const{category:s}=e[0],a=e.length,l=e.filter((e=>null!=this.props.privilegeCalculator.getEffectivePrimaryFeaturePrivilege(e.id,this.props.privilegeIndex))).length,c=Object(j.jsx)(r.EuiFlexGroup,{"data-test-subj":`featureCategoryButton_${s.id}`,alignItems:"center",responsive:!1,gutterSize:"m"},s.euiIconType?Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(r.EuiIcon,{size:"m",type:s.euiIconType})):null,Object(j.jsx)(r.EuiFlexItem,{grow:1},Object(j.jsx)(r.EuiTitle,{size:"xs"},Object(j.jsx)("h4",{className:"eui-displayInlineBlock"},s.label)))),u=o.i18n.translate("xpack.security.management.editRole.featureTable.featureAccordionSwitchLabel",{defaultMessage:"{grantedCount} / {featureCount} {featureCount, plural, one {feature} other {features}} granted",values:{grantedCount:l,featureCount:a}}),d=Object(j.jsx)(r.EuiText,{size:"s","aria-hidden":"true",color:"subdued","data-test-subj":"categoryLabel"},u),g=this.getCategoryHelpText(s),p=Object(j.jsx)(r.EuiAccordion,{id:`featureCategory_${s.id}`,"data-test-subj":`featureCategory_${s.id}`,key:s.id,arrowDisplay:"left",forceState:void 0,buttonContent:c,extraAction:d},Object(j.jsx)("div",null,Object(j.jsx)(r.EuiSpacer,{size:"s"}),g&&Object(j.jsx)(n.a.Fragment,null,Object(j.jsx)(r.EuiCallOut,{iconType:"iInCircle",size:"s"},g),Object(j.jsx)(r.EuiSpacer,{size:"s"})),Object(j.jsx)(r.EuiFlexGroup,{direction:"column",gutterSize:"s"},e.map((e=>Object(j.jsx)(r.EuiFlexItem,{key:e.id},this.renderPrivilegeControlsForFeature(e)))))));t.push({order:null!==(i=s.order)&&void 0!==i?i:Number.MAX_SAFE_INTEGER,element:p})})),t.sort(((e,t)=>e.order-t.order)),Object(j.jsx)("div",null,Object(j.jsx)(r.EuiFlexGroup,{alignItems:"flexEnd"},Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiText,{size:"xs"},Object(j.jsx)("b",null,o.i18n.translate("xpack.security.management.editRole.featureTable.featureVisibilityTitle",{defaultMessage:"Customize feature privileges"})))),!this.props.disabled&&Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(change_all_privileges_ChangeAllPrivilegesControl,{privileges:e,onChange:this.onChangeAllFeaturePrivileges}))),Object(j.jsx)(r.EuiHorizontalRule,{margin:"m"}),t.flatMap(((e,t)=>[e.element,Object(j.jsx)(r.EuiHorizontalRule,{key:`accordion-hr-${t}`,margin:"m"})])))}}p()(feature_table_FeatureTable,"defaultProps",{privilegeIndex:-1,showLocks:!0});class privilege_form_calculator_PrivilegeFormCalculator{constructor(e,t){this.kibanaPrivileges=e,this.role=t}getBasePrivilege(e){const t=this.role.kibana[e];return this.kibanaPrivileges.getBasePrivileges(t).find((e=>t.base.includes(e.id)))}getDisplayedPrimaryFeaturePrivilegeId(e,t){var i;return null===(i=this.getDisplayedPrimaryFeaturePrivilege(e,t))||void 0===i?void 0:i.id}hasCustomizedSubFeaturePrivileges(e,t){const i=this.kibanaPrivileges.getSecuredFeature(e),s=this.getDisplayedPrimaryFeaturePrivilege(e,t),a=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([this.role.kibana[t]]);return i.getSubFeaturePrivileges().some((e=>{var t;const i=a.grantsPrivilege(e);return i!==(null!==(t=null==s?void 0:s.grantsPrivilege(e))&&void 0!==t?t:i)}))}getEffectivePrimaryFeaturePrivilege(e,t){const i=this.kibanaPrivileges.getSecuredFeature(e),s=this.getBasePrivilege(t),a=this.getSelectedFeaturePrivileges(e,t);return i.getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:!0}).find((e=>a.includes(e.id)||(null==s?void 0:s.grantsPrivilege(e))))}isIndependentSubFeaturePrivilegeGranted(e,t,i){const s=this.role.kibana[i],a=this.kibanaPrivileges.getSecuredFeature(e).getSubFeaturePrivileges().find((e=>e.id===t));return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([s]).grantsPrivilege(a)}getSelectedMutuallyExclusiveSubFeaturePrivilege(e,t,i){const s=this.role.kibana[i],a=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([s]);return t.privileges.find((e=>a.grantsPrivilege(e)))}canCustomizeSubFeaturePrivileges(e,t){const i=this.getSelectedFeaturePrivileges(e,t);return this.kibanaPrivileges.getSecuredFeature(e).getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:!0}).some((e=>i.includes(e.id)))}updateSelectedFeaturePrivilegesForCustomization(e,t,i){const s=this.getDisplayedPrimaryFeaturePrivilege(e,t),a=this.getSelectedFeaturePrivileges(e,t);if(!s)return a;const r=[];if(i){const t=this.kibanaPrivileges.getSecuredFeature(e).getSubFeaturePrivileges().filter((e=>s.grantsPrivilege(e))).map((e=>e.id));r.push(s.getMinimalPrivilegeId(),...t)}else r.push(s.id);return r}hasSupersededInheritedPrivileges(e){const t=this.locateGlobalPrivilege(this.role),i=this.role.kibana[e];if(Object(m.a)(i)||!t)return!1;const s=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([t]),a=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([i]),r=this.kibanaPrivileges.getBasePrivileges(i).some((e=>i.base.includes(e.id))),l=this.kibanaPrivileges.getSecuredFeatures().filter((e=>e.getAllPrivileges().some((t=>{var s;return null===(s=i.feature[e.id])||void 0===s?void 0:s.includes(t.id)})))),n=r&&this.kibanaPrivileges.getBasePrivileges(i).some((e=>s.grantsPrivilege(e)&&!a.grantsPrivilege(e))),o=l.some((e=>e.getAllPrivileges().some((e=>s.grantsPrivilege(e)&&!a.grantsPrivilege(e)))));return n||o}getDisplayedPrimaryFeaturePrivilege(e,t){const i=this.kibanaPrivileges.getSecuredFeature(e),s=this.getBasePrivilege(t),a=this.getSelectedFeaturePrivileges(e,t);return i.getPrimaryFeaturePrivileges().find((e=>{const t=e.getMinimalPrivilegeId(),r=i.getMinimalFeaturePrivileges().find((e=>e.id===t)),l=i.subFeatures.length>0&&e.grantsPrivilege(r);return a.includes(e.id)||l&&a.includes(t)||(null==s?void 0:s.grantsPrivilege(e))}))}getSelectedFeaturePrivileges(e,t){var i;return null!==(i=this.role.kibana[t].feature[e])&&void 0!==i?i:[]}locateGlobalPrivilege(e){return e.kibana.find((e=>Object(m.a)(e)))}}class unsupported_space_privileges_warning_UnsupportedSpacePrivilegesWarning extends l.Component{constructor(...e){super(...e),p()(this,"getMessage",(()=>Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.unsupportedSpacePrivilegesWarning",defaultMessage:"This role contains privilege definitions for spaces, but spaces are not enabled in Kibana. Saving this role will remove these privileges."})))}render(){return Object(j.jsx)(r.EuiCallOut,{iconType:"alert",color:"warning",title:this.getMessage()})}}class simple_privilege_section_SimplePrivilegeSection extends l.Component{constructor(e){super(e),p()(this,"getDisplayedBasePrivilege",(()=>{if(this.state.isCustomizingGlobalPrivilege)return O;const{role:e}=this.props,t=this.locateGlobalPrivilege(e);return t&&t.base.length>0?t.base[0]:F})),p()(this,"onKibanaPrivilegeChange",(e=>{const t=Object(d.b)(this.props.role),i=this.locateGlobalPrivilege(t)||this.createGlobalPrivilegeEntry(t);e===F?t.kibana=t.kibana.filter((e=>!Object(m.a)(e))):e===O?i.base=[]:(i.base=[e],i.feature={}),this.props.onChange(t),this.setState({isCustomizingGlobalPrivilege:e===O,globalPrivsIndex:t.kibana.indexOf(i)})})),p()(this,"onFeaturePrivilegeChange",((e,t)=>{const i=Object(d.b)(this.props.role),s=this.locateGlobalPrivilege(i)||this.createGlobalPrivilegeEntry(i);t.length>0?s.feature[e]=[...t]:delete s.feature[e],this.props.onChange(i)})),p()(this,"onChangeAllFeaturePrivileges",(e=>{const t=Object(d.b)(this.props.role),i=this.locateGlobalPrivilege(t)||this.createGlobalPrivilegeEntry(t);e.length>0?this.props.kibanaPrivileges.getSecuredFeatures().forEach((t=>{i.feature[t.id]=[...e]})):i.feature={},this.props.onChange(t)})),p()(this,"maybeRenderSpacePrivilegeWarning",(()=>this.props.role.kibana.some((e=>!Object(m.a)(e)))?Object(j.jsx)(r.EuiFormRow,{fullWidth:!0},Object(j.jsx)(unsupported_space_privileges_warning_UnsupportedSpacePrivilegesWarning,null)):null)),p()(this,"locateGlobalPrivilegeIndex",(e=>e.kibana.findIndex((e=>Object(m.a)(e))))),p()(this,"locateGlobalPrivilege",(e=>e.kibana.find((e=>Object(m.a)(e)))));const t=this.locateGlobalPrivilege(e.role),i=this.locateGlobalPrivilegeIndex(e.role);this.state={isCustomizingGlobalPrivilege:Boolean(t&&Object.keys(t.feature).length>0),globalPrivsIndex:i}}render(){var e,t;const i=this.getDisplayedBasePrivilege(),s=null!==(e=null===(t=this.props.role.kibana[this.state.globalPrivsIndex])||void 0===t?void 0:t._reserved)&&void 0!==e?e:[],a=Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.kibanaPrivilegesTitle",defaultMessage:"Kibana privileges"}),n=Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.specifyPrivilegeForRoleDescription",defaultMessage:"Specifies the Kibana privilege for this role."}));return Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiFlexGroup,{direction:"column"},Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiText,{size:"s",color:"subdued"},n)),Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiFormRow,{label:a},s.length>0?Object(j.jsx)(r.EuiComboBox,{fullWidth:!0,selectedOptions:s.map((e=>({label:e}))),isDisabled:!0}):Object(j.jsx)(r.EuiSuperSelect,{disabled:!this.props.editable,onChange:this.onKibanaPrivilegeChange,options:[{value:F,inputDisplay:Object(j.jsx)(r.EuiText,null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeInput",defaultMessage:"None"})),dropdownDisplay:Object(j.jsx)(r.EuiText,null,Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeDropdown",defaultMessage:"None"})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeDropdownDescription",defaultMessage:"No access to Kibana"})))},{value:O,inputDisplay:Object(j.jsx)(r.EuiText,null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeInput",defaultMessage:"Custom"})),dropdownDisplay:Object(j.jsx)(r.EuiText,null,Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeDropdown",defaultMessage:"Custom"})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeDropdownDescription",defaultMessage:"Customize access to Kibana"})))},{value:"read",inputDisplay:Object(j.jsx)(r.EuiText,null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeInput",defaultMessage:"Read"})),dropdownDisplay:Object(j.jsx)(r.EuiText,null,Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeDropdown",defaultMessage:"Read"})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeDropdownDescription",defaultMessage:"Grants read-only access to all of Kibana"})))},{value:"all",inputDisplay:Object(j.jsx)(r.EuiText,null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeInput",defaultMessage:"All"})),dropdownDisplay:Object(j.jsx)(r.EuiText,null,Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeDropdown",defaultMessage:"All"})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeDropdownDescription",defaultMessage:"Grants full access to all of Kibana"})))}],hasDividers:!0,valueOfSelected:i})),this.state.isCustomizingGlobalPrivilege&&Object(j.jsx)(r.EuiFormRow,{fullWidth:!0},Object(j.jsx)(feature_table_FeatureTable,{role:this.props.role,kibanaPrivileges:this.props.kibanaPrivileges,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,this.props.role),onChange:this.onFeaturePrivilegeChange,onChangeAll:this.onChangeAllFeaturePrivileges,privilegeIndex:this.props.role.kibana.findIndex((e=>Object(m.a)(e))),canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges})),this.maybeRenderSpacePrivilegeWarning())))}createGlobalPrivilegeEntry(e){const t={spaces:["*"],base:[],feature:{}};return e.kibana.push(t),t}}class privilege_summary_calculator_PrivilegeSummaryCalculator{constructor(e,t){this.kibanaPrivileges=e,this.role=t}getEffectiveFeaturePrivileges(e){const t=this.collectAssignedPrivileges(e);return this.kibanaPrivileges.getSecuredFeatures().reduce(((i,s)=>{const a=this.getDisplayedPrimaryFeaturePrivilege(t,s),r=s.getSubFeaturePrivileges().filter((e=>t.grantsPrivilege(e))),l=this.hasCustomizedSubFeaturePrivileges(s,a,e);return{...i,[s.id]:{primary:a,hasCustomizedSubFeaturePrivileges:l,subFeature:r.map((e=>e.id))}}}),{})}hasCustomizedSubFeaturePrivileges(e,t,i){const s=this.collectAssignedPrivileges(i);return e.getSubFeaturePrivileges().some((e=>{var i;const a=s.grantsPrivilege(e);return a!==(null!==(i=null==t?void 0:t.grantsPrivilege(e))&&void 0!==i?i:a)}))}getDisplayedPrimaryFeaturePrivilege(e,t){const i=t.getPrimaryFeaturePrivileges(),s=t.getMinimalFeaturePrivileges(),a=t.subFeatures.length>0;return i.find((t=>{const i=e.grantsPrivilege(t);if(!i&&a){const i=s.find((e=>e.id===t.getMinimalPrivilegeId()));return e.grantsPrivilege(i)}return i}))}collectAssignedPrivileges(e){if(Object(m.a)(e))return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([e]);const t=this.locateGlobalPrivilege(this.role);return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges(t?[t,e]:[e])}locateGlobalPrivilege(e){return e.kibana.find((e=>Object(m.a)(e)))}}const E=e=>Object(j.jsx)(r.EuiFlexGroup,{direction:"column"},e.feature.getSubFeatures().map((t=>Object(j.jsx)(r.EuiFlexItem,{key:t.name,"data-test-subj":"subFeatureEntry"},Object(j.jsx)(r.EuiFlexGroup,null,Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiText,{size:"s","data-test-subj":"subFeatureName"},t.name)),e.effectiveFeaturePrivileges.map(((e,i)=>{return Object(j.jsx)(r.EuiFlexItem,{key:i,"data-test-subj":`entry-${i}`},t.getPrivilegeGroups().map((s=e.subFeature,(e,t)=>{switch(e.groupType){case"independent":return function(e,t,i){return Object(j.jsx)("div",{key:i},t.privileges.map((t=>{const i=e.includes(t.id);return Object(j.jsx)(r.EuiFlexGroup,{gutterSize:"s","data-test-subj":"independentPrivilege",key:t.id},Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(r.EuiIconTip,{type:i?"check":"cross",color:i?"primary":"danger",content:i?o.i18n.translate("xpack.security.management.editRole.privilegeSummary.privilegeGrantedIconTip",{defaultMessage:"Privilege is granted"}):o.i18n.translate("xpack.security.management.editRole.privilegeSummary.privilegeNotGrantedIconTip",{defaultMessage:"Privilege is not granted"})})),Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiText,{size:"s","data-test-subj":"privilegeName"},t.name)))})))}(s,e,t);case"mutually_exclusive":return function(e,t,i){var s;const a=null===(s=t.privileges.find((t=>e.includes(t.id))))||void 0===s?void 0:s.name;return Object(j.jsx)(r.EuiFlexGroup,{gutterSize:"s",key:i,"data-test-subj":"mutexPrivilege"},Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(r.EuiIconTip,{type:a?"check":"cross",color:a?"primary":"danger",content:a?"Privilege is granted":"Privilege is not granted"})),Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(r.EuiText,{size:"s","data-test-subj":"privilegeName"},null!=a?a:"None")))}(s,e,t);default:throw new Error(`Unsupported privilege group type: ${e.groupType}`)}})));var s})))))));i(264);var _=i(55);class spaces_popover_list_SpacesPopoverList extends l.Component{constructor(...e){super(...e),p()(this,"state",{searchTerm:"",allowSpacesListFocus:!1,isPopoverOpen:!1}),p()(this,"getMenuPanel",(()=>{const{searchTerm:e}=this.state,t=this.getVisibleSpaces(e).map(this.renderSpaceMenuItem),i={className:"spcMenu",title:o.i18n.translate("xpack.security.management.editRole.spacesPopoverList.popoverTitle",{defaultMessage:"Spaces"}),watchedItemProps:["data-search-term"]};return this.props.spaces.length>=_.SPACE_SEARCH_COUNT_THRESHOLD?Object(j.jsx)(r.EuiContextMenuPanel,i,this.renderSearchField(),this.renderSpacesListPanel(t,e)):Object(j.jsx)(r.EuiContextMenuPanel,a()({},i,{items:t}))})),p()(this,"onButtonClick",(()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen,searchTerm:""})})),p()(this,"closePopover",(()=>{this.setState({isPopoverOpen:!1,searchTerm:""})})),p()(this,"getVisibleSpaces",(e=>{const{spaces:t}=this.props;let i=t;return e&&(i=t.filter((t=>{const{name:i,description:s=""}=t;return i.toLowerCase().indexOf(e)>=0||s.toLowerCase().indexOf(e)>=0}))),i})),p()(this,"renderSpacesListPanel",((e,t)=>0===e.length?Object(j.jsx)(r.EuiText,{color:"subdued",className:"eui-textCenter"},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacesPopoverList.noSpacesFoundTitle",defaultMessage:" no spaces found "})):Object(j.jsx)(r.EuiContextMenuPanel,{key:"spcMenuList","data-search-term":t,className:"spcMenu__spacesList",hasFocus:this.state.allowSpacesListFocus,initialFocusedItemIndex:this.state.allowSpacesListFocus?0:void 0,items:e}))),p()(this,"renderSearchField",(()=>Object(j.jsx)("div",{key:"manageSpacesSearchField",className:"spcMenu__searchFieldWrapper"},Object(j.jsx)(r.EuiFieldSearch,{placeholder:o.i18n.translate("xpack.security.management.editRole.spacesPopoverList.findSpacePlaceholder",{defaultMessage:"Find a space"}),incremental:!0,onSearch:this.onSearch,onKeyDown:this.onSearchKeyDown,onFocus:this.onSearchFocus,compressed:!0})))),p()(this,"onSearchKeyDown",(e=>{const t=e.keyCode;[9,13,40].includes(t)&&this.setState({allowSpacesListFocus:!0})})),p()(this,"onSearchFocus",(()=>{this.setState({allowSpacesListFocus:!1})})),p()(this,"onSearch",(e=>{this.setState({searchTerm:e.trim().toLowerCase()})})),p()(this,"renderSpaceMenuItem",(e=>{const t=Object(l.memo)(this.props.spacesApiUi.components.getSpaceAvatar),i=Object(j.jsx)(t,{space:e,size:"s"});return Object(j.jsx)(r.EuiContextMenuItem,{key:e.id,icon:i,toolTipTitle:e.description&&e.name,toolTipContent:e.description},e.name)}))}render(){const e=Object(j.jsx)(r.EuiButtonEmpty,{size:"xs",onClick:this.onButtonClick},Object(j.jsx)("span",{className:"secSpacesPopoverList__buttonText"},this.props.buttonText));return Object(j.jsx)(r.EuiPopover,{id:"spacesPopoverList",button:e,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft",ownFocus:!0},this.getMenuPanel())}}const k=e=>{const{spacesApiUi:t}=e,i=Object(m.a)(e.entry),s=e.entry.spaces.map((t=>{var i;return null!==(i=e.spaces.find((e=>e.id===t)))&&void 0!==i?i:{id:t,name:t,disabledFeatures:[]}})),a=Object(l.useMemo)((()=>t.components.getSpaceAvatar),[t]);return Object(j.jsx)("div",null,s.slice(0,4).map((e=>Object(j.jsx)("span",{key:e.id},Object(j.jsx)(a,{size:"s",space:e})," ",i&&Object(j.jsx)("span",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeMatrix.globalSpaceName",defaultMessage:"All Spaces"}))))),s.length>4&&Object(j.jsx)(l.Fragment,null,Object(j.jsx)("br",null),Object(j.jsx)(spaces_popover_list_SpacesPopoverList,{spaces:s,buttonText:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeMatrix.showNMoreSpacesLink",{defaultMessage:"+{count} more",values:{count:s.length-4}}),spacesApiUi:t})))};function M(e){return`privilege_entry_${e.spaces.join("|")}`}const I=e=>{const[t,i]=Object(l.useState)([]),s=Object(l.useMemo)((()=>{const t=new Map;return e.kibanaPrivileges.getSecuredFeatures().filter((e=>null!=e.privileges||null!=e.reserved)).forEach((e=>{t.has(e.category.id)||t.set(e.category.id,[]),t.get(e.category.id).push(e)})),t}),[e.kibanaPrivileges]),a=new privilege_summary_calculator_PrivilegeSummaryCalculator(e.kibanaPrivileges,e.role),o={name:"Feature",field:"feature",render:e=>Object(j.jsx)(y,{feature:e})},u={align:"right",width:"40px",isExpander:!0,field:"featureId",name:"",render:(e,s)=>s.feature.getSubFeaturePrivileges().length>0?Object(j.jsx)(r.EuiButtonIcon,{onClick:()=>(e=>{t.includes(e)?i(t.filter((t=>t!==e))):i([...t,e])})(e),"data-test-subj":"expandPrivilegeSummaryRow","aria-label":t.includes(e)?"Collapse":"Expand",iconType:t.includes(e)?"arrowUp":"arrowDown"}):null},d=[...e.role.kibana].sort(((e,t)=>Object(m.a)(e)?-1:Object(m.a)(t)?1:0)),g=d.map((t=>{const i=M(t);return{name:Object(j.jsx)(k,{entry:t,spaces:e.spaces,spacesApiUi:e.spacesApiUi}),field:i,render:(e,t)=>{var i;const{primary:s,hasCustomizedSubFeaturePrivileges:a}=e[t.featureId];let l=null;return l=a?Object(j.jsx)(r.EuiIconTip,{size:"s",type:"iInCircle",content:Object(j.jsx)("span",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.additionalPrivilegesGrantedIconTip",defaultMessage:"Additional privileges granted. Expand this row for more information."}))}):Object(j.jsx)(r.EuiIcon,{size:"s",type:"empty"}),Object(j.jsx)("span",{"data-test-subj":"privilegeColumn "+(a?"additionalPrivilegesGranted":"")},null!==(i=null==s?void 0:s.name)&&void 0!==i?i:"None"," ",l)}}})),p=[];e.canCustomizeSubFeaturePrivileges&&p.push(u),p.push(o,...g);const h=d.reduce(((e,t)=>({...e,[M(t)]:a.getEffectiveFeaturePrivileges(t)})),{}),b=[];return s.forEach((i=>{const{category:s}=i[0],a=Object(j.jsx)(r.EuiFlexGroup,{"data-test-subj":`featureCategoryButton_${s.id}`,alignItems:"center",responsive:!1,gutterSize:"m"},s.euiIconType?Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(r.EuiIcon,{size:"m",type:s.euiIconType})):null,Object(j.jsx)(r.EuiFlexItem,{grow:1},Object(j.jsx)(r.EuiTitle,{size:"xs"},Object(j.jsx)("h4",{className:"eui-displayInlineBlock"},s.label)))),l=i.map((e=>({feature:e,featureId:e.id,...h})));b.push(Object(j.jsx)(r.EuiAccordion,{id:`privilegeSummaryFeatureCategory_${s.id}`,"data-test-subj":`privilegeSummaryFeatureCategory_${s.id}`,key:s.id,buttonContent:a,initialIsOpen:!0},Object(j.jsx)(r.EuiInMemoryTable,{columns:p,items:l,itemId:"featureId",rowProps:e=>({"data-test-subj":`summaryTableRow-${e.featureId}`}),itemIdToExpandedRowMap:t.reduce(((t,i)=>({...t,[i]:Object(j.jsx)(E,{feature:e.kibanaPrivileges.getSecuredFeature(i),effectiveFeaturePrivileges:Object.values(h).map((e=>e[i]))})})),{})})))})),Object(j.jsx)(n.a.Fragment,null,b.map(((e,t)=>Object(j.jsx)(l.Fragment,{key:t},e,Object(j.jsx)(r.EuiSpacer,null)))))},R=e=>{const[t,i]=Object(l.useState)(!1),s=e.role.kibana.length>5?"l":"m";return Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiButtonEmpty,{onClick:()=>i(!0),"data-test-subj":"viewPrivilegeSummaryButton"},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.viewSummaryButtonText",defaultMessage:"View privilege summary"})),t&&Object(j.jsx)(r.EuiFlyout,{onClose:()=>i(!1),size:s,maskProps:{headerZindexLocation:"below"}},Object(j.jsx)(r.EuiFlyoutHeader,null,Object(j.jsx)(r.EuiTitle,{size:"m"},Object(j.jsx)("h2",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.modalHeaderTitle",defaultMessage:"Privilege summary"})))),Object(j.jsx)(r.EuiFlyoutBody,null,Object(j.jsx)(I,{role:e.role,spaces:e.spaces,kibanaPrivileges:e.kibanaPrivileges,canCustomizeSubFeaturePrivileges:e.canCustomizeSubFeaturePrivileges,spacesApiUi:e.spacesApiUi})),Object(j.jsx)(r.EuiFlyoutFooter,null,Object(j.jsx)(r.EuiButton,{onClick:()=>i(!1)},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.closeSummaryButtonText",defaultMessage:"Close"})))))};var w=i(49);const T=(e,t)=>{if(e)return{id:`spaceOption_${e.id}`,label:e.name,color:Object(w.getSpaceColor)(e),disabled:"global"===t&&"*"!==e.id||"spaces"===t&&"*"===e.id}};class space_selector_SpaceSelector extends l.Component{constructor(...e){super(...e),p()(this,"onChange",(e=>{this.props.onChange(e.map((e=>e.id.split("spaceOption_")[1])))})),p()(this,"getOptions",(()=>this.props.spaces.map((e=>T(e,this.props.selectedSpaceIds.includes("*")?"global":this.props.selectedSpaceIds.length>0?"spaces":void 0))).filter(Boolean))),p()(this,"getSelectedOptions",(()=>{var e;return this.props.selectedSpaceIds.map((e=this.props.spaces,t=>T(e.find((e=>e.id===t))))).filter(Boolean)}))}render(){return Object(j.jsx)(r.EuiComboBox,{"data-test-subj":"spaceSelectorComboBox","aria-label":o.i18n.translate("xpack.security.management.editRole.spaceSelectorLabel",{defaultMessage:"Spaces"}),fullWidth:!0,options:this.getOptions(),renderOption:(e,t,i)=>{const{color:s,label:a}=e;return Object(j.jsx)(r.EuiHealth,{color:s},Object(j.jsx)("span",{className:i},Object(j.jsx)(r.EuiHighlight,{search:t},a)))},selectedOptions:this.getSelectedOptions(),isDisabled:this.props.disabled,onChange:this.onChange})}}class privilege_space_form_PrivilegeSpaceForm extends l.Component{constructor(e){super(e),p()(this,"getForm",(()=>{const{spaces:e}=this.props,t=this.state.selectedSpaceIds.length>0;return Object(j.jsx)(r.EuiForm,null,Object(j.jsx)(r.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.spaceSelectorFormLabel",{defaultMessage:"Spaces"}),helpText:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.spaceSelectorFormHelpText",{defaultMessage:"Select one or more Kibana spaces to which you wish to assign privileges."})},Object(j.jsx)(space_selector_SpaceSelector,{selectedSpaceIds:this.state.selectedSpaceIds,onChange:this.onSelectedSpacesChange,spaces:e})),this.getPrivilegeCallout(),Object(j.jsx)(r.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.privilegeSelectorFormLabel",{defaultMessage:"Privileges for all features"}),helpText:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.privilegeSelectorFormHelpText",{defaultMessage:"Assign the privilege level you wish to grant to all present and future features across this space."})},Object(j.jsx)(r.EuiButtonGroup,{name:"basePrivilegeButtonGroup","data-test-subj":"basePrivilegeButtonGroup",isFullWidth:!0,color:"primary",options:[{id:"basePrivilege_all",label:"All","data-test-subj":"basePrivilege_all"},{id:"basePrivilege_read",label:"Read","data-test-subj":"basePrivilege_read"},{id:"basePrivilege_custom",label:"Customize","data-test-subj":"basePrivilege_custom"}],idSelected:this.getDisplayedBasePrivilege(),isDisabled:!t,onChange:this.onSpaceBasePrivilegeChange,legend:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.basePrivilegeControlLegend",{defaultMessage:"Privileges for all features"})})),Object(j.jsx)(r.EuiSpacer,null),Object(j.jsx)(r.EuiTitle,{size:"xxs"},Object(j.jsx)("h3",null,this.getFeatureListLabel(this.state.selectedBasePrivilege.length>0))),Object(j.jsx)(r.EuiSpacer,{size:"xs"}),Object(j.jsx)(r.EuiText,{size:"s"},Object(j.jsx)("p",null,this.getFeatureListDescription(this.state.selectedBasePrivilege.length>0))),Object(j.jsx)(r.EuiSpacer,{size:"l"}),Object(j.jsx)(feature_table_FeatureTable,{role:this.state.role,privilegeCalculator:this.state.privilegeCalculator,onChange:this.onFeaturePrivilegesChange,onChangeAll:this.onChangeAllFeaturePrivileges,kibanaPrivileges:this.props.kibanaPrivileges,privilegeIndex:this.state.privilegeIndex,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges,disabled:this.state.selectedBasePrivilege.length>0||!t}),this.requiresGlobalPrivilegeWarning()&&Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiSpacer,{size:"l"}),Object(j.jsx)(r.EuiCallOut,{color:"warning",iconType:"alert","data-test-subj":"globalPrivilegeWarning",title:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.globalPrivilegeWarning",defaultMessage:"Creating a global privilege might impact your other space privileges."})})))})),p()(this,"getSaveButton",(()=>{const{mode:e}=this.state,t=this.isDefiningGlobalPrivilege();let i;switch(e){case"create":i=t?Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.createGlobalPrivilegeButton",defaultMessage:"Create global privilege"}):Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.createPrivilegeButton",defaultMessage:"Add Kibana privilege"});break;case"update":i=t?Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.updateGlobalPrivilegeButton",defaultMessage:"Update global privilege"}):Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.updatePrivilegeButton",defaultMessage:"Update space privilege"});break;default:throw new Error(`Unsupported mode: ${e}`)}let s="primary";return this.requiresGlobalPrivilegeWarning()&&(s="warning"),Object(j.jsx)(r.EuiButton,{onClick:this.onSaveClick,fill:!0,disabled:!this.canSave(),color:s,"data-test-subj":"createSpacePrivilegeButton"},i)})),p()(this,"getFeatureListLabel",(e=>e?o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.summaryOfFeaturePrivileges",{defaultMessage:"Summary of feature privileges"}):o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.customizeFeaturePrivileges",{defaultMessage:"Customize by feature"}))),p()(this,"getFeatureListDescription",(e=>e?o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.featurePrivilegeSummaryDescription",{defaultMessage:"Some features might be hidden by the space or affected by a global space privilege."}):o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.customizeFeaturePrivilegeDescription",{defaultMessage:"Increase privilege levels on a per feature basis. Some features might be hidden by the space or affected by a global space privilege."}))),p()(this,"getPrivilegeCallout",(()=>this.isDefiningGlobalPrivilege()?Object(j.jsx)(r.EuiFormRow,{fullWidth:!0},Object(j.jsx)(r.EuiCallOut,{color:"primary",iconType:"iInCircle",title:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.globalPrivilegeNotice",{defaultMessage:"These privileges will apply to all current and future spaces."})})):null)),p()(this,"closeFlyout",(()=>{this.props.onCancel()})),p()(this,"onSaveClick",(()=>{const e=Object(d.b)(this.state.role),t=e.kibana[this.state.privilegeIndex];this.isDefiningGlobalPrivilege()||(t.spaces=t.spaces.filter((e=>this.props.spaces.find((t=>t.id===e))))),this.props.onChange(e)})),p()(this,"onSelectedSpacesChange",(e=>{const t=Object(d.b)(this.state.role);t.kibana[this.state.privilegeIndex].spaces=[...e],this.setState({selectedSpaceIds:e,role:t,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,t)})})),p()(this,"onSpaceBasePrivilegeChange",(e=>{const t=Object(d.b)(this.state.role),i=t.kibana[this.state.privilegeIndex],s=e.split("basePrivilege_")[1];let a=!1;s===O?(i.base=[],a=!0):(i.base=[s],i.feature={}),this.setState({selectedBasePrivilege:s===O?[]:[s],role:t,isCustomizingFeaturePrivileges:a,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,t)})})),p()(this,"getDisplayedBasePrivilege",(()=>{const e=this.state.privilegeCalculator.getBasePrivilege(this.state.privilegeIndex);return e?`basePrivilege_${e.id}`:"basePrivilege_custom"})),p()(this,"onFeaturePrivilegesChange",((e,t)=>{const i=Object(d.b)(this.state.role),s=i.kibana[this.state.privilegeIndex];0===t.length?delete s.feature[e]:s.feature[e]=[...t],this.setState({role:i,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,i)})})),p()(this,"onChangeAllFeaturePrivileges",(e=>{const t=Object(d.b)(this.state.role),i=t.kibana[this.state.privilegeIndex];0===e.length?i.feature={}:this.props.kibanaPrivileges.getSecuredFeatures().forEach((t=>{const s=t.getPrimaryFeaturePrivileges().find((t=>e.includes(t.id)));s&&(i.feature[t.id]=[s.id])})),this.setState({role:t,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,t)})})),p()(this,"canSave",(()=>{if(0===this.state.selectedSpaceIds.length)return!1;const e=this.state.role.kibana[this.state.privilegeIndex];return 0!==e.base.length||0!==Object.keys(e.feature).length})),p()(this,"isDefiningGlobalPrivilege",(()=>this.state.selectedSpaceIds.includes("*"))),p()(this,"requiresGlobalPrivilegeWarning",(()=>{const e=this.props.role.kibana.length>0;return"create"===this.state.mode&&this.isDefiningGlobalPrivilege()&&e}));const t=Object(d.b)(e.role);let i=e.privilegeIndex;i<0&&(i=t.kibana.push({spaces:[],base:[],feature:{}})-1),this.state={role:t,privilegeIndex:i,selectedSpaceIds:[...t.kibana[i].spaces],selectedBasePrivilege:[...t.kibana[i].base||[]],mode:e.privilegeIndex<0?"create":"update",isCustomizingFeaturePrivileges:!1,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(e.kibanaPrivileges,t)}}render(){return Object(j.jsx)(r.EuiFlyout,{onClose:this.closeFlyout,size:"m",maxWidth:!0,maskProps:{headerZindexLocation:"below"}},Object(j.jsx)(r.EuiFlyoutHeader,{hasBorder:!0},Object(j.jsx)(r.EuiTitle,{size:"m"},Object(j.jsx)("h2",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.modalTitle",defaultMessage:"Kibana privileges"})))),Object(j.jsx)(r.EuiFlyoutBody,null,Object(j.jsx)(r.EuiErrorBoundary,null,this.getForm())),Object(j.jsx)(r.EuiFlyoutFooter,null,this.state.privilegeCalculator.hasSupersededInheritedPrivileges(this.state.privilegeIndex)&&Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiCallOut,{color:"warning",iconType:"alert","data-test-subj":"spaceFormGlobalPermissionsSupersedeWarning",title:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.supersededWarningTitle",defaultMessage:"Superseded by global privileges"})},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.supersededWarning",defaultMessage:"Declared privileges are less permissive than configured global privileges. View the privilege summary to see effective privileges."})),Object(j.jsx)(r.EuiSpacer,{size:"s"})),Object(j.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(r.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left","data-test-subj":"cancelSpacePrivilegeButton"},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.cancelButton",defaultMessage:"Cancel"}))),Object(j.jsx)(r.EuiFlexItem,{grow:!1},this.getSaveButton()))))}}p()(privilege_space_form_PrivilegeSpaceForm,"defaultProps",{privilegeIndex:-1});i(273);const A=e=>Object(j.jsx)(D,e),D=e=>{const{privilege:t,...i}=e;return Object(j.jsx)(r.EuiText,i,function(e){const t=function(e){if(void 0===e)return[];if(Array.isArray(e))return e;return[e]}(e);let i;i=0===t.length||1===t.length&&t.includes(F)?Object(j.jsx)(r.EuiIcon,{color:"subdued",type:"minusInCircle"}):t.map((e=>v.a.upperFirst(e))).join(", ");return i}(t))};A.defaultProps={privilege:[]};class privilege_space_table_PrivilegeSpaceTable extends l.Component{constructor(...e){super(...e),p()(this,"state",{expandedSpacesGroups:[]}),p()(this,"renderKibanaPrivileges",(()=>{const{privilegeCalculator:e,displaySpaces:t}=this.props,i=this.getSortedPrivileges().map(((e,i)=>({spaces:e.spaces.map((e=>t.find((t=>t.id===e))||{id:e,name:e,disabledFeatures:[],deleted:!0})),privilegeIndex:i,isGlobal:Object(m.a)(e),privileges:{spaces:e.spaces,base:e.base||[],feature:e.feature||{},reserved:e._reserved||[]}}))),s=[{field:"spaces",name:"Spaces",width:"60%",render:(e,t)=>{const i=this.state.expandedSpacesGroups.includes(t.privilegeIndex),s=i?e:e.slice(0,4);let l=null;return e.length>s.length?l=Object(j.jsx)(r.EuiButtonEmpty,{size:"xs",onClick:()=>this.toggleExpandSpacesGroup(t.privilegeIndex)},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.showNMoreSpacesLink",defaultMessage:"+{count} more",values:{count:e.length-s.length}})):i&&(l=Object(j.jsx)(r.EuiButtonEmpty,{size:"xs",onClick:()=>this.toggleExpandSpacesGroup(t.privilegeIndex)},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.showLessSpacesLink",defaultMessage:"show less"}))),Object(j.jsx)("div",null,Object(j.jsx)("span",{"data-test-subj":"spacesColumn"},s.map((e=>Object(j.jsx)(r.EuiBadge,a()({key:e.id},(e=>e.deleted?{iconType:"trash"}:{})(e),{color:Object(w.getSpaceColor)(e)}),e.name)))),l)}},{field:"privileges",name:"Privileges",render:(t,i)=>{var s,a;if(t.reserved.length>0)return Object(j.jsx)(A,{privilege:t.reserved,"data-test-subj":"privilegeColumn"});let l=Object(j.jsx)(r.EuiIcon,{type:"empty",size:"s"});return e.hasSupersededInheritedPrivileges(i.privilegeIndex)&&(l=Object(j.jsx)("span",{"data-test-subj":"spaceTablePrivilegeSupersededWarning"},Object(j.jsx)(r.EuiIconTip,{type:"alert",size:"s",content:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.supersededPrivilegeWarning",defaultMessage:"Privileges are superseded by configured global privilege. View the privilege summary to see effective privileges."})}))),Object(j.jsx)(r.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(j.jsx)(r.EuiFlexItem,{grow:!1},l),Object(j.jsx)(r.EuiFlexItem,null,Object(j.jsx)(A,{privilege:null!==(s=null===(a=e.getBasePrivilege(i.privilegeIndex))||void 0===a?void 0:a.id)&&void 0!==s?s:O,"data-test-subj":"privilegeColumn"})))}}];return this.props.disabled||s.push({name:"Actions",actions:[{render:e=>Object(j.jsx)(r.EuiButtonIcon,{"aria-label":o.i18n.translate("xpack.security.management.editRole.spacePrivilegeTable.editPrivilegesLabel",{defaultMessage:"Edit privileges for the following spaces: {spaceNames}.",values:{spaceNames:e.spaces.map((e=>e.name)).join(", ")}}),color:"primary",iconType:"pencil",onClick:()=>this.props.onEdit(e.privilegeIndex)})},{render:e=>Object(j.jsx)(r.EuiButtonIcon,{"aria-label":o.i18n.translate("xpack.security.management.editRole.spacePrivilegeTable.deletePrivilegesLabel",{defaultMessage:"Delete privileges for the following spaces: {spaceNames}.",values:{spaceNames:e.spaces.map((e=>e.name)).join(", ")}}),color:"danger",iconType:"trash",onClick:()=>this.onDeleteSpacePrivilege(e)})}]}),Object(j.jsx)(r.EuiInMemoryTable,{columns:s,items:i,hasActions:!0,rowProps:e=>({className:Object(m.a)(e.privileges)?"secPrivilegeTable__row--isGlobalSpace":""})})})),p()(this,"getSortedPrivileges",(()=>this.props.role.kibana.sort(((e,t)=>Object(m.a)(e)?-1:Object(m.a)(t)?1:0)))),p()(this,"toggleExpandSpacesGroup",(e=>{this.state.expandedSpacesGroups.includes(e)?this.setState({expandedSpacesGroups:this.state.expandedSpacesGroups.filter((t=>t!==e))}):this.setState({expandedSpacesGroups:[...this.state.expandedSpacesGroups,e]})})),p()(this,"onDeleteSpacePrivilege",(e=>{const t=Object(d.b)(this.props.role);t.kibana.splice(e.privilegeIndex,1),this.props.onChange(t),this.setState({expandedSpacesGroups:this.state.expandedSpacesGroups.filter((t=>t!==e.privilegeIndex))})}))}render(){return this.renderKibanaPrivileges()}}class space_aware_privilege_section_SpaceAwarePrivilegeSection extends l.Component{constructor(e){super(e),p()(this,"globalSpaceEntry",{id:"*",name:o.i18n.translate("xpack.security.management.editRole.spaceAwarePrivilegeForm.globalSpacesName",{defaultMessage:"* All Spaces"}),color:"#D3DAE6",initials:"*",disabledFeatures:[]}),p()(this,"renderKibanaPrivileges",(()=>{const{role:e}=this.props;if(e.kibana.length>0){const e=Object(j.jsx)(privilege_space_table_PrivilegeSpaceTable,{role:this.props.role,displaySpaces:this.getDisplaySpaces(),privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,this.props.role),onChange:this.props.onChange,onEdit:this.onEditSpacesPrivileges,disabled:!this.props.editable});return Object(j.jsx)("div",null,e,Object(j.jsx)(r.EuiSpacer,null),this.getAvailablePrivilegeButtons(!0))}return Object(j.jsx)(r.EuiEmptyPrompt,{iconType:"lock",title:Object(j.jsx)("h2",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeSection.noAccessToKibanaTitle",defaultMessage:"This role does not grant access to Kibana"})),titleSize:"s",actions:this.getAvailablePrivilegeButtons(!1)})})),p()(this,"getAvailablePrivilegeButtons",(e=>{const t=this.getAvailableSpaces().length>0;if(!t&&!e)return null;const i=Object(j.jsx)(r.EuiButton,{color:"primary",onClick:this.addSpacePrivilege,iconType:"plusInCircle","data-test-subj":"addSpacePrivilegeButton",isDisabled:!t||!this.props.editable},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeSection.addSpacePrivilegeButton",defaultMessage:"Add Kibana privilege"}));if(!e)return i;const s=Object(j.jsx)(R,{role:this.props.role,spaces:this.getDisplaySpaces(),kibanaPrivileges:this.props.kibanaPrivileges,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges,spacesApiUi:this.props.spacesApiUi});return Object(j.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(j.jsx)(r.EuiFlexItem,{grow:!1},i),e&&!Object(d.i)(this.props.role)&&Object(j.jsx)(r.EuiFlexItem,{grow:!1},s))})),p()(this,"getDisplaySpaces",(()=>[this.globalSpaceEntry,...this.props.spaces])),p()(this,"getAvailableSpaces",((e=-1)=>{const t=v.a.uniq(v.a.flatten(this.props.role.kibana.map(((t,i)=>e===i?[]:t.spaces))));return this.getDisplaySpaces().filter((e=>!t.includes(e.id)))})),p()(this,"addSpacePrivilege",(()=>{this.setState({showSpacePrivilegeEditor:!0,privilegeIndex:-1})})),p()(this,"onSpacesPrivilegeChange",(e=>{this.setState({showSpacePrivilegeEditor:!1,privilegeIndex:-1}),this.props.onChange(e)})),p()(this,"onEditSpacesPrivileges",(e=>{this.setState({privilegeIndex:e,showSpacePrivilegeEditor:!0})})),p()(this,"onCancelEditPrivileges",(()=>{this.setState({showSpacePrivilegeEditor:!1})})),this.state={showSpacePrivilegeEditor:!1,showPrivilegeMatrix:!1,role:null,privilegeIndex:-1}}render(){const{uiCapabilities:e}=this.props;return e.spaces.manage?Object(j.jsx)(r.EuiErrorBoundary,null,Object(j.jsx)(l.Fragment,null,this.renderKibanaPrivileges(),this.state.showSpacePrivilegeEditor&&Object(j.jsx)(privilege_space_form_PrivilegeSpaceForm,{role:this.props.role,kibanaPrivileges:this.props.kibanaPrivileges,onChange:this.onSpacesPrivilegeChange,onCancel:this.onCancelEditPrivileges,spaces:this.getAvailableSpaces(this.state.privilegeIndex),privilegeIndex:this.state.privilegeIndex,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges}))):Object(j.jsx)(r.EuiCallOut,{title:Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.insufficientPrivilegesDescription",defaultMessage:"Insufficient Privileges"})),iconType:"alert",color:"danger","data-test-subj":"userCannotManageSpacesCallout"},Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.howToViewAllAvailableSpacesDescription",defaultMessage:"You are not authorized to view all available spaces."})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.ensureAccountHasAllPrivilegesGrantedDescription",defaultMessage:"Please ensure your account has all privileges granted by the {kibanaAdmin} role, and try again.",values:{kibanaAdmin:Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.kibanaAdminTitle",defaultMessage:"kibana_admin"}))}})))}}class transform_error_section_TransformErrorSection extends l.PureComponent{render(){return Object(j.jsx)(r.EuiEmptyPrompt,{color:"danger",iconType:"alert",title:Object(j.jsx)("h2",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.transformErrorSectionTitle",defaultMessage:"Malformed role"})),body:Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.transformErrorSectionDescription",defaultMessage:"This role definition is invalid, and cannot be edited through this screen."}))})}}class kibana_privileges_region_KibanaPrivilegesRegion extends l.Component{constructor(...e){super(...e),p()(this,"getForm",(()=>{const{kibanaPrivileges:e,role:t,spacesEnabled:i,canCustomizeSubFeaturePrivileges:s,spaces:a=[],uiCapabilities:r,onChange:l,editable:n,validator:o,spacesApiUi:c}=this.props;return t._transform_error&&t._transform_error.includes("kibana")?Object(j.jsx)(transform_error_section_TransformErrorSection,null):i?Object(j.jsx)(space_aware_privilege_section_SpaceAwarePrivilegeSection,{kibanaPrivileges:e,role:t,spaces:a,uiCapabilities:r,onChange:l,editable:n,canCustomizeSubFeaturePrivileges:s,validator:o,spacesApiUi:c}):Object(j.jsx)(simple_privilege_section_SimplePrivilegeSection,{kibanaPrivileges:e,role:t,onChange:l,editable:n,canCustomizeSubFeaturePrivileges:s})}))}render(){return Object(j.jsx)(collapsible_panel_CollapsiblePanel,{iconType:"logoKibana",title:"Kibana"},this.getForm())}}const L=e=>{const{role:t}=e;return Object(d.i)(t)?Object(j.jsx)(r.EuiToolTip,{"data-test-subj":"reservedRoleBadgeTooltip",content:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.reversedRoleBadge.reservedRolesCanNotBeModifiedTooltip",defaultMessage:"Reserved roles are built-in and cannot be removed or modified."})},Object(j.jsx)(r.EuiIcon,{style:{verticalAlign:"super"},type:"lock"})):null};var B=i(9);class validate_role_RoleValidator{constructor(e={}){p()(this,"shouldValidate",void 0),this.shouldValidate=e.shouldValidate}enableValidation(){this.shouldValidate=!0}disableValidation(){this.shouldValidate=!1}validateRoleName(e){return this.shouldValidate?e.name?e.name.length>B.e?z(o.i18n.translate("xpack.security.management.editRole.validateRole.nameLengthWarningMessage",{defaultMessage:"Name must not exceed {maxLength} characters.",values:{maxLength:B.e}})):e.name.trim()!==e.name?z(o.i18n.translate("xpack.security.management.editRole.validateRole.nameWhitespaceWarningMessage",{defaultMessage:"Name must not contain leading or trailing spaces."})):e.name.match(B.f)?{isInvalid:!1}:z(o.i18n.translate("xpack.security.management.editRole.validateRole.nameAllowedCharactersWarningMessage",{defaultMessage:"Name must contain only letters, numbers, spaces, punctuation and printable symbols."})):z(o.i18n.translate("xpack.security.management.editRole.validateRole.provideRoleNameWarningMessage",{defaultMessage:"Please provide a role name."})):{isInvalid:!1}}validateIndexPrivileges(e){if(!this.shouldValidate)return{isInvalid:!1};if(!Array.isArray(e.elasticsearch.indices))throw new TypeError(o.i18n.translate("xpack.security.management.editRole.validateRole.indicesTypeErrorMessage",{defaultMessage:"Expected {elasticIndices} to be an array",values:{elasticIndices:'"role.elasticsearch.indices"'}}));return null==e.elasticsearch.indices.map((e=>this.validateIndexPrivilege(e))).find((e=>e.isInvalid))?{isInvalid:!1}:z()}validateIndexPrivilege(e){return this.shouldValidate&&e.names.length&&!e.privileges.length?z(o.i18n.translate("xpack.security.management.editRole.validateRole.onePrivilegeRequiredWarningMessage",{defaultMessage:"At least one privilege is required"})):{isInvalid:!1}}validateSelectedSpaces(e,t){return this.shouldValidate&&t?Array.isArray(e)&&e.length>0?{isInvalid:!1}:z(o.i18n.translate("xpack.security.management.editRole.validateRole.oneSpaceRequiredWarningMessage",{defaultMessage:"At least one space is required"})):{isInvalid:!1}}validateSelectedPrivilege(e,t){return this.shouldValidate&&e&&0!==e.length?t?{isInvalid:!1}:z(o.i18n.translate("xpack.security.management.editRole.validateRole.privilegeRequiredWarningMessage",{defaultMessage:"Privilege is required"})):{isInvalid:!1}}validateSpacePrivileges(e){if(!this.shouldValidate)return{isInvalid:!1};return(e.kibana||[]).every((e=>e.base.length>0||Object.keys(e.feature).length>0))?{isInvalid:!1}:z()}validateForSave(e){const{isInvalid:t}=this.validateRoleName(e),{isInvalid:i}=this.validateIndexPrivileges(e),{isInvalid:s}=this.validateSpacePrivileges(e);return t||i||s?z():{isInvalid:!1}}}function z(e){return{isInvalid:!0,error:e}}const G=({userAPIClient:e,indexPatterns:t,rolesAPIClient:i,indicesAPIClient:s,privilegesAPIClient:n,getFeatures:g,http:p,roleName:h,action:b,fatalErrors:v,license:m,docLinks:x,uiCapabilities:P,notifications:f,history:F,spacesApiUi:O})=>{const y=Object(l.useCallback)((()=>F.push("/")),[F]),{current:S}=Object(l.useRef)(new validate_role_RoleValidator({shouldValidate:!1})),[C,E]=Object(l.useState)(null),_=function(e,t){const[i,s]=Object(l.useState)(null);return Object(l.useEffect)((()=>{e.getUsers().then((e=>s(e.map((e=>e.username)))),(e=>t.add(e)))}),[t,e]),i}(e,v),k=function(e,t,i){const[s,a]=Object(l.useState)(null);return Object(l.useEffect)((()=>{e.getTitles().catch((e=>{var s;if(403===(null===(s=e.response)||void 0===s?void 0:s.status))return i.toasts.addDanger({title:o.i18n.translate("xpack.security.management.roles.noIndexPatternsPermission",{defaultMessage:"You need permission to access the list of available index patterns."})}),[];throw t.add(e),e})).then((e=>a(e.filter(Boolean))))}),[t,e,i]),s}(t,v,f),M=function(e,t){const[i,s]=Object(l.useState)(null);return Object(l.useEffect)((()=>{Promise.all([e.getAll({includeActions:!0}),e.getBuiltIn()]).then((([e,t])=>s([e,t])),(e=>t.add(e)))}),[e,t]),i}(n,v),I=function(e,t){const[i,s]=Object(l.useState)(null);return Object(l.useEffect)((()=>{e.get("/api/spaces/space").then((e=>s({enabled:!0,list:e})),(e=>{var i;404===(null===(i=e.response)||void 0===i?void 0:i.status)?s({enabled:!1,list:[]}):t.add(e)}))}),[e,t]),i}(p,v),R=function(e,t){const[i,s]=Object(l.useState)(null);return Object(l.useEffect)((()=>{e().catch((e=>{var i;if(403===(null===(i=e.response)||void 0===i?void 0:i.status))return[];t.add(e)})).then((e=>{s(e)}))}),[t,e]),i}(g,v),[w,T]=function(e,t,i,s,a,r,n){const[c,u]=Object(l.useState)(null);return Object(l.useEffect)((()=>{(n?e.getRole(n):Promise.resolve({name:"",elasticsearch:{cluster:[],indices:[],run_as:[]},kibana:[],_unrecognized_applications:[]})).then((e=>{if("clone"===a&&Object(d.i)(e))r();else{if(0===e.elasticsearch.indices.length){const t={names:[],privileges:[]},{allowRoleDocumentLevelSecurity:i,allowRoleFieldLevelSecurity:a}=s.getFeatures();a&&(t.field_security={grant:["*"],except:[]}),i&&(t.query=""),e.elasticsearch.indices.push(t)}u("clone"===a?Object(d.k)(e):Object(d.b)(e))}})).catch((e=>{var s;404===(null===(s=e.response)||void 0===s?void 0:s.status)?(i.toasts.addDanger({title:o.i18n.translate("xpack.security.management.roles.roleNotFound",{defaultMessage:'No "{roleName}" role found.',values:{roleName:n}})}),r()):t.add(e)}))}),[n,a,t,e,i,s,r]),[c,u]}(i,v,f,m,b,y,h);if(!(w&&_&&k&&M&&I&&R))return null;const A=!!h&&"edit"===b,D=Object(d.h)(w),B=Object(d.i)(w),z=Object(d.f)(w),[G,N]=M,K=e=>T({...w,name:e.target.value}),W=e=>T(e),$=()=>Object(j.jsx)(r.EuiButton,a()({},Object(u.reactRouterNavigate)(F,""),{"data-test-subj":"roleFormReturnButton"}),Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.returnToRoleListButtonLabel",defaultMessage:"Return to role list"})),q=()=>{const e=A?Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.updateRoleText",defaultMessage:"Update role"}):Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.createRoleText",defaultMessage:"Create role"});return Object(j.jsx)(r.EuiButton,{"data-test-subj":"roleFormSaveButton",fill:!0,onClick:V,disabled:B},e)},U=()=>Object(j.jsx)(r.EuiButtonEmpty,{"data-test-subj":"roleFormCancelButton",onClick:y},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.cancelButtonLabel",defaultMessage:"Cancel"})),V=async()=>{S.enableValidation();const e=S.validateForSave(w);if(e.isInvalid)E(e);else{E(null);try{await i.saveRole({role:w,spacesEnabled:I.enabled})}catch(e){var t,s;return void f.toasts.addDanger(null!==(t=null==e||null===(s=e.body)||void 0===s?void 0:s.message)&&void 0!==t?t:o.i18n.translate("xpack.security.management.editRole.errorSavingRoleError",{defaultMessage:"Error saving role"}))}f.toasts.addSuccess(o.i18n.translate("xpack.security.management.editRole.roleSuccessfullySavedNotificationMessage",{defaultMessage:"Saved role"})),y()}},H=async()=>{try{await i.deleteRole(w.name)}catch(i){var e,t;return void f.toasts.addDanger(null!==(e=null==i||null===(t=i.data)||void 0===t?void 0:t.message)&&void 0!==e?e:o.i18n.translate("xpack.security.management.editRole.errorDeletingRoleError",{defaultMessage:"Error deleting role"}))}f.toasts.addSuccess(o.i18n.translate("xpack.security.management.editRole.roleSuccessfullyDeletedNotificationMessage",{defaultMessage:"Deleted role"})),y()},Q=I.enabled?Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.setPrivilegesToKibanaSpacesDescription",defaultMessage:"Set privileges on your Elasticsearch data and control access to your Kibana spaces."}):Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.setPrivilegesToKibanaDescription",defaultMessage:"Set privileges on your Elasticsearch data and control access to Kibana."});return Object(j.jsx)("div",{className:"editRolePage"},Object(j.jsx)(r.EuiForm,C,(()=>{let e;const t={tabIndex:0};return B?(e=Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.viewingRoleTitle",defaultMessage:"Viewing role"}),t["aria-describedby"]="reservedRoleDescription"):e=A?Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.editRoleTitle",defaultMessage:"Edit role"}):Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.createRoleTitle",defaultMessage:"Create role"}),Object(j.jsx)(r.EuiTitle,{size:"l"},Object(j.jsx)("h1",t,e," ",Object(j.jsx)(L,{role:w})))})(),Object(j.jsx)(r.EuiSpacer,null),Object(j.jsx)(r.EuiText,{size:"s"},Q),B&&Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiSpacer,{size:"s"}),Object(j.jsx)(r.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",{id:"reservedRoleDescription",tabIndex:0},Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.modifyingReversedRolesDescription",defaultMessage:"Reserved roles are built-in and cannot be removed or modified."})))),z&&Object(j.jsx)(l.Fragment,null,Object(j.jsx)(r.EuiSpacer,{size:"s"}),Object(j.jsx)(r.EuiCallOut,{title:Object(d.c)(w),color:"warning",iconType:"alert"})),Object(j.jsx)(r.EuiSpacer,null),Object(j.jsx)(r.EuiPanel,{hasShadow:!1,hasBorder:!0},Object(j.jsx)(r.EuiFormRow,a()({label:Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.roleNameFormRowTitle",defaultMessage:"Role name"}),helpText:!B&&A?Object(j.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.roleNameFormRowHelpText",defaultMessage:"A role's name cannot be changed once it has been created."}):void 0},S.validateRoleName(w)),Object(j.jsx)(r.EuiFieldText,{name:"name",value:w.name||"",onChange:K,"data-test-subj":"roleFormNameInput",readOnly:B||A}))),Object(j.jsx)("div",null,Object(j.jsx)(r.EuiSpacer,null),Object(j.jsx)(elasticsearch_privileges_ElasticsearchPrivileges,{role:w,editable:!D,indicesAPIClient:s,onChange:W,runAsUsers:_,validator:S,indexPatterns:k,builtinESPrivileges:N,license:m,docLinks:x})),Object(j.jsx)("div",null,Object(j.jsx)(r.EuiSpacer,null),Object(j.jsx)(kibana_privileges_region_KibanaPrivilegesRegion,{kibanaPrivileges:new kibana_privileges_KibanaPrivileges(G,R),spaces:I.list,spacesEnabled:I.enabled,uiCapabilities:P,canCustomizeSubFeaturePrivileges:m.getFeatures().allowSubFeaturePrivileges,editable:!D,role:w,onChange:W,validator:S,spacesApiUi:O})),Object(j.jsx)(r.EuiSpacer,null),D?$():Object(j.jsx)(r.EuiFlexGroup,{responsive:!1},Object(j.jsx)(r.EuiFlexItem,{grow:!1},q()),Object(j.jsx)(r.EuiFlexItem,{grow:!1},U()),Object(j.jsx)(r.EuiFlexItem,{grow:!0}),A&&!D?Object(j.jsx)(r.EuiFlexItem,{grow:!1},Object(j.jsx)(delete_role_button_DeleteRoleButton,{canDelete:!0,onDelete:H})):null)))}}}]);