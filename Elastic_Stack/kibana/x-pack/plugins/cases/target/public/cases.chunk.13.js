/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.cases_bundle_jsonpfunction=window.cases_bundle_jsonpfunction||[]).push([[13],{185:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return A}));var n=a(2),r=a.n(n),s=a(33),c=a.n(s),o=a(6),i=a(3),l=a(73),u=a(50),d=a(12),b=a(10);const p=({caseType:e=i.CaseType.individual,hideConnectorServiceNowSir:t,isModalOpen:a,onCloseCaseModal:n,onSuccess:s,owner:c})=>a?r.a.createElement(o.EuiModal,{onClose:n,"data-test-subj":"create-case-modal"},r.a.createElement(o.EuiModalHeader,null,r.a.createElement(o.EuiModalHeaderTitle,null,d.p)),r.a.createElement(o.EuiModalBody,null,Object(b.e)({caseType:e,hideConnectorServiceNowSir:t,onCancel:n,onSuccess:s,withSteps:!1,owner:[c]}))):null,C=Object(n.memo)(p);C.displayName="CreateCaseModal";var m=a(16);const y="add-case",O={value:y,inputDisplay:r.a.createElement("span",{className:"euiButtonEmpty euiButtonEmpty--primary euiButtonEmpty--xSmall euiButtonEmpty--flushLeft"},m.a),"data-test-subj":"dropdown-connector-add-connector"},E=({isLoading:e,cases:t,selectedCase:a,onCaseChanged:s})=>{const c=Object(n.useMemo)((()=>t.reduce(((e,t)=>[...e,{value:t.id,inputDisplay:r.a.createElement("span",null,t.title),"data-test-subj":`case-connector-cases-dropdown-${t.id}`}]),[])),[t]),i=Object(n.useMemo)((()=>[...c,O]),[c]),l=Object(n.useCallback)((e=>s(e)),[s]);return r.a.createElement(o.EuiFormRow,{label:m.d,fullWidth:!0},r.a.createElement(o.EuiSuperSelect,{options:i,"data-test-subj":"case-connector-cases-dropdown",disabled:e,fullWidth:!0,isLoading:e,valueOfSelected:a,onChange:l}))},g=Object(n.memo)(E),h=({onCaseChanged:e,selectedCase:t})=>{const{data:a,loading:s,refetchCases:c}=Object(l.c)({initialQueryParams:l.b,initialFilterOptions:{...l.a,onlyCollectionType:!0}}),o=Object(n.useCallback)((t=>{c(),e(t.id)}),[e,c]),{modal:d,openModal:b}=(({caseType:e=i.CaseType.individual,onCaseCreated:t,hideConnectorServiceNowSir:a=!1})=>{const s=Object(u.a)(),[c,o]=Object(n.useState)(!1),l=Object(n.useCallback)((()=>o(!1)),[]),d=Object(n.useCallback)((()=>o(!0)),[]),b=Object(n.useCallback)((async e=>{t(e),l()}),[t,l]);return Object(n.useMemo)((()=>({modal:r.a.createElement(C,{caseType:e,hideConnectorServiceNowSir:a,isModalOpen:c,onCloseCaseModal:l,onSuccess:b,owner:s[0]}),isModalOpen:c,closeModal:l,openModal:d})),[e,l,a,c,b,d,s])})({onCaseCreated:o,caseType:i.CaseType.collection,hideConnectorServiceNowSir:!0}),p=Object(n.useCallback)((t=>{t!==y?e(t):b()}),[e,b]),m=Object(n.useMemo)((()=>s.includes("cases")||s.includes("caseUpdate")),[s]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(g,{isLoading:m,cases:a.cases,selectedCase:null!=t?t:void 0,onCaseChanged:p}),d)},f=Object(n.memo)(h);var S=a(23);const j=c.a.div.withConfig({displayName:"Container",componentId:"sc-13zr34n-0"})(["",""],(({theme:e})=>{var t,a,n,r,s,c,o,i;return`\n    padding:  ${null!==(t=null===(a=e.eui)||void 0===a?void 0:a.euiSizeS)&&void 0!==t?t:"8px"} ${null!==(n=null===(r=e.eui)||void 0===r?void 0:r.euiSizeL)&&void 0!==n?n:"24px"} ${null!==(s=null===(c=e.eui)||void 0===c?void 0:c.euiSizeL)&&void 0!==s?s:"24px"} ${null!==(o=null===(i=e.eui)||void 0===i?void 0:i.euiSizeL)&&void 0!==o?o:"24px"};\n  `})),T={type:i.CommentType.generatedAlert,alerts:'[{{#context.alerts}}{"_id": "{{_id}}", "_index": "{{_index}}", "ruleId": "{{signal.rule.id}}", "ruleName": "{{signal.rule.name}}"}__SEPARATOR__{{/context.alerts}}]'},A=({actionParams:e,editAction:t,index:a,actionConnector:s})=>{var c,l,u;const{caseId:d=null,comment:b=T}=null!==(c=e.subActionParams)&&void 0!==c?c:{},[p,C]=Object(n.useState)(null),y=Object(n.useCallback)(((n,r)=>{const s={...e.subActionParams,[n]:r};t("subActionParams",s,a)}),[e.subActionParams,a]),O=Object(n.useCallback)((e=>{C(e),y("caseId",e)}),[y]);return Object(n.useEffect)((()=>{var n,r;e.subAction||t("subAction","addComment",a),null!==(n=e.subActionParams)&&void 0!==n&&n.caseId||y("caseId",d),null!==(r=e.subActionParams)&&void 0!==r&&r.comment||y("comment",b),null!=d&&C((e=>e!==d?d:e))}),[s,a,null===(l=e.subActionParams)||void 0===l?void 0:l.caseId,null===(u=e.subActionParams)||void 0===u?void 0:u.comment,d,b,e.subAction]),r.a.createElement(j,null,r.a.createElement(S.b,{owner:[i.SECURITY_SOLUTION_OWNER]},r.a.createElement(f,{onCaseChanged:O,selectedCase:p})),r.a.createElement(o.EuiSpacer,{size:"m"}),r.a.createElement(o.EuiCallOut,{size:"s",title:m.c,iconType:"iInCircle"},r.a.createElement("p",null,m.b)))}},48:function(e,t,a){"use strict";a.d(t,"r",(function(){return l})),a.d(t,"h",(function(){return u})),a.d(t,"f",(function(){return d})),a.d(t,"j",(function(){return b})),a.d(t,"g",(function(){return p})),a.d(t,"d",(function(){return C})),a.d(t,"i",(function(){return m})),a.d(t,"e",(function(){return y})),a.d(t,"o",(function(){return O})),a.d(t,"k",(function(){return E})),a.d(t,"n",(function(){return g})),a.d(t,"l",(function(){return h})),a.d(t,"p",(function(){return f})),a.d(t,"m",(function(){return S})),a.d(t,"a",(function(){return j})),a.d(t,"b",(function(){return T})),a.d(t,"q",(function(){return A})),a.d(t,"c",(function(){return _}));var n=a(9),r=a(3),s=a(22),c=a(20),o=a(55),i=a(24);const l=async(e,t=!0,a)=>{const n=await c.a.get().http.fetch(Object(r.getCaseDetailsUrl)(e)+"/resolve",{method:"GET",query:{includeComments:t},signal:a});return Object(i.c)(Object(i.g)(n))},u=async(e,t,a=!0,s)=>{var o,l;const[u,d]=await Promise.all([c.a.get().http.fetch(Object(r.getCaseDetailsUrl)(e),{method:"GET",query:{includeComments:!1},signal:s}),c.a.get().http.fetch(Object(r.getSubCaseDetailsUrl)(e,t),{method:"GET",query:{includeComments:a},signal:s})]),b=Object(n.assign)(u,d),p=null!==(o=null===(l=b.subCaseIds)||void 0===l?void 0:l.findIndex((e=>e===b.id)))&&void 0!==o?o:-1;return b.title=`${b.title}${p>=0?` ${p+1}`:""}`,Object(i.c)(Object(i.h)(b))},d=async(e,t)=>{const a=await c.a.get().http.fetch(r.CASE_STATUS_URL,{method:"GET",signal:e,query:{...t.length>0?{owner:t}:{}}});return Object(i.c)(Object(i.l)(a))},b=async(e,t)=>{const a=await c.a.get().http.fetch(r.CASE_TAGS_URL,{method:"GET",signal:e,query:{...t.length>0?{owner:t}:{}}});return null!=a?a:[]},p=async(e,t)=>{const a=await c.a.get().http.fetch(r.CASE_REPORTERS_URL,{method:"GET",signal:e,query:{...t.length>0?{owner:t}:{}}});return null!=a?a:[]},C=async(e,t)=>{const a=await c.a.get().http.fetch(Object(r.getCaseUserActionUrl)(e),{method:"GET",signal:t});return Object(i.b)(Object(i.i)(a))},m=async(e,t,a)=>{const n=await c.a.get().http.fetch(Object(r.getSubCaseUserActionUrl)(e,t),{method:"GET",signal:a});return Object(i.b)(Object(i.i)(n))},y=async({filterOptions:e={onlyCollectionType:!1,search:"",reporters:[],status:r.StatusAll,tags:[],owner:[]},queryParams:t={page:1,perPage:20,sortField:o.a.createdAt,sortOrder:"desc"},signal:a})=>{const s={reporters:e.reporters.map((e=>{var t;return null!==(t=e.username)&&void 0!==t?t:""})).filter((e=>""!==e)),tags:e.tags,status:e.status,...e.search.length>0?{search:e.search}:{},...e.onlyCollectionType?{type:r.CaseType.collection}:{},...e.owner.length>0?{owner:e.owner}:{},...t},l=await c.a.get().http.fetch(`${r.CASES_URL}/_find`,{method:"GET",query:s.status===r.StatusAll?Object(n.omit)(s,["status"]):s,signal:a});return Object(i.a)(Object(i.j)(l))},O=async(e,t)=>{const a=await c.a.get().http.fetch(r.CASES_URL,{method:"POST",body:JSON.stringify(e),signal:t});return Object(i.c)(Object(i.h)(a))},E=async(e,t,a,n)=>{const s=await c.a.get().http.fetch(r.CASES_URL,{method:"PATCH",body:JSON.stringify({cases:[{...t,id:e,version:a}]}),signal:n});return Object(i.c)(Object(i.k)(s))},g=async(e,t,a,s,o)=>{const l=await c.a.get().http.fetch(r.SUB_CASE_DETAILS_URL,{method:"PATCH",body:JSON.stringify({cases:[{...a,id:e,version:s}]}),signal:o}),u=await c.a.get().http.fetch(Object(r.getCaseDetailsUrl)(e),{method:"GET",query:{includeComments:!1},signal:o}),d=l.map((e=>Object(n.assign)(u,e)));return Object(i.c)(Object(i.k)(d))},h=async(e,t)=>{const a=await c.a.get().http.fetch(r.CASES_URL,{method:"PATCH",body:JSON.stringify({cases:e}),signal:t});return Object(i.c)(Object(i.k)(a))},f=async(e,t,a,n)=>{const s=await c.a.get().http.fetch(`${r.CASES_URL}/${t}/comments`,{method:"POST",body:JSON.stringify(e),...n?{query:{subCaseId:n}}:{},signal:a});return Object(i.c)(Object(i.h)(s))},S=async({caseId:e,commentId:t,commentUpdate:a,version:n,signal:s,owner:o,subCaseId:l})=>{const u=await c.a.get().http.fetch(Object(r.getCaseCommentsUrl)(e),{method:"PATCH",body:JSON.stringify({comment:a,type:r.CommentType.user,id:t,version:n,owner:o}),...l?{query:{subCaseId:l}}:{},signal:s});return Object(i.c)(Object(i.h)(u))},j=async(e,t)=>await c.a.get().http.fetch(r.CASES_URL,{method:"DELETE",query:{ids:JSON.stringify(e)},signal:t}),T=async(e,t)=>await c.a.get().http.fetch(r.SUB_CASES_PATCH_DEL_URL,{method:"DELETE",query:{ids:JSON.stringify(e)},signal:t}),A=async(e,t,a)=>{const n=await c.a.get().http.fetch(Object(r.getCasePushUrl)(e,t),{method:"POST",body:JSON.stringify({}),signal:a});return Object(i.c)(Object(i.h)(n))},_=async e=>{const t=await c.a.get().http.fetch(Object(s.a)(),{method:"GET",signal:e});return Object(i.b)(t)}},50:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(2),r=a(23);const s=()=>{const e=Object(n.useContext)(r.a);if(0===e.length)throw new Error("useOwnerContext must be used within an OwnerProvider and not be an empty array");return e}},55:function(e,t,a){"use strict";a.d(t,"b",(function(){return n.b})),a.d(t,"a",(function(){return n.a}));var n=a(25)},73:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return d})),a.d(t,"c",(function(){return C}));var n=a(2);var r=a(55),s=a(20),c=a(13),o=a(48),i=a(50);const l=(e,t)=>{switch(t.type){case"FETCH_INIT":return{...e,isError:!1,loading:[...e.loading.filter((e=>e!==t.payload)),t.payload]};case"FETCH_UPDATE_CASE_SUCCESS":return{...e,loading:e.loading.filter((e=>"caseUpdate"!==e))};case"FETCH_CASES_SUCCESS":return{...e,data:t.payload,isError:!1,loading:e.loading.filter((e=>"cases"!==e))};case"FETCH_FAILURE":return{...e,isError:!0,loading:e.loading.filter((e=>e!==t.payload))};case"UPDATE_FILTER_OPTIONS":return{...e,filterOptions:{...e.filterOptions,...t.payload}};case"UPDATE_QUERY_PARAMS":return{...e,queryParams:{...e.queryParams,...t.payload}};case"UPDATE_TABLE_SELECTIONS":return{...e,selectedCases:t.payload};default:return e}},u={search:"",reporters:[],status:r.b,tags:[],onlyCollectionType:!1},d={page:1,perPage:5,sortField:r.a.createdAt,sortOrder:"desc"},b={cases:[],countClosedCases:null,countInProgressCases:null,countOpenCases:null,page:0,perPage:0,total:0},p={},C=(e={})=>{const t=Object(i.a)(),{initialQueryParams:a=p,initialFilterOptions:r=p}=e,[C,m]=Object(n.useReducer)(l,{data:b,filterOptions:{...u,...r},isError:!1,loading:[],queryParams:{...d,...a},selectedCases:[]}),y=Object(s.f)(),O=Object(n.useRef)(!1),E=Object(n.useRef)(!1),g=Object(n.useRef)(new AbortController),h=Object(n.useRef)(new AbortController),f=Object(n.useCallback)((e=>{m({type:"UPDATE_TABLE_SELECTIONS",payload:e})}),[]),S=Object(n.useCallback)((e=>{m({type:"UPDATE_QUERY_PARAMS",payload:e})}),[]),j=Object(n.useCallback)((e=>{m({type:"UPDATE_FILTER_OPTIONS",payload:e})}),[]),T=Object(n.useCallback)((async(e,a)=>{try{O.current=!1,g.current.abort(),g.current=new AbortController,m({type:"FETCH_INIT",payload:"cases"});const n=await Object(o.e)({filterOptions:{...e,owner:t},queryParams:a,signal:g.current.signal});O.current||m({type:"FETCH_CASES_SUCCESS",payload:n})}catch(e){O.current||("AbortError"!==e.name&&y.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:c.d}),m({type:"FETCH_FAILURE",payload:"cases"}))}}),[t,y]),A=Object(n.useCallback)((async({updateKey:e,updateValue:t,caseId:a,refetchCasesStatus:n,version:r})=>{try{E.current=!1,h.current.abort(),h.current=new AbortController,m({type:"FETCH_INIT",payload:"caseUpdate"}),await Object(o.k)(a,{[e]:t},null!=r?r:"",h.current.signal),E.current||(m({type:"FETCH_UPDATE_CASE_SUCCESS"}),T(C.filterOptions,C.queryParams),n())}catch(e){E.current||("AbortError"!==e.name&&y.addError(e,{title:c.d}),m({type:"FETCH_FAILURE",payload:"caseUpdate"}))}}),[C.filterOptions,C.queryParams]),_=Object(n.useCallback)((()=>{T(C.filterOptions,C.queryParams)}),[C.filterOptions,C.queryParams]);return Object(n.useEffect)((()=>(T(C.filterOptions,C.queryParams),()=>{O.current=!0,E.current=!0,g.current.abort(),h.current.abort()})),[C.queryParams,C.filterOptions]),{...C,dispatchUpdateCaseProperty:A,refetchCases:_,setFilters:j,setQueryParams:S,setSelectedCases:f}}}}]);