/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.cases_bundle_jsonpfunction=window.cases_bundle_jsonpfunction||[]).push([[11],{186:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var i=n(2),r=n.n(i),a=n(6),o=n(20),c=n(22),s=n(61);var l=n(19);const u=({http:e,toastNotifications:t,connector:n})=>{const[r,a]=Object(i.useState)(!0),[o,u]=Object(i.useState)([]),d=Object(i.useRef)(!1),b=Object(i.useRef)(new AbortController);return Object(i.useEffect)((()=>(d.current=!1,b.current.abort(),(async()=>{if(n)try{b.current=new AbortController,a(!0);const o=await async function({http:e,signal:t,connectorId:n}){const i=await e.post(Object(c.d)(n),{body:JSON.stringify({params:{subAction:"incidentTypes",subActionParams:{}}}),signal:t});return Object(s.a)(i)}({http:e,signal:b.current.signal,connectorId:n.id});var i,r;if(!d.current)if(a(!1),u(null!==(i=o.data)&&void 0!==i?i:[]),o.status&&"error"===o.status)t.addDanger({title:l.a,text:`${null!==(r=o.serviceMessage)&&void 0!==r?r:o.message}`})}catch(e){d.current||(a(!1),"AbortError"!==e.name&&t.addDanger({title:l.a,text:e.message}))}else a(!1)})(),()=>{d.current=!0,b.current.abort()})),[e,n,t]),{incidentTypes:o,isLoading:r}},d=({http:e,toastNotifications:t,connector:n})=>{const[r,a]=Object(i.useState)(!0),[o,u]=Object(i.useState)([]),d=Object(i.useRef)(new AbortController),b=Object(i.useRef)(!1);return Object(i.useEffect)((()=>(b.current=!1,d.current.abort(),(async()=>{if(n)try{d.current=new AbortController,a(!0);const o=await async function({http:e,signal:t,connectorId:n}){const i=await e.post(Object(c.d)(n),{body:JSON.stringify({params:{subAction:"severity",subActionParams:{}}}),signal:t});return Object(s.a)(i)}({http:e,signal:d.current.signal,connectorId:n.id});var i,r;if(!b.current)if(a(!1),u(null!==(i=o.data)&&void 0!==i?i:[]),o.status&&"error"===o.status)t.addDanger({title:l.d,text:`${null!==(r=o.serviceMessage)&&void 0!==r?r:o.message}`})}catch(e){b.current||(a(!1),"AbortError"!==e.name&&t.addDanger({title:l.d,text:e.message}))}else a(!1)})(),()=>{b.current=!0,d.current.abort()})),[e,n,t]),{severity:o,isLoading:r}};var b=n(3),p=n(56);const m=({isEdit:e=!0,fields:t,connector:n,onChange:c})=>{const s=Object(i.useRef)(!0),{incidentTypes:m=null,severityCode:f=null}=null!=t?t:{},{http:g,notifications:v}=Object(o.d)().services,{isLoading:y,incidentTypes:j}=u({http:g,toastNotifications:v.toasts,connector:n}),{isLoading:E,severity:O}=d({http:g,toastNotifications:v.toasts,connector:n}),C=Object(i.useMemo)((()=>O.map((e=>({value:e.id.toString(),text:e.name})))),[O]),h=Object(i.useMemo)((()=>j?j.map((e=>({label:e.name,value:e.id.toString()}))):[]),[j]),T=Object(i.useMemo)((()=>{var e,t;return[...null!=m&&m.length>0?[{title:l.b,description:j.filter((e=>m.includes(e.id.toString()))).map((e=>e.name)).join(", ")}]:[],...null!=f&&f.length>0?[{title:l.e,description:null!==(e=null===(t=O.find((e=>e.id.toString()===f)))||void 0===t?void 0:t.name)&&void 0!==e?e:""}]:[]]}),[m,f,j,O]),S=Object(i.useCallback)(((e,n)=>{c({...t,incidentTypes:m,severityCode:f,[e]:n})}),[m,f,c,t]),w=Object(i.useMemo)((()=>{const e=j.reduce(((e,t)=>({...e,[t.id.toString()]:t.name})),{});return m?m.map((t=>({label:e[t.toString()],value:t.toString()}))).filter((e=>null!=e.label)):[]}),[j,m]),I=Object(i.useCallback)((e=>{S("incidentTypes",e.map((e=>{var t;return null!==(t=e.value)&&void 0!==t?t:e.label})))}),[S]),A=Object(i.useCallback)((()=>{m||S("incidentTypes",[])}),[m,S]);return Object(i.useEffect)((()=>{s.current&&(s.current=!1,c({incidentTypes:m,severityCode:f}))}),[m,c,f]),e?r.a.createElement("span",{"data-test-subj":"connector-fields-resilient"},r.a.createElement(a.EuiFormRow,{fullWidth:!0,label:l.b},r.a.createElement(a.EuiComboBox,{"data-test-subj":"incidentTypeComboBox",fullWidth:!0,isClearable:!0,isDisabled:y,isLoading:y,onBlur:A,onChange:I,options:h,placeholder:l.c,selectedOptions:w})),r.a.createElement(a.EuiSpacer,{size:"m"}),r.a.createElement(a.EuiFormRow,{fullWidth:!0,label:l.e},r.a.createElement(a.EuiSelect,{"data-test-subj":"severitySelect",disabled:E,fullWidth:!0,hasNoInitialSelection:!0,isLoading:E,onChange:e=>S("severityCode",e.target.value),options:C,value:null!=f?f:void 0})),r.a.createElement(a.EuiSpacer,{size:"m"})):r.a.createElement(p.a,{connectorType:b.ConnectorTypes.resilient,isLoading:y||E,listItems:T,title:n.name})}},47:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return u}));var i=n(3),r=n(51),a=n(49);const o=(e,t)=>{var n;return null!==(n=t.find((t=>t.id===e)))&&void 0!==n?n:null},c={[i.ConnectorTypes.swimlane]:r.a,[i.ConnectorTypes.serviceNowITSM]:a.a,[i.ConnectorTypes.serviceNowSIR]:a.a},s=({connectors:e=[],config:t={}})=>({...t,validations:[{validator:({value:t})=>{const n=o(t,e);var i;if(null!=n)return null===(i=c[n.actionTypeId])||void 0===i?void 0:i.call(c,n)}}]}),l=(e,t)=>{if(null==t)return"";try{if(e.actionTypeRegistry.has(t))return e.actionTypeRegistry.get(t).iconClass}catch{return""}return""},u=e=>null!=e&&((".servicenow"===e.actionTypeId||".servicenow-sir"===e.actionTypeId)&&!!e.config.usesTableApi)},49:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=e=>{const{config:{usesTableApi:t}}=e;if(t)return{message:"Deprecated connector"}}},51:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(3);const r=["caseIdConfig","caseNameConfig","descriptionConfig","commentsConfig"],a=e=>{const{config:{mappings:t,connectorType:n}}=e;if(n===i.SwimlaneConnectorType.Alerts||(a=t,r.some((e=>null==(null==a?void 0:a[e])))))return{message:"Invalid connector"};var a}},56:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(2),r=n.n(i),a=n(6),o=n(33),c=n.n(o),s=n(20),l=n(47);const u=c.a.span.withConfig({displayName:"StyledText",componentId:"sc-10fyrf5-0"})(["span{display:block;}"]),d=({connectorType:e,title:t,listItems:n,isLoading:o})=>{const{triggersActionsUi:c}=Object(s.d)().services,d=Object(i.useMemo)((()=>r.a.createElement(u,null,n.length>0&&n.map(((e,t)=>r.a.createElement("span",{"data-test-subj":"card-list-item",key:`${e.title}-${t}`},r.a.createElement("strong",null,`${e.title}: `),e.description))))),[n]),b=Object(i.useMemo)((()=>r.a.createElement(a.EuiIcon,{size:"xl",type:Object(l.b)(c,e)})),[e]);return r.a.createElement(r.a.Fragment,null,o&&r.a.createElement(a.EuiLoadingSpinner,{"data-test-subj":"connector-card-loading"}),!o&&r.a.createElement(a.EuiFlexGroup,{direction:"row"},r.a.createElement(a.EuiFlexItem,null,r.a.createElement(a.EuiCard,{"data-test-subj":"connector-card",description:d,display:"plain",layout:"horizontal",paddingSize:"none",title:t,titleSize:"xs"})),r.a.createElement(a.EuiFlexItem,{grow:!1},b)))},b=Object(i.memo)(d)},61:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=({connector_id:e,service_message:t,...n})=>({...n,actionId:e,...t&&{serviceMessage:t}})}}]);