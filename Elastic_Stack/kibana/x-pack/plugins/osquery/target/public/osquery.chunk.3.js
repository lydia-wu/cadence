/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.osquery_bundle_jsonpfunction=window.osquery_bundle_jsonpfunction||[]).push([[3],{129:function(e,t,a){e.exports={ReactQueryDevtools:function(){return null},ReactQueryDevtoolsPanel:function(){return null}}},130:function(e,t,a){"use strict";const l=a(131),r=a(132),n=a(133);function i(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function s(e,t){return t.encode?t.strict?l(e):encodeURIComponent(e):e}function u(e,t){return t.decode?r(e):e}function c(e){return Array.isArray(e)?e.sort():"object"==typeof e?c(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function o(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function d(e){const t=(e=o(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function m(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function p(e,t){i((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const a=function(e){let t;switch(e.arrayFormat){case"index":return(e,a,l)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===l[e]&&(l[e]={}),l[e][t[1]]=a):l[e]=a};case"bracket":return(e,a,l)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==l[e]?l[e]=[].concat(l[e],a):l[e]=[a]:l[e]=a};case"comma":case"separator":return(t,a,l)=>{const r="string"==typeof a&&a.split("").indexOf(e.arrayFormatSeparator)>-1?a.split(e.arrayFormatSeparator).map((t=>u(t,e))):null===a?a:u(a,e);l[t]=r};default:return(e,t,a)=>{void 0!==a[e]?a[e]=[].concat(a[e],t):a[e]=t}}}(t),l=Object.create(null);if("string"!=typeof e)return l;if(!(e=e.trim().replace(/^[?#&]/,"")))return l;for(const r of e.split("&")){let[e,i]=n(t.decode?r.replace(/\+/g," "):r,"=");i=void 0===i?null:["comma","separator"].includes(t.arrayFormat)?i:u(i,t),a(u(e,t),i,l)}for(const e of Object.keys(l)){const a=l[e];if("object"==typeof a&&null!==a)for(const e of Object.keys(a))a[e]=m(a[e],t);else l[e]=m(a,t)}return!1===t.sort?l:(!0===t.sort?Object.keys(l).sort():Object.keys(l).sort(t.sort)).reduce(((e,t)=>{const a=l[t];return Boolean(a)&&"object"==typeof a&&!Array.isArray(a)?e[t]=c(a):e[t]=a,e}),Object.create(null))}t.extract=d,t.parse=p,t.stringify=(e,t)=>{if(!e)return"";i((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const a=a=>t.skipNull&&null==e[a]||t.skipEmptyString&&""===e[a],l=function(e){switch(e.arrayFormat){case"index":return t=>(a,l)=>{const r=a.length;return void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,[s(t,e),"[",r,"]"].join("")]:[...a,[s(t,e),"[",s(r,e),"]=",s(l,e)].join("")]};case"bracket":return t=>(a,l)=>void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,[s(t,e),"[]"].join("")]:[...a,[s(t,e),"[]=",s(l,e)].join("")];case"comma":case"separator":return t=>(a,l)=>null==l||0===l.length?a:0===a.length?[[s(t,e),"=",s(l,e)].join("")]:[[a,s(l,e)].join(e.arrayFormatSeparator)];default:return t=>(a,l)=>void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,s(t,e)]:[...a,[s(t,e),"=",s(l,e)].join("")]}}(t),r={};for(const t of Object.keys(e))a(t)||(r[t]=e[t]);const n=Object.keys(r);return!1!==t.sort&&n.sort(t.sort),n.map((a=>{const r=e[a];return void 0===r?"":null===r?s(a,t):Array.isArray(r)?r.reduce(l(a),[]).join("&"):s(a,t)+"="+s(r,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[a,l]=n(e,"#");return Object.assign({url:a.split("?")[0]||"",query:p(d(e),t)},t&&t.parseFragmentIdentifier&&l?{fragmentIdentifier:u(l,t)}:{})},t.stringifyUrl=(e,a)=>{a=Object.assign({encode:!0,strict:!0},a);const l=o(e.url).split("?")[0]||"",r=t.extract(e.url),n=t.parse(r,{sort:!1}),i=Object.assign(n,e.query);let u=t.stringify(i,a);u&&(u=`?${u}`);let c=function(e){let t="";const a=e.indexOf("#");return-1!==a&&(t=e.slice(a)),t}(e.url);return e.fragmentIdentifier&&(c=`#${s(e.fragmentIdentifier,a)}`),`${l}${u}${c}`}},131:function(e,t,a){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},132:function(e,t,a){"use strict";var l="%[a-f0-9]{2}",r=new RegExp(l,"gi"),n=new RegExp("("+l+")+","gi");function i(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var a=e.slice(0,t),l=e.slice(t);return Array.prototype.concat.call([],i(a),i(l))}function s(e){try{return decodeURIComponent(e)}catch(l){for(var t=e.match(r),a=1;a<t.length;a++)t=(e=i(t,a).join("")).match(r);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},a=n.exec(e);a;){try{t[a[0]]=decodeURIComponent(a[0])}catch(e){var l=s(a[0]);l!==a[0]&&(t[a[0]]=l)}a=n.exec(e)}t["%C2"]="�";for(var r=Object.keys(t),i=0;i<r.length;i++){var u=r[i];e=e.replace(new RegExp(u,"g"),t[u])}return e}(e)}}},133:function(e,t,a){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const a=e.indexOf(t);return-1===a?[e]:[e.slice(0,a),e.slice(a+t.length)]}},161:function(e,t,a){"use strict";a.r(t),a.d(t,"renderApp",(function(){return ra}));var l=a(11),r=a(28),n=a(0),i=a.n(n),s=a(26),u=a.n(s),c=a(18),o=a(13),d=a(17),m=a.n(d),p=a(31),E=a(129),g=a(16),y=a(4),b=a.n(y);const f=m.a.div.withConfig({displayName:"Container",componentId:"sc-gz9q42-0"})(["min-height:calc( 100vh - ","px );background:",";display:flex;flex-direction:column;"],(e=>2*parseFloat(e.theme.eui.euiHeaderHeightCompensation)),(e=>e.theme.eui.euiColorEmptyShade)),v=m.a.div.withConfig({displayName:"Wrapper",componentId:"sc-gz9q42-1"})(["display:flex;flex-direction:column;flex:1;"]),k=m.a.nav.withConfig({displayName:"Nav",componentId:"sc-gz9q42-2"})(["background:",";border-bottom:",";padding:",";.euiTabs{padding-left:3px;margin-left:-3px;}"],(e=>e.theme.eui.euiColorEmptyShade),(e=>e.theme.eui.euiBorderThin),(e=>`${e.theme.eui.euiSize} ${e.theme.eui.euiSizeL} ${e.theme.eui.euiSize} ${e.theme.eui.euiSizeL}`)),x=m.a.div.withConfig({displayName:"Container",componentId:"sc-399yyp-0"})(["border-bottom:",";background-color:",";"],(e=>e.theme.eui.euiBorderThin),(e=>e.theme.eui.euiPageBackgroundColor)),h=m.a.div.withConfig({displayName:"Wrapper",componentId:"sc-399yyp-1"})(["max-width:","px;margin-left:auto;margin-right:auto;padding-top:",";padding-left:",";padding-right:",";"],(e=>e.maxWidth||1200),(e=>e.theme.eui.paddingSizes.xl),(e=>e.theme.eui.paddingSizes.m),(e=>e.theme.eui.paddingSizes.m)),O=m()(l.EuiTabs).withConfig({displayName:"Tabs",componentId:"sc-399yyp-2"})(["top:1px;&:before{height:0px;}"]),j=Object(n.memo)((({leftColumn:e,rightColumn:t,rightColumnGrow:a})=>i.a.createElement(l.EuiFlexGroup,{alignItems:"center"},e?i.a.createElement(l.EuiFlexItem,null,e):null,t?i.a.createElement(l.EuiFlexItem,{grow:a},t):null)));j.displayName="HeaderColumns";const q=({leftColumn:e,rightColumn:t,rightColumnGrow:a,tabs:r,maxWidth:n,tabsClassName:s,"data-test-subj":u})=>i.a.createElement(x,{"data-test-subj":u},i.a.createElement(h,{maxWidth:n},i.a.createElement(j,{leftColumn:e,rightColumn:t,rightColumnGrow:a}),i.a.createElement(l.EuiFlexGroup,null,r?i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"s"}),i.a.createElement(O,{className:s},r.map((e=>i.a.createElement(l.EuiTab,b()({},e,{key:e.id}),e.name))))):i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"l"}))))),M=m()(l.EuiPage).withConfig({displayName:"Page",componentId:"sc-18dk5bh-0"})(["background:",";width:100%;align-self:center;margin-left:0;margin-right:0;flex:1;"],(e=>e.theme.eui.euiColorEmptyShade)),C=m.a.div.withConfig({displayName:"ContentWrapper",componentId:"sc-18dk5bh-1"})(["height:100%;"]),F=({restrictWidth:e,restrictHeaderWidth:t,children:a,"data-test-subj":r,...s})=>i.a.createElement(n.Fragment,null,i.a.createElement(q,b()({maxWidth:t,"data-test-subj":r?`${r}_header`:void 0},s)),i.a.createElement(M,{restrictWidth:e||1200,"data-test-subj":r?`${r}_page`:void 0},i.a.createElement(l.EuiPageBody,null,i.a.createElement(C,null,i.a.createElement(l.EuiSpacer,{size:"m"}),a))));var S=a(12),T=a(2),I=a(39),w=a(30);const _={href:I.a.overview(),text:S.i18n.translate("xpack.osquery.breadcrumbs.appTitle",{defaultMessage:"Osquery"})},P={base:()=>[_],overview:()=>[_,{text:S.i18n.translate("xpack.osquery.breadcrumbs.overviewPageTitle",{defaultMessage:"Overview"})}],live_queries:()=>[_,{text:S.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})}],live_query_new:()=>[_,{href:I.a.live_queries(),text:S.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})},{text:S.i18n.translate("xpack.osquery.breadcrumbs.newLiveQueryPageTitle",{defaultMessage:"New"})}],live_query_details:({liveQueryId:e})=>[_,{href:I.a.live_queries(),text:S.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})},{text:e}],saved_queries:()=>[_,{text:S.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})}],saved_query_new:()=>[_,{href:I.a.saved_queries(),text:S.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})},{text:S.i18n.translate("xpack.osquery.breadcrumbs.newSavedQueryPageTitle",{defaultMessage:"New"})}],saved_query_edit:({savedQueryName:e})=>[_,{href:I.a.saved_queries(),text:S.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})},{text:e}],packs:()=>[_,{text:S.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})}],pack_add:()=>[_,{href:I.a.packs(),text:S.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{text:S.i18n.translate("xpack.osquery.breadcrumbs.addpacksPageTitle",{defaultMessage:"Add"})}],pack_details:({packName:e})=>[_,{href:I.a.packs(),text:S.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{text:e}],pack_edit:({packName:e,packId:t})=>[_,{href:I.a.packs(),text:S.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{href:I.a.pack_details({packId:t}),text:e},{text:S.i18n.translate("xpack.osquery.breadcrumbs.editpacksPageTitle",{defaultMessage:"Edit"})}]};function Q(e,t={}){var a;const{chrome:l,http:r}=Object(w.e)().services,n=(null===(a=P[e])||void 0===a?void 0:a.call(P,t).map((e=>({...e,href:e.href?r.basePath.prepend(`${T.a}${e.href}`):void 0}))))||[],i=[...n].reverse().map((e=>e.text));l.docTitle.change(i),l.setBreadcrumbs(n)}var N=a(15),L=a(50),B=a(37);const A=(e,t)=>({activePage:e,cursorStart:e*t,fakePossibleCount:4<=e&&e>0?t*(e+2):5*t,querySize:t});var z=a(32);const R=i.a.memo((({actionId:e})=>{const t=Object(w.f)(`live_queries/${e}`);return i.a.createElement(l.EuiButtonIcon,b()({iconType:"visTable"},t))}));R.displayName="ActionTableResultsButton";const D=()=>{var e;const{push:t}=Object(c.useHistory)(),[a,r]=Object(n.useState)(0),[s,u]=Object(n.useState)(20),{data:o}=(({activePage:e,direction:t,limit:a,sortField:l,filterQuery:r,skip:n=!1})=>{const{data:i}=Object(w.e)().services,s=Object(z.a)();return Object(p.useQuery)(["actions",{activePage:e,direction:t,limit:a,sortField:l}],(async()=>{const n=await i.search.search({factoryQueryType:B.b.actions,filterQuery:Object(L.a)(r),pagination:A(e,a),sort:{direction:t,field:l}},{strategy:"osquerySearchStrategy"}).toPromise();return{...n,actions:n.edges,inspect:(s=n,u={},{dsl:null!==(c=null!==(o=null==s||null===(d=s.inspect)||void 0===d?void 0:d.dsl)&&void 0!==o?o:null==u?void 0:u.dsl)&&void 0!==c?c:[],response:null!=s?[JSON.stringify(s.rawResponse,null,2)]:null==u?void 0:u.response})};var s,u,c,o,d}),{keepPreviousData:!0,enabled:!n,onSuccess:()=>s(),onError:e=>s(e,{title:S.i18n.translate("xpack.osquery.all_actions.fetchError",{defaultMessage:"Error while fetching actions"})})})})({activePage:a,limit:s,direction:B.a.desc,sortField:"@timestamp"}),d=Object(n.useCallback)((({page:e={}})=>{const{index:t,size:a}=e;r(t),u(a)}),[]),m=Object(n.useCallback)(((e,t)=>i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"s",paddingSize:"none",transparentBackground:!0},t._source.data.query)),[]),E=Object(n.useCallback)(((e,t)=>{var a,l;return i.a.createElement(i.a.Fragment,null,null!==(a=null===(l=t.fields.agents)||void 0===l?void 0:l.length)&&void 0!==a?a:0)}),[]),g=Object(n.useCallback)((e=>Object(N.isArray)(e)?e[0]:"-"),[]),y=Object(n.useCallback)(((e,t)=>i.a.createElement(i.a.Fragment,null,Object(l.formatDate)(t.fields["@timestamp"][0]))),[]),b=Object(n.useCallback)((e=>i.a.createElement(R,{actionId:e.fields.action_id[0]})),[]),f=Object(n.useCallback)((e=>t("/live_queries/new",{form:Object(N.pickBy)({agentIds:e.fields.agents,query:e._source.data.query,ecs_mapping:e._source.data.ecs_mapping,savedQueryId:e._source.data.saved_query_id},(e=>!Object(N.isEmpty)(e)))})),[t]),v=Object(n.useMemo)((()=>[{field:"query",name:S.i18n.translate("xpack.osquery.liveQueryActions.table.queryColumnTitle",{defaultMessage:"Query"}),truncateText:!0,render:m},{field:"agents",name:S.i18n.translate("xpack.osquery.liveQueryActions.table.agentsColumnTitle",{defaultMessage:"Agents"}),width:"100px",render:E},{field:"created_at",name:S.i18n.translate("xpack.osquery.liveQueryActions.table.createdAtColumnTitle",{defaultMessage:"Created at"}),width:"200px",render:y},{field:"fields.user_id",name:S.i18n.translate("xpack.osquery.liveQueryActions.table.createdByColumnTitle",{defaultMessage:"Run by"}),width:"200px",render:g},{name:S.i18n.translate("xpack.osquery.liveQueryActions.table.viewDetailsColumnTitle",{defaultMessage:"View details"}),actions:[{type:"icon",icon:"play",onClick:f},{render:b}]}]),[f,b,E,g,m,y]),k=Object(n.useMemo)((()=>{var e;return{pageIndex:a,pageSize:s,totalItemCount:null!==(e=null==o?void 0:o.totalCount)&&void 0!==e?e:0,pageSizeOptions:[20,50,100]}}),[null==o?void 0:o.totalCount,a,s]);return i.a.createElement(l.EuiBasicTable,{items:null!==(e=null==o?void 0:o.actions)&&void 0!==e?e:[],columns:v,pagination:k,onChange:d})},G=i.a.memo(D),$=()=>{const e=Object(w.e)().services.application.capabilities.osquery;Q("live_queries");const t=Object(w.f)("live_queries/new"),a=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.liveQueriesHistory.pageTitle",defaultMessage:"Live queries history"})))))),[]),r=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,b()({fill:!0},t,{iconType:"plusInCircle",isDisabled:!(e.writeLiveQueries||e.runSavedQueries)}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.liveQueriesHistory.newLiveQueryButtonLabel",defaultMessage:"New live query"}))),[e.writeLiveQueries,e.runSavedQueries,t]);return i.a.createElement(F,{leftColumn:a,rightColumn:r,rightColumnGrow:!1},i.a.createElement(G,null))},V=i.a.memo($);var U=a(130),W=a.n(U),H=a(69);const Y=()=>{var e;Q("live_query_new");const{replace:t}=Object(c.useHistory)(),a=Object(c.useLocation)(),r=Object(w.f)("live_queries"),[s,u]=Object(n.useState)({}),d=Object(n.useMemo)((()=>{const e=W.a.parse(a.search);return null!=e&&e.agentPolicyId?[null==e?void 0:e.agentPolicyId]:void 0}),[a.search]);Object(n.useEffect)((()=>{var e,l;null!==(e=a.state)&&void 0!==e&&e.form&&(u(null===(l=a.state)||void 0===l?void 0:l.form),t({state:null}))}),[null===(e=a.state)||void 0===e?void 0:e.form,t]);const m=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,b()({iconType:"arrowLeft"},r,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.newLiveQuery.viewLiveQueriesHistoryTitle",defaultMessage:"View live queries history"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.newLiveQuery.pageTitle",defaultMessage:"New live query"})))))),[r]);return i.a.createElement(F,{leftColumn:m},i.a.createElement(H.a,b()({agentPolicyIds:d},s)))},J=i.a.memo(Y);var X=a(88),K=a(107);const Z=()=>{var e,t,a,r;const{actionId:s}=Object(c.useParams)();Q("live_query_details",{liveQueryId:s});const u=Object(w.f)("live_queries"),{data:d}=Object(X.a)({actionId:s}),m=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,b()({iconType:"arrowLeft"},u,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.liveQueryDetails.viewLiveQueriesHistoryTitle",defaultMessage:"View live queries history"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.liveQueryDetails.pageTitle",defaultMessage:"Live query details"})))))),[u]);return i.a.createElement(F,{leftColumn:m,rightColumnGrow:!1},i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"m",paddingSize:"m"},null==d||null===(e=d.actionDetails._source)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.query),i.a.createElement(l.EuiSpacer,null),i.a.createElement(K.a,{actionId:s,agentIds:null==d||null===(a=d.actionDetails)||void 0===a||null===(r=a.fields)||void 0===r?void 0:r.agents,startDate:Object(N.get)(d,["actionDetails","fields","@timestamp","0"]),endDate:Object(N.get)(d,"actionDetails.fields.expiration[0]")}))},ee=i.a.memo(Z),te=m()(l.EuiPanel).withConfig({displayName:"Panel",componentId:"sc-1msa277-0"})(["max-width:500px;margin-right:auto;margin-left:auto;"]),ae=()=>i.a.createElement("div",null,i.a.createElement(l.EuiSpacer,null),i.a.createElement(te,null,i.a.createElement(l.EuiEmptyPrompt,{iconType:"securityApp",title:i.a.createElement("h2",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.permissionDeniedErrorTitle",defaultMessage:"Permission denied"})),body:i.a.createElement("p",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.permissionDeniedErrorMessage",defaultMessage:"You are not authorized to access this page."}))})),i.a.createElement(l.EuiSpacer,null)),le=i.a.memo(ae),re=()=>{const e=Object(w.e)().services.application.capabilities.osquery;Q("live_queries");const t=Object(c.useRouteMatch)();return e.readLiveQueries?i.a.createElement(c.Switch,null,i.a.createElement(c.Route,{path:`${t.url}/new`},e.runSavedQueries||e.writeLiveQueries?i.a.createElement(J,null):i.a.createElement(le,null)),i.a.createElement(c.Route,{path:`${t.url}/:actionId`},i.a.createElement(ee,null)),i.a.createElement(c.Route,{path:`${t.url}`},i.a.createElement(V,null))):i.a.createElement(le,null)},ne=i.a.memo(re);var ie=a(24),se=a.n(ie),ue=a(46);const ce=({disabled:e=!1,savedQuery:t})=>{const{push:a}=Object(c.useHistory)(),r=Object(n.useCallback)((()=>a("/live_queries/new",{form:{savedQueryId:t.id,query:t.attributes.query,ecs_mapping:t.attributes.ecs_mapping}})),[a,t]);return i.a.createElement(l.EuiButtonIcon,{color:"primary",iconType:"play",isDisabled:e,onClick:r,"aria-label":S.i18n.translate("xpack.osquery.savedQueryList.queriesTable.runActionAriaLabel",{defaultMessage:"Run {savedQueryName}",values:{savedQueryName:t.attributes.name}})})},oe=i.a.memo(ce),de=({disabled:e=!1,savedQueryId:t,savedQueryName:a})=>{const r=Object(w.f)(`saved_queries/${t}`);return i.a.createElement(l.EuiButtonIcon,b()({color:"primary"},r,{iconType:"pencil",isDisabled:e,"aria-label":S.i18n.translate("xpack.osquery.savedQueryList.queriesTable.editActionAriaLabel",{defaultMessage:"Edit {savedQueryName}",values:{savedQueryName:a}})}))},me=i.a.memo(de),pe=()=>{const e=Object(w.e)().services.application.capabilities.osquery;Q("saved_queries");const t=Object(w.f)("saved_queries/new"),[a,r]=Object(n.useState)(0),[s,u]=Object(n.useState)(20),[c,d]=Object(n.useState)("attributes.updated_at"),[m,p]=Object(n.useState)("desc"),{data:E}=Object(ue.a)({isLive:!0}),g=Object(n.useCallback)((e=>i.a.createElement(me,{savedQueryId:e.id,savedQueryName:e.attributes.name})),[]),y=Object(n.useCallback)((t=>i.a.createElement(oe,{savedQuery:t,disabled:!(e.runSavedQueries||e.writeLiveQueries)})),[e.runSavedQueries,e.writeLiveQueries]),f=Object(n.useCallback)(((e,t)=>{if(!e)return"-";const a=t.attributes.updated_by!==t.attributes.created_by?` @ ${t.attributes.updated_by}`:"";return e?`${se()(e).fromNow()}${a}`:"-"}),[]),v=Object(n.useMemo)((()=>[{field:"attributes.id",name:S.i18n.translate("xpack.osquery.savedQueries.table.queryIdColumnTitle",{defaultMessage:"Query ID"}),sortable:!0,truncateText:!0},{field:"attributes.description",name:S.i18n.translate("xpack.osquery.savedQueries.table.descriptionColumnTitle",{defaultMessage:"Description"}),sortable:!0,truncateText:!0},{field:"attributes.created_by",name:S.i18n.translate("xpack.osquery.savedQueries.table.createdByColumnTitle",{defaultMessage:"Created by"}),sortable:!0,truncateText:!0},{field:"attributes.updated_at",name:S.i18n.translate("xpack.osquery.savedQueries.table.updatedAtColumnTitle",{defaultMessage:"Last updated at"}),sortable:e=>e.attributes.updated_at?Date.parse(e.attributes.updated_at):0,truncateText:!0,render:f},{name:S.i18n.translate("xpack.osquery.savedQueries.table.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:y},{render:g}]}]),[g,y,f]),k=Object(n.useCallback)((({page:e={},sort:t={}})=>{r(e.index),u(e.size),d(t.field),p(t.direction)}),[]),x=Object(n.useMemo)((()=>{var e;return{pageIndex:a,pageSize:s,totalItemCount:null!==(e=null==E?void 0:E.total)&&void 0!==e?e:0,pageSizeOptions:[10,20,50,100]}}),[a,s,null==E?void 0:E.total]),h=Object(n.useMemo)((()=>({sort:{field:c,direction:m}})),[m,c]),O=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.savedQueryList.pageTitle",defaultMessage:"Saved queries"})))))),[]),j=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,b()({fill:!0},t,{iconType:"plusInCircle",isDisabled:!e.writeSavedQueries}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.savedQueryList.addSavedQueryButtonLabel",defaultMessage:"Add saved query"}))),[e.writeSavedQueries,t]);return i.a.createElement(F,{leftColumn:O,rightColumn:j,rightColumnGrow:!1},(null==E?void 0:E.saved_objects)&&i.a.createElement(l.EuiInMemoryTable,{items:null==E?void 0:E.saved_objects,itemId:"id",columns:v,pagination:x,sorting:h,onChange:k,rowHeader:"id"}))},Ee=i.a.memo(pe);var ge=a(34),ye=a(70),be=a(60);const fe=({defaultValue:e,handleSubmit:t})=>{const a=Object(n.useRef)(null),r=Object(w.f)("saved_queries"),{form:s}=Object(be.a)({defaultValue:e,savedQueryFormRef:a,handleSubmit:t}),{submit:u,isSubmitting:c,isValid:d}=s;return i.a.createElement(ge.d,{form:s},i.a.createElement(ye.a,{ref:a,hasPlayground:!0,isValid:d}),i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,b()({color:"ghost"},r),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addSavedQuery.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:c,color:"primary",fill:!0,size:"m",iconType:"save",onClick:u},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addSavedQuery.form.saveQueryButtonLabel",defaultMessage:"Save query"}))))))),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}))},ve=i.a.memo(fe);var ke=a(101);const xe=()=>{Q("saved_query_new");const e=Object(w.f)("saved_queries"),{mutateAsync:t}=Object(ke.a)({withRedirect:!0}),a=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,b()({iconType:"arrowLeft"},e,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addSavedQuery.viewSavedQueriesListTitle",defaultMessage:"View all saved queries"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addSavedQuery.pageTitle",defaultMessage:"Add saved query"})))))),[e]);return i.a.createElement(F,{leftColumn:a},i.a.createElement(ve,{handleSubmit:t}))},he=i.a.memo(xe);var Oe=a(20);const je=({defaultValue:e,handleSubmit:t,viewMode:a})=>{const r=Object(n.useRef)(null),s=Object(w.f)("saved_queries"),{form:u}=Object(be.a)({defaultValue:e,savedQueryFormRef:r,handleSubmit:t}),{submit:c,isSubmitting:d}=u;return i.a.createElement(ge.d,{form:u},i.a.createElement(ye.a,{ref:r,viewMode:a,hasPlayground:!0}),!a&&i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,b()({color:"ghost"},s),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:d,color:"primary",fill:!0,size:"m",iconType:"save",onClick:c},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.form.updateQueryButtonLabel",defaultMessage:"Update query"}))))))),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"})))},qe=i.a.memo(je);var Me=a(108);const Ce=()=>{var e,t,a;const r=Object(w.e)().services.application.capabilities.osquery,[s,u]=Object(n.useState)(!1),{savedQueryId:d}=Object(c.useParams)(),m=Object(w.f)("saved_queries"),{isLoading:p,data:E}=Object(Me.c)({savedQueryId:d}),g=Object(Me.d)({savedQueryId:d}),y=Object(Me.b)({savedQueryId:d});Q("saved_query_edit",{savedQueryName:null!==(e=null==E||null===(t=E.attributes)||void 0===t?void 0:t.id)&&void 0!==e?e:""});const f=Object(n.useMemo)((()=>!r.writeSavedQueries),[r.writeSavedQueries]),v=Object(n.useCallback)((()=>{u(!1)}),[]),k=Object(n.useCallback)((()=>{u(!0)}),[]),x=Object(n.useCallback)((()=>{y.mutateAsync().then((()=>{v()}))}),[y,v]),h=Object(n.useMemo)((()=>{var e,t,a,r;return i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,b()({iconType:"arrowLeft"},m,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.viewSavedQueriesListTitle",defaultMessage:"View all saved queries"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,f?i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.viewSavedQuery.pageTitle",defaultMessage:'"{savedQueryId}" details',values:{savedQueryId:null!==(e=null==E||null===(t=E.attributes)||void 0===t?void 0:t.id)&&void 0!==e?e:""}}):i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.pageTitle",defaultMessage:'Edit "{savedQueryId}"',values:{savedQueryId:null!==(a=null==E||null===(r=E.attributes)||void 0===r?void 0:r.id)&&void 0!==a?a:""}})))))}),[null==E||null===(a=E.attributes)||void 0===a?void 0:a.id,m,f]),O=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,{color:"danger",onClick:k,iconType:"trash"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editSavedQuery.deleteSavedQueryButtonLabel",defaultMessage:"Delete query"}))),[k]);return p?null:i.a.createElement(F,{leftColumn:h,rightColumn:f?void 0:O,rightColumnGrow:!1},!p&&!Object(Oe.isEmpty)(E)&&i.a.createElement(qe,{defaultValue:null==E?void 0:E.attributes,handleSubmit:g.mutateAsync,viewMode:f}),s?i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.title",defaultMessage:"Are you sure you want to delete this query?"}),onCancel:v,onConfirm:x,cancelButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.confirmButtonLabel",defaultMessage:"Confirm"}),buttonColor:"danger",defaultFocusedButton:"confirm"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.body",defaultMessage:"You're about to delete this query. Are you sure you want to do this?"})):null)},Fe=i.a.memo(Ce),Se=()=>{const e=Object(w.e)().services.application.capabilities.osquery;Q("saved_queries");const t=Object(c.useRouteMatch)();return e.readSavedQueries?i.a.createElement(c.Switch,null,i.a.createElement(c.Route,{path:`${t.url}/new`},e.writeSavedQueries?i.a.createElement(he,null):i.a.createElement(le,null)),i.a.createElement(c.Route,{path:`${t.url}/:savedQueryId`},i.a.createElement(Fe,null)),i.a.createElement(c.Route,{path:`${t.url}`},i.a.createElement(Ee,null))):i.a.createElement(le,null)},Te=i.a.memo(Se),Ie="packList";var we=a(63);const _e=({onConfirm:e,onCancel:t,agentCount:a,agentPolicyCount:r})=>i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalTitle",defaultMessage:"Save and deploy changes"}),onCancel:t,onConfirm:e,cancelButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalCancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalConfirmButtonLabel",defaultMessage:"Save and deploy changes"}),buttonColor:"primary"},i.a.createElement(l.EuiCallOut,{iconType:"iInCircle",title:S.i18n.translate("xpack.osquery.agentPolicy.confirmModalCalloutTitle",{defaultMessage:"This action will update {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:a}})},i.a.createElement("div",{className:"eui-textBreakWord"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalCalloutDescription",defaultMessage:"Fleet has detected that the selected {agentPolicyCount, plural, one {agent policy} other {agent policies}}, is already in use by some of your agents. As a result of this action, Fleet will deploy updates to all agents that use this {agentPolicyCount, plural, one {agent policy} other {agent policies}}.",values:{agentPolicyCount:r}}))),i.a.createElement(l.EuiSpacer,{size:"l"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalDescription",defaultMessage:"Are you sure you wish to continue?"})),Pe=i.a.memo(_e);var Qe=a(1);const Ne=({withRedirect:e,options:t})=>{const a=Object(p.useQueryClient)(),{application:{navigateToApp:l},http:r,notifications:{toasts:n}}=Object(w.e)().services,i=Object(z.a)();return Object(p.useMutation)((({id:e,...t})=>r.put(`/internal/osquery/packs/${e}`,{body:JSON.stringify(t)})),{onError:e=>{i(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:t=>{var r,i;a.invalidateQueries(Ie),e&&l(Qe.PLUGIN_ID,{path:I.a.packs()}),n.addSuccess(S.i18n.translate("xpack.osquery.updatePack.successToastMessageText",{defaultMessage:'Successfully updated "{packName}" pack',values:{packName:null!==(r=null===(i=t.attributes)||void 0===i?void 0:i.name)&&void 0!==r?r:""}}))},...t})},Le=m()(l.EuiLoadingSpinner).withConfig({displayName:"StyledEuiLoadingSpinner",componentId:"sc-12idgjh-0"})(["margin-right:",";"],(({theme:e})=>e.eui.paddingSizes.s)),Be=({item:e})=>{const t=Object(p.useQueryClient)(),{application:{capabilities:{osquery:a}},notifications:{toasts:r}}=Object(w.e)().services,s=Object(z.a)(),[u,c]=Object(n.useState)(!1),o=Object(n.useCallback)((()=>c(!1)),[]),{data:d}=Object(we.a)(),m=Object(n.useMemo)((()=>e.policy_ids.reduce(((e,t)=>{var a;return e+((null==d||null===(a=d.agentPoliciesById[t])||void 0===a?void 0:a.agents)||0)}),0)),[null==d?void 0:d.agentPoliciesById,e.policy_ids]),{isLoading:E,mutateAsync:g}=Ne({options:{onSuccess:e=>{t.invalidateQueries("packList"),s(),r.addSuccess(e.attributes.enabled?S.i18n.translate("xpack.osquery.pack.table.activatedSuccessToastMessageText",{defaultMessage:'Successfully activated "{packName}" pack',values:{packName:e.attributes.name}}):S.i18n.translate("xpack.osquery.pack.table.deactivatedSuccessToastMessageText",{defaultMessage:'Successfully deactivated "{packName}" pack',values:{packName:e.attributes.name}}))},onError:e=>{s(e,{title:e.body.error,toastMessage:e.body.message})}}}),y=Object(n.useCallback)((()=>{g({id:e.id,enabled:!e.attributes.enabled}),o()}),[o,e,g]),b=Object(n.useCallback)((()=>{if(m)return c(!0);y()}),[m,y]);return i.a.createElement(i.a.Fragment,null,E&&i.a.createElement(Le,null),i.a.createElement(l.EuiSwitch,{checked:e.attributes.enabled,disabled:!a.writePacks||E,showLabel:!1,label:"",onChange:b}),u&&m&&i.a.createElement(Pe,{onConfirm:y,onCancel:o,agentCount:m,agentPolicyCount:e.policy_ids.length}))},Ae=i.a.memo(Be);var ze=a(22),Re=a(21),De=a(64);const Ge=m()(l.EuiLink).withConfig({displayName:"StyledEuiLink",componentId:"sc-n9jy5t-0"})(["white-space:nowrap;text-overflow:ellipsis;overflow:hidden;"]),$e=({policyId:e})=>{var t;const{application:{getUrlForApp:a,navigateToApp:l}}=Object(w.e)().services,{data:r}=Object(De.a)({policyId:e}),s=Object(n.useMemo)((()=>a(ze.PLUGIN_ID,{path:Re.pagePathGetters.policy_details({policyId:e})[1]})),[a,e]),u=Object(n.useCallback)((t=>{if(!Object(w.d)(t)&&Object(w.c)(t))return t.preventDefault(),l(ze.PLUGIN_ID,{path:Re.pagePathGetters.policy_details({policyId:e})[1]})}),[l,e]);return i.a.createElement(Ge,{href:s,onClick:u},null!==(t=null==r?void 0:r.name)&&void 0!==t?t:e)},Ve=i.a.memo($e),Ue=m.a.span.withConfig({displayName:"UpdatedBy",componentId:"sc-mndcml-0"})(["white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"]),We=({id:e,name:t})=>i.a.createElement(l.EuiLink,Object(w.f)(`packs/${e}`),t),He=i.a.memo(We),Ye=(e,t)=>i.a.createElement(He,{id:t.id,name:t.attributes.name}),Je=({agentPolicyIds:e})=>{const[t,a]=Object(n.useState)(!1),r=Object(n.useCallback)((()=>a((e=>!e))),[]),s=Object(n.useCallback)((()=>a(!1)),[]),u=Object(n.useMemo)((()=>{var t;return i.a.createElement(l.EuiButtonEmpty,{size:"s",flush:"both",onClick:r},i.a.createElement(i.a.Fragment,null,null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0))}),[null==e?void 0:e.length,r]);var c;return null!=e&&e.length?i.a.createElement(l.EuiPopover,{button:u,isOpen:t,closePopover:s,initialFocus:!1},i.a.createElement(l.EuiText,{size:"s"},null==e?void 0:e.map((e=>i.a.createElement("div",{key:e},i.a.createElement(Ve,{policyId:e})))))):i.a.createElement(i.a.Fragment,null,null!==(c=null==e?void 0:e.length)&&void 0!==c?c:0)},Xe=()=>{var e;const{data:t}=(({isLive:e=!1,pageIndex:t=0,pageSize:a=1e4,sortField:l="updated_at",sortDirection:r="desc"})=>{const{http:n}=Object(w.e)().services;return Object(p.useQuery)([Ie,{pageIndex:t,pageSize:a,sortField:l,sortDirection:r}],(async()=>n.get("/internal/osquery/packs",{query:{pageIndex:t,pageSize:a,sortField:l,sortDirection:r}})),{keepPreviousData:!0,refetchInterval:!!e&&1e4})})({}),a=Object(n.useCallback)((e=>i.a.createElement(Je,{agentPolicyIds:e})),[]),r=Object(n.useCallback)((e=>{var t;return i.a.createElement(i.a.Fragment,null,null!==(t=e&&Object.keys(e).length)&&void 0!==t?t:0)}),[]),s=Object(n.useCallback)(((e,t)=>i.a.createElement(Ae,{item:t})),[]),u=Object(n.useCallback)(((e,t)=>{if(!e)return"-";const a=t.attributes.updated_by!==t.attributes.created_by?` @ ${t.attributes.updated_by}`:"";return e?i.a.createElement(l.EuiToolTip,{content:`${se()(e).fromNow()}${a}`},i.a.createElement(Ue,null,`${se()(e).fromNow()}${a}`)):"-"}),[]),c=Object(n.useMemo)((()=>[{field:"attributes.name",name:S.i18n.translate("xpack.osquery.packs.table.nameColumnTitle",{defaultMessage:"Name"}),sortable:!0,render:Ye},{field:"policy_ids",name:S.i18n.translate("xpack.osquery.packs.table.policyColumnTitle",{defaultMessage:"Scheduled policies"}),truncateText:!0,render:a},{field:"attributes.queries",name:S.i18n.translate("xpack.osquery.packs.table.numberOfQueriesColumnTitle",{defaultMessage:"Number of queries"}),render:r,width:"150px"},{field:"attributes.created_by",name:S.i18n.translate("xpack.osquery.packs.table.createdByColumnTitle",{defaultMessage:"Created by"}),sortable:!0,truncateText:!0},{field:"attributes.updated_at",name:"Last updated",sortable:e=>e.updated_at?Date.parse(e.updated_at):0,truncateText:!0,render:u},{field:"attributes.enabled",name:S.i18n.translate("xpack.osquery.packs.table.activeColumnTitle",{defaultMessage:"Active"}),sortable:!0,align:"right",width:"80px",render:s}]),[s,a,r,u]),o=Object(n.useMemo)((()=>({sort:{field:"attributes.name",direction:"asc"}})),[]);return i.a.createElement(l.EuiInMemoryTable,{items:null!==(e=null==t?void 0:t.saved_objects)&&void 0!==e?e:[],columns:c,pagination:!0,sorting:o})},Ke=i.a.memo(Xe),Ze=()=>{const e=Object(w.e)().services.application.capabilities.osquery,t=Object(w.f)("packs/add"),a=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packList.pageTitle",defaultMessage:"Packs"})))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,{color:"subdued"},i.a.createElement("p",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packList.pageSubtitle",defaultMessage:"Create packs to organize sets of queries and to schedule queries for agent policies."})))))),[]),r=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,b()({fill:!0},t,{iconType:"plusInCircle",isDisabled:!e.writePacks}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packList.addPackButtonLabel",defaultMessage:"Add pack"}))),[t,e.writePacks]);return i.a.createElement(F,{leftColumn:a,rightColumn:r,rightColumnGrow:!1},i.a.createElement(Ke,null))},et=i.a.memo(Ze),tt=m()(l.EuiFlexItem).withConfig({displayName:"AgentPolicyNameColumn",componentId:"sc-1xn7fsq-0"})(["max-width:",";overflow:hidden;"],(e=>e.grow/9*100+"%")),at=m()(l.EuiFlexItem).withConfig({displayName:"AgentPolicyDescriptionColumn",componentId:"sc-1xn7fsq-1"})(["max-width:",";overflow:hidden;"],(e=>e.grow/9*100+"%")),lt=({euiFieldProps:e,field:t,agentPoliciesById:a})=>{const{value:r,setValue:s}=t,u=Object(n.useMemo)((()=>Object.entries(a).map((([e,t])=>({key:e,label:t.name})))),[a]),c=Object(n.useMemo)((()=>r.map((e=>{var t,l;return{key:e,label:null!==(t=null===(l=a[e])||void 0===l?void 0:l.name)&&void 0!==t?t:e}}))),[a,r]),d=Object(n.useCallback)((e=>{s(e.map((e=>e.key||e.label)))}),[s]),m=Object(n.useCallback)((e=>{var t,r,n,s,u;return i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(tt,{grow:2},i.a.createElement("span",{className:"eui-textTruncate"},null!==(t=e.key&&(null===(r=a[e.key])||void 0===r?void 0:r.name))&&void 0!==t?t:e.label)),i.a.createElement(at,{grow:5},i.a.createElement(l.EuiTextColor,{className:"eui-textTruncate",color:"subdued"},null!==(n=e.key&&a[e.key].description)&&void 0!==n?n:"")),i.a.createElement(l.EuiFlexItem,{grow:2,className:"eui-textRight"},i.a.createElement(l.EuiTextColor,{color:"subdued"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.createScheduledQuery.agentPolicyAgentsCountText",defaultMessage:"{count, plural, one {# agent} other {# agents}} enrolled",values:{count:null!==(s=e.key&&(null===(u=a[e.key])||void 0===u?void 0:u.agents))&&void 0!==s?s:0}}))))}),[a]),p=Object(n.useMemo)((()=>{if(null==r||!r.length||!r[0].length||!a)return;const e=Object(N.reduce)(r,((e,t)=>{var l;const r=a&&a[t];return e+(null!==(l=null==r?void 0:r.agents)&&void 0!==l?l:0)}),0);return i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.createScheduledQuery.agentPolicyAgentsCountText",defaultMessage:"{count, plural, one {# agent} other {# agents}} enrolled",values:{count:e}})}),[a,r]),E=Object(n.useMemo)((()=>({onCreateOption:null,noSuggestions:!1,isClearable:!0,selectedOptions:c,options:u,renderOption:m,onChange:d,...e})),[e,d,u,m,c]);return i.a.createElement(ge.a,{field:t,fullWidth:!0,helpText:p,euiFieldProps:E})},rt=i.a.memo(lt);var nt=a(42),it=a(98),st=a(96);const ut=({platform:e})=>{const[t,a]=Object(n.useState)(it.a);Object(n.useEffect)((()=>{a((t=>{if(e){let a;try{a=null==e?void 0:e.split(",").map((e=>e.trim()))}catch(e){return t}return a}return it.a}))}),[e]);const r=Object(n.useMemo)((()=>t.map((e=>i.a.createElement(l.EuiFlexItem,{key:e,grow:!1},i.a.createElement(st.a,{platform:e}))))),[t]);return i.a.createElement(l.EuiFlexGroup,{gutterSize:"s"},r)},ct=i.a.memo(ut),ot=({data:e,onDeleteClick:t,onEditClick:a,selectedItems:r,setSelectedItems:s})=>{const u=Object(n.useCallback)((e=>i.a.createElement(l.EuiButtonIcon,{color:"danger",onClick:()=>t(e),iconType:"trash","aria-label":S.i18n.translate("xpack.osquery.pack.queriesTable.deleteActionAriaLabel",{defaultMessage:"Delete {queryName}",values:{queryName:e.id}})})),[t]),c=Object(n.useCallback)((e=>i.a.createElement(l.EuiButtonIcon,{color:"primary",onClick:()=>a(e),iconType:"pencil","aria-label":S.i18n.translate("xpack.osquery.pack.queriesTable.editActionAriaLabel",{defaultMessage:"Edit {queryName}",values:{queryName:e.id}})})),[a]),o=Object(n.useCallback)((e=>i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"s",paddingSize:"none",transparentBackground:!0},e)),[]),d=Object(n.useCallback)((e=>i.a.createElement(ct,{platform:e})),[]),m=Object(n.useCallback)((e=>e?`${e}`:S.i18n.translate("xpack.osquery.pack.queriesTable.osqueryVersionAllLabel",{defaultMessage:"ALL"})),[]),p=Object(n.useMemo)((()=>[{field:"id",name:S.i18n.translate("xpack.osquery.pack.queriesTable.idColumnTitle",{defaultMessage:"ID"}),width:"20%"},{field:"interval",name:S.i18n.translate("xpack.osquery.pack.queriesTable.intervalColumnTitle",{defaultMessage:"Interval (s)"}),width:"100px"},{field:"query",name:S.i18n.translate("xpack.osquery.pack.queriesTable.queryColumnTitle",{defaultMessage:"Query"}),render:o},{field:"platform",name:S.i18n.translate("xpack.osquery.pack.queriesTable.platformColumnTitle",{defaultMessage:"Platform"}),render:d},{field:"version",name:S.i18n.translate("xpack.osquery.pack.queriesTable.versionColumnTitle",{defaultMessage:"Min Osquery version"}),render:m},{name:S.i18n.translate("xpack.osquery.pack.queriesTable.actionsColumnTitle",{defaultMessage:"Actions"}),width:"120px",actions:[{render:c},{render:u}]}]),[u,c,d,o,m]),E=Object(n.useMemo)((()=>({sort:{field:"id",direction:"asc"}})),[]),g=Object(n.useCallback)((e=>Object(Oe.get)("id",e)),[]),y=Object(n.useMemo)((()=>({onSelectionChange:s,initialSelected:r})),[r,s]);return i.a.createElement(l.EuiBasicTable,{items:e,itemId:g,columns:p,sorting:E,selection:y,isSelectable:!0})},dt=i.a.memo(ot);var mt=a(100),pt=a(95),Et=a(94),gt=a(89),yt=a.n(gt),bt=a(92);var ft=a(102),vt=a(62);const kt=Object(ge.i)({component:ge.c}),xt=({uniqueQueryIds:e,defaultValue:t,onSave:a,onClose:r})=>{const s=Object(n.useRef)(),[u]=Object(n.useState)(!!t),{form:c}=(({uniqueQueryIds:e,defaultValue:t,handleSubmit:a})=>{const l=Object(n.useMemo)((()=>new Set(Object(N.xor)(e,null!=t&&t.id?[t.id]:[]))),[e,t]),r=Object(n.useMemo)((()=>Object(bt.a)(l)),[l]);return Object(ge.j)({id:"editQueryFlyoutForm"+yt.a.v4(),onSubmit:async(e,t)=>{if(t&&a)return a(e,t)},options:{stripEmptyFields:!0},defaultValue:t||{id:"",query:"",interval:3600,ecs_mapping:{}},serializer:e=>Object(nt.produce)(e,(e=>{var t;return Object(N.isArray)(e.platform)&&e.platform.join(","),3===(null===(t=e.platform)||void 0===t?void 0:t.split(",").length)&&delete e.platform,Object(N.isArray)(e.version)&&(e.version.length?e.version=e.version[0]:delete e.version),Object(N.isEmpty)(e.ecs_mapping)&&delete e.ecs_mapping,e})),deserializer:e=>{var t;return e?{id:e.id,query:e.query,interval:e.interval,platform:e.platform,version:e.version?[e.version]:[],ecs_mapping:null!==(t=e.ecs_mapping)&&void 0!==t?t:{}}:{}},schema:r})})({uniqueQueryIds:e,defaultValue:t,handleSubmit:async(e,t)=>{var l;const n=await(null==s||null===(l=s.current)||void 0===l?void 0:l.validate());return new Promise((l=>{t&&n&&(a({...e,...Object(N.isEmpty)(n)?{}:{ecs_mapping:n}}),r()),l()}))}}),{submit:d,setFieldValue:m,reset:p,isSubmitting:E}=c,[{query:g}]=Object(ge.k)({form:c,watch:["query"]}),y=Object(n.useCallback)((e=>{if(!e)return p();m("id",e.id),m("query",e.query),e.description&&m("description",e.description),e.interval&&m("interval",e.interval),e.platform&&m("platform",e.platform),e.version&&m("version",[e.version]),e.ecs_mapping&&m("ecs_mapping",e.ecs_mapping)}),[m,p]),b=Object(n.useMemo)((()=>({onClick:()=>({})})),[]);return i.a.createElement(l.EuiFlyout,{size:"m",onClose:r,"aria-labelledby":"flyoutTitle",outsideClickCloses:!1,maskProps:b},i.a.createElement(l.EuiFlyoutHeader,{hasBorder:!0},i.a.createElement(l.EuiTitle,{size:"s"},i.a.createElement("h2",{id:"flyoutTitle"},u?i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.editFormTitle",defaultMessage:"Edit query"}):i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.addFormTitle",defaultMessage:"Attach next query"})))),i.a.createElement(l.EuiFlyoutBody,null,i.a.createElement(ge.d,{form:c},u?null:i.a.createElement(i.a.Fragment,null,i.a.createElement(ft.a,{onChange:y}),i.a.createElement(l.EuiSpacer,null)),i.a.createElement(kt,{path:"id"}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(kt,{path:"query",component:mt.a}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(kt,{path:"interval",euiFieldProps:{append:"s"}}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(kt,{path:"version",labelAppend:i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiText,{size:"xs",color:"subdued"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.versionFieldOptionalLabel",defaultMessage:"(optional)"}))),euiFieldProps:{noSuggestions:!1,singleSelection:{asPlainText:!0},placeholder:S.i18n.translate("xpack.osquery.queriesTable.osqueryVersionAllLabel",{defaultMessage:"ALL"}),options:Et.a,onCreateOption:void 0}})),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(kt,{path:"platform",component:pt.a}))),i.a.createElement(l.EuiSpacer,null),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(kt,{path:"ecs_mapping",component:vt.a,query:g,fieldRef:s}))))),i.a.createElement(l.EuiFlyoutFooter,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"spaceBetween"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,{iconType:"cross",onClick:r,flush:"left"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:E,onClick:d,fill:!0},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.saveButtonLabel",defaultMessage:"Save"}))))))},ht=i.a.memo(xt),Ot=["application/json","text/plain"],jt=i.a.memo((()=>i.a.createElement(l.EuiLink,{href:"https://github.com/osquery/osquery/tree/master/packs",target:"_blank"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packUploader.examplePacksLinkLabel",defaultMessage:"Example packs"}))));jt.displayName="ExamplePackLink";const qt=({onChange:e})=>{const t=Object(n.useRef)(""),a=Object(n.useRef)(null),[r,s]=Object(n.useState)(null);let u;const c=()=>{var l,r;const n=u.result;let i;try{i=JSON.parse(n.replaceAll("\\\n",""),((e,t)=>"query"===e?t.replaceAll(/\s(?=\s)/gm,""):"interval"===e?`${t}`:t)),s(null)}catch(e){var c;s(e),null===(c=a.current)||void 0===c||c.removeFiles(new Event("fake"))}null!==(l=i)&&void 0!==l&&l.queries&&(e(i,t.current),null===(r=a.current)||void 0===r||r.removeFiles(new Event("fake")))},o=e=>{u=new FileReader,u.onloadend=c,u.readAsText(e)},d=Object(n.useCallback)((e=>{var l;if(e.length){var r;if(e.length&&(null!==(l=!!e[0].type.length&&!Ot.includes(e[0].type))&&void 0!==l?l:!e[0].name.endsWith(".conf")))return t.current="",s(S.i18n.translate("xpack.osquery.packUploader.unsupportedFileTypeText",{defaultMessage:"File type {fileType} is not supported, please upload {supportedFileTypes} config file",values:{fileType:e[0].type,supportedFileTypes:Ot.join(" or ")}})),void(null===(r=a.current)||void 0===r||r.removeFiles(new Event("fake")));t.current=Object(N.kebabCase)(e[0].name.split(".")[0]),o(e[0])}else t.current=""}),[o]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiSpacer,{size:"xl"}),i.a.createElement(l.EuiFormRow,{fullWidth:!0,labelAppend:i.a.createElement(jt,null),isInvalid:!!r,error:i.a.createElement(i.a.Fragment,null,`${r}`)},i.a.createElement(l.EuiFilePicker,{ref:a,id:"osquery_pack_picker",initialPromptText:S.i18n.translate("xpack.osquery.packUploader.initialPromptTextLabel",{defaultMessage:"Select or drag and drop osquery pack config file"}),onChange:d,display:"large",fullWidth:!0,isInvalid:!!r,accept:Ot.join(",")})))},Mt=i.a.memo(qt);var Ct=a(97);const Ft=({field:e,handleNameChange:t})=>{var a;const[r,s]=Object(n.useState)(!1),[u,c]=Object(n.useState)(-1),[d,m]=Object(n.useState)([]),p=Object(n.useCallback)((()=>s(!0)),[]),E=Object(n.useCallback)((()=>s(!1)),[]),g=Object(n.useCallback)((()=>c(-1)),[]),{setValue:y}=e,b=Object(n.useCallback)((t=>{const a=Object(N.findIndex)(e.value,["id",t.id]);a>-1&&y(Object(nt.produce)((e=>(Object(N.pullAt)(e,[a]),e))))}),[e.value,y]),f=Object(n.useCallback)((t=>{const a=Object(N.findIndex)(e.value,["id",t.id]);c(a)}),[e.value]),v=Object(n.useCallback)((e=>new Promise((t=>{u>=0&&y(Object(nt.produce)((t=>{var a,l;return t[u].id=e.id,t[u].interval=e.interval,t[u].query=e.query,null!==(a=e.platform)&&void 0!==a&&a.length?t[u].platform=e.platform:delete t[u].platform,null!==(l=e.version)&&void 0!==l&&l.length?t[u].version=e.version:delete t[u].version,e.ecs_mapping?t[u].ecs_mapping=e.ecs_mapping:delete t[u].ecs_mapping,t}))),g(),t()}))),[g,y,u]),k=Object(n.useCallback)((e=>new Promise((t=>{y(Object(nt.produce)((t=>(t.push(e),t)))),E(),t()}))),[E,y]),x=Object(n.useCallback)((()=>{y(Object(nt.produce)((e=>(Object(N.pullAllBy)(e,d,"id"),e)))),m([])}),[y,d]),h=Object(n.useCallback)(((e,a)=>{y(Object(nt.produce)((t=>(Object(N.forEach)(e.queries,((a,l)=>{var r,n,i;t.push(Object(N.pickBy)({id:l,interval:null!==(r=a.interval)&&void 0!==r?r:e.interval,query:a.query,version:null!==(n=a.version)&&void 0!==n?n:e.version,platform:Object(Ct.b)(null!==(i=a.platform)&&void 0!==i?i:e.platform)},(e=>!Object(N.isEmpty)(e))))})),t)))),t(a)}),[t,y]),O=Object(n.useMemo)((()=>{var t;return null!==(t=e.value)&&void 0!==t&&t.length?e.value:[]}),[e.value]),j=Object(n.useMemo)((()=>e.value&&e.value.length?e.value.reduce(((e,t)=>(null!=t&&t.id&&e.push(t.id),e)),[]):[]),[e.value]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},d.length?i.a.createElement(l.EuiButton,{color:"danger",onClick:x,iconType:"trash"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.table.deleteQueriesButtonLabel",defaultMessage:"Delete {queriesCount, plural, one {# query} other {# queries}}",values:{queriesCount:d.length}})):i.a.createElement(l.EuiButton,{fill:!0,onClick:p,iconType:"plusInCircle"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.queriesForm.addQueryButtonLabel",defaultMessage:"Add query"})))),i.a.createElement(l.EuiSpacer,null),null!==(a=e.value)&&void 0!==a&&a.length?i.a.createElement(dt,{data:O,onEditClick:f,onDeleteClick:b,selectedItems:d,setSelectedItems:m}):null,i.a.createElement(l.EuiSpacer,null),i.a.createElement(Mt,{onChange:h}),r&&i.a.createElement(ht,{uniqueQueryIds:j,onSave:k,onClose:E}),null!=u&&u>=0&&i.a.createElement(ht,{uniqueQueryIds:j,defaultValue:e.value[u],onSave:v,onClose:g}))},St=i.a.memo(Ft);var Tt=a(104);var It=a(93);const wt=()=>i.a.createElement(i.a.Fragment,null),_t=Object(ge.i)({component:ge.c}),Pt=({defaultValue:e,editMode:t=!1})=>{const[a,r]=Object(n.useState)(!1),s=Object(n.useCallback)((()=>r(!1)),[]),{data:{agentPoliciesById:u}={}}=Object(Tt.a)(),c=Object(w.f)(`packs/${t?null==e?void 0:e.id:""}`),{mutateAsync:d}=(({withRedirect:e})=>{const t=Object(p.useQueryClient)(),{application:{navigateToApp:a},http:l,notifications:{toasts:r}}=Object(w.e)().services,n=Object(z.a)();return Object(p.useMutation)((e=>l.post("/internal/osquery/packs",{body:JSON.stringify(e)})),{onError:e=>{n(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:l=>{var n,i;t.invalidateQueries(Ie),e&&a(Qe.PLUGIN_ID,{path:I.a.packs()}),r.addSuccess(S.i18n.translate("xpack.osquery.newPack.successToastMessageText",{defaultMessage:'Successfully created "{packName}" pack',values:{packName:null!==(n=null===(i=l.attributes)||void 0===i?void 0:i.name)&&void 0!==n?n:""}}))}})})({withRedirect:!0}),{mutateAsync:m}=Ne({withRedirect:!0}),{form:E}=Object(ge.j)({id:"scheduledQueryForm",schema:{name:{type:ge.b.TEXT,label:S.i18n.translate("xpack.osquery.pack.form.nameFieldLabel",{defaultMessage:"Name"}),validations:[{validator:It.b},{validator:ge.g.emptyField(S.i18n.translate("xpack.osquery.pack.form.nameFieldRequiredErrorMessage",{defaultMessage:"Name is a required field"}))}]},description:{type:ge.b.TEXT,label:S.i18n.translate("xpack.osquery.pack.form.descriptionFieldLabel",{defaultMessage:"Description (optional)"})},policy_ids:{defaultValue:[],type:ge.b.COMBO_BOX,label:S.i18n.translate("xpack.osquery.pack.form.agentPoliciesFieldLabel",{defaultMessage:"Scheduled agent policies (optional)"}),helpText:S.i18n.translate("xpack.osquery.pack.form.agentPoliciesFieldHelpText",{defaultMessage:"Queries in this pack are scheduled for agents in the selected policies."})},enabled:{defaultValue:!0},queries:{defaultValue:[]}},onSubmit:async(a,l)=>{if(l)try{t?await m({id:null==e?void 0:e.id,...a}):await d(a)}catch(e){}},deserializer:e=>{var t,a;return{...e,policy_ids:null!==(t=e.policy_ids)&&void 0!==t?t:[],queries:(a=e.queries,Object(N.reduce)(a,((e,t,a)=>(e.push({id:a,...Object(N.pick)(t,["query","interval","platform","version","ecs_mapping"])}),e)),[]))}},serializer:e=>{return{...e,queries:(t=e.queries,Object(N.reduce)(t,((e,{id:t,...a})=>(e[t]=a,e)),{}))};var t},defaultValue:e}),{setFieldValue:g,submit:y,isSubmitting:f}=E,[{name:v,policy_ids:k}]=Object(ge.k)({form:E,watch:["name","policy_ids"]}),x=Object(n.useMemo)((()=>Object(N.reduce)(k,((e,t)=>{var a;const l=u&&u[t];return e+(null!==(a=null==l?void 0:l.agents)&&void 0!==a?a:0)}),0)),[k,u]),h=Object(n.useCallback)((e=>Object(N.isEmpty)(v)&&g("name",e)),[v,g]),O=Object(n.useCallback)((()=>{x?r(!0):y()}),[x,y]),j=Object(n.useCallback)((()=>{y(),r(!1)}),[y]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(ge.d,{form:E},i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(_t,{path:"name"}))),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(_t,{path:"description"}))),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(_t,{path:"policy_ids",component:rt,agentPoliciesById:u}))),i.a.createElement(l.EuiHorizontalRule,null),i.a.createElement(_t,{path:"queries",component:St,handleNameChange:h}),i.a.createElement(_t,{path:"enabled",component:wt})),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,b()({color:"ghost"},c),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:f,color:"primary",fill:!0,size:"m",iconType:"save",onClick:O},t?i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.form.updatePackButtonLabel",defaultMessage:"Update pack"}):i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.pack.form.savePackButtonLabel",defaultMessage:"Save pack"}))))))),a&&i.a.createElement(Pe,{onCancel:s,onConfirm:j,agentCount:x,agentPolicyCount:k.length}))},Qt=i.a.memo(Pt),Nt=()=>{Q("pack_add");const e=Object(w.f)("packs"),t=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,b()({iconType:"arrowLeft"},e,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addPack.viewPacksListTitle",defaultMessage:"View all packs"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.addPack.pageTitle",defaultMessage:"Add pack"})))))),[e]);return i.a.createElement(F,{leftColumn:t},i.a.createElement(Qt,null))},Lt=i.a.memo(Nt),Bt=({packId:e,skip:t=!1})=>{const{http:a}=Object(w.e)().services;return Object(p.useQuery)(["pack",{packId:e}],(()=>a.get(`/internal/osquery/packs/${e}`)),{keepPreviousData:!0,enabled:!t||!e})},At=()=>{var e,t;const{packId:a}=Object(c.useParams)(),r=Object(w.f)(`packs/${a}`),[s,u]=Object(n.useState)(!1),{isLoading:d,data:m}=Bt({packId:a}),E=(({packId:e,withRedirect:t})=>{const a=Object(p.useQueryClient)(),{application:{navigateToApp:l},http:r,notifications:{toasts:n}}=Object(w.e)().services,i=Object(z.a)();return Object(p.useMutation)((()=>r.delete(`/internal/osquery/packs/${e}`)),{onError:e=>{i(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:()=>{a.invalidateQueries(Ie),t&&l(Qe.PLUGIN_ID,{path:I.a.packs()}),n.addSuccess(S.i18n.translate("xpack.osquery.deletePack.successToastMessageText",{defaultMessage:"Successfully deleted pack"}))}})})({packId:a,withRedirect:!0});Q("pack_edit",{packId:null!==(e=null==m?void 0:m.id)&&void 0!==e?e:"",packName:null!==(t=null==m?void 0:m.name)&&void 0!==t?t:""});const g=Object(n.useCallback)((()=>{u(!1)}),[]),y=Object(n.useCallback)((()=>{u(!0)}),[]),f=Object(n.useCallback)((()=>{E.mutateAsync().then((()=>{g()}))}),[E,g]),v=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,b()({iconType:"arrowLeft"},r,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editPack.viewPackListTitle",defaultMessage:"View {queryName} details",values:{queryName:null==m?void 0:m.name}}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editPack.pageTitle",defaultMessage:"Edit {queryName}",values:{queryName:null==m?void 0:m.name}})))))),[null==m?void 0:m.name,r]),k=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,{color:"danger",onClick:y,iconType:"trash"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.editPack.deletePackButtonLabel",defaultMessage:"Delete pack"}))),[y]);return d?null:i.a.createElement(F,{leftColumn:v,rightColumn:k,rightColumnGrow:!1},m?i.a.createElement(Qt,{editMode:!0,defaultValue:m}):i.a.createElement(l.EuiLoadingContent,{lines:10}),s?i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.title",defaultMessage:"Are you sure you want to delete this pack?"}),onCancel:g,onConfirm:f,cancelButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.confirmButtonLabel",defaultMessage:"Confirm"}),buttonColor:"danger",defaultFocusedButton:"confirm"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.body",defaultMessage:"You're about to delete this pack. Are you sure you want to do this?"})):null)},zt=i.a.memo(At);var Rt=a(109);const Dt=m.a.div.withConfig({displayName:"Divider",componentId:"sc-e3f879-0"})(["width:0;height:100%;border-left:",";"],(({theme:e})=>e.eui.euiBorderThin)),Gt=()=>{var e;const t=Object(w.e)().services.application.capabilities.osquery,{packId:a}=Object(c.useParams)(),r=Object(w.f)("packs"),s=Object(w.f)(`packs/${a}/edit`),{data:u}=Bt({packId:a}),{data:d}=(({agentPolicyId:e,silent:t,skip:a})=>{const{http:l}=Object(w.e)().services,r=Object(z.a)();return Object(p.useQuery)(["agentPolicyAgentIds",e],(()=>{const t=`${ze.AGENT_SAVED_OBJECT_TYPE}.policy_id:${e}`;return l.get("/internal/osquery/fleet_wrapper/agents",{query:{kuery:t,perPage:1e4}})}),{select:e=>Object(N.map)(null==e?void 0:e.agents,"id")||[],enabled:!a||!e,onSuccess:()=>r(),onError:e=>!t&&r(e,{title:S.i18n.translate("xpack.osquery.agents.fetchError",{defaultMessage:"Error while fetching agents"})}),refetchOnReconnect:!1,refetchOnWindowFocus:!1})})({agentPolicyId:null==u?void 0:u.policy_id,skip:!u});Q("pack_details",{packName:null!==(e=null==u?void 0:u.name)&&void 0!==e?e:""});const m=Object(n.useMemo)((()=>{var e;return null!==(e=(null==u?void 0:u.queries)&&Object.entries(u.queries).map((([e,t])=>({...t,id:e}))))&&void 0!==e?e:[]}),[u]),E=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,b()({iconType:"arrowLeft"},r,{flush:"left",size:"xs"}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packDetails.viewAllPackListTitle",defaultMessage:"View all packs"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packDetails.pageTitle",defaultMessage:"{queryName} details",values:{queryName:null==u?void 0:u.name}})))),(null==u?void 0:u.description)&&i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"s"}),i.a.createElement(l.EuiText,{color:"subdued",size:"s"},u.description)))),[null==u?void 0:u.description,null==u?void 0:u.name,r]),g=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},i.a.createElement(l.EuiFlexItem,{grow:!1,key:"agents_failed_count"},i.a.createElement(l.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},i.a.createElement(l.EuiDescriptionListTitle,{className:"eui-textNoWrap"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packDetailsPage.kpis.policiesLabelText",defaultMessage:"Policies"})),i.a.createElement(l.EuiDescriptionListDescription,{className:"eui-textNoWrap"},i.a.createElement(Je,{agentPolicyIds:null==u?void 0:u.policy_ids})))),i.a.createElement(l.EuiFlexItem,{grow:!1,key:"agents_failed_count_divider"},i.a.createElement(Dt,null)),i.a.createElement(l.EuiFlexItem,{grow:!1,key:"edit_button"},i.a.createElement(l.EuiButton,b()({fill:!0},s,{iconType:"pencil",isDisabled:!t.writePacks}),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.packDetailsPage.editQueryButtonLabel",defaultMessage:"Edit"}))))),[null==u?void 0:u.policy_ids,s,t]);return i.a.createElement(F,{leftColumn:E,rightColumn:g,rightColumnGrow:!1},u&&i.a.createElement(Rt.a,{agentIds:d,packName:u.name,data:m}))},$t=i.a.memo(Gt),Vt=()=>{const e=Object(w.e)().services.application.capabilities.osquery;Q("packs");const t=Object(c.useRouteMatch)();return e.readPacks?i.a.createElement(c.Switch,null,i.a.createElement(c.Route,{path:`${t.url}/add`},e.writePacks?i.a.createElement(Lt,null):i.a.createElement(le,null)),i.a.createElement(c.Route,{path:`${t.url}/:packId/edit`},e.writePacks?i.a.createElement(zt,null):i.a.createElement(le,null)),i.a.createElement(c.Route,{path:`${t.url}/:packId`},i.a.createElement($t,null)),i.a.createElement(c.Route,{path:`${t.url}`},i.a.createElement(et,null))):i.a.createElement(le,null)},Ut=i.a.memo(Vt),Wt=()=>(Q("base"),i.a.createElement(c.Switch,null,i.a.createElement(c.Route,{path:"/packs"},i.a.createElement(Ut,null)),i.a.createElement(c.Route,{path:"/saved_queries"},i.a.createElement(Te,null)),i.a.createElement(c.Route,{path:"/live_queries"},i.a.createElement(ne,null)),i.a.createElement(c.Redirect,{to:"/live_queries"}))),Ht=i.a.memo(Wt),Yt=()=>{const{application:{getUrlForApp:e,navigateToApp:t}}=Object(w.e)().services,a=Object(n.useMemo)((()=>e(ze.INTEGRATIONS_PLUGIN_ID,{path:Re.pagePathGetters.integration_details_policies({pkgkey:Qe.OSQUERY_INTEGRATION_NAME})[1]})),[e]),r=Object(n.useCallback)((e=>{if(!Object(w.d)(e)&&Object(w.c)(e))return e.preventDefault(),t(ze.INTEGRATIONS_PLUGIN_ID,{path:Re.pagePathGetters.integration_details_policies({pkgkey:Qe.OSQUERY_INTEGRATION_NAME})[1]})}),[t]);return a?i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,{iconType:"gear",href:a,onClick:r},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.manageIntegrationButton",defaultMessage:"Manage integration"}))):null},Jt=i.a.memo(Yt);a(25);var Xt=a(52);const Kt=()=>{Q("base");const{application:{getUrlForApp:e,navigateToApp:t}}=Object(w.e)().services,a=Object(n.useMemo)((()=>e(ze.INTEGRATIONS_PLUGIN_ID,{path:Re.pagePathGetters.integration_details_overview({pkgkey:Qe.OSQUERY_INTEGRATION_NAME})[1]})),[e]),r=Object(n.useCallback)((e=>{if(!Object(w.d)(e)&&Object(w.c)(e))return e.preventDefault(),t(ze.INTEGRATIONS_PLUGIN_ID,{path:Re.pagePathGetters.integration_details_overview({pkgkey:Qe.OSQUERY_INTEGRATION_NAME})[1]})}),[t]),s=Object(n.useMemo)((()=>({iconType:Xt.a,pageTitle:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.emptyState.pageTitle",defaultMessage:"Add Osquery Manager"}),description:i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.emptyState.pageDescription",defaultMessage:"Add this integration to run and schedule queries for Elastic Agent."}),rightSideItems:[i.a.createElement(l.EuiButton,{key:"button",fill:!0,href:a,onClick:r,iconType:"plusInCircleFilled"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.emptyState.addOsqueryManagerButton",defaultMessage:"Add Osquery Manager"}))]})),[r,a]);return i.a.createElement(g.KibanaPageTemplate,{isEmptyState:!0,pageHeader:s})},Zt=i.a.memo(Kt),ea=()=>{const e=Object(c.useLocation)(),t=Object(n.useMemo)((()=>{var t;return null!==(t=e.pathname.split("/")[1])&&void 0!==t?t:"overview"}),[e.pathname]),{data:a,isFetched:r}=(()=>{const{http:e}=Object(w.e)().services,t=Object(z.a)();return Object(p.useQuery)("integration",(()=>e.get("/internal/osquery/status")),{onError:e=>t(e,{title:S.i18n.translate("xpack.osquery.osquery_integration.fetchError",{defaultMessage:"Error while fetching osquery integration"})}),refetchOnReconnect:!1,refetchOnWindowFocus:!1})})();return r?r&&"installed"!==(null==a?void 0:a.install_status)?i.a.createElement(Zt,null):i.a.createElement(f,null,i.a.createElement(v,null,i.a.createElement(k,null,i.a.createElement(l.EuiFlexGroup,{gutterSize:"l",alignItems:"center"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiTabs,{display:"condensed"},i.a.createElement(l.EuiTab,b()({isSelected:"live_queries"===t},Object(w.f)("live_queries")),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.liveQueriesLinkText",defaultMessage:"Live queries"})),i.a.createElement(l.EuiTab,b()({isSelected:"packs"===t},Object(w.f)("packs")),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.packsLinkText",defaultMessage:"Packs"})),i.a.createElement(l.EuiTab,b()({isSelected:"saved_queries"===t},Object(w.f)("saved_queries")),i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.savedQueriesLinkText",defaultMessage:"Saved queries"})))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"s",direction:"row"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,{iconType:"popout",href:"https://ela.st/osquery-feedback",target:"_blank"},i.a.createElement(o.FormattedMessage,{id:"xpack.osquery.appNavigation.sendFeedbackButton",defaultMessage:"Send feedback"}))),i.a.createElement(Jt,null))))),i.a.createElement(Ht,null))):i.a.createElement(l.EuiPage,{paddingSize:"none"},i.a.createElement(l.EuiPageBody,null,i.a.createElement(l.EuiPageContent,{verticalPosition:"center",horizontalPosition:"center",paddingSize:"none",color:"subdued",hasShadow:!1},i.a.createElement(l.EuiLoadingElastic,{size:"xxl"}))))},ta=i.a.memo(ea);var aa=a(57);const la=()=>{const[e]=Object(g.useUiSetting$)(Qe.DEFAULT_DARK_MODE),t=Object(n.useMemo)((()=>({eui:e?r.euiDarkVars:r.euiLightVars,darkMode:e})),[e]);return i.a.createElement(d.ThemeProvider,{theme:t},i.a.createElement(ta,null))},ra=(e,t,{element:a,history:r},n,s)=>(u.a.render(i.a.createElement(w.b,{services:{appName:Qe.PLUGIN_NAME,kibanaVersion:s,...e,...t,storage:n}},i.a.createElement(l.EuiErrorBoundary,null,i.a.createElement(c.Router,{history:r},i.a.createElement(o.I18nProvider,null,i.a.createElement(p.QueryClientProvider,{client:aa.a},i.a.createElement(la,null),i.a.createElement(E.ReactQueryDevtools,{initialIsOpen:!1})))))),a),()=>u.a.unmountComponentAtNode(a))}}]);