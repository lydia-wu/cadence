/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[8],{156:function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return l}));var r=a(0);const n="metrics.alert.threshold",i="metrics.alert.inventory.threshold";let s,l;!function(e){e.GT=">",e.LT="<",e.GT_OR_EQ=">=",e.LT_OR_EQ="<=",e.BETWEEN="between",e.OUTSIDE_RANGE="outside"}(s||(s={})),function(e){e.COUNT="count",e.AVERAGE="avg",e.SUM="sum",e.MIN="min",e.MAX="max",e.RATE="rate",e.CARDINALITY="cardinality",e.P95="p95",e.P99="p99"}(l||(l={}));r.union([r.literal("hosts"),r.literal("k8s")]),r.union([r.literal("memory_usage"),r.literal("network_in"),r.literal("network_out")]),r.type({fieldName:r.string,fieldValue:r.string})},160:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var r=a(45),n=a(2),i=a(1),s=a.n(i);const l=({options:e,onChange:t,fields:a,errorOptions:l})=>{const o=Object(i.useCallback)((e=>{const a=e.map((e=>e.label));t(a)}),[t]),c=Array.isArray(e.groupBy)?e.groupBy.map((e=>({label:e,color:null!=l&&l.includes(e)?"danger":void 0}))):e.groupBy?[{label:e.groupBy,color:null!=l&&l.includes(e.groupBy)?"danger":void 0}]:[];return s.a.createElement(r.EuiComboBox,{"data-test-subj":"metricsExplorer-groupBy",placeholder:n.i18n.translate("xpack.infra.metricsExplorer.groupByLabel",{defaultMessage:"Everything"}),"aria-label":n.i18n.translate("xpack.infra.metricsExplorer.groupByAriaLabel",{defaultMessage:"Graph per"}),fullWidth:!0,singleSelection:!1,selectedOptions:c,options:a.filter((e=>e.aggregatable&&"string"===e.type)).map((e=>({label:e.name}))),onChange:o,isClearable:!0})}},161:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var r=a(5),n=a.n(r),i=a(47),s=a(1),l=a(89),o=a(99),c=a(8),u=a(12),d=a(72);function m(e,t,a,r,m,p,g=!0){var f;const b=null===(f=Object(c.useKibana)().services.http)||void 0===f?void 0:f.fetch,[h,y]=Object(s.useState)(null),[E,v]=Object(s.useState)(!0),[x,k]=Object(s.useState)(null),[M,O]=Object(s.useState)(null),[w,j]=Object(s.useState)(null),S=n.a.parse(r.from),C=n.a.parse(r.to,{roundUp:!0}),[,T]=Object(d.c)({cancelPreviousOn:"creation",createPromise:()=>(v(!0),S&&C?b?t?b?b("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify({forceInterval:e.forceInterval,dropLastBucket:null==e.dropLastBucket||e.dropLastBucket,metrics:"count"===e.aggregation?[{aggregation:"count"}]:e.metrics.map((e=>({aggregation:e.aggregation,field:e.field}))),groupBy:e.groupBy,afterKey:m,limit:e.limit,indexPattern:t.metricAlias,filterQuery:e.filterQuery&&Object(o.a)(e.filterQuery,a)||void 0,timerange:{...r,field:t.fields.timestamp,from:S.valueOf(),to:C.valueOf()}})}):Promise.reject(new Error("HTTP service is unavailable")):Promise.reject(new Error("Source is unavailable")):Promise.reject(new Error("HTTP service is unavailable")):Promise.reject(new Error("Unalble to parse timerange"))),onResolve:t=>{v(!1);const a=Object(u.b)(l.e)(t);if(a){if(x&&M&&x.pageInfo.afterKey!==a.pageInfo.afterKey&&(n=M,s=e,Object(i.isEqual)(n,s))&&Object(i.isEqual)(r,w)&&m){const{series:e}=x;k({...a,series:[...e,...a.series]})}else k(a);O(e),j(r),y(null)}var n,s},onReject:e=>{y(e),v(!1)}},[t,r,e,p,m]);return Object(s.useEffect)((()=>{g&&T()}),[T,g]),{error:h,loading:E,data:x,loadData:T}}},222:function(e,t,a){var r=a(289),n={};for(var i in r)r.hasOwnProperty(i)&&(n[r[i]]=i);var s=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var l in s)if(s.hasOwnProperty(l)){if(!("channels"in s[l]))throw new Error("missing channels property: "+l);if(!("labels"in s[l]))throw new Error("missing channel labels property: "+l);if(s[l].labels.length!==s[l].channels)throw new Error("channel and label counts mismatch: "+l);var o=s[l].channels,c=s[l].labels;delete s[l].channels,delete s[l].labels,Object.defineProperty(s[l],"channels",{value:o}),Object.defineProperty(s[l],"labels",{value:c})}s.rgb.hsl=function(e){var t,a,r=e[0]/255,n=e[1]/255,i=e[2]/255,s=Math.min(r,n,i),l=Math.max(r,n,i),o=l-s;return l===s?t=0:r===l?t=(n-i)/o:n===l?t=2+(i-r)/o:i===l&&(t=4+(r-n)/o),(t=Math.min(60*t,360))<0&&(t+=360),a=(s+l)/2,[t,100*(l===s?0:a<=.5?o/(l+s):o/(2-l-s)),100*a]},s.rgb.hsv=function(e){var t,a,r,n,i,s=e[0]/255,l=e[1]/255,o=e[2]/255,c=Math.max(s,l,o),u=c-Math.min(s,l,o),d=function(e){return(c-e)/6/u+.5};return 0===u?n=i=0:(i=u/c,t=d(s),a=d(l),r=d(o),s===c?n=r-a:l===c?n=1/3+t-r:o===c&&(n=2/3+a-t),n<0?n+=1:n>1&&(n-=1)),[360*n,100*i,100*c]},s.rgb.hwb=function(e){var t=e[0],a=e[1],r=e[2];return[s.rgb.hsl(e)[0],100*(1/255*Math.min(t,Math.min(a,r))),100*(r=1-1/255*Math.max(t,Math.max(a,r)))]},s.rgb.cmyk=function(e){var t,a=e[0]/255,r=e[1]/255,n=e[2]/255;return[100*((1-a-(t=Math.min(1-a,1-r,1-n)))/(1-t)||0),100*((1-r-t)/(1-t)||0),100*((1-n-t)/(1-t)||0),100*t]},s.rgb.keyword=function(e){var t=n[e];if(t)return t;var a,i,s,l=1/0;for(var o in r)if(r.hasOwnProperty(o)){var c=r[o],u=(i=e,s=c,Math.pow(i[0]-s[0],2)+Math.pow(i[1]-s[1],2)+Math.pow(i[2]-s[2],2));u<l&&(l=u,a=o)}return a},s.keyword.rgb=function(e){return r[e]},s.rgb.xyz=function(e){var t=e[0]/255,a=e[1]/255,r=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*t+.7152*a+.0722*r),100*(.0193*t+.1192*a+.9505*r)]},s.rgb.lab=function(e){var t=s.rgb.xyz(e),a=t[0],r=t[1],n=t[2];return r/=100,n/=108.883,a=(a/=95.047)>.008856?Math.pow(a,1/3):7.787*a+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(a-r),200*(r-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]},s.hsl.rgb=function(e){var t,a,r,n,i,s=e[0]/360,l=e[1]/100,o=e[2]/100;if(0===l)return[i=255*o,i,i];t=2*o-(a=o<.5?o*(1+l):o+l-o*l),n=[0,0,0];for(var c=0;c<3;c++)(r=s+1/3*-(c-1))<0&&r++,r>1&&r--,i=6*r<1?t+6*(a-t)*r:2*r<1?a:3*r<2?t+(a-t)*(2/3-r)*6:t,n[c]=255*i;return n},s.hsl.hsv=function(e){var t=e[0],a=e[1]/100,r=e[2]/100,n=a,i=Math.max(r,.01);return a*=(r*=2)<=1?r:2-r,n*=i<=1?i:2-i,[t,100*(0===r?2*n/(i+n):2*a/(r+a)),100*((r+a)/2)]},s.hsv.rgb=function(e){var t=e[0]/60,a=e[1]/100,r=e[2]/100,n=Math.floor(t)%6,i=t-Math.floor(t),s=255*r*(1-a),l=255*r*(1-a*i),o=255*r*(1-a*(1-i));switch(r*=255,n){case 0:return[r,o,s];case 1:return[l,r,s];case 2:return[s,r,o];case 3:return[s,l,r];case 4:return[o,s,r];case 5:return[r,s,l]}},s.hsv.hsl=function(e){var t,a,r,n=e[0],i=e[1]/100,s=e[2]/100,l=Math.max(s,.01);return r=(2-i)*s,a=i*l,[n,100*(a=(a/=(t=(2-i)*l)<=1?t:2-t)||0),100*(r/=2)]},s.hwb.rgb=function(e){var t,a,r,n,i,s,l,o=e[0]/360,c=e[1]/100,u=e[2]/100,d=c+u;switch(d>1&&(c/=d,u/=d),r=6*o-(t=Math.floor(6*o)),0!=(1&t)&&(r=1-r),n=c+r*((a=1-u)-c),t){default:case 6:case 0:i=a,s=n,l=c;break;case 1:i=n,s=a,l=c;break;case 2:i=c,s=a,l=n;break;case 3:i=c,s=n,l=a;break;case 4:i=n,s=c,l=a;break;case 5:i=a,s=c,l=n}return[255*i,255*s,255*l]},s.cmyk.rgb=function(e){var t=e[0]/100,a=e[1]/100,r=e[2]/100,n=e[3]/100;return[255*(1-Math.min(1,t*(1-n)+n)),255*(1-Math.min(1,a*(1-n)+n)),255*(1-Math.min(1,r*(1-n)+n))]},s.xyz.rgb=function(e){var t,a,r,n=e[0]/100,i=e[1]/100,s=e[2]/100;return a=-.9689*n+1.8758*i+.0415*s,r=.0557*n+-.204*i+1.057*s,t=(t=3.2406*n+-1.5372*i+-.4986*s)>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:12.92*a,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(t=Math.min(Math.max(0,t),1)),255*(a=Math.min(Math.max(0,a),1)),255*(r=Math.min(Math.max(0,r),1))]},s.xyz.lab=function(e){var t=e[0],a=e[1],r=e[2];return a/=100,r/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116)-16,500*(t-a),200*(a-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},s.lab.xyz=function(e){var t,a,r,n=e[0];t=e[1]/500+(a=(n+16)/116),r=a-e[2]/200;var i=Math.pow(a,3),s=Math.pow(t,3),l=Math.pow(r,3);return a=i>.008856?i:(a-16/116)/7.787,t=s>.008856?s:(t-16/116)/7.787,r=l>.008856?l:(r-16/116)/7.787,[t*=95.047,a*=100,r*=108.883]},s.lab.lch=function(e){var t,a=e[0],r=e[1],n=e[2];return(t=360*Math.atan2(n,r)/2/Math.PI)<0&&(t+=360),[a,Math.sqrt(r*r+n*n),t]},s.lch.lab=function(e){var t,a=e[0],r=e[1];return t=e[2]/360*2*Math.PI,[a,r*Math.cos(t),r*Math.sin(t)]},s.rgb.ansi16=function(e){var t=e[0],a=e[1],r=e[2],n=1 in arguments?arguments[1]:s.rgb.hsv(e)[2];if(0===(n=Math.round(n/50)))return 30;var i=30+(Math.round(r/255)<<2|Math.round(a/255)<<1|Math.round(t/255));return 2===n&&(i+=60),i},s.hsv.ansi16=function(e){return s.rgb.ansi16(s.hsv.rgb(e),e[2])},s.rgb.ansi256=function(e){var t=e[0],a=e[1],r=e[2];return t===a&&a===r?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(a/255*5)+Math.round(r/255*5)},s.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];var a=.5*(1+~~(e>50));return[(1&t)*a*255,(t>>1&1)*a*255,(t>>2&1)*a*255]},s.ansi256.rgb=function(e){if(e>=232){var t=10*(e-232)+8;return[t,t,t]}var a;return e-=16,[Math.floor(e/36)/5*255,Math.floor((a=e%36)/6)/5*255,a%6/5*255]},s.rgb.hex=function(e){var t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},s.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var a=t[0];3===t[0].length&&(a=a.split("").map((function(e){return e+e})).join(""));var r=parseInt(a,16);return[r>>16&255,r>>8&255,255&r]},s.rgb.hcg=function(e){var t,a=e[0]/255,r=e[1]/255,n=e[2]/255,i=Math.max(Math.max(a,r),n),s=Math.min(Math.min(a,r),n),l=i-s;return t=l<=0?0:i===a?(r-n)/l%6:i===r?2+(n-a)/l:4+(a-r)/l+4,t/=6,[360*(t%=1),100*l,100*(l<1?s/(1-l):0)]},s.hsl.hcg=function(e){var t=e[1]/100,a=e[2]/100,r=1,n=0;return(r=a<.5?2*t*a:2*t*(1-a))<1&&(n=(a-.5*r)/(1-r)),[e[0],100*r,100*n]},s.hsv.hcg=function(e){var t=e[1]/100,a=e[2]/100,r=t*a,n=0;return r<1&&(n=(a-r)/(1-r)),[e[0],100*r,100*n]},s.hcg.rgb=function(e){var t=e[0]/360,a=e[1]/100,r=e[2]/100;if(0===a)return[255*r,255*r,255*r];var n,i=[0,0,0],s=t%1*6,l=s%1,o=1-l;switch(Math.floor(s)){case 0:i[0]=1,i[1]=l,i[2]=0;break;case 1:i[0]=o,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=l;break;case 3:i[0]=0,i[1]=o,i[2]=1;break;case 4:i[0]=l,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=o}return n=(1-a)*r,[255*(a*i[0]+n),255*(a*i[1]+n),255*(a*i[2]+n)]},s.hcg.hsv=function(e){var t=e[1]/100,a=t+e[2]/100*(1-t),r=0;return a>0&&(r=t/a),[e[0],100*r,100*a]},s.hcg.hsl=function(e){var t=e[1]/100,a=e[2]/100*(1-t)+.5*t,r=0;return a>0&&a<.5?r=t/(2*a):a>=.5&&a<1&&(r=t/(2*(1-a))),[e[0],100*r,100*a]},s.hcg.hwb=function(e){var t=e[1]/100,a=t+e[2]/100*(1-t);return[e[0],100*(a-t),100*(1-a)]},s.hwb.hcg=function(e){var t=e[1]/100,a=1-e[2]/100,r=a-t,n=0;return r<1&&(n=(a-r)/(1-r)),[e[0],100*r,100*n]},s.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},s.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},s.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},s.gray.hsl=s.gray.hsv=function(e){return[0,0,e[0]]},s.gray.hwb=function(e){return[0,100,e[0]]},s.gray.cmyk=function(e){return[0,0,0,e[0]]},s.gray.lab=function(e){return[e[0],0,0]},s.gray.hex=function(e){var t=255&Math.round(e[0]/100*255),a=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(a.length)+a},s.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},269:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(270),n=a(13);t.ThrowReporter={report:function(e){if(n.isLeft(e))throw new Error(r.PathReporter.report(e).join("\n"))}}},270:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(0),n=a(13);function i(e){return void 0!==e.message?e.message:"Invalid value "+(("function"==typeof(t=e.value)?r.getFunctionName(t):"number"!=typeof t||isFinite(t)?JSON.stringify(t):isNaN(t)?"NaN":t>0?"Infinity":"-Infinity")+" supplied to ")+e.context.map((function(e){return e.key+": "+e.type.name})).join("/");var t}function s(e){return e.map(i)}function l(){return["No errors!"]}t.failure=s,t.success=l,t.PathReporter={report:n.fold(s,l)}},271:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","groups":["hosts","metrics"],"description":"Metrics: Hosts - Identify unusual spikes in memory usage across hosts.","analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(\'system.memory.actual.used.pct\')","function":"max","field_name":"system.memory.actual.used.pct","custom_rules":[{"actions":["skip_result"],"conditions":[{"applies_to":"actual","operator":"lt","value":0.1}]}]}],"influencers":["host.name"]},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"64mb"},"custom_settings":{"created_by":"ml-module-metrics-ui-hosts","custom_urls":[{"url_name":"Host Metrics","url_value":"metrics/detail/host/$host.name$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},272:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"system.memory"}}]}}}')},273:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","description":"Metrics: Hosts - Identify unusual spikes in inbound traffic across hosts.","groups":["hosts","metrics"],"analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(bytes_in_derivative)","function":"max","field_name":"bytes_in_derivative"}],"influencers":["host.name"],"summary_count_field_name":"doc_count"},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"32mb"},"custom_settings":{"created_by":"ml-module-metrics-ui-hosts","custom_urls":[{"url_name":"Host Metrics","url_value":"metrics/detail/host/$host.name$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},274:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"system.network"}}]}},"chunking_config":{"mode":"manual","time_span":"900s"},"aggregations":{"host.name":{"terms":{"field":"host.name","size":100},"aggregations":{"buckets":{"date_histogram":{"field":"@timestamp","fixed_interval":"5m"},"aggregations":{"@timestamp":{"max":{"field":"@timestamp"}},"bytes_in_max":{"max":{"field":"system.network.in.bytes"}},"bytes_in_derivative":{"derivative":{"buckets_path":"bytes_in_max"}},"positive_only":{"bucket_script":{"buckets_path":{"in_derivative":"bytes_in_derivative.value"},"script":"params.in_derivative > 0.0 ? params.in_derivative : 0.0"}}}}}}}}')},275:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","description":"Metrics: Hosts - Identify unusual spikes in outbound traffic across hosts.","groups":["hosts","metrics"],"analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(bytes_out_derivative)","function":"max","field_name":"bytes_out_derivative"}],"influencers":["host.name"],"summary_count_field_name":"doc_count"},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"32mb"},"custom_settings":{"created_by":"ml-module-metrics-ui-hosts","custom_urls":[{"url_name":"Host Metrics","url_value":"metrics/detail/host/$host.name$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},276:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"system.network"}}]}},"chunking_config":{"mode":"manual","time_span":"900s"},"aggregations":{"host.name":{"terms":{"field":"host.name","size":100},"aggregations":{"buckets":{"date_histogram":{"field":"@timestamp","fixed_interval":"5m"},"aggregations":{"@timestamp":{"max":{"field":"@timestamp"}},"bytes_out_max":{"max":{"field":"system.network.out.bytes"}},"bytes_out_derivative":{"derivative":{"buckets_path":"bytes_out_max"}},"positive_only":{"bucket_script":{"buckets_path":{"out_derivative":"bytes_out_derivative.value"},"script":"params.out_derivative > 0.0 ? params.out_derivative : 0.0"}}}}}}}}')},277:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","groups":["k8s","metrics"],"description":"Metrics: Kubernetes - Identify unusual spikes in memory usage across Kubernetes pods.","analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(\'kubernetes.pod.memory.usage.node.pct\')","function":"max","field_name":"kubernetes.pod.memory.usage.node.pct","partition_field_name":"kubernetes.namespace","custom_rules":[{"actions":["skip_result"],"conditions":[{"applies_to":"actual","operator":"lt","value":0.1}]}]}],"influencers":["kubernetes.namespace","kubernetes.node.name","kubernetes.pod.uid"]},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"64mb"},"custom_settings":{"created_by":"ml-module-metrics-ui-k8s","custom_urls":[{"url_name":"Pod Metrics","url_value":"metrics/detail/pod/$kubernetes.pod.uid$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},278:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"kubernetes.pod.uid"}},{"exists":{"field":"kubernetes.pod.memory"}}]}}}')},279:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","description":"Metrics: Kubernetes - Identify unusual spikes in inbound traffic across Kubernetes pods.","groups":["k8s","metrics"],"analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(bytes_in_derivative)","function":"max","field_name":"bytes_in_derivative","partition_field_name":"kubernetes.namespace"}],"influencers":["kubernetes.namespace","kubernetes.pod.uid"],"summary_count_field_name":"doc_count"},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"32mb"},"custom_settings":{"created_by":"ml-module-metrics-ui-k8s","custom_urls":[{"url_name":"Pod Metrics","url_value":"metrics/detail/pod/$kubernetes.pod.uid$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},280:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"kubernetes.pod.network"}}]}},"chunking_config":{"mode":"manual","time_span":"900s"},"aggregations":{"kubernetes.namespace":{"terms":{"field":"kubernetes.namespace","size":25},"aggregations":{"kubernetes.pod.uid":{"terms":{"field":"kubernetes.pod.uid","size":100},"aggregations":{"buckets":{"date_histogram":{"field":"@timestamp","fixed_interval":"5m"},"aggregations":{"@timestamp":{"max":{"field":"@timestamp"}},"bytes_in_max":{"max":{"field":"kubernetes.pod.network.rx.bytes"}},"bytes_in_derivative":{"derivative":{"buckets_path":"bytes_in_max"}},"positive_only":{"bucket_script":{"buckets_path":{"in_derivative":"bytes_in_derivative.value"},"script":"params.in_derivative > 0.0 ? params.in_derivative : 0.0"}}}}}}}}}}')},281:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","description":"Metrics: Kubernetes - Identify unusual spikes in outbound traffic across Kubernetes pods.","groups":["k8s","metrics"],"analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(bytes_out_derivative)","function":"max","field_name":"bytes_out_derivative","partition_field_name":"kubernetes.namespace"}],"influencers":["kubernetes.namespace","kubernetes.pod.uid"],"summary_count_field_name":"doc_count"},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"32mb"},"custom_settings":{"created_by":"ml-module-metrics-ui-k8s","custom_urls":[{"url_name":"Pod Metrics","url_value":"metrics/detail/pod/$kubernetes.pod.uid$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},282:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"kubernetes.pod.network"}}]}},"chunking_config":{"mode":"manual","time_span":"900s"},"aggregations":{"kubernetes.namespace":{"terms":{"field":"kubernetes.namespace","size":25},"aggregations":{"kubernetes.pod.uid":{"terms":{"field":"kubernetes.pod.uid","size":100},"aggregations":{"buckets":{"date_histogram":{"field":"@timestamp","fixed_interval":"5m"},"aggregations":{"@timestamp":{"max":{"field":"@timestamp"}},"bytes_out_max":{"max":{"field":"kubernetes.pod.network.tx.bytes"}},"bytes_out_derivative":{"derivative":{"buckets_path":"bytes_out_max"}},"positive_only":{"bucket_script":{"buckets_path":{"pos_derivative":"bytes_out_derivative.value"},"script":"params.pos_derivative > 0.0 ? params.pos_derivative : 0.0"}}}}}}}}}}')},283:function(e,t,a){"use strict";var r=a(284),n=a(288),i=[].slice,s=["keyword","gray","hex"],l={};Object.keys(n).forEach((function(e){l[i.call(n[e].labels).sort().join("")]=e}));var o={};function c(e,t){if(!(this instanceof c))return new c(e,t);if(t&&t in s&&(t=null),t&&!(t in n))throw new Error("Unknown model: "+t);var a,u;if(e)if(e instanceof c)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var d=r.get(e);if(null===d)throw new Error("Unable to parse color from string: "+e);this.model=d.model,u=n[this.model].channels,this.color=d.value.slice(0,u),this.valpha="number"==typeof d.value[u]?d.value[u]:1}else if(e.length){this.model=t||"rgb",u=n[this.model].channels;var m=i.call(e,0,u);this.color=p(m,u),this.valpha="number"==typeof e[u]?e[u]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var g=Object.keys(e);"alpha"in e&&(g.splice(g.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);var f=g.sort().join("");if(!(f in l))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=l[f];var b=n[this.model].labels,h=[];for(a=0;a<b.length;a++)h.push(e[b[a]]);this.color=p(h)}else this.model="rgb",this.color=[0,0,0],this.valpha=1;if(o[this.model])for(u=n[this.model].channels,a=0;a<u;a++){var y=o[this.model][a];y&&(this.color[a]=y(this.color[a]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function u(e,t,a){return(e=Array.isArray(e)?e:[e]).forEach((function(e){(o[e]||(o[e]=[]))[t]=a})),e=e[0],function(r){var n;return arguments.length?(a&&(r=a(r)),(n=this[e]()).color[t]=r,n):(n=this[e]().color[t],a&&(n=a(n)),n)}}function d(e){return function(t){return Math.max(0,Math.min(e,t))}}function m(e){return Array.isArray(e)?e:[e]}function p(e,t){for(var a=0;a<t;a++)"number"!=typeof e[a]&&(e[a]=0);return e}c.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var t=this.model in r.to?this:this.rgb(),a=1===(t=t.round("number"==typeof e?e:1)).valpha?t.color:t.color.concat(this.valpha);return r.to[t.model](a)},percentString:function(e){var t=this.rgb().round("number"==typeof e?e:1),a=1===t.valpha?t.color:t.color.concat(this.valpha);return r.to.rgb.percent(a)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},t=n[this.model].channels,a=n[this.model].labels,r=0;r<t;r++)e[a[r]]=this.color[r];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new c(this.color.map(function(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new c(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:u("rgb",0,d(255)),green:u("rgb",1,d(255)),blue:u("rgb",2,d(255)),hue:u(["hsl","hsv","hsl","hwb","hcg"],0,(function(e){return(e%360+360)%360})),saturationl:u("hsl",1,d(100)),lightness:u("hsl",2,d(100)),saturationv:u("hsv",1,d(100)),value:u("hsv",2,d(100)),chroma:u("hcg",1,d(100)),gray:u("hcg",2,d(100)),white:u("hwb",1,d(100)),wblack:u("hwb",2,d(100)),cyan:u("cmyk",0,d(100)),magenta:u("cmyk",1,d(100)),yellow:u("cmyk",2,d(100)),black:u("cmyk",3,d(100)),x:u("xyz",0,d(100)),y:u("xyz",1,d(100)),z:u("xyz",2,d(100)),l:u("lab",0,d(100)),a:u("lab",1),b:u("lab",2),keyword:function(e){return arguments.length?new c(e):n[this.model].keyword(this.color)},hex:function(e){return arguments.length?new c(e):r.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,t=[],a=0;a<e.length;a++){var r=e[a]/255;t[a]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),a=e.luminosity();return t>a?(t+.05)/(a+.05):(a+.05)/(t+.05)},level:function(e){var t=this.contrast(e);return t>=7.1?"AAA":t>=4.5?"AA":""},dark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},light:function(){return!this.dark()},negate:function(){for(var e=this.rgb(),t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten:function(e){var t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken:function(e){var t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate:function(e){var t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate:function(e){var t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten:function(e){var t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken:function(e){var t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale:function(){var e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return c.rgb(t,t,t)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var t=this.hsl(),a=t.color[0];return a=(a=(a+e)%360)<0?360+a:a,t.color[0]=a,t},mix:function(e,t){var a=this.rgb(),r=e.rgb(),n=void 0===t?.5:t,i=2*n-1,s=a.alpha()-r.alpha(),l=((i*s==-1?i:(i+s)/(1+i*s))+1)/2,o=1-l;return c.rgb(l*a.red()+o*r.red(),l*a.green()+o*r.green(),l*a.blue()+o*r.blue(),a.alpha()*n+r.alpha()*(1-n))}},Object.keys(n).forEach((function(e){if(-1===s.indexOf(e)){var t=n[e].channels;c.prototype[e]=function(){if(this.model===e)return new c(this);if(arguments.length)return new c(arguments,e);var a="number"==typeof arguments[t]?t:this.valpha;return new c(m(n[this.model][e].raw(this.color)).concat(a),e)},c[e]=function(a){return"number"==typeof a&&(a=p(i.call(arguments),t)),new c(a,e)}}})),e.exports=c},284:function(e,t,a){var r=a(285),n=a(286),i={};for(var s in r)r.hasOwnProperty(s)&&(i[r[s]]=s);var l=e.exports={to:{},get:{}};function o(e,t,a){return Math.min(Math.max(t,e),a)}function c(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}l.get=function(e){var t,a;switch(e.substring(0,3).toLowerCase()){case"hsl":t=l.get.hsl(e),a="hsl";break;case"hwb":t=l.get.hwb(e),a="hwb";break;default:t=l.get.rgb(e),a="rgb"}return t?{model:a,value:t}:null},l.get.rgb=function(e){if(!e)return null;var t,a,n,i=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(n=t[2],t=t[1],a=0;a<3;a++){var s=2*a;i[a]=parseInt(t.slice(s,s+2),16)}n&&(i[3]=parseInt(n,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(n=(t=t[1])[3],a=0;a<3;a++)i[a]=parseInt(t[a]+t[a],16);n&&(i[3]=parseInt(n+n,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(a=0;a<3;a++)i[a]=parseInt(t[a+1],0);t[4]&&(i[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(i=r[t[1]])?(i[3]=1,i):null:null;for(a=0;a<3;a++)i[a]=Math.round(2.55*parseFloat(t[a+1]));t[4]&&(i[3]=parseFloat(t[4]))}for(a=0;a<3;a++)i[a]=o(i[a],0,255);return i[3]=o(i[3],0,1),i},l.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,o(parseFloat(t[2]),0,100),o(parseFloat(t[3]),0,100),o(isNaN(a)?1:a,0,1)]}return null},l.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,o(parseFloat(t[2]),0,100),o(parseFloat(t[3]),0,100),o(isNaN(a)?1:a,0,1)]}return null},l.to.hex=function(){var e=n(arguments);return"#"+c(e[0])+c(e[1])+c(e[2])+(e[3]<1?c(Math.round(255*e[3])):"")},l.to.rgb=function(){var e=n(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},l.to.rgb.percent=function(){var e=n(arguments),t=Math.round(e[0]/255*100),a=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+a+"%, "+r+"%)":"rgba("+t+"%, "+a+"%, "+r+"%, "+e[3]+")"},l.to.hsl=function(){var e=n(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},l.to.hwb=function(){var e=n(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},l.to.keyword=function(e){return i[e.slice(0,3)]}},285:function(e,t,a){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},286:function(e,t,a){"use strict";var r=a(287),n=Array.prototype.concat,i=Array.prototype.slice,s=e.exports=function(e){for(var t=[],a=0,s=e.length;a<s;a++){var l=e[a];r(l)?t=n.call(t,i.call(l)):t.push(l)}return t};s.wrap=function(e){return function(){return e(s(arguments))}}},287:function(e,t){e.exports=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))}},288:function(e,t,a){var r=a(222),n=a(290),i={};Object.keys(r).forEach((function(e){i[e]={},Object.defineProperty(i[e],"channels",{value:r[e].channels}),Object.defineProperty(i[e],"labels",{value:r[e].labels});var t=n(e);Object.keys(t).forEach((function(a){var r=t[a];i[e][a]=function(e){var t=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var a=e(t);if("object"==typeof a)for(var r=a.length,n=0;n<r;n++)a[n]=Math.round(a[n]);return a};return"conversion"in e&&(t.conversion=e.conversion),t}(r),i[e][a].raw=function(e){var t=function(t){return null==t?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(r)}))})),e.exports=i},289:function(e,t,a){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},290:function(e,t,a){var r=a(222);function n(e){var t=function(){for(var e={},t=Object.keys(r),a=t.length,n=0;n<a;n++)e[t[n]]={distance:-1,parent:null};return e}(),a=[e];for(t[e].distance=0;a.length;)for(var n=a.pop(),i=Object.keys(r[n]),s=i.length,l=0;l<s;l++){var o=i[l],c=t[o];-1===c.distance&&(c.distance=t[n].distance+1,c.parent=n,a.unshift(o))}return t}function i(e,t){return function(a){return t(e(a))}}function s(e,t){for(var a=[t[e].parent,e],n=r[t[e].parent][e],s=t[e].parent;t[s].parent;)a.unshift(t[s].parent),n=i(r[t[s].parent][s],n),s=t[s].parent;return n.conversion=a,n}e.exports=function(e){for(var t=n(e),a={},r=Object.keys(t),i=r.length,l=0;l<i;l++){var o=r[l];null!==t[o].parent&&(a[o]=s(o,t))}return a}},294:function(e,t,a){"use strict";a.r(t),a.d(t,"renderApp",(function(){return Ac}));var r=a(1),n=a.n(r),i=a(15),s=a.n(i),l=a(51),o=a(55),c=(a(200),a(201)),u=a(71),d=a.n(u),m=a(48),p=a.n(m),g=a(5),f=a.n(g),b=a(0),h=a(16),y=a(13),E=a(14),v=a(91),x=a(101);const k=e=>{const t=f.a.parse(e.from.toString()),a=f.a.parse(e.to.toString(),{roundUp:!0});return{...e,from:t&&t.valueOf()||p()().subtract(1,"hour").valueOf(),to:a&&a.valueOf()||p()().valueOf()}},M={from:"now-1h",to:"now",interval:">=1m"},O={time:M,autoReload:!1,refreshInterval:5e3},w=b.type({from:b.union([b.string,b.number]),to:b.union([b.string,b.number]),interval:b.string}),j=b.partial({time:w,autoReload:b.boolean,refreshInterval:b.number}),S=j.encode,C=e=>Object(h.pipe)(j.decode(e),Object(y.fold)(Object(E.constant)(void 0),E.identity)),T=(e,t)=>Number.isNaN(e)||Number.isNaN(t)?e=>e:Object(x.d)("metricTime",{autoReload:!1,time:{interval:">=1m",from:p()(e).toISOString(),to:p()(t).toISOString()}}),F=d()((()=>{const[e,t]=Object(v.b)({defaultState:O,decodeUrlState:C,encodeUrlState:S,urlStateKey:"metricTime"}),[a,n]=Object(r.useState)(e.autoReload||!1),[i,s]=Object(r.useState)(e.refreshInterval||5e3),[l,o]=Object(r.useState)(p()().valueOf()),[c,u]=Object(r.useState)(e.time||M);Object(r.useEffect)((()=>t({time:c,autoReload:a,refreshInterval:i})),[a,i,t,c]);const[d,m]=Object(r.useState)(k(e.time||M)),g=Object(r.useCallback)((e=>{u(e),m(k(e))}),[]);return{timeRange:c,setTimeRange:g,parsedTimeRange:d,refreshInterval:i,setRefreshInterval:s,isAutoReloading:a,setAutoReload:n,lastRefresh:l,triggerRefresh:Object(r.useCallback)((()=>o(p()().valueOf())),[o])}})),[L,P]=F;var I=a(141);const D=({match:{params:{nodeId:e,nodeType:t}},location:a})=>{const r=T(Object(I.b)(a),Object(I.d)(a))("");return n.a.createElement(l.Redirect,{to:`/detail/${t}/${e}?${r}`})},_=({nodeType:e,nodeId:t,to:a,from:r})=>({app:"metrics",pathname:`link-to/${e}-detail/${t}`,search:a&&r?{to:`${a}`,from:`${r}`}:void 0});var R=a(2),A=a(8);var B=a(102),N=a(45),V=a(46),z=a(11),$=a(173);const U=Object(z.euiStyled)($.b)`
  overflow: auto;
  background-color: ${e=>e.theme.eui.euiColorLightestShade};
`,H=({message:e})=>n.a.createElement($.a,null,n.a.createElement(U,null,n.a.createElement(q,{message:e}))),q=({message:e})=>n.a.createElement(N.EuiPage,{style:{flex:"1 0 auto"}},n.a.createElement(N.EuiPageBody,null,n.a.createElement(N.EuiPageHeader,null,n.a.createElement(N.EuiPageHeaderSection,null,n.a.createElement(N.EuiTitle,{size:"m"},n.a.createElement("h1",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.errorPage.unexpectedErrorTitle",defaultMessage:"Oops!"}))))),n.a.createElement(N.EuiPageContent,null,n.a.createElement(N.EuiCallOut,{color:"danger",title:e,iconType:"alert"},n.a.createElement("p",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.errorPage.tryAgainDescription ",defaultMessage:"Please click the back button and try again."}))))));var J=a(128);const G=({match:{params:{hostIp:e}},location:t})=>{const{source:a}=Object(J.a)({sourceId:"default"}),{error:i,name:s}=((e,t)=>{var a;const n=null===(a=Object(A.useKibana)().services.http)||void 0===a?void 0:a.fetch,[i,s]=Object(r.useState)(null),[l,o]=Object(r.useState)(!0),[c,u]=Object(r.useState)(null);return Object(r.useEffect)((()=>{(async()=>{o(!0),s(null);try{if(!n)throw new Error("HTTP service is unavailable");if(e&&t){const a=await n("/api/infra/ip_to_host",{method:"POST",body:JSON.stringify({ip:e,index_pattern:t})});o(!1),u(a)}}catch(e){o(!1),s(e)}})()}),[e,t,n]),{name:c&&c.host||null,loading:l,error:i}})(e,a&&a.configuration&&a.configuration.metricAlias||null);if(i)return n.a.createElement(H,{message:R.i18n.translate("xpack.infra.linkTo.hostWithIp.error",{defaultMessage:'Host not found with IP address "{hostIp}".',values:{hostIp:e}})});const o=T(Object(I.b)(t),Object(I.d)(t))("");return s?n.a.createElement(l.Redirect,{to:`/detail/host/${s}?${o}`}):n.a.createElement(B.a,{message:R.i18n.translate("xpack.infra.linkTo.hostWithIp.loading",{defaultMessage:'Loading host with IP address "{hostIp}".',values:{hostIp:e}})})};var K=a(90);const W=({location:e})=>{const t=function(e){if(0===e.length)return{};const t=Object(K.parse)(e.substring(1));for(const e in t)Object.hasOwnProperty.call(t,e)&&(t[e]||delete t[e],Array.isArray(t.key)&&(t[e]=t[e][0]));return t}(e.search),a="?waffleFilter=(expression:'',kind:kuery)&waffleTime=(currentTime:{timestamp},isAutoReloading:!f)&waffleOptions=(accountId:'',autoBounds:!t,boundsOverride:(max:1,min:0),customMetrics:!({customMetric}),customOptions:!(),groupBy:!(),legend:(palette:cool,reverseColors:!f,steps:10),metric:{metric},nodeType:{nodeType},region:'',sort:(by:name,direction:desc),timelineOpen:!f,view:map)".replace(/{(\w+)}/g,((e,a)=>t[a]||""));return n.a.createElement(l.Redirect,{to:"/inventory"+a})};var Q=a(80);const X=Q.c.map((e=>e.id)).join("|"),Y=e=>n.a.createElement(l.Switch,null,n.a.createElement(l.Route,{path:`${e.match.url}/:nodeType(${X})-detail/:nodeId`,component:D}),n.a.createElement(l.Route,{path:`${e.match.url}/host-detail-via-ip/:hostIp`,component:G}),n.a.createElement(l.Route,{path:`${e.match.url}/inventory`,component:W}),n.a.createElement(l.Redirect,{to:"/"}));var Z=a(69),ee=a.n(Z),te=a(103),ae=a(207),re=a(221),ne=a(84),ie=a(60),se=a(269);const le=()=>{const{options:e,chartOptions:t,setChartOptions:a,currentTimerange:i,setOptions:s,setTimeRange:l}=Object(r.useContext)(ne.c.Context),o=Object(r.useMemo)((()=>({options:e,chartOptions:t,timerange:i})),[e,t,i]),c=e=>{var t;e&&e.options&&(t=e.options,s(t)),e&&e.timerange&&l(e.timerange),e&&e.chartOptions&&a(e.chartOptions)};return n.a.createElement(x.a,{urlState:o,urlStateKey:"metricsExplorer",mapToUrlState:oe,onChange:c,onInitialize:c,populateWithInitialState:!0})};const oe=e=>{const t={};if(e)return e.options&&function(e){const t=ne.e.decode(e);try{return se.ThrowReporter.report(t),!0}catch(e){return!1}}(e.options)&&(e.options.source="url",Object(ie.set)(t,"options",e.options)),e.timerange&&function(e){const t=ne.g.decode(e);try{return se.ThrowReporter.report(t),!0}catch(e){return!1}}(e.timerange)&&Object(ie.set)(t,"timerange",e.timerange),e.chartOptions&&function(e){const t=ne.f.decode(e);try{return se.ThrowReporter.report(t),!0}catch(e){return!1}}(e.chartOptions)&&Object(ie.set)(t,"chartOptions",e.chartOptions),t};var ce=a(74);const ue=({children:e})=>{const{createSourceConfiguration:t,createDerivedIndexPattern:a,source:n,sourceExists:i,sourceId:s,metricIndicesExist:l,isLoading:o,loadSource:c,hasFailedLoadingSource:u,loadSourceFailureMessage:d,updateSourceConfiguration:m,version:p}=Object(r.useContext)(ce.a.Context);return e({create:t,configuration:n&&n.configuration,createDerivedIndexPattern:a,exists:i,hasFailed:u,isLoading:o,lastFailureMessage:d,load:c,metricIndicesExist:l,sourceId:s,update:m,version:p})};var de=a(49),me=a(209),pe=a(20),ge=a(86);const fe=e=>{Object(me.a)(pe.c,ge.f,e)};var be=a(158),he=a(127),ye=a(169),Ee=a(50),ve=a(47),xe=a(122),ke=a(111),Me=a(28),Oe=a(156),we=a(115);const je=e=>{const{visible:t,setVisible:a}=e,{triggersActionsUI:i}=Object(r.useContext)(Me.a),s=Object(r.useCallback)((()=>a(!1)),[a]),l=Object(r.useMemo)((()=>i&&i.getAddAlertFlyout({consumer:"infrastructure",onClose:s,canChangeTrigger:!1,alertTypeId:Oe.d,metadata:{currentOptions:e.options,series:e.series}})),[i,s]);return n.a.createElement(n.a.Fragment,null,t&&l)},Se=({onClose:e})=>{const{metricThresholdPrefill:t}=Object(we.b)(),{groupBy:a,filterQuery:r,metrics:i}=t;return n.a.createElement(je,{options:{groupBy:a,filterQuery:r,metrics:i},visible:!0,setVisible:e})};var Ce=a(17),Te=a(31),Fe=a.n(Te),Le=a(79),Pe=a(199),Ie=a(24),De=a(198);const _e="metric*",Re=e=>{if("rate"===e.aggregation){const t=Fe.a.v1(),a=Fe.a.v1(),r=Fe.a.v1();return[{id:t,type:"max",field:e.field||void 0},{id:r,type:"derivative",field:t,unit:"1s"},{id:a,type:"positive_only",field:r}]}if("p95"===e.aggregation||"p99"===e.aggregation){const t="p95"===e.aggregation?"95":"99";return[{id:Fe.a.v1(),type:"percentile",field:e.field,percentiles:[{id:Fe.a.v1(),value:t,mode:"line",percentile:"",shade:.2}]}]}return[{id:Fe.a.v1(),type:e.aggregation,field:e.field||void 0}]},Ae=e=>t=>{const a=Object(Pe.a)(t);return{label:Object(De.a)(t),axis_position:"right",chart_type:"line",color:t.color&&Object(Le.b)(t.color)||Object(Le.b)(Le.a.color0),fill:e.type===ne.b.area?.5:0,formatter:a===Ie.b.bits?Ie.b.bytes:a,value_template:"rate"===t.aggregation?"{{value}}/s":"{{value}}",id:Fe.a.v1(),line_width:2,metrics:Re(t),point_size:0,separate_axis:0,split_mode:"everything",stacked:e.stack?"stacked":"none"}},Be=(e,t)=>{const a=[];if(e.filterQuery&&a.push(e.filterQuery),e.groupBy){const r=t.id.replace('"','\\"'),n=Array.isArray(e.groupBy)?e.groupBy.map(((e,a)=>{if(!t.keys)return null;const r=t.keys[a];return r?`${e}: "${r.replace('"','\\"')}"`:null})).join(" and "):`${e.groupBy} : "${r}"`;a.push(n)}return{language:"kuery",query:a.join(" and ")}},Ne=(e,t,a,r,n)=>{const i=(s=e&&e.metricAlias||_e).split(",").length>1?_e:s;var s;const l={filters:[],linked:!1,query:{language:"kuery",query:""},uiState:{},vis:{aggs:[],params:{axis_formatter:"number",axis_position:"left",axis_scale:"normal",id:Fe.a.v1(),default_index_pattern:i,index_pattern:i,interval:"auto",series:t.metrics.map(Ae(n)),show_grid:1,show_legend:1,time_field:e&&e.fields.timestamp||"@timestamp",type:"timeseries",filter:Be(t,a)},title:a.id,type:"metrics"}};n.yAxisMode===ne.d.fromZero&&Object(ie.set)(l,"vis.params.axis_min",0);const o={refreshInterval:{pause:!0,value:0},time:{from:r.from,to:r.to}};return{app:"visualize",hash:"/create",search:{type:"metrics",_g:Object(Ce.encode)(o),_a:Object(Ce.encode)(l)}}};var Ve=a(73);const ze=(e,t=!1)=>{const a=f.a.parse(e,{roundUp:t});if(!a)throw new Error(`"${e}" is not a valid time string`);return a.valueOf()},$e=(e,t,a,r)=>_({nodeType:e,nodeId:t,from:ze(a),to:ze(r,!0)}),Ue=({onFilter:e,options:t,series:a,source:i,timeRange:s,uiCapabilities:l,chartOptions:o})=>{var c,u;const[d,m]=Object(r.useState)(!1),[p,g]=Object(r.useState)(!1),f=null!=t.groupBy&&null!=e,b=Object(r.useCallback)((()=>{f&&e&&(Array.isArray(t.groupBy)?e(t.groupBy.map(((e,t)=>{var r;return`${e}: "${null===(r=a.keys)||void 0===r?void 0:r[t]}"`})).join(" and ")):e(`${t.groupBy}: "${a.id}"`)),m(!1)}),[f,e,t,a.keys,a.id]),h=f?[{name:R.i18n.translate("xpack.infra.metricsExplorer.filterByLabel",{defaultMessage:"Add filter"}),icon:"metricsApp",onClick:b,"data-test-subj":"metricsExplorerAction-AddFilter"}]:[],y=i&&t.groupBy&&((e,t)=>{const a=Array.isArray(t)?t:[t];return a.includes(e.fields.host)?"host":a.includes(e.fields.pod)?"pod":a.includes(e.fields.container)?"container":void 0})(i,t.groupBy),E=Object(Ve.b)({app:"metrics",...y?$e(y,a.id,s.from,s.to):{}}),v=Object(Ve.b)({...Ne(i,t,a,s,o)}),x=y?[{name:R.i18n.translate("xpack.infra.metricsExplorer.viewNodeDetail",{defaultMessage:"View metrics for {name}",values:{name:y}}),icon:"metricsApp",...y?E:{},"data-test-subj":"metricsExplorerAction-ViewNodeMetrics"}]:[],k=[...h,...null!=l&&null!==(c=l.visualize)&&void 0!==c&&c.show?[{name:R.i18n.translate("xpack.infra.metricsExplorer.openInTSVB",{defaultMessage:"Open in Visualize"}),...v,icon:"visualizeApp",disabled:0===t.metrics.length,"data-test-subj":"metricsExplorerAction-OpenInTSVB"}]:[],...x,...null!=l&&null!==(u=l.infrastructure)&&void 0!==u&&u.save?[{name:R.i18n.translate("xpack.infra.metricsExplorer.alerts.createRuleButton",{defaultMessage:"Create threshold rule"}),icon:"bell",onClick(){g(!0)}}]:[]];if(0===k.length)return null;const M=[{id:0,title:"Actions",items:k}],O=R.i18n.translate("xpack.infra.metricsExplorer.actionsLabel.aria",{defaultMessage:"Actions for {grouping}",values:{grouping:a.id}}),w=R.i18n.translate("xpack.infra.metricsExplorer.actionsLabel.button",{defaultMessage:"Actions"}),j=n.a.createElement(N.EuiButtonEmpty,{contentProps:{"aria-label":O},onClick:()=>m(!0),size:"s",iconType:"arrowDown",iconSide:"right"},w);return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiPopover,{closePopover:()=>m(!1),id:`${a.id}-popover`,button:j,isOpen:d,panelPaddingSize:"none"},n.a.createElement(N.EuiContextMenu,{initialPanelId:0,panels:M}),n.a.createElement(je,{series:a,options:t,setVisible:g,visible:p})))},He=()=>n.a.createElement(N.EuiEmptyPrompt,{iconType:"stats",title:n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.emptyChart.title",defaultMessage:"Chart Data Missing"})),body:n.a.createElement("p",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.emptyChart.body",defaultMessage:"Unable to render chart."}))}),qe=()=>n.a.createElement(N.EuiEmptyPrompt,{"data-test-subj":"metricsExplorer-missingMetricMessage",iconType:"stats",title:n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.noMetrics.title",defaultMessage:"Missing Metric"})),body:n.a.createElement("p",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.noMetrics.body",defaultMessage:"Please choose a metric above."}))});function Je(e){return e?Ee.DARK_THEME:Ee.LIGHT_THEME}function Ge(e){return e?Ee.DARK_THEME:Object(Ee.mergeWithDefaultTheme)(Ke,Ee.LIGHT_THEME)}const Ke={crosshair:{band:{fill:"#D3DAE6"}},axes:{gridLine:{horizontal:{stroke:"#eaeaea"}}}};var We=a(105),Qe=a(112);const Xe=R.i18n.translate("xpack.infra.metricsExplorer.everything",{defaultMessage:"Everything"}),Ye=({series:e})=>{if(null!=e.keys){const{keys:t}=e;return n.a.createElement(N.EuiFlexGroup,{gutterSize:"xs"},t.map(((e,a)=>n.a.createElement(r.Fragment,{key:e},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiText,{size:"m",color:t.length-1>a?"subdued":"default"},n.a.createElement("strong",null,"*"===e?Xe:e))),t.length-1>a&&n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiText,{size:"m",color:"subdued"},n.a.createElement("span",null,"/")))))))}return n.a.createElement("span",null,e.id)},Ze=({source:e,options:t,chartOptions:a,series:i,title:s,onFilter:l,height:o=200,width:c="100%",timeRange:u,onTimeChange:d})=>{var m;const g=null===(m=Object(A.useKibana)().services.application)||void 0===m?void 0:m.capabilities,f=Object(A.useUiSetting)("theme:darkMode"),{metrics:b}=t,[h]=Object(We.a)("dateFormat"),y=Object(r.useMemo)((()=>{const e=Object(ve.first)(i.rows),t=Object(ve.last)(i.rows);return e&&t?Object(Ee.niceTimeFormatter)([e.timestamp,t.timestamp]):e=>`${e}`}),[i.rows]),E={headerFormatter:Object(r.useCallback)((e=>p()(e.value).format(h||"Y-MM-DD HH:mm:ss.SSS")),[h])},v=Object(r.useCallback)(Object(xe.a)(Object(ve.first)(b)),[t]),x=Object(Qe.a)(i,b,a.stack),k=a.yAxisMode===ne.d.fromZero?{...x,min:0}:x;return n.a.createElement("div",{style:{padding:24},"data-test-subj":"metricsExplorer-chart"},t.groupBy?n.a.createElement(N.EuiTitle,{size:"xs"},n.a.createElement(N.EuiFlexGroup,{alignItems:"center"},n.a.createElement(et,null,n.a.createElement(N.EuiToolTip,{content:s,anchorClassName:"metricsExplorerTitleAnchor"},n.a.createElement(Ye,{series:i}))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(Ue,{timeRange:u,options:t,chartOptions:a,series:i,onFilter:l,source:e,uiCapabilities:g})))):n.a.createElement(N.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(Ue,{options:t,chartOptions:a,series:i,source:e,timeRange:u,uiCapabilities:g}))),n.a.createElement("div",{className:"metricsExplorerChart",style:{height:o,width:c}},b.length&&i.rows.length>0?n.a.createElement(Ee.Chart,null,b.map(((e,t)=>n.a.createElement(ke.a,{type:a.type,key:t,metric:e,id:t,series:i,stack:a.stack}))),n.a.createElement(Ee.Axis,{id:"timestamp",position:Ee.Position.Bottom,showOverlappingTicks:!0,tickFormat:y}),n.a.createElement(Ee.Axis,{id:"values",position:Ee.Position.Left,tickFormat:v,domain:k}),n.a.createElement(Ee.Settings,{tooltip:E,onBrushEnd:({x:e})=>{if(!e)return;const[t,a]=e;d(p()(t).toISOString(),p()(a).toISOString())},theme:Je(f)})):t.metrics.length>0?n.a.createElement(He,null):n.a.createElement(qe,null)))},et=z.euiStyled.div`
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;
  flex: 1 1 auto;
  margin: 12px;
`,tt=({loading:e,data:t,onLoadMore:a,options:r,chartOptions:i,onRefetch:s,onFilter:l,source:o,timeRange:c,onTimeChange:u})=>{if(e)return n.a.createElement(he.a,{height:800,width:"100%",text:R.i18n.translate("xpack.infra.metricsExplorer.loadingCharts",{defaultMessage:"Loading charts"})});if(!t||0===t.series.length)return n.a.createElement(ye.a,{titleText:R.i18n.translate("xpack.infra.metricsExplorer.noDataTitle",{defaultMessage:"There is no data to display."}),bodyText:R.i18n.translate("xpack.infra.metricsExplorer.noDataBodyText",{defaultMessage:"Try adjusting your time, filters or group by settings."}),refetchText:R.i18n.translate("xpack.infra.metricsExplorer.noDataRefetchText",{defaultMessage:"Check for new data"}),testString:"metrics-explorer-no-data",onRefetch:s});const d=R.i18n.translate("xpack.infra.metricsExplorer.andLabel",{defaultMessage:'" and "'});return n.a.createElement("div",{style:{width:"100%"}},n.a.createElement(N.EuiFlexGrid,{gutterSize:"s",columns:1===t.series.length?1:3},t.series.map((e=>n.a.createElement(N.EuiFlexItem,{key:e.id,style:{minWidth:0}},n.a.createElement(Ze,{key:`chart-${e.id}`,onFilter:l,options:r,chartOptions:i,title:r.groupBy?e.id:null,height:t.series.length>1?200:400,series:e,source:o,timeRange:c,onTimeChange:u}))))),t.series.length>1?n.a.createElement("div",{style:{textAlign:"center",marginBottom:16}},n.a.createElement(N.EuiHorizontalRule,null),n.a.createElement(N.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.footerPaginationMessage",defaultMessage:'Displaying {length} of {total} charts grouped by "{groupBy}".',values:{length:t.series.length,total:t.pageInfo.total,groupBy:Array.isArray(r.groupBy)?r.groupBy.join(d):r.groupBy}}))),t.pageInfo.afterKey?n.a.createElement("div",{style:{margin:"16px 0"}},n.a.createElement(N.EuiButton,{isLoading:e,size:"s",onClick:()=>a(t.pageInfo.afterKey||null)},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.loadMoreChartsButton",defaultMessage:"Load More Charts"}))):null):null)};var at=a(53),rt=a(130);const nt=({options:e,onChange:t,fields:a,autoFocus:i=!1})=>{const s=Object.keys(Le.a),[l,o]=Object(r.useState)(i),c=Object(r.useCallback)((e=>{e&&l&&(e.focus(),o(!1))}),[l]),u=Object(r.useCallback)((a=>{t(a.map(((t,a)=>({aggregation:e.aggregation,field:t.value,color:s[a]}))))}),[t,e.aggregation,s]),d=a.map((e=>({label:e.name,value:e.name}))),m=e.metrics.filter((e=>"count"!==e.aggregation)).map((e=>({label:e.field||"",value:e.field||"",color:Object(Le.b)(e.color||Le.a.color0)}))),p=R.i18n.translate("xpack.infra.metricsExplorer.metricComboBoxPlaceholder",{defaultMessage:"choose a metric to plot"});return n.a.createElement(N.EuiComboBox,{"data-test-subj":"metricsExplorer-metrics","aria-label":p,isDisabled:"count"===e.aggregation,placeholder:p,fullWidth:!0,options:d,selectedOptions:m,onChange:u,isClearable:!0,inputRef:c})};var it=a(160),st=a(89);const lt=({options:e,onChange:t})=>{const a={avg:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.avg",{defaultMessage:"Average"}),sum:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.sum",{defaultMessage:"Sum"}),max:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.max",{defaultMessage:"Max"}),min:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.min",{defaultMessage:"Min"}),cardinality:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.cardinality",{defaultMessage:"Cardinality"}),rate:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.rate",{defaultMessage:"Rate"}),p95:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.p95",{defaultMessage:"95th Percentile"}),p99:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.p99",{defaultMessage:"99th Percentile"}),count:R.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.count",{defaultMessage:"Document count"})},i=Object(r.useCallback)((e=>{const a=st.c.is(e.target.value)&&e.target.value||"avg";t(a)}),[t]),s=R.i18n.translate("xpack.infra.metricsExplorer.aggregationSelectLabel",{defaultMessage:"Select an aggregation"});return n.a.createElement(N.EuiSelect,{"aria-label":s,placeholder:s,fullWidth:!0,value:e.aggregation,options:st.a.map((e=>({text:a[e],value:e}))),onChange:i})},ot=({chartOptions:e,onChange:t})=>{const[a,i]=Object(r.useState)(!1),s=Object(r.useCallback)((()=>{i(!1)}),[]),l=Object(r.useCallback)((()=>{i(!0)}),[]),o=n.a.createElement(N.EuiButtonEmpty,{iconSide:"left",iconType:"eye",onClick:l,"data-test-subj":"metricsExplorer-customize"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.customizeChartOptions",defaultMessage:"Customize"})),c=[{id:ne.d.auto,label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.autoLabel",{defaultMessage:"Automatic (min to max)"})},{id:ne.d.fromZero,label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.fromZeroLabel",{defaultMessage:"From zero (0 to max)"})}],u=[{"data-test-subj":"metricsExplorer-chartRadio-line",id:ne.b.line,label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.lineLabel",{defaultMessage:"Line"})},{"data-test-subj":"metricsExplorer-chartRadio-area",id:ne.b.area,label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.areaLabel",{defaultMessage:"Area"})},{"data-test-subj":"metricsExplorer-chartRadio-bar",id:ne.b.bar,label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.barLabel",{defaultMessage:"Bar"})}],d=Object(r.useCallback)((a=>{t({...e,yAxisMode:a})}),[e,t]),m=Object(r.useCallback)((a=>{t({...e,type:a})}),[e,t]),p=Object(r.useCallback)((a=>{t({...e,stack:a.target.checked})}),[e,t]);return n.a.createElement(N.EuiPopover,{id:"MetricExplorerChartOptionsPopover",button:o,isOpen:a,closePopover:s},n.a.createElement(N.EuiForm,null,n.a.createElement(N.EuiFormRow,{display:"rowCompressed",label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.typeLabel",{defaultMessage:"Chart style"})},n.a.createElement(N.EuiRadioGroup,{compressed:!0,options:u,idSelected:e.type,onChange:m})),n.a.createElement(N.EuiFormRow,{display:"rowCompressed",label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.stackLabel",{defaultMessage:"Stack series"})},n.a.createElement(N.EuiSwitch,{label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.stackSwitchLabel",{defaultMessage:"Stack"}),checked:e.stack,onChange:p})),n.a.createElement(N.EuiFormRow,{display:"rowCompressed",label:R.i18n.translate("xpack.infra.metricsExplorer.chartOptions.yAxisDomainLabel",{defaultMessage:"Y Axis Domain"})},n.a.createElement(N.EuiRadioGroup,{compressed:!0,options:c,idSelected:e.yAxisMode,onChange:d}))))},ct=e=>e?e.map((e=>({start:e.from,end:e.to,label:e.display}))):[],ut=({timeRange:e,derivedIndexPattern:t,options:a,onTimeChange:r,onRefresh:i,onGroupByChange:s,onFilterQuerySubmit:l,onMetricsChange:o,onAggregationChange:c,chartOptions:u,onChartOptionsChange:d})=>{const m="avg"===a.aggregation&&0===a.metrics.length,[p]=Object(We.a)(at.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),g=ct(p);return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiFlexGroup,{alignItems:"center"},n.a.createElement(N.EuiFlexItem,{grow:"count"===a.aggregation&&2},n.a.createElement(lt,{fullWidth:!0,options:a,onChange:c})),"count"!==a.aggregation&&n.a.createElement(N.EuiText,{size:"s",color:"subdued"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.aggregationLabel",defaultMessage:"of"})),"count"!==a.aggregation&&n.a.createElement(N.EuiFlexItem,{grow:2},n.a.createElement(nt,{autoFocus:m,fields:t.fields,options:a,onChange:o})),n.a.createElement(N.EuiText,{size:"s",color:"subdued"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metricsExplorer.groupByToolbarLabel",defaultMessage:"graph per"})),n.a.createElement(N.EuiFlexItem,{grow:1},n.a.createElement(it.a,{onChange:s,fields:t.fields,options:a}))),n.a.createElement(N.EuiFlexGroup,{alignItems:"center"},n.a.createElement(N.EuiFlexItem,null,n.a.createElement(rt.a,{derivedIndexPattern:t,onSubmit:l,value:a.filterQuery})),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(ot,{onChange:d,chartOptions:u})),n.a.createElement(N.EuiFlexItem,{grow:!1,style:{marginRight:5}},n.a.createElement(N.EuiSuperDatePicker,{start:e.from,end:e.to,onTimeChange:({start:e,end:t})=>r(e,t),onRefresh:i,commonlyUsedRanges:g}))))};var dt=a(161);const mt=({errors:e,name:t,onChange:a,value:r})=>({error:e,isInvalid:e.length>0,name:t,onChange:e=>a(e.currentTarget.value),value:r}),pt=e=>""===e?[n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.fieldEmptyErrorMessage",defaultMessage:"The field must not be empty"})]:[],gt={name:"",description:"",metricAlias:"",containerField:"",hostField:"",podField:"",tiebreakerField:"",timestampField:"",anomalyThreshold:0},ft=e=>{const t=(({initialFormState:e=gt})=>{const[t,a]=Object(r.useState)({}),n=Object(r.useCallback)((()=>a({})),[]),i=Object(r.useMemo)((()=>({...e,...t})),[e,t]),s=Object(r.useMemo)((()=>mt({errors:pt(i.name),name:"name",onChange:e=>a((t=>({...t,name:e}))),value:i.name})),[i.name]),l=Object(r.useMemo)((()=>mt({errors:pt(i.metricAlias),name:"metricAlias",onChange:e=>a((t=>({...t,metricAlias:e}))),value:i.metricAlias})),[i.metricAlias]),o=Object(r.useMemo)((()=>mt({errors:pt(i.containerField),name:"containerField",onChange:e=>a((t=>({...t,containerField:e}))),value:i.containerField})),[i.containerField]),c=Object(r.useMemo)((()=>mt({errors:pt(i.hostField),name:"hostField",onChange:e=>a((t=>({...t,hostField:e}))),value:i.hostField})),[i.hostField]),u=Object(r.useMemo)((()=>mt({errors:pt(i.podField),name:"podField",onChange:e=>a((t=>({...t,podField:e}))),value:i.podField})),[i.podField]),d=Object(r.useMemo)((()=>mt({errors:pt(i.tiebreakerField),name:"tiebreakerField",onChange:e=>a((t=>({...t,tiebreakerField:e}))),value:i.tiebreakerField})),[i.tiebreakerField]),m=Object(r.useMemo)((()=>mt({errors:pt(i.timestampField),name:"timestampField",onChange:e=>a((t=>({...t,timestampField:e}))),value:i.timestampField})),[i.timestampField]),p=Object(r.useMemo)((()=>(({errors:e,name:t,onChange:a,value:r})=>({error:e,isInvalid:e.length>0,name:t,onChange:(e,t)=>a(+e.currentTarget.value,t),value:r}))({errors:pt(i.anomalyThreshold),name:"anomalyThreshold",onChange:e=>a((t=>({...t,anomalyThreshold:e}))),value:i.anomalyThreshold})),[i.anomalyThreshold]),g=Object(r.useMemo)((()=>({name:s,metricAlias:l,containerField:o,hostField:c,podField:u,tiebreakerField:d,timestampField:m,anomalyThreshold:p})),[s,l,o,c,u,d,m,p]),f=Object(r.useMemo)((()=>Object.values(g).reduce(((e,{error:t})=>[...e,...t]),[])),[g]),b=Object(r.useMemo)((()=>f.length<=0),[f]),h=Object(r.useMemo)((()=>Object.keys(t).length>0),[t]);return{errors:f,fieldProps:g,formState:i,formStateChanges:t,isFormDirty:h,isFormValid:b,resetForm:n}})({initialFormState:Object(r.useMemo)((()=>e?{name:e.name,description:e.description,metricAlias:e.metricAlias,containerField:e.fields.container,hostField:e.fields.host,podField:e.fields.pod,tiebreakerField:e.fields.tiebreaker,timestampField:e.fields.timestamp,anomalyThreshold:e.anomalyThreshold}:void 0),[e])}),a=Object(r.useMemo)((()=>[...t.errors]),[t.errors]),n=Object(r.useCallback)((()=>{t.resetForm()}),[t]),i=Object(r.useMemo)((()=>t.isFormDirty),[t.isFormDirty]),s=Object(r.useMemo)((()=>t.isFormValid),[t.isFormValid]);return{errors:a,formState:Object(r.useMemo)((()=>({name:t.formState.name,description:t.formState.description,metricAlias:t.formState.metricAlias,fields:{container:t.formState.containerField,host:t.formState.hostField,pod:t.formState.podField,tiebreaker:t.formState.tiebreakerField,timestamp:t.formState.timestampField},anomalyThreshold:t.formState.anomalyThreshold})),[t.formState]),formStateChanges:Object(r.useMemo)((()=>({name:t.formStateChanges.name,description:t.formStateChanges.description,metricAlias:t.formStateChanges.metricAlias,fields:{container:t.formStateChanges.containerField,host:t.formStateChanges.hostField,pod:t.formStateChanges.podField,tiebreaker:t.formStateChanges.tiebreakerField,timestamp:t.formStateChanges.timestampField},anomalyThreshold:t.formStateChanges.anomalyThreshold})),[t.formStateChanges]),isFormDirty:i,isFormValid:s,indicesConfigurationProps:t.fieldProps,resetForm:n}},bt=b.type({viewId:b.string}),ht={viewId:"0"},yt=d()((e=>{const{source:t,isLoading:a,sourceExists:n,createSourceConfiguration:i,updateSourceConfiguration:s}=Object(r.useContext)(ce.a.Context),{viewType:l,defaultViewState:o}=e,{data:c,loading:u,find:d,error:m,hasView:p}=(e=>{const t=Object(de.useUiTracker)({app:"infra_metrics"}),a=Object(A.useKibana)(),[n,i]=Object(r.useState)(null),[s,l]=Object(r.useState)(null),[o,c]=Object(r.useState)(!1);return{hasView:async t=>{var r;const n=null===(r=a.services.savedObjects)||void 0===r?void 0:r.client;if(!n)throw new Error("Saved objects client is unavailable");return(await n.find({type:e})).savedObjects.find((e=>e.attributes.name===t))},data:n,loading:o,error:s,find:Object(r.useCallback)(((r,n=[])=>{c(!0),(async()=>{try{var s;const o=null===(s=a.services.savedObjects)||void 0===s?void 0:s.client;if(!o)throw new Error("Saved objects client is unavailable");const u=await o.find({type:e,search:r,searchFields:n,page:1,perPage:1e3});l(null),c(!1),i(u),u.total>1e3?t({metric:`over_1000_saved_objects_for_${e}`}):t({metric:`under_1000_saved_objects_for_${e}`})}catch(e){c(!1),l(e)}})()}),[e,a.services.savedObjects,t])}})(l),[g,f]=Object(v.b)({defaultState:ht,decodeUrlState:kt,encodeUrlState:xt,urlStateKey:"savedView"}),[b]=Object(r.useState)(e.shouldLoadDefault),[h,y]=Object(r.useState)(null),[E,x]=Object(r.useState)(null),{create:k,error:M,data:O,createdId:w}=(e=>{const t=Object(A.useKibana)(),[a,n]=Object(r.useState)(null),[i,s]=Object(r.useState)(null),[l,o]=Object(r.useState)(null),[c,u]=Object(r.useState)(!1);return{data:a,loading:c,error:l,create:Object(r.useCallback)(((a,r)=>{u(!0),(async()=>{try{var i;const l=null===(i=t.services.savedObjects)||void 0===i?void 0:i.client;if(!l)throw new Error("Saved objects client is unavailable");const c=await l.create(e,a,r);s(c.id),o(null),n(c),u(!1)}catch(e){u(!1),o(e)}})()}),[e,t.services.savedObjects]),createdId:i}})(l),{update:j,error:S,data:C,updatedId:T}=(e=>{const t=Object(A.useKibana)(),[a,n]=Object(r.useState)(null),[i,s]=Object(r.useState)(null),[l,o]=Object(r.useState)(null),[c,u]=Object(r.useState)(!1);return{data:a,loading:c,error:l,update:Object(r.useCallback)(((a,r,i)=>{u(!0),(async()=>{try{var l;const c=null===(l=t.services.savedObjects)||void 0===l?void 0:l.client;if(!c)throw new Error("Saved objects client is unavailable");const d=await c.update(e,a,r,i);s(d.id),o(null),n(d),u(!1)}catch(e){u(!1),o(e)}})()}),[e,t.services.savedObjects]),updatedId:i}})(l),{deleteObject:F,deletedId:L}=(e=>{const t=Object(A.useKibana)(),[a,n]=Object(r.useState)(null),[i,s]=Object(r.useState)(!1),[l,o]=Object(r.useState)(null);return{loading:i,error:a,deleteObject:Object(r.useCallback)((a=>{s(!0),(async()=>{try{var r;await(null===(r=t.services.savedObjects)||void 0===r?void 0:r.client.delete(e,a)),n(null),o(a),s(!1)}catch(e){s(!1),n(e)}})()}),[e,t.services.savedObjects]),deletedId:l}})(l),{getObject:P,data:I}=(e=>{const t=Object(A.useKibana)(),[a,n]=Object(r.useState)(null),[i,s]=Object(r.useState)(null),[l,o]=Object(r.useState)(!1);return{data:a,loading:l,error:i,getObject:Object(r.useCallback)((a=>{o(!0),(async()=>{try{var r;const i=null===(r=t.services.savedObjects)||void 0===r?void 0:r.client;if(!i)throw new Error("Saved objects client is unavailable");const l=await i.get(e,a);s(null),o(!1),n(l)}catch(e){o(!1),s(e)}})()}),[e,t.services.savedObjects])}})(l),[D,_]=Object(r.useState)(null);Object(r.useEffect)((()=>_(M)),[M]);const B=Object(r.useCallback)((e=>F(e)),[F]),N=ft(t&&t.configuration),V=Object(r.useMemo)((()=>"inventory-view"===l?"inventoryDefaultView":"metricsExplorerDefaultView"),[l]),z=Object(r.useCallback)((async e=>{n?await s({...N.formStateChanges,[V]:e}):await i({...N.formState,[V]:e})}),[N.formState,N.formStateChanges,n,V,i,s]),$=Object(r.useCallback)((e=>{_(null),(async()=>{await p(e.name)?_(R.i18n.translate("xpack.infra.savedView.errorOnCreate.duplicateViewName",{defaultMessage:"A view with that name already exists."})):k(e)})()}),[k,p]),U=Object(r.useCallback)(((e,t)=>{_(null),(async()=>{const a=await p(t.name);a&&a.id!==e?_(R.i18n.translate("xpack.infra.savedView.errorOnCreate.duplicateViewName",{defaultMessage:"A view with that name already exists."})):j(e,t)})()}),[j,p]),H=Object(r.useMemo)((()=>t&&t.configuration?"inventoryDefaultView"===V?t.configuration.inventoryDefaultView:"metricsExplorerDefaultView"===V?t.configuration.metricsExplorerDefaultView:"":""),[t,V]),q=Object(r.useCallback)((e=>({...e.attributes,id:e.id,isDefault:H===e.id})),[H]),J=Object(r.useMemo)((()=>c?c.savedObjects:[]),[c]),G=Object(r.useMemo)((()=>{const e=[{name:R.i18n.translate("xpack.infra.savedView.defaultViewNameHosts",{defaultMessage:"Default view"}),id:"0",isDefault:!H||"0"===H,...o}];return J.forEach((t=>t.type===l&&e.push(q(t)))),e}),[o,J,l,H,q]),K=Object(r.useMemo)((()=>O?q(O):null),[O,q]),W=Object(r.useMemo)((()=>C?q(C):null),[C,q]),Q=Object(r.useCallback)((()=>{x(!0),P(H)}),[x,P,H]);Object(r.useEffect)((()=>{I&&(y(q(I)),x(!1))}),[I,H,q]);const X=Object(r.useCallback)((()=>{y({name:R.i18n.translate("xpack.infra.savedView.defaultViewNameHosts",{defaultMessage:"Default view"}),id:"0",isDefault:!H||"0"===H,...o})}),[y,H,o]),Y=Object(r.useCallback)((()=>{"0"!==H?Q():(X(),x(!1))}),[H,Q,X,x]);return Object(r.useEffect)((()=>{E||h||!b||Y()}),[Y,E,h,b]),Object(r.useEffect)((()=>{h&&g.viewId!==h.id&&c&&f({viewId:h.id})}),[g,f,h,H,c]),Object(r.useEffect)((()=>{if(!h&&!u&&c&&b){const e=G.find((e=>e.id===g.viewId));e?y(e):Y()}}),[u,h,c,G,y,Y,g.viewId,b]),{views:G,saveView:$,defaultViewId:H,loading:u,updateView:U,updatedView:W,updatedId:T,deletedId:L,createdId:w,createdView:K,errorOnUpdate:S,errorOnFind:m,errorOnCreate:D,shouldLoadDefault:b,makeDefault:z,sourceIsLoading:a,deleteView:B,loadingDefaultView:E,setCurrentView:y,currentView:h,loadDefaultView:Q,find:d}})),[Et,vt]=yt,xt=e=>bt.encode(e),kt=e=>Object(h.pipe)(bt.decode(e),Object(y.fold)(Object(E.constant)(void 0),E.identity));var Mt=a(22);const Ot=({hasData:e=!0,"data-test-subj":t,...a})=>{const{services:{observability:{navigation:{PageTemplate:r}},docLinks:i}}=Object(Mt.b)(),s=e?void 0:{solution:R.i18n.translate("xpack.infra.metrics.noDataConfig.solutionName",{defaultMessage:"Observability"}),actions:{beats:{title:R.i18n.translate("xpack.infra.metrics.noDataConfig.beatsCard.title",{defaultMessage:"Add a metrics integration"}),description:R.i18n.translate("xpack.infra.metrics.noDataConfig.beatsCard.description",{defaultMessage:"Use Beats to send metrics data to Elasticsearch. We make it easy with modules for many popular systems and apps."})}},docsLink:i.links.observability.guide};return n.a.createElement(r,ee()({"data-test-subj":e?t:"noDataPage",noDataConfig:s},a))},wt=({close:e,save:t,isInvalid:a})=>{const[i,s]=Object(r.useState)(""),[l,o]=Object(r.useState)(!1),c=Object(r.useCallback)((e=>o(e.target.checked)),[]),u=Object(r.useCallback)((e=>s(e.target.value)),[]),d=Object(r.useCallback)((()=>{t(i,l)}),[l,t,i]);return n.a.createElement(N.EuiModal,{onClose:e,"data-test-subj":"savedViews-createModal"},n.a.createElement(N.EuiModalHeader,null,n.a.createElement(N.EuiModalHeaderTitle,null,n.a.createElement(V.FormattedMessage,{defaultMessage:"Save View",id:"xpack.infra.waffle.savedView.createHeader"}))),n.a.createElement(N.EuiModalBody,null,n.a.createElement(N.EuiFieldText,{isInvalid:a,placeholder:R.i18n.translate("xpack.infra.waffle.savedViews.viewNamePlaceholder",{defaultMessage:"Name"}),"data-test-subj":"savedViewViweName",value:i,onChange:u,"aria-label":R.i18n.translate("xpack.infra.waffle.savedViews.viewNamePlaceholder",{defaultMessage:"Name"})}),n.a.createElement(N.EuiSpacer,{size:"xl"}),n.a.createElement(N.EuiSwitch,{id:"saved-view-save-time-checkbox",label:n.a.createElement(V.FormattedMessage,{defaultMessage:"Store time with view",id:"xpack.infra.waffle.savedViews.includeTimeFilterLabel"}),checked:l,onChange:c}),n.a.createElement(N.EuiSpacer,{size:"s"}),n.a.createElement(N.EuiText,{size:"xs",grow:!1,style:{maxWidth:400}},n.a.createElement(V.FormattedMessage,{defaultMessage:"This changes the time filter to the currently selected time each time the view is loaded",id:"xpack.infra.waffle.savedViews.includeTimeHelpText"}))),n.a.createElement(N.EuiModalFooter,null,n.a.createElement(N.EuiButtonEmpty,{onClick:e},n.a.createElement(V.FormattedMessage,{defaultMessage:"Cancel",id:"xpack.infra.waffle.savedViews.cancelButton"})),n.a.createElement(N.EuiButton,{color:"primary",disabled:!i,fill:!0,onClick:d,"data-test-subj":"createSavedViewButton"},n.a.createElement(V.FormattedMessage,{defaultMessage:"Save",id:"xpack.infra.waffle.savedViews.saveButton"}))))};function jt({close:e,save:t,isInvalid:a,currentView:i}){const[s,l]=Object(r.useState)(i.name),[o,c]=Object(r.useState)(!1),u=Object(r.useCallback)((e=>c(e.target.checked)),[]),d=Object(r.useCallback)((e=>l(e.target.value)),[]),m=Object(r.useCallback)((()=>{t(s,o)}),[o,t,s]);return n.a.createElement(N.EuiModal,{onClose:e},n.a.createElement(N.EuiModalHeader,null,n.a.createElement(N.EuiModalHeaderTitle,null,n.a.createElement(V.FormattedMessage,{defaultMessage:"Update View",id:"xpack.infra.waffle.savedView.updateHeader"}))),n.a.createElement(N.EuiModalBody,null,n.a.createElement(N.EuiFieldText,{isInvalid:a,placeholder:R.i18n.translate("xpack.infra.waffle.savedViews.viewNamePlaceholder",{defaultMessage:"Name"}),"data-test-subj":"savedViewViweName",value:s,onChange:d,"aria-label":R.i18n.translate("xpack.infra.waffle.savedViews.viewNamePlaceholder",{defaultMessage:"Name"})}),n.a.createElement(N.EuiSpacer,{size:"xl"}),n.a.createElement(N.EuiSwitch,{id:"saved-view-save-time-checkbox",label:n.a.createElement(V.FormattedMessage,{defaultMessage:"Store time with view",id:"xpack.infra.waffle.savedViews.includeTimeFilterLabel"}),checked:o,onChange:u}),n.a.createElement(N.EuiSpacer,{size:"s"}),n.a.createElement(N.EuiText,{size:"xs",grow:!1,style:{maxWidth:400}},n.a.createElement(V.FormattedMessage,{defaultMessage:"This changes the time filter to the currently selected time each time the view is loaded",id:"xpack.infra.waffle.savedViews.includeTimeHelpText"}))),n.a.createElement(N.EuiModalFooter,null,n.a.createElement(N.EuiButtonEmpty,{onClick:e},n.a.createElement(V.FormattedMessage,{defaultMessage:"Cancel",id:"xpack.infra.waffle.savedViews.cancelButton"})),n.a.createElement(N.EuiButton,{color:"primary",disabled:!s,fill:!0,onClick:m,"data-test-subj":"updateSavedViewButton"},n.a.createElement(V.FormattedMessage,{defaultMessage:"Save",id:"xpack.infra.waffle.savedViews.saveButton"}))))}const St=e=>{const[t,a]=Object(r.useState)(!1),i=Object(r.useCallback)((()=>a(!0)),[]),s=Object(r.useCallback)((()=>a(!1)),[]);return n.a.createElement(n.a.Fragment,null,t&&n.a.createElement(N.EuiFlexGroup,null,n.a.createElement(N.EuiButtonEmpty,{onClick:s,"data-test-subj":"hideConfirm"},n.a.createElement(V.FormattedMessage,{defaultMessage:"cancel",id:"xpack.infra.waffle.savedViews.cancel"})),n.a.createElement(N.EuiButton,{disabled:e.isDisabled,fill:!0,iconType:"trash",color:"danger",onClick:e.confirmedAction,"data-test-subj":"showConfirm"},n.a.createElement(V.FormattedMessage,{defaultMessage:"Delete view?",id:"xpack.infra.openView.actionNames.deleteConfirmation"}))),!t&&n.a.createElement(N.EuiButtonEmpty,{iconType:"trash",color:"danger",onClick:i}))};function Ct({close:e,views:t,defaultViewId:a,setView:i,makeDefault:s,deleteView:l,loading:o,sourceIsLoading:c}){const[u,d]=Object(r.useState)(null),m=Object(r.useCallback)(((t,a)=>n.a.createElement(N.EuiButtonEmpty,{onClick:()=>{i(a),e()}},t)),[i,e]),p=Object(r.useCallback)((e=>"0"===e.id?n.a.createElement(n.a.Fragment,null):n.a.createElement(St,{isDisabled:e.isDefault,confirmedAction:()=>{l(e.id)}})),[l]),g=Object(r.useCallback)((e=>{const t=e.id===a;return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiButtonEmpty,{isLoading:u===e.id&&c,iconType:t?"starFilled":"starEmpty",onClick:()=>{d(e.id),s(e.id)}}))}),[s,a,c,u]),f=[{field:"name",name:R.i18n.translate("xpack.infra.openView.columnNames.name",{defaultMessage:"Name"}),sortable:!0,truncateText:!0,render:m},{name:R.i18n.translate("xpack.infra.openView.columnNames.actions",{defaultMessage:"Actions"}),actions:[{available:()=>!0,render:g},{available:e=>!0,render:p}]}];return n.a.createElement(N.EuiPortal,null,n.a.createElement(N.EuiFlyout,{onClose:e,"data-test-subj":"loadViewsFlyout"},n.a.createElement(N.EuiFlyoutHeader,null,n.a.createElement(N.EuiTitle,{size:"m"},n.a.createElement("h2",null,n.a.createElement(V.FormattedMessage,{defaultMessage:"Manage saved views",id:"xpack.infra.openView.flyoutHeader"})))),n.a.createElement(N.EuiFlyoutBody,null,n.a.createElement(N.EuiInMemoryTable,{items:t,columns:f,loading:o,search:!0,pagination:!0,sorting:!0})),n.a.createElement(N.EuiModalFooter,null,n.a.createElement(N.EuiButtonEmpty,{"data-test-subj":"cancelSavedViewModal",onClick:e},n.a.createElement(V.FormattedMessage,{defaultMessage:"Cancel",id:"xpack.infra.openView.cancelButton"})))))}function Tt({close:e,views:t,setView:a,currentView:i}){const[s,l]=Object(r.useState)(null),o=Object(r.useCallback)((e=>{l(e)}),[]),c=Object(r.useCallback)((()=>{if(!s)return void e();const r=s.find((e=>e.checked));r?(a(t.find((e=>e.id===r.key))),e()):e()}),[s,t,a,e]),u=Object(r.useMemo)((()=>t.map((e=>({label:e.name,key:e.id,checked:(null==i?void 0:i.id)===e.id?"on":void 0})))),[t,i]);return n.a.createElement(N.EuiModal,{onClose:e,"data-test-subj":"savedViews-loadModal"},n.a.createElement(N.EuiModalHeader,null,n.a.createElement(N.EuiModalHeaderTitle,null,n.a.createElement(V.FormattedMessage,{defaultMessage:"Select a view to load",id:"xpack.infra.waffle.savedView.selectViewHeader"}))),n.a.createElement(N.EuiModalBody,null,n.a.createElement(N.EuiSelectable,{singleSelection:!0,searchable:!0,options:s||u,onChange:o,searchProps:{placeholder:R.i18n.translate("xpack.infra.savedView.searchPlaceholder",{defaultMessage:"Search for saved views"})},listProps:{bordered:!0}},((e,t)=>n.a.createElement(n.a.Fragment,null,t,n.a.createElement("div",{style:{marginTop:20},"data-test-subj":"savedViews-loadList"},e))))),n.a.createElement(N.EuiModalFooter,null,n.a.createElement(N.EuiButtonEmpty,{"data-test-subj":"cancelSavedViewModal",onClick:e},n.a.createElement(V.FormattedMessage,{defaultMessage:"Cancel",id:"xpack.infra.openView.cancelButton"})),n.a.createElement(N.EuiButton,{fill:!0,color:"primary","data-test-subj":"loadSavedViewModal",onClick:c},n.a.createElement(V.FormattedMessage,{defaultMessage:"Load view",id:"xpack.infra.openView.loadButton"}))))}function Ft(e){const t=Object(A.useKibana)(),{views:a,saveView:i,loading:s,updateView:l,deletedId:o,deleteView:c,defaultViewId:u,makeDefault:d,sourceIsLoading:m,find:p,errorOnFind:g,errorOnCreate:f,createdView:b,updatedView:h,currentView:y,setCurrentView:E}=vt(),[v,x]=Object(r.useState)(!1),[k,M]=Object(r.useState)(!1),[O,w]=Object(r.useState)(!1),[j,S]=Object(r.useState)(!1),[C,T]=Object(r.useState)(!1),[F,L]=Object(r.useState)(!1),P=Object(r.useCallback)((()=>{S(!1)}),[S]),I=Object(r.useCallback)((()=>{P(),p(),M(!0)}),[M,p,P]),D=Object(r.useCallback)((()=>{M(!1)}),[M]),_=Object(r.useCallback)((()=>{P(),w(!1),T(!0)}),[P]),B=Object(r.useCallback)((()=>{P(),w(!1),L(!0)}),[P]),V=Object(r.useCallback)((()=>x(!1)),[]),z=Object(r.useCallback)((()=>T(!1)),[]),$=Object(r.useCallback)((()=>L(!1)),[]),U=Object(r.useCallback)((()=>{P(),p(),x(!0)}),[p,P]),H=Object(r.useCallback)((()=>{S(!0)}),[S]),q=Object(r.useCallback)(((t,a=!1)=>{const r={...e.viewState,...a?{}:{time:void 0}};i({...r,name:t})}),[e.viewState,i]),J=Object(r.useCallback)(((t,a=!1)=>{const r={...e.viewState,...a?{}:{time:void 0}};l(y.id,{...r,name:t})}),[e.viewState,l,y]);return Object(r.useEffect)((()=>{f&&w(!0)}),[f]),Object(r.useEffect)((()=>{void 0!==h&&(E(h),$())}),[h,E,$]),Object(r.useEffect)((()=>{void 0!==b&&(E(b),z())}),[b,E,z]),Object(r.useEffect)((()=>{void 0!==o&&p()}),[o,p]),Object(r.useEffect)((()=>{f?t.notifications.toasts.warning(Lt("create",f)):g&&t.notifications.toasts.warning(Lt("find",g))}),[f,g,t]),n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiPopover,{"data-test-subj":"savedViews-popover",button:n.a.createElement(N.EuiButton,{onClick:H,"data-test-subj":"savedViews-openPopover",iconType:"arrowDown",iconSide:"right"},y?y.name:R.i18n.translate("xpack.infra.savedView.unknownView",{defaultMessage:"No view selected"})),isOpen:j,closePopover:P,anchorPosition:"leftCenter"},n.a.createElement(N.EuiListGroup,{flush:!0},n.a.createElement(N.EuiListGroupItem,{"data-test-subj":"savedViews-manageViews",iconType:"indexSettings",onClick:U,label:R.i18n.translate("xpack.infra.savedView.manageViews",{defaultMessage:"Manage views"})}),n.a.createElement(N.EuiListGroupItem,{"data-test-subj":"savedViews-updateView",iconType:"refresh",onClick:B,disabled:!y||"0"===y.id,label:R.i18n.translate("xpack.infra.savedView.updateView",{defaultMessage:"Update view"})}),n.a.createElement(N.EuiListGroupItem,{"data-test-subj":"savedViews-loadView",iconType:"importAction",onClick:I,label:R.i18n.translate("xpack.infra.savedView.loadView",{defaultMessage:"Load view"})}),n.a.createElement(N.EuiListGroupItem,{"data-test-subj":"savedViews-saveNewView",iconType:"save",onClick:_,label:R.i18n.translate("xpack.infra.savedView.saveNewView",{defaultMessage:"Save new view"})}))),C&&n.a.createElement(wt,{isInvalid:O,close:z,save:q}),F&&n.a.createElement(jt,{currentView:y,isInvalid:O,close:$,save:J}),k&&n.a.createElement(Tt,{currentView:y,views:a,close:D,setView:E}),v&&n.a.createElement(Ct,{sourceIsLoading:m,loading:s,views:a,defaultViewId:u,makeDefault:d,deleteView:c,close:V,setView:E}))}const Lt=(e,t)=>"create"===e?{toastLifeTimeMs:3e3,title:t||R.i18n.translate("xpack.infra.savedView.errorOnCreate.title",{defaultMessage:"An error occured saving view."})}:"find"===e?{toastLifeTimeMs:3e3,title:t||R.i18n.translate("xpack.infra.savedView.findError.title",{defaultMessage:"An error occurred while loading views."})}:void 0,Pt=({source:e,derivedIndexPattern:t})=>{const{loading:a,error:i,data:s,currentTimerange:l,options:o,chartOptions:c,setChartOptions:u,handleAggregationChange:d,handleMetricsChange:m,handleFilterQuerySubmit:p,handleGroupByChange:g,handleTimeChange:f,handleRefresh:b,handleLoadMore:h,onViewStateChange:y,loadData:E}=((e,t,a=!0)=>{const[n,i]=Object(r.useState)(0),[s,l]=Object(r.useState)(null),{defaultViewState:o,options:c,currentTimerange:u,chartOptions:d,setChartOptions:m,setTimeRange:p,setOptions:g}=Object(r.useContext)(ne.c.Context),{loading:f,error:b,data:h,loadData:y}=Object(dt.a)(c,e,t,u,s,n,a),E=Object(r.useCallback)((()=>{l(null),i(n+1)}),[n]),v=Object(r.useCallback)(((e,t)=>{l(null),p({...u,from:e,to:t})}),[u,p]),x=Object(r.useCallback)((e=>{l(null),g({...c,groupBy:e||void 0})}),[c,g]),k=Object(r.useCallback)((e=>{l(null),g({...c,filterQuery:e})}),[c,g]),M=Object(r.useCallback)((e=>{l(null),g({...c,metrics:e})}),[c,g]),O=Object(r.useCallback)((e=>{l(null);const t="count"===e?[{aggregation:e}]:c.metrics.filter((e=>"count"!==e.aggregation)).map((t=>({...t,aggregation:e})));g({...c,aggregation:e,metrics:t})}),[c,g]),w=Object(r.useCallback)((e=>{e.chartOptions&&m(e.chartOptions),e.currentTimerange&&"0"!==e.id&&p(e.currentTimerange),e.options&&g(e.options)}),[m,g,p]);return{loading:f,error:b,data:h,currentTimerange:u,options:c,chartOptions:d,setChartOptions:m,handleAggregationChange:O,handleMetricsChange:M,handleFilterQuerySubmit:k,handleGroupByChange:x,handleTimeChange:v,handleRefresh:E,handleLoadMore:l,defaultViewState:o,onViewStateChange:w,loadData:y,refreshSignal:n,afterKey:s}})(e,t,!1),{currentView:v,shouldLoadDefault:x}=vt();Object(de.useTrackPageview)({app:"infra_metrics",path:"metrics_explorer"}),Object(de.useTrackPageview)({app:"infra_metrics",path:"metrics_explorer",delay:15e3});const{metricIndicesExist:k}=Object(r.useContext)(ce.a.Context);return Object(r.useEffect)((()=>{v&&y(v)}),[v,y]),Object(r.useEffect)((()=>{null==v&&x||E()}),[E,x]),fe([{text:ge.e}]),n.a.createElement(N.EuiErrorBoundary,null,n.a.createElement(te.a,{title:e=>R.i18n.translate("xpack.infra.infrastructureMetricsExplorerPage.documentTitle",{defaultMessage:"{previousTitle} | Metrics Explorer",values:{previousTitle:e}})}),n.a.createElement(Ot,{hasData:k,pageHeader:{pageTitle:ge.e,rightSideItems:[n.a.createElement(Ft,{viewState:{options:o,chartOptions:c,currentTimerange:l}})]}},n.a.createElement(ut,{derivedIndexPattern:t,timeRange:l,options:o,chartOptions:c,onRefresh:b,onTimeChange:f,onGroupByChange:g,onFilterQuerySubmit:p,onMetricsChange:m,onAggregationChange:d,onChartOptionsChange:u}),i?n.a.createElement(be.a,{titleText:"Whoops!",bodyText:R.i18n.translate("xpack.infra.metricsExplorer.errorMessage",{defaultMessage:'It looks like the request failed with "{message}"',values:{message:i.message}}),onRefetch:b,refetchText:"Try Again"}):n.a.createElement(tt,{timeRange:l,loading:a,data:s,source:e,options:o,chartOptions:c,onLoadMore:h,onFilter:p,onRefetch:b,onTimeChange:f})))},It=new RegExp(`^([\\d\\.]+)\\s*(${f.a.units.join("|")})$`),Dt=(b.keyof({seconds:null,minutes:null,hours:null,days:null,weeks:null,months:null,years:null}),["seconds","minutes","hours","days","weeks","months","years"]),_t={seconds:R.i18n.translate("xpack.infra.durationUnits.seconds.plural",{defaultMessage:"seconds"}),minutes:R.i18n.translate("xpack.infra.durationUnits.minutes.plural",{defaultMessage:"minutes"}),hours:R.i18n.translate("xpack.infra.durationUnits.hours.plural",{defaultMessage:"hours"}),days:R.i18n.translate("xpack.infra.durationUnits.days.plural",{defaultMessage:"days"}),weeks:R.i18n.translate("xpack.infra.durationUnits.weeks.plural",{defaultMessage:"weeks"}),months:R.i18n.translate("xpack.infra.durationUnits.months.plural",{defaultMessage:"months"}),years:R.i18n.translate("xpack.infra.durationUnits.years.plural",{defaultMessage:"years"})},Rt={seconds:R.i18n.translate("xpack.infra.durationUnits.seconds.singular",{defaultMessage:"second"}),minutes:R.i18n.translate("xpack.infra.durationUnits.minutes.singular",{defaultMessage:"minute"}),hours:R.i18n.translate("xpack.infra.durationUnits.hours.singular",{defaultMessage:"hour"}),days:R.i18n.translate("xpack.infra.durationUnits.days.singular",{defaultMessage:"day"}),weeks:R.i18n.translate("xpack.infra.durationUnits.weeks.singular",{defaultMessage:"week"}),months:R.i18n.translate("xpack.infra.durationUnits.months.singular",{defaultMessage:"month"}),years:R.i18n.translate("xpack.infra.durationUnits.years.singular",{defaultMessage:"year"})},At=e=>{const t=(e=>{if(e){const t=e.match(It);if(t)return{value:Number(t[1]),unit:t[2]}}throw new Error(R.i18n.translate("xpack.infra.parseInterval.errorMessage",{defaultMessage:"{value} is not an interval string",values:{value:e}}))})(e);if("s"===(null==t?void 0:t.unit)){const e=p.a.duration(t.value,t.unit),n=Dt.reduce(((t,a)=>e.as(a)>=1?a:t),"seconds"),i=e.as(n);return`${Math.floor(i)} ${a=i,r=n,1===Math.floor(a)?Rt[r]:_t[r]}`}var a,r};var Bt=a(121);const Nt={currentTime:Date.now(),isAutoReloading:!1},Vt=b.type({currentTime:b.number,isAutoReloading:b.boolean}),zt=Vt.encode,$t=e=>Object(h.pipe)(Vt.decode(e),Object(y.fold)(Object(E.constant)(void 0),E.identity)),Ut=d()((()=>{const[e]=Object(Bt.a)({from:"now",to:"now"}),t=f.a.parse(e().to),[a,n]=Object(v.b)({defaultState:{...Nt,currentTime:t?t.toDate().getTime():Date.now()},decodeUrlState:$t,encodeUrlState:zt,urlStateKey:"waffleTime"}),[i,s]=Object(r.useState)(a);Object(r.useEffect)((()=>{n(i)}),[n,i]);const{currentTime:l,isAutoReloading:o}=a;return{currentTime:l,currentTimeRange:{from:l-3e5,interval:"1m",to:l},isAutoReloading:o,startAutoReload:Object(r.useCallback)((()=>{s((e=>({...e,isAutoReloading:!0})))}),[s]),stopAutoReload:Object(r.useCallback)((()=>{s((e=>({...e,isAutoReloading:!1})))}),[s]),jumpToTime:Object(r.useCallback)((e=>{s((t=>({...t,currentTime:e})))}),[s]),setWaffleTimeState:s}})),[Ht,qt]=Ut,Jt=Object(z.withTheme)((({interval:e})=>{const{currentTime:t,isAutoReloading:a,startAutoReload:i,stopAutoReload:s,jumpToTime:l}=qt(),o=p()(t),c=At(e),u=a?n.a.createElement(N.EuiButton,{color:"primary",iconSide:"left",iconType:"pause",onClick:s},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.waffleTime.stopRefreshingButtonLabel",defaultMessage:"Stop refreshing"})):n.a.createElement(N.EuiButton,{iconSide:"left",iconType:"play",onClick:i},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.waffleTime.autoRefreshButtonLabel",defaultMessage:"Auto-refresh"})),d=Object(r.useCallback)((e=>{e&&l(e.valueOf())}),[l]);return n.a.createElement(N.EuiFlexGroup,{gutterSize:"m"},n.a.createElement(N.EuiFlexItem,{grow:!1,"data-test-subj":"waffleDatePicker"},n.a.createElement(N.EuiToolTip,{content:`Last ${c} of data for the selected time`,delay:"long",display:"inlineBlock",position:"top"},n.a.createElement(N.EuiDatePicker,{dateFormat:"L LTS",disabled:a,injectTimes:o?[o]:[],isLoading:a,onChange:d,popperPlacement:"top-end",selected:o,shouldCloseOnSelect:!0,showTimeSelect:!0,timeFormat:"LT"}))),n.a.createElement(N.EuiFlexItem,{grow:!1},u))}));var Gt=a(231),Kt=a(186),Wt=a(99);const Qt={kind:"kuery",expression:""},Xt=b.type({kind:b.literal("kuery"),expression:b.string}),Yt=Xt.encode,Zt=e=>Object(h.pipe)(Xt.decode(e),Object(y.fold)(Object(E.constant)(void 0),E.identity)),ea=d()((()=>{const{createDerivedIndexPattern:e}=Object(ce.b)(),t=e("metrics"),[a,n]=Object(v.b)({defaultState:Qt,decodeUrlState:Zt,encodeUrlState:Yt,urlStateKey:"waffleFilter"}),[i,s]=Object(r.useState)(a);Object(r.useEffect)((()=>n(i)),[n,i]);const[l,o]=Object(r.useState)(a.expression),c=Object(r.useMemo)((()=>Object(Wt.a)(a.expression,t)),[t,a.expression]),u=Object(r.useCallback)((e=>{s((t=>({...t,kind:"kuery",expression:e})))}),[s]),d=Object(r.useCallback)((e=>{s(e),o(e.expression)}),[]),m=Object(r.useMemo)((()=>(e=>{try{at.esKuery.fromKueryExpression(e)}catch(e){return!1}return!0})(l)),[l]),{inventoryPrefill:p}=Object(we.b)(),g=Object(r.useMemo)((()=>p),[p]);return Object(r.useEffect)((()=>g.setFilterQuery(i.expression)),[g,i]),{filterQuery:a,filterQueryDraft:l,filterQueryAsJson:c,applyFilterQuery:d,setFilterQueryDraftFromKueryExpression:o,applyFilterQueryFromKueryExpression:u,isFilterQueryDraftValid:m,setWaffleFiltersState:d}})),[ta,aa]=ea,ra=()=>{const{createDerivedIndexPattern:e}=Object(r.useContext)(ce.a.Context),{applyFilterQueryFromKueryExpression:t,filterQueryDraft:a,isFilterQueryDraftValid:i,setFilterQueryDraftFromKueryExpression:s}=aa();return n.a.createElement(Kt.a,{indexPattern:e("metrics")},(({isLoadingSuggestions:e,loadSuggestions:r,suggestions:l})=>n.a.createElement(Gt.a,{isLoadingSuggestions:e,isValid:i,loadSuggestions:r,onChange:s,onSubmit:t,placeholder:R.i18n.translate("xpack.infra.homePage.toolbar.kqlSearchFieldPlaceholder",{defaultMessage:"Search for infrastructure data (e.g. host.name:host-1)"}),suggestions:l,value:a||"",autoFocus:!0})))},na=({interval:e})=>n.a.createElement(N.EuiFlexGroup,{justifyContent:"spaceBetween",gutterSize:"m",style:{flexGrow:0}},n.a.createElement(N.EuiFlexItem,null,n.a.createElement(ra,null)),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(Jt,{interval:e})));var ia=a(143);const sa=({detailedMessage:e,retry:t,shortMessage:a})=>n.a.createElement(ia.a,{isEmptyState:!0},n.a.createElement(N.EuiCallOut,{color:"danger",iconType:"cross",title:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.errorPage.errorOccurredTitle",defaultMessage:"An error occurred"})},n.a.createElement(N.EuiFlexGroup,{alignItems:"center"},n.a.createElement(N.EuiFlexItem,null,a),t?n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButton,{onClick:t,iconType:"refresh"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.errorPage.tryAgainButtonLabel",defaultMessage:"Try again"}))):null),e?n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiSpacer,null),n.a.createElement("div",null,e)):null)),la=({errorMessage:e,retry:t})=>n.a.createElement(sa,{shortMessage:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceErrorPage.failedToLoadDataSourcesMessage",defaultMessage:"Failed to load data sources."}),detailedMessage:n.a.createElement("code",null,e),retry:t});var oa=a(106),ca=a(124),ua=a.n(ca),da=a(114);function ma(e){return e&&null!=e.nodes&&Array.isArray(e.nodes)}function pa(e){return e&&null!=e.groups&&Array.isArray(e.groups)}function ga(e){return e.map((e=>e.value)).join("/")}function fa(e,t){const a=0===t.length?"__all__":ga(t),r=Object(ve.first)(t);if(2===t.length&&r){const t=r.value,n=e.find((e=>e.id===t));if(pa(n)){const e=n.groups.find((e=>e.id===a));if(ma(e))return e}}const n=Object(ve.last)(t),i=e.find((e=>e.id===a));return ma(i)?i:{id:a,name:"__all__"===a?R.i18n.translate("xpack.infra.nodesToWaffleMap.groupsWithNodes.allName",{defaultMessage:"All"}):n&&n.label||"Unknown Group",count:0,width:0,squareSize:0,nodes:[]}}function ba(e){const t=Object(ve.last)(e.path);if(!t)throw new Error("There must be at least one node path item");return{pathId:e.path.map((e=>e.value)).join("/"),path:e.path,id:t.value,ip:t.ip,name:t.label||t.value,metrics:e.metrics}}function ha(e){return t=>t.id!==e.id}function ya(e){return e.reduce(((e,t)=>{const a=ba(t);if(2===t.path.length){const r=fa(e,t.path.slice(0,t.path.length-1));return r.nodes.push(a),e.filter(ha(r)).concat([r])}if(3===t.path.length){const r=fa(e,t.path.slice(0,t.path.length-1));r.nodes.push(a);const n=function(e,t){const a=0===t.length?"__all__":ga(t),r=Object(ve.last)(t),n=e.find((e=>e.id===a));return pa(n)?n:{id:a,name:"__all__"===a?R.i18n.translate("xpack.infra.nodesToWaffleMap.groupsWithGroups.allName",{defaultMessage:"All"}):r&&r.label||"Unknown Group",count:0,width:0,squareSize:0,groups:[]}}(e,t.path.slice(0,t.path.length-2));return n.groups=n.groups.filter(ha(r)).concat([r]),e.filter(ha(n)).concat([n])}const r=fa(e,[]);return r.nodes.push(a),e.filter(ha(r)).concat([r])}),[])}var Ea=a(9),va=a.n(Ea);class group_name_GroupName extends n.a.PureComponent{constructor(...e){super(...e),va()(this,"handleClick",(e=>{e.preventDefault();const{groupBy:t}=this.props.options;if(0===t.length)return;const a=this.props.isChild&&t.length>1?t[1]:t[0];this.props.onDrilldown(`${a.field}: "${this.props.group.name}"`)}))}render(){const{group:e,isChild:t}=this.props,a={fontSize:t?"0.85em":"1em"};return n.a.createElement(xa,null,n.a.createElement(ka,{isChild:t},n.a.createElement(Ma,null,n.a.createElement(N.EuiToolTip,{position:"top",content:e.name},n.a.createElement(N.EuiLink,{style:a,onClickCapture:this.handleClick},e.name))),n.a.createElement(Oa,null,e.count)))}}const xa=z.euiStyled.div`
  position: relative;
  text-align: center;
  font-size: 16px;
  margin-bottom: 5px;
  top: 20px;
  display: flex;
  justify-content: center;
  padding: 0 10px;
`,ka=z.euiStyled.div`
  border: 1px solid ${e=>e.theme.eui.euiBorderColor};
  background-color: ${e=>e.isChild?e.theme.eui.euiColorLightestShade:e.theme.eui.euiColorEmptyShade};
  border-radius: 4px;
  box-shadow: 0px 2px 0px 0px ${e=>e.theme.eui.euiBorderColor};
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
`,Ma=z.euiStyled.div`
  flex: 1 1 auto;
  padding: 6px 10px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,Oa=z.euiStyled.div`
  flex: 0 0 auto;
  border-left: 1px solid ${e=>e.theme.eui.euiBorderColor};
  padding: 6px 10px;
  font-size: 0.85em;
  font-weight: normal;
`;var wa=a(98),ja=a(109),Sa=a(77),Ca=a(135),Ta=a(136),Fa=a(129);const La=Object.keys(Sa.e).reduce(((e,t)=>{var a;const r=null===(a=Object(Fa.a)(t))||void 0===a?void 0:a.text;return r?{...e,[t]:r}:e}),{});var Pa=a(78);const Ia=Object(z.withTheme)((({theme:e,node:t,nodeType:a,currentTime:r})=>{const{sourceId:i}=Object(ce.b)(),s=Object(Q.b)(a),{customMetrics:l}=Object(Pa.d)(),o=s.tooltipMetrics.map((e=>({type:e}))).concat(l),c=JSON.stringify({bool:{filter:{match_phrase:{[s.fields.id]:t.id}}}}),{nodes:u}=Object(Ca.a)(c,o,[],a,i,r,"",""),d=Object(ve.first)(u),m=d&&d.metrics||[];return n.a.createElement("div",{style:{minWidth:200},"data-test-subj":`conditionalTooltipContent-${t.name}`},n.a.createElement("div",{style:{borderBottom:`1px solid ${null==e?void 0:e.eui.euiColorMediumShade}`,paddingBottom:null==e?void 0:e.eui.paddingSizes.xs,marginBottom:null==e?void 0:e.eui.paddingSizes.xs}},t.name),m.map((e=>{const t=Sa.f.is(e.name)?e.name:"custom",a=La[t]||t,r="custom"===a?l.find((t=>t.id===e.name)):null,i=r?Object(xe.a)(r):Object(Ta.a)({type:t});return n.a.createElement(N.EuiFlexGroup,{gutterSize:"s",key:e.name},n.a.createElement(N.EuiFlexItem,{grow:1,className:"eui-textTruncate eui-displayBlock","data-test-subj":"conditionalTooltipContent-metric"},r?Object(ja.a)(r):a),n.a.createElement(N.EuiFlexItem,{grow:!1,"data-test-subj":"conditionalTooltipContent-value"},e.value&&i(e.value)||"-"))})))})),Da={[Ie.c.eq]:ve.isEqual,[Ie.c.lt]:ve.lt,[Ie.c.lte]:ve.lte,[Ie.c.gte]:ve.gte,[Ie.c.gt]:ve.gt},_a=e=>Object(wa.toColorString)(Object(wa.parseToRgb)(e)),Ra=(e,t,a)=>(a-e)/(t-e),Aa=(e,t,a,r="rgba(217, 217, 217, 1)")=>{var n,i;const s=Ra(a.min,a.max,Number(t)),l=e.length,o=Object(ve.last)(e);return o&&Object(ve.gte)(s,o.value)?o.color:e.reduce(((e,t)=>{const a=t.value-1/l,r=t.value;return Object(ve.gte)(s,a)&&Object(ve.lte)(s,r)?t.color:e}),null!==(n=null===(i=Object(ve.first)(e))||void 0===i?void 0:i.color)&&void 0!==n?n:r)},Ba=(e,t,a="rgba(217, 217, 217, 1)")=>e.reduce(((e,a)=>(0,Da[a.operator])(t,a.value)?a.color:e),a),Na=(e,t,a,r="rgba(0, 179, 164, 1)")=>{if(0===e.length)return r;if(1===e.length)return Object(ve.last)(e).color;const{min:n,max:i}=a,s=Object(ve.sortBy)(e,"value"),l=Ra(n,i,Number(t)),o=s.reduce(((e,t)=>t.value<=l?t:e),Object(ve.first)(s)),c=s.filter((e=>e!==o)).find((e=>e.value>=l));if(!c)return o.color;const u=Ra(o.value,c.value,l);return Object(wa.mix)(u,c.color,o.color)},Va=z.euiStyled.div`
  padding: ${e=>e.theme.eui.paddingSizes.m};
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
`,za=({title:e,metrics:t})=>n.a.createElement(N.EuiFlexGroup,{gutterSize:"s",responsive:!1},n.a.createElement($a,{grow:1},n.a.createElement(N.EuiText,{size:"s"},n.a.createElement(Ua,null,e))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},t.map((e=>n.a.createElement(N.EuiFlexItem,{key:e.label},n.a.createElement(N.EuiFlexGroup,{key:e.label,gutterSize:"xs",alignItems:"center",responsive:!1},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiIcon,{color:Object(Le.b)(e.color),type:"dot"})),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiText,{size:"xs"},e.label))))))))),$a=Object(z.euiStyled)(N.EuiFlexItem).attrs({grow:1})`
  overflow: hidden;
`,Ua=Object(z.euiStyled)("h4")`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,Ha=["100%",160],qa=({title:e,style:t,chartRef:a,series:r,tickFormatterForTime:i,tickFormatter:s,onPointerUpdate:l,domain:o,stack:c=!1})=>{const u=Object(A.useUiSetting)("theme:darkMode"),d=r.map((e=>e.metric)),m={headerFormatter:e=>p()(e.value).format("Y-MM-DD HH:mm:ss.SSS")};return n.a.createElement(n.a.Fragment,null,n.a.createElement(za,{title:e,metrics:d}),n.a.createElement(Ee.Chart,{ref:a,size:Ha},r.map(((e,a)=>n.a.createElement(ke.a,{type:t,metric:e.metric,id:"0",key:e.series.id,series:e.series,stack:c}))),n.a.createElement(Ee.Axis,{id:"timestamp",position:Ee.Position.Bottom,showOverlappingTicks:!0,tickFormat:i}),n.a.createElement(Ee.Axis,{id:"values",position:Ee.Position.Left,tickFormat:s,domain:o,ticks:6,showGridLines:!0}),n.a.createElement(Ee.Settings,{onPointerUpdate:l,tooltip:m,theme:Ge(u)})))},Ja=R.i18n.translate("xpack.infra.nodeDetails.metrics.system",{defaultMessage:"System"}),Ga=R.i18n.translate("xpack.infra.nodeDetails.metrics.user",{defaultMessage:"User"}),Ka=R.i18n.translate("xpack.infra.nodeDetails.metrics.inbound",{defaultMessage:"Inbound"}),Wa=R.i18n.translate("xpack.infra.nodeDetails.metrics.outbound",{defaultMessage:"Outbound"}),Qa=R.i18n.translate("xpack.infra.nodeDetails.metrics.used",{defaultMessage:"Used"}),Xa=(R.i18n.translate("xpack.infra.nodeDetails.metrics.cached",{defaultMessage:"Cached"}),R.i18n.translate("xpack.infra.nodeDetails.metrics.free",{defaultMessage:"Free"})),Ya=R.i18n.translate("xpack.infra.nodeDetails.metrics.charts.networkTitle",{defaultMessage:"Network"}),Za=R.i18n.translate("xpack.infra.nodeDetails.metrics.charts.memoryTitle",{defaultMessage:"Memory"}),er=R.i18n.translate("xpack.infra.nodeDetails.metrics.fcharts.cpuTitle",{defaultMessage:"CPU"}),tr=R.i18n.translate("xpack.infra.nodeDetails.metrics.charts.loadTitle",{defaultMessage:"Load"}),ar=R.i18n.translate("xpack.infra.nodeDetails.metrics.logRate",{defaultMessage:"Log Rate"}),rr=R.i18n.translate("xpack.infra.nodeDetails.metrics.charts.logRateTitle",{defaultMessage:"Log Rate"}),nr=e=>n.a.createElement(N.EuiSelect,{fullWidth:!0,options:[{text:R.i18n.translate("xpack.infra.nodeDetails.metrics.last15Minutes",{defaultMessage:"Last 15 minutes"}),value:9e5},{text:R.i18n.translate("xpack.infra.nodeDetails.metrics.lastHour",{defaultMessage:"Last hour"}),value:36e5},{text:R.i18n.translate("xpack.infra.nodeDetails.metrics.last3Hours",{defaultMessage:"Last 3 hours"}),value:108e5},{text:R.i18n.translate("xpack.infra.nodeDetails.metrics.last24Hours",{defaultMessage:"Last 24 hours"}),value:864e5},{text:R.i18n.translate("xpack.infra.nodeDetails.metrics.last7Days",{defaultMessage:"Last 7 days"}),value:6048e5}],value:e.value,onChange:e.onChange}),ir=Object(z.euiStyled)(N.EuiFlexItem)`
  overflow: hidden
`,sr=()=>n.a.createElement("div",{style:{width:"100%",height:"200px",padding:"16px",display:"flex",alignItems:"center",justifyContent:"center"}},n.a.createElement(N.EuiLoadingChart,{size:"xl"})),lr={id:"metrics",name:R.i18n.translate("xpack.infra.nodeDetails.tabs.metrics",{defaultMessage:"Metrics"}),content:e=>{const t=Object(r.useRef)(null),a=Object(r.useRef)(null),i=Object(r.useRef)(null),s=Object(r.useRef)(null),l=Object(r.useRef)(null),o=Object(r.useRef)({}),[c,u]=Object(r.useState)(36e5),d=Object(r.useMemo)((()=>[...[t,a,i,s,l],o]),[t,a,i,s,l,o]),{sourceId:m,createDerivedIndexPattern:p}=Object(ce.b)(),{nodeType:g,accountId:f,region:b,customMetrics:h}=Object(Pa.d)(),{currentTime:y,options:E,node:v}=e,x=Object(r.useMemo)((()=>p("metrics")),[p]);let k=E.fields?`${Object(Q.a)(g,E.fields).id}: "${v.id}"`:"";k&&(k=Object(Wt.a)(k,x));const M=Object(r.useCallback)(((e,t,a="avg")=>({type:"custom",aggregation:a,field:e,id:t})),[]),O=Object(r.useCallback)((e=>{u(Number(e.currentTarget.value))}),[u]),w={interval:"1m",to:y,from:y-c,ignoreLookback:!0},j=[{type:"rx"},{type:"tx"},M("system.cpu.user.pct","user"),M("system.cpu.system.pct","system"),M("system.load.1","load1m"),M("system.load.5","load5m"),M("system.load.15","load15m"),M("system.memory.actual.used.bytes","usedMemory"),M("system.memory.actual.free","freeMemory"),M("system.cpu.cores","cores","max")],{nodes:S,reload:C}=Object(Ca.a)(k,[...j,...h],[],g,m,y,f,b,!1,w),{nodes:T,reload:F}=Object(Ca.a)(k,[{type:"logRate"}],[],g,m,y,f,b,!1,w),L=Object(r.useCallback)(((e,t)=>{const a=e?Object(Qe.a)(e,t,!1):null;return a?{max:1.1*a.max,min:a.min}:{max:0,min:0}}),[]),P=Object(r.useCallback)((e=>{var t,a;if(!e)return()=>"";const r=null===(t=Object(ve.first)(e.rows))||void 0===t?void 0:t.timestamp,n=null===(a=Object(ve.last)(e.rows))||void 0===a?void 0:a.timestamp;return null==r||null==n?e=>`${e}`:Object(Ee.niceTimeFormatter)([r,n])}),[]),I=Object(r.useMemo)((()=>Object(Ta.a)({type:"rx"})),[]),D=Object(r.useMemo)((()=>Object(Ta.a)({type:"cpu"})),[]),_=Object(r.useMemo)((()=>Object(Ta.a)({type:"s3BucketSize"})),[]),R=Object(r.useMemo)((()=>Object(Ta.a)({type:"load"})),[]),A=Object(r.useMemo)((()=>Object(Ta.a)({type:"logRate"})),[]),B=Object(r.useCallback)(((...e)=>{const t=e[0],a=e.slice(1);return t.rows=t.rows.map(((e,t)=>{const r={...e};return a.forEach(((e,a)=>{r[`metric_${a+1}`]=e.rows[t].metric_0})),r})),t}),[]),V=Object(r.useCallback)(((e,t)=>{const a={color:Le.a.color0,aggregation:t,label:"System"};return e.map(((e,t)=>({...a,color:Le.a[`color${t}`],label:e})))}),[]),z=Object(r.useCallback)((e=>{d.forEach((t=>{if(t.current)if(t.current instanceof Ee.Chart)t.current.dispatchExternalPointerEvent(e);else{Object.values(t.current).forEach((t=>{t&&t.dispatchExternalPointerEvent(e)}))}}))}),[d]),$=Object(r.useCallback)((e=>S&&S.length?S[0].metrics.find((t=>t.name===e)).timeseries:null),[S]),U=Object(r.useCallback)((()=>T?0===T.length?{rows:[],columns:[],id:"0"}:T[0].metrics.find((e=>"logRate"===e.name)).timeseries:null),[T]),H=Object(r.useMemo)((()=>$("system")),[$]),q=Object(r.useMemo)((()=>$("user")),[$]),J=Object(r.useMemo)((()=>$("rx")),[$]),G=Object(r.useMemo)((()=>$("tx")),[$]),K=Object(r.useMemo)((()=>$("load1m")),[$]),W=Object(r.useMemo)((()=>$("load5m")),[$]),X=Object(r.useMemo)((()=>$("load15m")),[$]),Y=Object(r.useMemo)((()=>$("usedMemory")),[$]),Z=Object(r.useMemo)((()=>$("freeMemory")),[$]),ee=Object(r.useMemo)((()=>$("cores")),[$]),te=Object(r.useMemo)((()=>U()),[U]);if(Object(r.useEffect)((()=>{C(),F()}),[c,C,F]),!(H&&q&&J&&G&&K&&W&&X&&Y&&Z&&te))return n.a.createElement(sr,null);const ae=V([Ja,Ga],"avg"),re=V([ar],"rate"),ie=V([Ka,Wa],"rate"),se=V(["1m","5m","15m"],"avg"),le=V([Qa,Xa],"rate");H.rows=H.rows.slice().map(((e,t)=>{const a=e.metric_0,r=ee.rows[t].metric_0;return a&&r&&(e.metric_0=a/r),e})),q.rows=q.rows.slice().map(((e,t)=>{const a=e.metric_0,r=ee.rows[t].metric_0;return a&&r&&(e.metric_0=a/r),e}));const oe=B(H,q),ue=B(te),de=B(J,G),me=B(K,W,X),pe=B(Y,Z),ge=P(J);return n.a.createElement(Va,null,n.a.createElement(nr,{value:c,onChange:O}),n.a.createElement(N.EuiSpacer,{size:"l"}),n.a.createElement(N.EuiFlexGrid,{columns:2,gutterSize:"l",responsive:!1},n.a.createElement(ir,null,n.a.createElement(qa,{title:er,style:ne.b.line,chartRef:t,series:[{metric:ae[0],series:H},{metric:ae[1],series:q}],tickFormatterForTime:ge,tickFormatter:D,onPointerUpdate:z,domain:L(oe,ae)})),n.a.createElement(ir,null,n.a.createElement(qa,{title:tr,style:ne.b.line,chartRef:s,series:[{metric:se[0],series:K},{metric:se[1],series:W},{metric:se[2],series:X}],tickFormatterForTime:ge,tickFormatter:R,onPointerUpdate:z,domain:L(me,se)})),n.a.createElement(ir,null,n.a.createElement(qa,{title:Za,style:ne.b.line,chartRef:i,series:[{metric:le[0],series:Y},{metric:le[1],series:Z}],tickFormatterForTime:ge,tickFormatter:_,onPointerUpdate:z,domain:L(pe,le)})),n.a.createElement(ir,null,n.a.createElement(qa,{title:Ya,style:ne.b.line,chartRef:a,series:[{metric:ie[0],series:J},{metric:ie[1],series:G}],tickFormatterForTime:ge,tickFormatter:I,onPointerUpdate:z,domain:L(de,ie),stack:!0})),n.a.createElement(ir,null,n.a.createElement(qa,{title:rr,style:ne.b.line,chartRef:l,series:[{metric:re[0],series:te}],tickFormatterForTime:ge,tickFormatter:A,onPointerUpdate:z,domain:L(ue,re),stack:!0})),h.map((e=>{const t=$(e.id),a=V([e.field],e.aggregation);return t?n.a.createElement(ir,null,n.a.createElement(qa,{title:Object(ja.a)(e),style:ne.b.line,chartRef:t=>{o.current[e.id]=t},series:[{metric:a[0],series:t}],tickFormatterForTime:ge,tickFormatter:Object(xe.a)(e),onPointerUpdate:z,domain:L(B(t),a),stack:!0})):null}))))}};var or=a(174),cr=a.n(or),ur=a(212),dr=(a(182),a(142));const mr={id:"logs",name:R.i18n.translate("xpack.infra.nodeDetails.tabs.logs",{defaultMessage:"Logs"}),content:e=>{const[t,a]=Object(r.useState)(""),i=e.currentTime,s=i-36e5,{nodeType:l}=Object(Pa.d)(),{options:o,node:c}=e,u=cr()(t,pr),d=Object(r.useMemo)((()=>({language:"kuery",query:[...null!=o.fields?[`${Object(Q.a)(l,o.fields).id}: "${c.id}"`]:[],...""!==u?[u]:[]].join(" and ")})),[o.fields,l,c.id,u]),m=Object(r.useCallback)((e=>{a(e.target.value)}),[]),p=Object(Ve.b)(Object(dr.b)({nodeType:l,nodeId:c.id,time:s}));return n.a.createElement(Va,null,n.a.createElement(N.EuiFlexGroup,{gutterSize:"m",alignItems:"center",responsive:!1},n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiFieldSearch,{fullWidth:!0,placeholder:R.i18n.translate("xpack.infra.nodeDetails.logs.textFieldPlaceholder",{defaultMessage:"Search for log entries..."}),value:t,isClearable:!0,onChange:m})),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButtonEmpty,ee()({size:"xs",flush:"both",iconType:"popout"},p),n.a.createElement(V.FormattedMessage,{id:"xpack.infra.nodeDetails.logs.openLogsLink",defaultMessage:"Open in Logs"})))),n.a.createElement(ur.a,{startTimestamp:s,endTimestamp:i,query:d}))}},pr=1e3;var gr=a(88),fr=a(12),br=a(92);const hr=d()((function(e){const{hostTerm:t,timefield:a,to:r}=e,{createDerivedIndexPattern:n}=Object(ce.b)();return{hostTerm:t,indexPattern:n("metrics").title,timefield:a,to:r}})),[yr,Er]=hr,vr={running:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateRunning",{defaultMessage:"Running"}),sleeping:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateSleeping",{defaultMessage:"Sleeping"}),dead:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateDead",{defaultMessage:"Dead"}),stopped:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateStopped",{defaultMessage:"Stopped"}),idle:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateIdle",{defaultMessage:"Idle"}),zombie:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateZombie",{defaultMessage:"Zombie"}),unknown:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateUnknown",{defaultMessage:"Unknown"})},xr=["running","sleeping","stopped","idle","dead","zombie","unknown"],kr=({processSummary:e,isLoading:t})=>{const a=Object(r.useMemo)((()=>({total:t?-1:e.total,...Object(ve.mapValues)(vr,(()=>t?-1:0)),...t?{}:e})),[e,t]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiFlexGroup,{gutterSize:"m",responsive:!1,wrap:!0},Object.entries(a).map((([e,t])=>n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiDescriptionList,{compressed:!0},n.a.createElement(wr,null,Mr[e]),n.a.createElement(N.EuiDescriptionListDescription,null,-1===t?n.a.createElement(Or,null):t)))))),n.a.createElement(N.EuiHorizontalRule,{margin:"m"}))},Mr={total:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.headingTotalProcesses",{defaultMessage:"Total processes"}),...vr},Or=Object(z.euiStyled)(N.EuiLoadingSpinner).attrs({size:"m"})`
  margin-top: 2px;
  margin-bottom: 3px;
`,wr=Object(z.euiStyled)(N.EuiDescriptionListTitle)`
  white-space: nowrap;
`;var jr=a(26);const Sr=({command:e})=>{const{loading:t,error:a,response:i}=function(e){const[t,a]=Object(r.useState)(!1),{hostTerm:n,timefield:i,indexPattern:s,to:l}=Er(),{error:o,loading:c,response:u,makeRequest:d}=Object(br.a)("/api/metrics/process_list/chart","POST",JSON.stringify({hostTerm:n,timefield:i,indexPattern:s,to:l,command:e}),(e=>Object(h.pipe)(gr.h.decode(e),Object(y.fold)(Object(fr.c)(fr.a),E.identity))));return Object(r.useEffect)((()=>a(!0)),[o]),Object(r.useEffect)((()=>a(!1)),[c]),Object(r.useEffect)((()=>{d()}),[d]),{error:t,loading:c,response:u,makeRequest:d}}(e),s=t||!i,l=a?n.a.createElement(N.EuiEmptyPrompt,{iconType:"alert",title:n.a.createElement(N.EuiText,null,Pr)}):s?n.a.createElement(N.EuiLoadingChart,null):n.a.createElement(Cr,{timeseries:i.cpu,color:Le.a.color2,label:Fr}),o=a?n.a.createElement(N.EuiEmptyPrompt,{iconType:"alert",title:n.a.createElement(N.EuiText,null,Pr)}):s?n.a.createElement(N.EuiLoadingChart,null):n.a.createElement(Cr,{timeseries:i.memory,color:Le.a.color0,label:Lr});return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiDescriptionListTitle,null,Fr),n.a.createElement(N.EuiDescriptionListDescription,null,l)),n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiDescriptionListTitle,null,Lr),n.a.createElement(N.EuiDescriptionListDescription,null,o)))},Cr=({timeseries:e,color:t,label:a})=>{const i={color:t,aggregation:"avg",label:a},s=Object(A.useUiSetting)("theme:darkMode"),l=Object(r.useMemo)((()=>{var t,a;if(!e)return()=>"";const r=null===(t=Object(ve.first)(e.rows))||void 0===t?void 0:t.timestamp,n=null===(a=Object(ve.last)(e.rows))||void 0===a?void 0:a.timestamp;return null==r||null==n?e=>`${e}`:Object(Ee.niceTimeFormatter)([r,n])}),[e]),o=Object(jr.b)("percent"),c={headerFormatter:e=>p()(e.value).format("Y-MM-DD HH:mm:ss.SSS")},u=Object(Qe.a)(e,[i],!1),d=u?{max:1.1*u.max,min:u.min}:{max:0,min:0};return n.a.createElement(Tr,null,n.a.createElement(Ee.Chart,null,n.a.createElement(ke.a,{type:ne.b.area,metric:i,id:"0",series:e,stack:!1}),n.a.createElement(Ee.Axis,{id:"timestamp",position:Ee.Position.Bottom,showOverlappingTicks:!0,tickFormat:l}),n.a.createElement(Ee.Axis,{id:"values",position:Ee.Position.Left,tickFormat:o,domain:d,ticks:6,showGridLines:!0}),n.a.createElement(Ee.Settings,{tooltip:c,theme:Je(s)})))},Tr=z.euiStyled.div`
  width: 100%;
  height: 140px;
`,Fr=R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelCPU",{defaultMessage:"CPU"}),Lr=R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelMemory",{defaultMessage:"Memory"}),Pr=R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.failedToLoadChart",{defaultMessage:"Unable to load chart"}),Ir=({cells:e,item:t})=>{const[a,i]=Object(r.useState)(!1);return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiTableRow,null,n.a.createElement(N.EuiTableRowCell,{isExpander:!0,textOnly:!1},n.a.createElement(N.EuiButtonEmpty,{iconType:a?"arrowDown":"arrowRight","aria-expanded":a,onClick:()=>i(!a)})),e),n.a.createElement(N.EuiTableRow,{isExpandable:!0,isExpandedRow:a},a&&n.a.createElement(da.a,{bounds:!0},(({measureRef:e,bounds:{height:a=0}})=>n.a.createElement(Ar,{commandHeight:a},n.a.createElement(N.EuiSpacer,{size:"s"}),n.a.createElement(Dr,null,n.a.createElement(N.EuiFlexGroup,{gutterSize:"s"},n.a.createElement(N.EuiFlexItem,null,n.a.createElement("div",{ref:e},n.a.createElement(N.EuiDescriptionListTitle,null,R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelCommand",{defaultMessage:"Command"})),n.a.createElement(N.EuiDescriptionListDescription,null,n.a.createElement(Rr,null,t.command)))),t.apmTrace&&n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButton,null,R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.viewTraceInAPM",{defaultMessage:"View trace in APM"})))),n.a.createElement(N.EuiFlexGrid,{columns:2,gutterSize:"s",responsive:!1},n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiDescriptionListTitle,null,R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelPID",{defaultMessage:"PID"})),n.a.createElement(N.EuiDescriptionListDescription,null,n.a.createElement(_r,null,t.pid))),n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiDescriptionListTitle,null,R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelUser",{defaultMessage:"User"})),n.a.createElement(N.EuiDescriptionListDescription,null,n.a.createElement(_r,null,t.user))),n.a.createElement(Sr,{command:t.command}))))))))},Dr=Object(z.euiStyled)(N.EuiDescriptionList).attrs({compressed:!0})`
  width: 100%;
`,_r=Object(z.euiStyled)(N.EuiCode).attrs({transparentBackground:!0})`
  padding: 0 !important;
  & code.euiCodeBlock__code {
    white-space: nowrap !important;
    vertical-align: middle;
  }
`,Rr=Object(z.euiStyled)(N.EuiCode).attrs({transparentBackground:!0})`
  padding: 0 !important;
  margin-bottom: ${e=>e.theme.eui.euiSizeS};
`,Ar=Object(z.euiStyled)(N.EuiTableRowCell).attrs({textOnly:!1,colSpan:6})`
  height: ${e=>e.commandHeight+240}px;
  padding: 0 ${e=>e.theme.eui.paddingSizes.m};
  background-color: ${e=>e.theme.eui.euiColorLightestShade};
`,Br=({state:e})=>{switch(e){case"running":return n.a.createElement(N.EuiBadge,{color:"secondary"},vr.running);case"sleeping":return n.a.createElement(N.EuiBadge,{color:"default"},vr.sleeping);case"dead":return n.a.createElement(N.EuiBadge,{color:"danger"},vr.dead);case"stopped":return n.a.createElement(N.EuiBadge,{color:"warning"},vr.stopped);case"idle":return n.a.createElement(N.EuiBadge,{color:"primary"},vr.idle);case"zombie":return n.a.createElement(N.EuiBadge,{color:"danger"},vr.zombie);default:return n.a.createElement(N.EuiBadge,{color:"hollow"},vr.unknown)}};const Nr=({processList:e,currentTime:t,isLoading:a,sortBy:i,setSortBy:s,clearSearchBar:l})=>{const{updateSortableProperties:o}=function(e,t,a){const[n]=Object(r.useState)(new N.SortableProperties(e,t));return{updateSortableProperties:Object(r.useCallback)((e=>{n.sortOn(e),a(Object(ve.omit)(n.getSortedProperty(),"getValue"))}),[n,a])}}([{name:"startTime",getValue:e=>Date.parse(e.startTime),isAscending:!0},{name:"cpu",getValue:e=>e.cpu,isAscending:!1},{name:"memory",getValue:e=>e.memory,isAscending:!1}],"cpu",s),c=Object(r.useMemo)((()=>e.sort(((e,t)=>xr.indexOf(e.state)-xr.indexOf(t.state)))),[e]);return a?n.a.createElement(Vr,null):0===c.length?n.a.createElement(N.EuiEmptyPrompt,{iconType:"search",titleSize:"s",title:n.a.createElement("strong",null,R.i18n.translate("xpack.infra.metrics.nodeDetails.noProcesses",{defaultMessage:"No processes found"})),body:n.a.createElement(N.EuiText,{size:"s"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metrics.nodeDetails.noProcessesBody",defaultMessage:"Try modifying your filter. Only processes that are within the configured {metricbeatDocsLink} will display here.",values:{metricbeatDocsLink:n.a.createElement(N.EuiLink,{href:"https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-module-system.html",target:"_blank"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metrics.nodeDetails.noProcessesBody.metricbeatDocsLinkText",defaultMessage:"top N by CPU or Memory"}))}})),actions:n.a.createElement(N.EuiButton,{onClick:l},R.i18n.translate("xpack.infra.metrics.nodeDetails.noProcessesClearFilters",{defaultMessage:"Clear filters"}))}):n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiTable,{responsive:!1},n.a.createElement(N.EuiTableHeader,null,n.a.createElement(N.EuiTableHeaderCell,{width:24}),Jr.map((e=>{var t;return n.a.createElement(N.EuiTableHeaderCell,{key:`${String(e.field)}-header`,align:null!==(t=e.align)&&void 0!==t?t:N.LEFT_ALIGNMENT,width:e.width,onSort:e.sortable?()=>o(e.field):void 0,isSorted:i.name===e.field,isSortAscending:i.name===e.field&&i.isAscending},e.name)}))),n.a.createElement($r,null,n.a.createElement(zr,{items:c,currentTime:t}))))},Vr=()=>n.a.createElement("div",{style:{width:"100%",height:"200px",padding:"16px",display:"flex",alignItems:"center",justifyContent:"center"}},n.a.createElement(N.EuiLoadingChart,{size:"xl"})),zr=({items:e,currentTime:t})=>n.a.createElement(n.a.Fragment,null,e.map(((e,a)=>{const r=Jr.map((r=>{var i,s;return n.a.createElement(N.EuiTableRowCell,{key:`${String(r.field)}-${a}`,header:r.name,align:null!==(i=r.align)&&void 0!==i?i:N.LEFT_ALIGNMENT,textOnly:null===(s=r.textOnly)||void 0===s||s},r.render?r.render(e[r.field],t):e[r.field])}));return n.a.createElement(Ir,{cells:r,item:e,key:`row-${a}`})}))),$r=Object(z.euiStyled)(N.EuiTableBody)`
  & .euiTableCellContent {
    padding-top: 0;
    padding-bottom: 0;
    
  }
`,Ur=6e4,Hr=36e5,qr=({startTime:e,currentTime:t})=>{let a=t-e;const r=Math.floor(a/Hr);a-=r*Hr;const i=Math.floor(a/Ur);a-=i*Ur;const s=Math.floor(a/1e3);a-=1e3*s;const l=r?`${r}:`:"",o=i<10?`0${i}:`:`${i}:`,c=s<10?`0${s}`:s;return n.a.createElement(n.a.Fragment,null,`${l}${o}${c}`)},Jr=[{field:"state",name:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelState",{defaultMessage:"State"}),sortable:!1,render:e=>n.a.createElement(Br,{state:e}),width:84,textOnly:!1},{field:"command",name:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelCommand",{defaultMessage:"Command"}),sortable:!1,width:"40%",render:e=>n.a.createElement(Gr,null,e)},{field:"startTime",name:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelTime",{defaultMessage:"Time"}),align:N.RIGHT_ALIGNMENT,sortable:!0,render:(e,t)=>n.a.createElement(qr,{startTime:e,currentTime:t})},{field:"cpu",name:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelCPU",{defaultMessage:"CPU"}),sortable:!0,render:e=>jr.a.percent(e)},{field:"memory",name:R.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelMemory",{defaultMessage:"Mem."}),sortable:!0,render:e=>jr.a.percent(e)}],Gr=z.euiStyled.div`
  font-family: ${e=>e.theme.eui.euiCodeFontFamily};
  font-size: ${e=>e.theme.eui.euiFontSizeS};
  white-space: pre;
  overflow: hidden;
  text-overflow: ellipsis;
`,Kr=e=>e.replace(/([+-=!\(\)\{\}\[\]^"~*?:\\/!]|&&|\|\|)/g,"\\$1"),Wr={id:"processes",name:R.i18n.translate("xpack.infra.metrics.nodeDetails.tabs.processes",{defaultMessage:"Processes"}),content:({currentTime:e,node:t,nodeType:a,options:i})=>{var s,l;const[o,c]=Object(r.useState)(N.Query.MATCH_ALL),[u,d]=Object(r.useState)(""),[m,p]=Object(r.useState)({name:"cpu",isAscending:!1}),g=i.fields.timestamp,f=Object(r.useMemo)((()=>({[i.fields&&Reflect.has(i.fields,a)?Reflect.get(i.fields,a):a]:t.name})),[i,t,a]),{loading:b,error:v,response:x,makeRequest:k}=function(e,t,a,n,i){const{createDerivedIndexPattern:s}=Object(ce.b)(),l=s("metrics").title,[o,c]=Object(r.useState)(!1),u="runtimeLength"===n.name?{...n,name:"startTime"}:n,{error:d,loading:m,response:p,makeRequest:g}=Object(br.a)("/api/metrics/process_list","POST",JSON.stringify({hostTerm:e,timefield:t,indexPattern:l,to:a,sortBy:u,searchFilter:i}),(e=>Object(h.pipe)(gr.i.decode(e),Object(y.fold)(Object(fr.c)(fr.a),E.identity))));return Object(r.useEffect)((()=>c(!0)),[d]),Object(r.useEffect)((()=>c(!1)),[m]),Object(r.useEffect)((()=>{g()}),[g]),{error:o,loading:m,response:p,makeRequest:g}}(f,g,e,m,(e=>{if(""===e.trim())return[{match_all:{}}];const t=e.split(" ").map((e=>e.trim())).filter(Boolean),a=t.filter((e=>e.startsWith("state=")));return[...t.filter((e=>!e.startsWith("state="))).map((e=>({query_string:{fields:["system.process.cmdline"],query:`*${Kr(e)}*`,minimum_should_match:1}}))),...a.map((e=>({match:{"system.process.state":e.replace("state=","")}})))]})(u)),M=Object(r.useMemo)((()=>Object(ve.debounce)((e=>d(e)),500)),[d]),O=Object(r.useCallback)((({query:e,queryText:t})=>{c(e),M(t)}),[c,M]),w=Object(r.useCallback)((()=>{c(N.Query.MATCH_ALL),d("")}),[c,d]);return n.a.createElement(Va,null,n.a.createElement(yr,{hostTerm:f,to:e,timefield:g},n.a.createElement(kr,{isLoading:b,processSummary:null!==(s=v?null:null==x?void 0:x.summary)&&void 0!==s?s:{total:0}}),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiText,null,n.a.createElement("h4",null,R.i18n.translate("xpack.infra.metrics.nodeDetails.processesHeader",{defaultMessage:"Top processes"})," ",n.a.createElement(N.EuiIconTip,{"aria-label":R.i18n.translate("xpack.infra.metrics.nodeDetails.processesHeader.tooltipLabel",{defaultMessage:"More info"}),size:"m",type:"iInCircle",content:R.i18n.translate("xpack.infra.metrics.nodeDetails.processesHeader.tooltipBody",{defaultMessage:"The table below aggregates the top CPU and top memory consuming processes. It does not display all processes."})}))),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiSearchBar,{query:o,onChange:O,box:{incremental:!0,placeholder:R.i18n.translate("xpack.infra.metrics.nodeDetails.searchForProcesses",{defaultMessage:"Search for processes"})},filters:[{type:"field_value_selection",field:"state",name:"State",operator:"exact",multiSelect:!1,options:Object.entries(vr).map((([e,t])=>({value:e,view:t})))}]}),n.a.createElement(N.EuiSpacer,{size:"m"}),v?n.a.createElement(N.EuiEmptyPrompt,{iconType:"alert",title:n.a.createElement("h4",null,R.i18n.translate("xpack.infra.metrics.nodeDetails.processListError",{defaultMessage:"Unable to load process data"})),actions:n.a.createElement(N.EuiButton,{color:"primary",fill:!0,onClick:k},R.i18n.translate("xpack.infra.metrics.nodeDetails.processListRetry",{defaultMessage:"Try again"}))}):n.a.createElement(Nr,{currentTime:e,isLoading:b||!x,processList:null!==(l=null==x?void 0:x.processList)&&void 0!==l?l:[],sortBy:m,setSortBy:p,clearSearchBar:w})))}};var Qr=a(165),Xr=a(177);const Yr=(e,t)=>{const a=t.filter((e=>e&&"metrics"===e.source)).map((e=>e&&e.name));return e.filter((e=>{const t=(0,Xr.a.tsvb[e])("@timestamp","test",">=1m");return a.some((e=>e&&t.requires.includes(e)))}))};function Zr(e,t,a,n,i){const{error:s,loading:l,response:o,makeRequest:c}=Object(br.a)("/api/infra/metadata","POST",JSON.stringify({nodeId:e,nodeType:t,sourceId:n,timeRange:{from:i.from,to:i.to}}),(e=>Object(h.pipe)(Qr.a.decode(e),Object(y.fold)(Object(fr.c)(fr.a),E.identity))));return Object(r.useEffect)((()=>{(async()=>{await c()})()}),[c]),{name:o&&o.name||"",filteredRequiredMetrics:o&&Yr(a,o.features)||[],error:s&&s.message||null,loading:l,metadata:o,cloudId:o&&o.info&&o.info.cloud&&o.info.cloud.instance&&o.info.cloud.instance.id||""}}const en=(e,t)=>{var a,r,n,i,s,l,o,c,u,d,m,p,g,f,b,h,y,E,v,x,k,M,O,w,j,S,C,T,F,L,P,I,D,_,R,A,B,N,V,z,$,U,H,q,J,G,K,W,Q,X,Y,Z,ee,te,ae,re,ne;switch(t){case"host":return tn([{name:"host.architecture",value:null===(a=e.info)||void 0===a||null===(r=a.host)||void 0===r?void 0:r.architecture},{name:"host.hostname",value:null===(n=e.info)||void 0===n||null===(i=n.host)||void 0===i?void 0:i.name},{name:"host.id",value:null===(s=e.info)||void 0===s||null===(l=s.host)||void 0===l?void 0:l.id},{name:"host.ip",value:null===(o=e.info)||void 0===o||null===(c=o.host)||void 0===c?void 0:c.ip},{name:"host.mac",value:null===(u=e.info)||void 0===u||null===(d=u.host)||void 0===d?void 0:d.mac},{name:"host.name",value:null===(m=e.info)||void 0===m||null===(p=m.host)||void 0===p?void 0:p.name},{name:"host.os.build",value:null===(g=e.info)||void 0===g||null===(f=g.host)||void 0===f||null===(b=f.os)||void 0===b?void 0:b.build},{name:"host.os.family",value:null===(h=e.info)||void 0===h||null===(y=h.host)||void 0===y||null===(E=y.os)||void 0===E?void 0:E.family},{name:"host.os.name",value:null===(v=e.info)||void 0===v||null===(x=v.host)||void 0===x||null===(k=x.os)||void 0===k?void 0:k.name},{name:"host.os.kernel",value:null===(M=e.info)||void 0===M||null===(O=M.host)||void 0===O||null===(w=O.os)||void 0===w?void 0:w.kernel},{name:"host.os.platform",value:null===(j=e.info)||void 0===j||null===(S=j.host)||void 0===S||null===(C=S.os)||void 0===C?void 0:C.platform},{name:"host.os.version",value:null===(T=e.info)||void 0===T||null===(F=T.host)||void 0===F||null===(L=F.os)||void 0===L?void 0:L.version}]);case"cloud":return tn([{name:"cloud.account.id",value:null===(P=e.info)||void 0===P||null===(I=P.cloud)||void 0===I||null===(D=I.account)||void 0===D?void 0:D.id},{name:"cloud.account.name",value:null===(_=e.info)||void 0===_||null===(R=_.cloud)||void 0===R||null===(A=R.account)||void 0===A?void 0:A.name},{name:"cloud.availability_zone",value:null===(B=e.info)||void 0===B||null===(N=B.cloud)||void 0===N?void 0:N.availability_zone},{name:"cloud.instance.id",value:null===(V=e.info)||void 0===V||null===(z=V.cloud)||void 0===z||null===($=z.instance)||void 0===$?void 0:$.id},{name:"cloud.instance.name",value:null===(U=e.info)||void 0===U||null===(H=U.cloud)||void 0===H||null===(q=H.instance)||void 0===q?void 0:q.name},{name:"cloud.machine.type",value:null===(J=e.info)||void 0===J||null===(G=J.cloud)||void 0===G||null===(K=G.machine)||void 0===K?void 0:K.type},{name:"cloud.provider",value:null===(W=e.info)||void 0===W||null===(Q=W.cloud)||void 0===Q?void 0:Q.provider},{name:"cloud.region",value:null===(X=e.info)||void 0===X||null===(Y=X.cloud)||void 0===Y?void 0:Y.region}]);case"agent":return tn([{name:"agent.id",value:null===(Z=e.info)||void 0===Z||null===(ee=Z.agent)||void 0===ee?void 0:ee.id},{name:"agent.version",value:null===(te=e.info)||void 0===te||null===(ae=te.agent)||void 0===ae?void 0:ae.version},{name:"agent.policy",value:null===(re=e.info)||void 0===re||null===(ne=re.agent)||void 0===ne?void 0:ne.policy}])}},tn=e=>e.filter((e=>!!e.value)),an=e=>{const{rows:t,title:a,onClick:i}=e,s=Object(r.useMemo)((()=>[{field:"name",name:"",width:"35%",sortable:!1,render:(e,t)=>n.a.createElement(N.EuiText,{size:"xs"},n.a.createElement("strong",null,t.name))},{field:"value",name:"",width:"65%",sortable:!1,render:(e,t)=>n.a.createElement("span",null,n.a.createElement(N.EuiFlexGroup,{gutterSize:"xs",alignItems:"center",responsive:!1},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiToolTip,{content:R.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.setFilterTooltip",{defaultMessage:"View event with filter"})},n.a.createElement(N.EuiButtonIcon,{color:"subdued",size:"s",iconType:"filter","aria-label":R.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.filterAriaLabel",{defaultMessage:"Filter"}),onClick:()=>i(t)}))),n.a.createElement(N.EuiFlexItem,null,!Array.isArray(t.value)&&t.value,Array.isArray(t.value)&&n.a.createElement(rn,{values:t.value}))))}]),[i]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiText,null,n.a.createElement("h4",null,a)),n.a.createElement(N.EuiSpacer,{size:"s"}),n.a.createElement(table_TableWithoutHeader,{tableLayout:"fixed",compressed:!0,responsive:!1,columns:s,items:t}))};class table_TableWithoutHeader extends N.EuiBasicTable{renderTableHead(){return n.a.createElement(n.a.Fragment,null)}}const rn=e=>{const{values:t}=e,[a,i]=Object(r.useState)(!1),s=Object(r.useCallback)((()=>{i(!0)}),[]),l=Object(r.useCallback)((()=>{i(!1)}),[]);return n.a.createElement(n.a.Fragment,null,!a&&n.a.createElement(N.EuiFlexGroup,{gutterSize:"xs",responsive:!1,alignItems:"baseline",wrap:!0},n.a.createElement(N.EuiFlexItem,{grow:!1},Object(ve.first)(t)," ... "),n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiLink,{onClick:s},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.nodeDetails.tabs.metadata.seeMore",defaultMessage:"+{count} more",values:{count:t.length}})))),a&&n.a.createElement("div",null,t.map((e=>n.a.createElement("div",{key:e},e))),n.a.createElement(N.EuiLink,{onClick:l},R.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.seeLess",{defaultMessage:"Show less"}))))},nn=z.euiStyled.div`
  &:not(:last-child) {
    margin-bottom: 16px
  }
`,sn=()=>n.a.createElement("div",{style:{width:"100%",height:"200px",padding:"16px",display:"flex",alignItems:"center",justifyContent:"center"}},n.a.createElement(N.EuiLoadingChart,{size:"xl"})),ln={id:"properties",name:R.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.title",{defaultMessage:"Metadata"}),content:e=>{const t=e.node.id,a=e.nodeType,i=Object(Q.b)(a),{sourceId:s}=Object(r.useContext)(ce.a.Context),{currentTimeRange:l}=qt(),{applyFilterQuery:o}=aa(),{loading:c,metadata:u}=Zr(t,a,i.requiredMetrics,s,l),d=Object(r.useMemo)((()=>u?en(u,"host"):null),[u]),m=Object(r.useMemo)((()=>u?en(u,"cloud"):null),[u]),p=Object(r.useMemo)((()=>u?en(u,"agent"):null),[u]),g=Object(r.useCallback)((e=>{o({kind:"kuery",expression:`${e.name}: "${e.value}"`})}),[o]);return c?n.a.createElement(sn,null):n.a.createElement(Va,null,d&&d.length>0&&n.a.createElement(nn,null,n.a.createElement(an,{title:R.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.hostsHeader",{defaultMessage:"Hosts"}),onClick:g,rows:d})),m&&m.length>0&&n.a.createElement(nn,null,n.a.createElement(an,{title:R.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.cloudHeader",{defaultMessage:"Cloud"}),onClick:g,rows:m})),p&&p.length>0&&n.a.createElement(nn,null,n.a.createElement(an,{title:R.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.agentHeader",{defaultMessage:"Agent"}),onClick:g,rows:p})))}};var on=a(18);var cn=a(3);const un=b.tuple([b.union([b.string,b.number]),b.union([b.string,b.number])]),dn=b.keyof({metrics_hosts:null,metrics_k8s:null}),mn=b.keyof({anomalyScore:null,dataset:null,startTime:null}),pn=b.keyof({asc:null,desc:null}),gn=b.type({searchBefore:un}),fn=b.type({searchAfter:un}),bn=b.intersection([b.type({pageSize:b.number}),b.partial({cursor:b.union([gn,fn])})]),hn=b.type({field:mn,direction:pn}),yn=b.keyof({memory_usage:null,network_in:null,network_out:null}),En=b.intersection([b.type({id:b.string,anomalyScore:b.number,typical:b.number,actual:b.number,type:dn,influencers:b.array(b.string),duration:b.number,startTime:b.number,jobId:b.string}),b.partial({partitionFieldName:b.string,partitionFieldValue:b.string})]),vn=b.intersection([b.type({data:b.intersection([b.type({anomalies:b.array(En),hasMoreEntries:b.boolean}),b.partial({paginationCursors:b.type({previousPageCursor:un,nextPageCursor:un})})])}),b.partial({timing:cn.c})]),xn=b.type({data:b.intersection([b.type({sourceId:b.string,anomalyThreshold:b.number,timeRange:cn.d}),b.partial({query:b.string,hostName:b.string,metric:yn,pagination:bn,sort:hn})])}),kn=b.intersection([b.type({id:b.string,anomalyScore:b.number,typical:b.number,actual:b.number,type:dn,influencers:b.array(b.string),duration:b.number,startTime:b.number,jobId:b.string}),b.partial({partitionFieldName:b.string,partitionFieldValue:b.string})]),Mn=b.intersection([b.type({data:b.intersection([b.type({anomalies:b.array(kn),hasMoreEntries:b.boolean}),b.partial({paginationCursors:b.type({previousPageCursor:un,nextPageCursor:un})})])}),b.partial({timing:cn.c})]),On=b.type({data:b.intersection([b.type({sourceId:b.string,anomalyThreshold:b.number,timeRange:cn.d}),b.partial({query:b.string,metric:yn,pagination:bn,sort:hn})])});var wn=a(72);const jn=(e,t)=>{const a={page:1,paginationCursor:void 0};switch(t.type){case"changePaginationOptions":case"changeSortOptions":return{...e,...a,...t.payload};case"changeHasNextPage":case"changeLastReceivedCursors":return{...e,...t.payload};case"fetchNextPage":return e.lastReceivedCursors?{...e,page:e.page+1,paginationCursor:{searchAfter:e.lastReceivedCursors.nextPageCursor}}:e;case"fetchPreviousPage":return e.lastReceivedCursors?{...e,page:e.page-1,paginationCursor:{searchBefore:e.lastReceivedCursors.previousPageCursor}}:e;case"changeTimeRange":case"changeFilteredDatasets":return{...e,...a,...t.payload};default:return e}},Sn={page:1,lastReceivedCursors:void 0,paginationCursor:void 0,hasNextPage:!1},Cn=({endTime:e,startTime:t,sourceId:a,anomalyThreshold:n,defaultSortOptions:i,defaultPaginationOptions:s,onGetMetricsHostsAnomaliesDatasetsError:l,filteredDatasets:o})=>{const{services:c}=Object(Mt.b)(),[u,d]=Object(r.useReducer)(jn,Sn,(a=>({...a,paginationOptions:s,sortOptions:i,filteredDatasets:o,timeRange:{start:t,end:e}}))),[m,p]=Object(r.useState)([]),[g,f]=Object(wn.c)({cancelPreviousOn:"creation",createPromise:async(e,t)=>{const{timeRange:{start:r,end:i},sortOptions:s,paginationOptions:l,paginationCursor:o}=u;return await Tn({sourceId:a,anomalyThreshold:n,startTime:r,endTime:i,metric:e,query:t,sort:s,pagination:{...l,cursor:o}},c.http.fetch)},onResolve:({data:{anomalies:e,paginationCursors:t,hasMoreEntries:a}})=>{const{paginationCursor:r}=u;t&&d({type:"changeLastReceivedCursors",payload:{lastReceivedCursors:t}}),!r||r&&"searchAfter"in r?d({type:"changeHasNextPage",payload:{hasNextPage:a}}):r&&"searchBefore"in r&&d({type:"changeHasNextPage",payload:{hasNextPage:!0}}),p(e)}},[a,n,d,u.timeRange.start,u.timeRange.end,u.sortOptions,u.paginationOptions,u.paginationCursor,u.filteredDatasets]),b=Object(r.useCallback)((e=>{d({type:"changeSortOptions",payload:{sortOptions:e}})}),[d]),h=Object(r.useCallback)((e=>{d({type:"changePaginationOptions",payload:{paginationOptions:e}})}),[d]);Object(r.useEffect)((()=>{d({type:"changeTimeRange",payload:{timeRange:{start:t,end:e}}})}),[t,e]),Object(r.useEffect)((()=>{d({type:"changeFilteredDatasets",payload:{filteredDatasets:o}})}),[o]);const y=Object(r.useCallback)((()=>{u.lastReceivedCursors&&d({type:"fetchNextPage"})}),[d,u]),E=Object(r.useCallback)((()=>{u.lastReceivedCursors&&d({type:"fetchPreviousPage"})}),[d,u]);return{metricsK8sAnomalies:m,getMetricsK8sAnomalies:f,isLoadingMetricsK8sAnomalies:Object(r.useMemo)((()=>"pending"===g.state),[g.state]),hasFailedLoadingMetricsK8sAnomalies:Object(r.useMemo)((()=>"rejected"===g.state),[g.state]),changeSortOptions:b,sortOptions:u.sortOptions,changePaginationOptions:h,paginationOptions:u.paginationOptions,fetchPreviousPage:u.page>1?E:void 0,fetchNextPage:u.hasNextPage?y:void 0,page:u.page}},Tn=async(e,t)=>{const{sourceId:a,anomalyThreshold:r,startTime:n,endTime:i,metric:s,query:l,sort:o,pagination:c}=e,u=await t("/api/infra/infra_ml/results/metrics_k8s_anomalies",{method:"POST",body:JSON.stringify(On.encode({data:{sourceId:a,anomalyThreshold:r,timeRange:{startTime:n,endTime:i},metric:s,query:l,sort:o,pagination:c}}))});return Object(fr.b)(Mn)(u)},Fn=(e,t)=>{const a={page:1,paginationCursor:void 0};switch(t.type){case"changePaginationOptions":case"changeSortOptions":return{...e,...a,...t.payload};case"changeHasNextPage":case"changeLastReceivedCursors":return{...e,...t.payload};case"fetchNextPage":return e.lastReceivedCursors?{...e,page:e.page+1,paginationCursor:{searchAfter:e.lastReceivedCursors.nextPageCursor}}:e;case"fetchPreviousPage":return e.lastReceivedCursors?{...e,page:e.page-1,paginationCursor:{searchBefore:e.lastReceivedCursors.previousPageCursor}}:e;case"changeTimeRange":case"changeFilteredDatasets":return{...e,...a,...t.payload};default:return e}},Ln={page:1,lastReceivedCursors:void 0,paginationCursor:void 0,hasNextPage:!1},Pn=({endTime:e,startTime:t,sourceId:a,anomalyThreshold:n,defaultSortOptions:i,defaultPaginationOptions:s,onGetMetricsHostsAnomaliesDatasetsError:l,filteredDatasets:o})=>{const{services:c}=Object(Mt.b)(),[u,d]=Object(r.useReducer)(Fn,Ln,(a=>({...a,paginationOptions:s,sortOptions:i,filteredDatasets:o,timeRange:{start:t,end:e}}))),[m,p]=Object(r.useState)([]),[g,f]=Object(wn.c)({cancelPreviousOn:"creation",createPromise:async(e,t,r)=>{const{timeRange:{start:i,end:s},sortOptions:l,paginationOptions:o,paginationCursor:d}=u;return await In({sourceId:a,anomalyThreshold:n,startTime:i,endTime:s,metric:e,query:t,sort:l,pagination:{...o,cursor:d},hostName:r},c.http.fetch)},onResolve:({data:{anomalies:e,paginationCursors:t,hasMoreEntries:a}})=>{const{paginationCursor:r}=u;t&&d({type:"changeLastReceivedCursors",payload:{lastReceivedCursors:t}}),!r||r&&"searchAfter"in r?d({type:"changeHasNextPage",payload:{hasNextPage:a}}):r&&"searchBefore"in r&&d({type:"changeHasNextPage",payload:{hasNextPage:!0}}),p(e)}},[a,n,d,u.timeRange.start,u.timeRange.end,u.sortOptions,u.paginationOptions,u.paginationCursor,u.filteredDatasets]),b=Object(r.useCallback)((e=>{d({type:"changeSortOptions",payload:{sortOptions:e}})}),[d]),h=Object(r.useCallback)((e=>{d({type:"changePaginationOptions",payload:{paginationOptions:e}})}),[d]);Object(r.useEffect)((()=>{d({type:"changeTimeRange",payload:{timeRange:{start:t,end:e}}})}),[t,e]),Object(r.useEffect)((()=>{d({type:"changeFilteredDatasets",payload:{filteredDatasets:o}})}),[o]);const y=Object(r.useCallback)((()=>{u.lastReceivedCursors&&d({type:"fetchNextPage"})}),[d,u]),E=Object(r.useCallback)((()=>{u.lastReceivedCursors&&d({type:"fetchPreviousPage"})}),[d,u]);return{metricsHostsAnomalies:m,getMetricsHostsAnomalies:f,isLoadingMetricsHostsAnomalies:Object(r.useMemo)((()=>"pending"===g.state),[g.state]),hasFailedLoadingMetricsHostsAnomalies:Object(r.useMemo)((()=>"rejected"===g.state),[g.state]),changeSortOptions:b,sortOptions:u.sortOptions,changePaginationOptions:h,paginationOptions:u.paginationOptions,fetchPreviousPage:u.page>1?E:void 0,fetchNextPage:u.hasNextPage?y:void 0,page:u.page,timeRange:u.timeRange}},In=async(e,t)=>{const{sourceId:a,anomalyThreshold:r,startTime:n,endTime:i,metric:s,sort:l,pagination:o,query:c,hostName:u}=e,d=await t("/api/infra/infra_ml/results/metrics_hosts_anomalies",{method:"POST",body:JSON.stringify(xn.encode({data:{sourceId:a,anomalyThreshold:r,timeRange:{startTime:n,endTime:i},query:c,metric:s,sort:l,pagination:o,hostName:u}}))});return Object(fr.b)(vn)(d)},Dn=R.i18n.translate("xpack.infra.logs.analysis.anomaliesTablePreviousPageLabel",{defaultMessage:"Previous page"}),_n=R.i18n.translate("xpack.infra.logs.analysis.anomaliesTableNextPageLabel",{defaultMessage:"Next page"}),Rn=({fetchPreviousPage:e,fetchNextPage:t,page:a,isLoading:r})=>n.a.createElement(N.EuiFlexGroup,{justifyContent:"center"},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiFlexGroup,null,n.a.createElement(N.EuiButtonIcon,{iconType:"arrowLeft",isDisabled:!e||r,onClick:e,"aria-label":Dn}),n.a.createElement("span",null,n.a.createElement("strong",null,a)),n.a.createElement(N.EuiButtonIcon,{iconType:"arrowRight",isDisabled:!t||r,onClick:t,"aria-label":_n}))));var An=a(70);const Bn=({anomaly:e})=>{const{actual:t,typical:a}=e,r=R.i18n.translate("xpack.infra.ml.anomalyFlyout.anomaliesTableMoreThanExpectedAnomalyMessage",{defaultMessage:"more"}),i=R.i18n.translate("xpack.infra.ml.anomalyFlyout.anomaliesTableFewerThanExpectedAnomalyMessage",{defaultMessage:"fewer"}),s=t>a,l=s?r:i,o=s?t/a:a/t,c=s?"sortUp":"sortDown",u=o!==1/0?`${Object(An.h)(o)}x`:"";return n.a.createElement(N.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},n.a.createElement(N.EuiFlexItem,{grow:!1,component:"span"},n.a.createElement(N.EuiIcon,{type:c})),n.a.createElement(N.EuiFlexItem,{component:"span"},`${u} ${l}`))};var Nn=a(171),Vn=a(54),zn=a(183);const $n=b.type({capabilities:b.type({canGetJobs:b.boolean,canCreateJob:b.boolean,canDeleteJob:b.boolean,canOpenJob:b.boolean,canCloseJob:b.boolean,canForecastJob:b.boolean,canGetDatafeeds:b.boolean,canStartStopDatafeed:b.boolean,canUpdateJob:b.boolean,canUpdateDatafeed:b.boolean,canPreviewDatafeed:b.boolean}),isPlatinumOrTrialLicense:b.boolean,mlFeatureEnabledInSpace:b.boolean,upgradeInProgress:b.boolean}),Un=()=>{const{services:e}=Object(Mt.b)(),[t,a]=Object(r.useState)(Jn),[n,i]=Object(wn.c)({cancelPreviousOn:"resolution",createPromise:async()=>{const t=await e.http.fetch("/api/ml/ml_capabilities");return Object(h.pipe)($n.decode(t),Object(y.fold)(Object(fr.c)(fr.a),E.identity))},onResolve:e=>{a(e)}},[]);Object(r.useEffect)((()=>{i()}),[i]);const s=Object(r.useMemo)((()=>"pending"===n.state),[n.state]),l=t.capabilities.canCreateJob,o=t.capabilities.canGetJobs;return{hasInfraMLCapabilities:t.isPlatinumOrTrialLicense&&t.mlFeatureEnabledInSpace,hasInfraMLReadCapabilities:o,hasInfraMLSetupCapabilities:l,isLoading:s}},[Hn,qn]=d()(Un),Jn={capabilities:{canGetJobs:!1,canCreateJob:!1,canDeleteJob:!1,canOpenJob:!1,canCloseJob:!1,canForecastJob:!1,canGetDatafeeds:!1,canStartStopDatafeed:!1,canUpdateJob:!1,canUpdateDatafeed:!1,canPreviewDatafeed:!1,canGetCalendars:!1,canCreateCalendar:!1,canDeleteCalendar:!1,canGetFilters:!1,canCreateFilter:!1,canDeleteFilter:!1,canFindFileStructure:!1,canGetDataFrameJobs:!1,canDeleteDataFrameJob:!1,canPreviewDataFrameJob:!1,canCreateDataFrameJob:!1,canStartStopDataFrameJob:!1},isPlatinumOrTrialLicense:!1,mlFeatureEnabledInSpace:!1,upgradeInProgress:!1};var Gn=a(178),Kn=a(95);const Wn=({jobTypes:e})=>({jobStatus:e.reduce(((e,t)=>({...e,[t]:"unknown"})),{}),jobSummaries:[],lastSetupErrorMessages:[],setupStatus:{type:"initializing"}}),Qn=e=>t=>t.filter((t=>t.id===e&&t.success&&!t.error)).length>0,Xn=e=>t=>t.filter((t=>t.id===e&&t.success&&t.started&&!t.error)).length>0,Yn=e=>t=>t.filter((t=>t.id===e)).map((e=>"failed"===e.jobState||""===e.datafeedState?"failed":"closed"===e.jobState&&"stopped"===e.datafeedState&&e.fullJob&&null!=e.fullJob.finished_time?"finished":"closed"===e.jobState||"closing"===e.jobState||"stopped"===e.datafeedState?"stopped":"opening"===e.jobState&&!1===e.awaitingNodeAssignment?"initializing":"opened"===e.jobState&&"started"===e.datafeedState||"opening"===e.jobState&&"starting"===e.datafeedState&&!0===e.awaitingNodeAssignment?"started":"unknown"))[0]||"missing",Zn=e=>t=>Object.entries(e).reduce(((e,[,t])=>"missing"===t?{type:"required"}:"required"===e.type||"succeeded"===e.type?e:"skipped"===e.type||Object(Kn.e)(t)?{type:"skipped",newlyCreated:"skipped"===e.type&&e.newlyCreated}:e),t),ei=e=>null!=e.error,ti=e=>Object(r.useReducer)((e=>(t,a)=>{switch(a.type){case"startedSetup":return{...t,jobStatus:e.reduce(((e,t)=>({...e,[t]:"initializing"})),{}),setupStatus:{type:"pending"}};case"finishedSetup":{const{datafeedSetupResults:r,jobSetupResults:n,jobSummaries:i,spaceId:s,sourceId:l}=a,o=e.reduce(((e,t)=>({...e,[t]:Qn(Object(Kn.c)(s,l,t))(n)&&Xn(Object(Kn.b)(s,l,t))(r)?"started":"failed"})),{}),c=Object.values(o).every((e=>"started"===e))?{type:"succeeded"}:{type:"failed",reasons:[...Object.values(r).filter(ei).map((e=>e.error.msg)),...Object.values(n).filter(ei).map((e=>e.error.msg))]};return{...t,jobStatus:o,jobSummaries:i,setupStatus:c}}case"failedSetup":return{...t,jobStatus:e.reduce(((e,t)=>({...e,[t]:"failed"})),{}),setupStatus:{type:"failed",reasons:["unknown"]}};case"fetchingJobStatuses":return{...t,setupStatus:"unknown"===t.setupStatus.type?{type:"initializing"}:t.setupStatus};case"fetchedJobStatuses":{const{payload:r,spaceId:n,sourceId:i}=a,{setupStatus:s}=t,l=e.reduce(((e,t)=>({...e,[t]:Yn(Object(Kn.c)(n,i,t))(r)})),{}),o=Zn(l)(s);return{...t,jobSummaries:r,jobStatus:l,setupStatus:o}}case"failedFetchingJobStatuses":return{...t,setupStatus:{type:"unknown"},jobStatus:e.reduce(((e,t)=>({...e,[t]:"unknown"})),{})};case"viewedResults":return{...t,setupStatus:{type:"skipped",newlyCreated:!0}};default:return t}})(e),{jobTypes:e},Wn),ai=({sourceConfiguration:e,moduleDescriptor:t})=>{const{services:a}=Object(Mt.b)(),{spaceId:n,sourceId:i,timestampField:s}=e,[l,o]=ti(t.jobTypes),[,c]=Object(wn.c)({cancelPreviousOn:"resolution",createPromise:async()=>(o({type:"fetchingJobStatuses"}),await t.getJobSummary(n,i,a.http.fetch)),onResolve:e=>{o({type:"fetchedJobStatuses",payload:e,spaceId:n,sourceId:i})},onReject:()=>{o({type:"failedFetchingJobStatuses"})}},[n,i]),[,u]=Object(wn.c)({cancelPreviousOn:"resolution",createPromise:async(e,r,l,c,u)=>{o({type:"startedSetup"});return{setupResult:await t.setUpModule({start:r,end:l,filter:c,moduleSourceConfiguration:{indices:e,sourceId:i,spaceId:n,timestampField:s},partitionField:u},a.http.fetch),jobSummaries:await t.getJobSummary(n,i,a.http.fetch)}},onResolve:({setupResult:{datafeeds:e,jobs:t},jobSummaries:a})=>{o({type:"finishedSetup",datafeedSetupResults:e,jobSetupResults:t,jobSummaries:a,spaceId:n,sourceId:i})},onReject:()=>{o({type:"failedSetup"})}},[t.setUpModule,n,i,s]),[d,m]=Object(wn.c)({cancelPreviousOn:"resolution",createPromise:async()=>await t.cleanUpModule(n,i,a.http.fetch)},[n,i]),p=Object(r.useMemo)((()=>"pending"===d.state),[d.state]),g=Object(r.useCallback)(((e,t,a,r,n)=>{o({type:"startedSetup"}),m().then((()=>{u(e,t,a,r,n)})).catch((()=>{o({type:"failedSetup"})}))}),[m,o,u]),f=Object(r.useCallback)((()=>{o({type:"viewedResults"})}),[o]),b=Object(r.useMemo)((()=>t.getJobIds(n,i)),[t,n,i]);return{cleanUpAndSetUpModule:g,cleanUpModule:m,fetchJobStatus:c,isCleaningUp:p,jobIds:b,jobStatus:l.jobStatus,jobSummaries:l.jobSummaries,lastSetupErrorMessages:l.lastSetupErrorMessages,moduleDescriptor:t,setUpModule:u,setupStatus:l.setupStatus,sourceConfiguration:e,viewResults:f}},ri=({moduleDescriptor:e,sourceConfiguration:t})=>({getIsJobConfigurationOutdated:Object(r.useMemo)((()=>ni(e,t)),[t,e])}),ni=({bucketSpan:e},t)=>a=>{if(!a.fullJob||!a.fullJob.custom_settings)return!1;const r=a.fullJob.custom_settings.metrics_source_config;return!(r&&r.bucketSpan===e&&r.indexPattern&&ii(new Set(r.indexPattern.split(",")),new Set(t.indices))&&r.timestampField===t.timestampField)},ii=(e,t)=>Array.from(e).every((e=>t.has(e))),si=({sourceConfiguration:{spaceId:e,sourceId:t},moduleDescriptor:a})=>{const{services:n}=Object(Mt.b)(),[i,s]=Object(r.useState)(),l=Object(r.useMemo)((()=>i?i.jobs.reduce(((a,r)=>({...a,[Object(An.k)(e,t,r.id)]:r})),{}):{}),[i,t,e]),[o,c]=Object(wn.c)({cancelPreviousOn:"resolution",createPromise:async()=>await a.getModuleDefinition(n.http.fetch),onResolve:e=>{s(e)},onReject:()=>{s(void 0)}},[a.getModuleDefinition,e,t]),u=Object(r.useCallback)((e=>{var t,a,r;const n=l[e.id];if(null==n)return!1;const i=null==n?void 0:n.config.custom_settings.job_revision;return(null!==(t=null===(a=e.fullJob)||void 0===a||null===(r=a.custom_settings)||void 0===r?void 0:r.job_revision)&&void 0!==t?t:0)<(null!=i?i:0)}),[l]);return{fetchModuleDefinition:c,fetchModuleDefinitionRequestState:o.state,getIsJobDefinitionOutdated:u,jobDefinitionByJobId:l,moduleDefinition:i}},li=async e=>{const t=await e("/api/ml/jobs/deleting_jobs_tasks");return Object(fr.b)(ui)(t)},oi=b.type({jobIds:b.array(b.string)}),ci=b.record(b.string,b.type({deleted:b.boolean})),ui=b.type({jobIds:b.array(b.string)}),di=b.type({datafeedIds:b.array(b.string)}),mi=b.record(b.string,b.type({stopped:b.boolean})),pi=async(e,t,a,r)=>{try{await(async(e,t)=>{const{spaceId:a,sourceId:r,jobTypes:n}=e,i=await t("/api/ml/jobs/stop_datafeeds",{method:"POST",body:JSON.stringify(di.encode({datafeedIds:n.map((e=>Object(Kn.b)(a,r,e)))}))});return Object(fr.b)(mi)(i)})({spaceId:e,sourceId:t,jobTypes:a},r)}catch(e){var n;if(404!==(null==e||null===(n=e.res)||void 0===n?void 0:n.status))throw e}return await gi(e,t,a,r)},gi=async(e,t,a,r)=>{const n=await(async(e,t)=>{const{spaceId:a,sourceId:r,jobTypes:n}=e,i=await t("/api/ml/jobs/delete_jobs",{method:"POST",body:JSON.stringify(oi.encode({jobIds:n.map((e=>Object(Kn.c)(a,r,e)))}))});return Object(fr.b)(ci)(i)})({spaceId:e,sourceId:t,jobTypes:a},r);return await fi(e,t,a,r),n},fi=async(e,t,a,r)=>{const n=a.map((a=>Object(Kn.c)(e,t,a)));for(;;){const{jobIds:e}=await li(r);if(!e.some((e=>n.includes(e))))return!0;await bi(1e3)}},bi=e=>new Promise((t=>setTimeout(t,e))),hi=async(e,t)=>{const{spaceId:a,sourceId:r,jobTypes:n}=e,i=await t("/api/ml/jobs/jobs_summary",{method:"POST",body:JSON.stringify(yi.encode({jobIds:n.map((e=>Object(Kn.c)(a,r,e)))}))});return Object(fr.b)(Oi)(i)},yi=b.type({jobIds:b.array(b.string)}),Ei=b.keyof({started:null,starting:null,stopped:null,stopping:null,"":null}),vi=b.keyof({closed:null,closing:null,deleting:null,failed:null,opened:null,opening:null}),xi=b.keyof({ok:null,warn:null}),ki=b.type({categorization_status:xi,categorized_doc_count:b.number,dead_category_count:b.number,frequent_category_count:b.number,rare_category_count:b.number,total_category_count:b.number}),Mi=b.intersection([b.type({id:b.string,jobState:vi}),b.partial({awaitingNodeAssignment:b.boolean,datafeedIndices:b.array(b.string),datafeedState:Ei,fullJob:b.partial({custom_settings:Kn.f,finished_time:b.number,model_size_stats:ki})})]),Oi=b.array(Mi),wi=async(e,t)=>{const a=await t(`/api/ml/modules/get_module/${e}`,{method:"GET"});return Object(fr.b)(Si)(a)},ji=b.type({id:b.string,config:b.type({custom_settings:An.q})}),Si=b.type({id:b.string,jobs:b.array(ji)}),Ci=async(e,t)=>{const{moduleId:a,start:r,end:n,spaceId:i,sourceId:s,indexPattern:l,jobOverrides:o=[],datafeedOverrides:c=[],query:u}=e,d=await t(`/api/ml/modules/setup/${a}`,{method:"POST",body:JSON.stringify(Ii.encode({start:r,end:n,indexPatternName:l,prefix:Object(Kn.d)(i,s),startDatafeed:!0,jobOverrides:o,datafeedOverrides:c,query:u}))});return Object(fr.b)(Ai)(d)},Ti=b.partial({start:b.number,end:b.number}),Fi=b.type({job_id:b.string,custom_settings:Kn.f}),Li=b.object,Pi=b.intersection([b.strict({indexPatternName:b.string,prefix:b.string,startDatafeed:b.boolean,jobOverrides:b.array(Fi),datafeedOverrides:b.array(Li)}),b.exact(b.partial({query:b.object}))]),Ii=b.intersection([Ti,Pi]),Di=b.type({msg:b.string}),_i=b.intersection([b.type({id:b.string,started:b.boolean,success:b.boolean}),b.partial({error:Di})]),Ri=b.intersection([b.type({id:b.string,success:b.boolean}),b.partial({error:Di})]),Ai=b.type({datafeeds:b.array(_i),jobs:b.array(Ri)});var Bi=a(271),Ni=a(272),Vi=a(273),zi=a(274),$i=a(275),Ui=a(276);const Hi="metrics_ui_hosts",qi=R.i18n.translate("xpack.infra.ml.metricsModuleName",{defaultMessage:"Metrics anomanly detection"}),Ji=R.i18n.translate("xpack.infra.ml.metricsHostModuleDescription",{defaultMessage:"Use Machine Learning to automatically detect anomalous log entry rates."}),Gi=(e,t)=>Kn.g.reduce(((a,r)=>({...a,[r]:Object(Kn.c)(e,t,r)})),{}),Ki=e=>{switch(e){case"hosts_memory_usage":return{datafeed:Ni,job:Bi};case"hosts_network_in":return{datafeed:zi,job:Vi};case"hosts_network_out":return{datafeed:Ui,job:$i}}},Wi={moduleId:Hi,moduleName:qi,moduleDescription:Ji,jobTypes:Kn.g,bucketSpan:Kn.a,getJobIds:Gi,getJobSummary:async(e,t,a)=>{const r=await hi({spaceId:e,sourceId:t,jobTypes:Kn.g},a),n=Object.values(Gi(e,t));return r.filter((e=>n.includes(e.id)))},getModuleDefinition:async e=>await wi(Hi,e),setUpModule:async(e,t)=>{const{start:a,end:r,filter:n,moduleSourceConfiguration:{spaceId:i,sourceId:s,indices:l,timestampField:o},partitionField:c}=e,u=l.join(","),d=["hosts_memory_usage","hosts_network_in","hosts_network_out"],m=d.map((e=>{const{job:t}=Ki(e),a={...t.analysis_config};return c&&(a.detectors[0].partition_field_name=c,-1===a.influencers.indexOf(c)&&a.influencers.push(c)),{job_id:e,data_description:{time_field:o},analysis_config:a,custom_settings:{metrics_source_config:{indexPattern:u,timestampField:o,bucketSpan:Kn.a}}}})),p=d.map((e=>{const{datafeed:t}=Ki(e),a={...t};if(n){const e=JSON.parse(n);a.query.bool={...a.query.bool,...e.bool}}if(!c||"hosts_memory_usage"===e)return{...a,job_id:e};const r={[c]:{terms:{field:c},aggregations:{...t.aggregations}}};return{...a,job_id:e,aggregations:r}}));return Ci({moduleId:Hi,start:a,end:r,spaceId:i,sourceId:s,indexPattern:u,jobOverrides:m,datafeedOverrides:p},t)},cleanUpModule:async(e,t,a)=>await pi(e,t,Kn.g,a)},[Qi,Xi]=d()((({indexPattern:e,sourceId:t,spaceId:a,timestampField:n})=>{const i=Object(r.useMemo)((()=>({indices:e.split(","),sourceId:t,spaceId:a,timestampField:n})),[e,t,a,n]),s=ai({moduleDescriptor:Wi,sourceConfiguration:i}),{getIsJobConfigurationOutdated:l}=ri({sourceConfiguration:i,moduleDescriptor:Wi}),{fetchModuleDefinition:o,getIsJobDefinitionOutdated:c}=si({sourceConfiguration:i,moduleDescriptor:Wi}),u=Object(r.useMemo)((()=>s.jobSummaries.some(l)),[l,s.jobSummaries]),d=Object(r.useMemo)((()=>s.jobSummaries.some(c)),[c,s.jobSummaries]),m=Object(r.useMemo)((()=>Object.values(s.jobStatus).some((e=>"stopped"===e))),[s.jobStatus]);return{...s,fetchModuleDefinition:o,hasOutdatedJobConfigurations:u,hasOutdatedJobDefinitions:d,hasStoppedJobs:m}}));var Yi=a(277),Zi=a(278),es=a(279),ts=a(280),as=a(281),rs=a(282);const ns="kubernetes.namespace",is="metrics_ui_k8s",ss=R.i18n.translate("xpack.infra.ml.metricsModuleName",{defaultMessage:"Metrics anomanly detection"}),ls=R.i18n.translate("xpack.infra.ml.metricsHostModuleDescription",{defaultMessage:"Use Machine Learning to automatically detect anomalous log entry rates."}),os=(e,t)=>Kn.h.reduce(((a,r)=>({...a,[r]:Object(Kn.c)(e,t,r)})),{}),cs=e=>{switch(e){case"k8s_memory_usage":return{datafeed:Zi,job:Yi};case"k8s_network_in":return{datafeed:ts,job:es};case"k8s_network_out":return{datafeed:rs,job:as}}},us={moduleId:is,moduleName:ss,moduleDescription:ls,jobTypes:Kn.h,bucketSpan:Kn.a,getJobIds:os,getJobSummary:async(e,t,a)=>{const r=await hi({spaceId:e,sourceId:t,jobTypes:Kn.h},a),n=Object.values(os(e,t));return r.filter((e=>n.includes(e.id)))},getModuleDefinition:async e=>await wi(is,e),setUpModule:async(e,t)=>{const{start:a,end:r,filter:n,moduleSourceConfiguration:{spaceId:i,sourceId:s,indices:l,timestampField:o},partitionField:c}=e,u=l.join(","),d=["k8s_memory_usage","k8s_network_in","k8s_network_out"],m=d.map((e=>{const{job:t}=cs(e),a={...t.analysis_config};return c&&(a.detectors[0].partition_field_name=c,-1===a.influencers.indexOf(c)&&a.influencers.push(c)),{job_id:e,data_description:{time_field:o},analysis_config:a,custom_settings:{metrics_source_config:{indexPattern:u,timestampField:o,bucketSpan:Kn.a}}}})),p=d.map((e=>{const{datafeed:t}=cs(e),a={...t};if(n){const e=JSON.parse(n);a.query.bool={...a.query.bool,...e.bool}}if(!c||"k8s_memory_usage"===e)return{...a,job_id:e};const r=t.aggregations["kubernetes.namespace"].aggregations,i={[c]:{terms:{field:c,size:25},aggregations:{...r}}};return{...a,job_id:e,aggregations:i}}));return Ci({moduleId:is,start:a,end:r,spaceId:i,sourceId:s,indexPattern:u,jobOverrides:m,datafeedOverrides:p},t)},cleanUpModule:async(e,t,a)=>await pi(e,t,Kn.h,a)},[ds,ms]=d()((({indexPattern:e,sourceId:t,spaceId:a,timestampField:n})=>{const i=Object(r.useMemo)((()=>({indices:e.split(","),sourceId:t,spaceId:a,timestampField:n})),[e,t,a,n]),s=ai({moduleDescriptor:us,sourceConfiguration:i}),{getIsJobConfigurationOutdated:l}=ri({sourceConfiguration:i,moduleDescriptor:us}),{fetchModuleDefinition:o,getIsJobDefinitionOutdated:c}=si({sourceConfiguration:i,moduleDescriptor:us}),u=Object(r.useMemo)((()=>s.jobSummaries.some(l)),[l,s.jobSummaries]),d=Object(r.useMemo)((()=>s.jobSummaries.some(c)),[c,s.jobSummaries]),m=Object(r.useMemo)((()=>Object.values(s.jobStatus).some((e=>"stopped"===e))),[s.jobStatus]);return{...s,fetchModuleDefinition:o,hasOutdatedJobConfigurations:u,hasOutdatedJobDefinitions:d,hasStoppedJobs:m}})),ps=e=>{const[t,a]=Object(r.useState)("jobs"),{goToSetup:i,closeFlyout:s}=e,{fetchJobStatus:l,setupStatus:o,jobSummaries:c}=Xi(),{fetchJobStatus:u,setupStatus:d,jobSummaries:m}=ms(),{hasInfraMLCapabilities:p,hasInfraMLReadCapabilities:g,hasInfraMLSetupCapabilities:f}=qn(),b=Object(r.useCallback)((()=>{i("hosts")}),[i]),h=Object(r.useCallback)((()=>{i("kubernetes")}),[i]),y=[...(m||[]).map((e=>e.id)),...(c||[]).map((e=>e.id))];Object(r.useEffect)((()=>{g&&(l(),u())}),[u,l,g]);const E=c.length>0||m.length>0,v=Object(Ve.b)({app:"ml",pathname:"/jobs"});return p?g?"initializing"===o.type||"initializing"===d.type?n.a.createElement(B.b,{message:R.i18n.translate("xpack.infra.ml.anomalyFlyout.jobStatusLoadingMessage",{defaultMessage:"Checking status of metrics jobs..."})}):f?n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiFlyoutHeader,null,n.a.createElement(N.EuiTitle,{size:"m"},n.a.createElement("h2",null,n.a.createElement(V.FormattedMessage,{defaultMessage:"Machine Learning anomaly detection",id:"xpack.infra.ml.anomalyFlyout.flyoutHeader"})))),n.a.createElement(N.EuiTabs,null,n.a.createElement(N.EuiTab,{isSelected:"jobs"===t,onClick:()=>a("jobs")},"Jobs"),n.a.createElement(N.EuiTab,{isSelected:"anomalies"===t,onClick:()=>a("anomalies"),"data-test-subj":"anomalyFlyoutAnomaliesTab"},"Anomalies")),n.a.createElement(N.EuiFlyoutBody,{banner:n.a.createElement(n.a.Fragment,null,"jobs"===t&&E&&n.a.createElement(n.a.Fragment,null,n.a.createElement(gs,{hasHostJobs:c.length>0,hasK8sJobs:m.length>0,jobIds:y})),n.a.createElement(Vn.MLJobsAwaitingNodeWarning,{jobIds:y}))},"jobs"===t&&n.a.createElement(n.a.Fragment,null,E&&n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiFlexGroup,{gutterSize:"s"},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButton,ee()({},v,{style:{marginRight:5}}),n.a.createElement(V.FormattedMessage,{defaultMessage:"Manage jobs in ML",id:"xpack.infra.ml.anomalyFlyout.manageJobs"})))),n.a.createElement(N.EuiSpacer,{size:"l"})),n.a.createElement(N.EuiText,null,n.a.createElement("h4",null,"Create ML Jobs"),n.a.createElement("p",null,n.a.createElement(V.FormattedMessage,{defaultMessage:"Anomaly detection is powered by machine learning. Machine learning jobs are available for the following resource types. Enable these jobs to begin detecting anomalies in your infrastructure metrics.",id:"xpack.infra.ml.anomalyFlyout.createJobs"}))),n.a.createElement(N.EuiSpacer,{size:"l"}),n.a.createElement(fs,{hasHostJobs:c.length>0,hasK8sJobs:m.length>0,hasSetupCapabilities:e.hasSetupCapabilities,createHosts:b,createK8s:h})),"anomalies"===t&&n.a.createElement(xs,{closeFlyout:s}))):n.a.createElement(Gn.c,null):n.a.createElement(Gn.b,null):n.a.createElement(zn.b,null)},gs=e=>{let t="";return e.hasHostJobs&&e.hasK8sJobs?t=`${R.i18n.translate("xpack.infra.ml.anomalyFlyout.create.hostTitle",{defaultMessage:"Hosts"})} and ${R.i18n.translate("xpack.infra.ml.anomalyFlyout.create.k8sSuccessTitle",{defaultMessage:"Kubernetes"})}`:e.hasHostJobs?t=R.i18n.translate("xpack.infra.ml.anomalyFlyout.create.hostSuccessTitle",{defaultMessage:"Hosts"}):e.hasK8sJobs&&(t=R.i18n.translate("xpack.infra.ml.anomalyFlyout.create.k8sSuccessTitle",{defaultMessage:"Kubernetes"})),n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiCallOut,{size:"m",color:"success",title:n.a.createElement(V.FormattedMessage,{defaultMessage:"Anomaly detection enabled for {target}",id:"xpack.infra.ml.anomalyFlyout.enabledCallout",values:{target:t}}),iconType:"check"}))},fs=e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiFlexGroup,{gutterSize:"m"},n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiCard,{isDisabled:!e.hasSetupCapabilities,icon:n.a.createElement(N.EuiIcon,{type:"storage",size:"xl"}),title:n.a.createElement(V.FormattedMessage,{defaultMessage:"Hosts",id:"xpack.infra.ml.anomalyFlyout.create.hostTitle"}),description:n.a.createElement(V.FormattedMessage,{defaultMessage:"Detect anomalies for memory usage and network traffic on hosts.",id:"xpack.infra.ml.anomalyFlyout.create.hostDescription"}),footer:n.a.createElement(n.a.Fragment,null,e.hasHostJobs&&n.a.createElement(N.EuiButtonEmpty,{onClick:e.createHosts},n.a.createElement(V.FormattedMessage,{defaultMessage:"Recreate jobs",id:"xpack.infra.ml.anomalyFlyout.create.recreateButton"})),!e.hasHostJobs&&n.a.createElement(N.EuiButton,{onClick:e.createHosts},n.a.createElement(V.FormattedMessage,{defaultMessage:"Enable",id:"xpack.infra.ml.anomalyFlyout.create.createButton"})))})),n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiCard,{isDisabled:!e.hasSetupCapabilities,icon:n.a.createElement(N.EuiIcon,{type:"logoKubernetes",size:"xl"}),title:n.a.createElement(V.FormattedMessage,{defaultMessage:"Kubernetes Pods",id:"xpack.infra.ml.anomalyFlyout.create.k8sTitle"}),description:n.a.createElement(V.FormattedMessage,{defaultMessage:"Detect anomalies for memory usage and network traffic on Kubernetes Pods.",id:"xpack.infra.ml.anomalyFlyout.create.k8sDescription"}),footer:n.a.createElement(n.a.Fragment,null,e.hasK8sJobs&&n.a.createElement(N.EuiButtonEmpty,{onClick:e.createK8s},n.a.createElement(V.FormattedMessage,{defaultMessage:"Recreate jobs",id:"xpack.infra.ml.anomalyFlyout.create.recreateButton"})),!e.hasK8sJobs&&n.a.createElement(N.EuiButton,{onClick:e.createK8s},n.a.createElement(V.FormattedMessage,{defaultMessage:"Enable",id:"xpack.infra.ml.anomalyFlyout.create.createButton"})))})))),bs=(e,t="absolute")=>{let a="";return a+=`(ml:(jobIds:!(${e.map((e=>`'${e}'`)).join(",")}))`,a+=`,refreshInterval:(display:Off,pause:!f,value:0),time:(from:'${p()().subtract(4,"weeks").toISOString()}'`,a+=`,to:'${p()().toISOString()}'`,"invalid"===t&&(a+=",mode:invalid"),a+="))&_a=(query:(query_string:(analyze_wildcard:!t,query:'*')))",a},hs={...Pa.b,filterQuery:Qt,time:Nt.currentTime,autoReload:Nt.isAutoReloading},ys=()=>{const{metric:e,groupBy:t,nodeType:a,view:n,customOptions:i,customMetrics:s,boundsOverride:l,autoBounds:o,accountId:c,region:u,legend:d,sort:m,timelineOpen:p,setWaffleOptionsState:g}=Object(Pa.d)(),{currentTime:f,isAutoReloading:b,setWaffleTimeState:h}=qt(),{filterQuery:y,setWaffleFiltersState:E}=aa(),v={metric:e,sort:m,groupBy:t,nodeType:a,view:n,customOptions:i,customMetrics:s,boundsOverride:l,autoBounds:o,accountId:c,region:u,time:f,autoReload:b,filterQuery:y,legend:d,timelineOpen:p},x=Object(r.useCallback)((e=>{g({sort:e.sort,metric:e.metric,groupBy:e.groupBy,nodeType:e.nodeType,view:e.view,customOptions:e.customOptions,customMetrics:e.customMetrics,boundsOverride:e.boundsOverride,autoBounds:e.autoBounds,accountId:e.accountId,region:e.region,legend:e.legend,timelineOpen:e.timelineOpen}),e.time&&h({currentTime:e.time,isAutoReloading:e.autoReload}),E(e.filterQuery)}),[g,h,E]);return{viewState:v,defaultViewState:hs,onViewChange:x}},Es=({jobId:e,type:t,startTime:a,closeFlyout:i,influencerField:s,influencers:l,disableShowInInventory:o})=>{const[c,u]=Object(r.useState)(!1),d=Object(r.useCallback)((()=>u(!1)),[u]),m=Object(r.useCallback)((()=>u(!c)),[c]),{onViewChange:p}=ys(),g=Object(r.useCallback)((()=>{const r=e.split("-"),n={metric:{type:{memory_usage:"memory",network_in:"rx",network_out:"tx"}[r[r.length-1].replace(/hosts_|k8s_/,"")]},sort:{by:"name",direction:"desc"},groupBy:[],nodeType:"metrics_k8s"===t?"pod":"host",view:"map",customOptions:[],customMetrics:[],boundsOverride:{max:1,min:0},autoBounds:!0,accountId:"",region:"",autoReload:!1,filterQuery:{expression:l.reduce(((e,t)=>(e&&(e=`${e} or `),`${e} ${s}: "${t}"`)),""),kind:"kuery"},legend:{palette:"cool",reverseColors:!1,steps:10},time:a};p(n),i()}),[e,p,a,t,l,s,i]),f=Object(Ve.b)({app:"ml",pathname:`/explorer?_g=${bs([e.toString()])}`}),b=[n.a.createElement(N.EuiContextMenuItem,ee()({key:"openInAnomalyExplorer",icon:"popout"},f),n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.actions.openInAnomalyExplorer",defaultMessage:"Open in Anomaly Explorer"}))];return o||b.push(n.a.createElement(N.EuiContextMenuItem,{key:"showInInventory",icon:"search",onClick:g},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.actions.showInInventory",defaultMessage:"Show in Inventory"}))),n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiPopover,{anchorPosition:"downRight",panelPaddingSize:"none",button:n.a.createElement(N.EuiButtonIcon,{iconType:"boxesHorizontal",onClick:m,"aria-label":R.i18n.translate("xpack.infra.ml.anomalyFlyout.actions.openActionMenu",{defaultMessage:"Open"})}),isOpen:c,closePopover:d},n.a.createElement(N.EuiContextMenuPanel,{items:b})))},vs=Object(z.withTheme)((({theme:e})=>n.a.createElement(N.EuiText,null,n.a.createElement(N.EuiSpacer,{size:"xl"}),n.a.createElement("p",null,n.a.createElement(N.EuiIcon,{type:"eyeClosed",size:"xl",color:e.eui.euiColorMediumShade})),n.a.createElement("h3",{"data-test-subj":"noAnomaliesFoundMsg"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.anomalyTable.noAnomaliesFound",defaultMessage:"No anomalies found"})),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiText,{color:"subdued"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.anomalyTable.noAnomaliesSuggestion",defaultMessage:"Try modifying your search or selected time range."}))))),xs=e=>{const{closeFlyout:t,hostName:a}=e,[i,s]=Object(r.useState)(""),[l,o]=Object(r.useState)("now-30d"),[c,u]=Object(r.useState)("now"),d=Object(de.useUiTracker)({app:"infra_metrics"}),[m,p]=Object(r.useState)({start:Object(on.a)(l)||0,end:Object(on.a)(c,"up")||0}),{sorting:g,setSorting:f}=function(e){const[t,a]=Object(r.useState)(e);return{sorting:t,setSorting:a}}({field:"startTime",direction:"desc"}),b=[{id:"hosts",label:R.i18n.translate("xpack.infra.ml.anomalyFlyout.hostBtn",{defaultMessage:"Hosts"}),"data-test-subj":"anomaliesHostComboBoxItem"},{id:"k8s",label:R.i18n.translate("xpack.infra.ml.anomalyFlyout.podsBtn",{defaultMessage:"Kubernetes Pods"}),"data-test-subj":"anomaliesK8sComboBoxItem"}],[h,y]=Object(r.useState)("hosts"),[E,v]=Object(r.useState)([b.find((e=>"hosts"===e.id))||b[0]]),{source:x}=Object(ce.b)(),k=null==x?void 0:x.configuration.anomalyThreshold,M=Object(r.useCallback)((({isInvalid:e,start:t,end:a})=>{e||(o(t),u(a),p({start:Object(on.a)(t),end:Object(on.a)(a,"up")}))}),[]),O=Object(r.useMemo)((()=>({sourceId:"default",anomalyThreshold:k||0,startTime:m.start,endTime:m.end,defaultSortOptions:{direction:(null==g?void 0:g.direction)||"desc",field:(null==g?void 0:g.field)||"startTime"},defaultPaginationOptions:{pageSize:10}})),[m.start,m.end,null==g?void 0:g.field,null==g?void 0:g.direction,k]),{metricsHostsAnomalies:w,getMetricsHostsAnomalies:j,page:S,changeSortOptions:C,fetchNextPage:T,fetchPreviousPage:F,isLoadingMetricsHostsAnomalies:L}=Pn(O),{metricsK8sAnomalies:P,getMetricsK8sAnomalies:I,page:D,changeSortOptions:_,fetchNextPage:A,fetchPreviousPage:B,isLoadingMetricsK8sAnomalies:z}=Cn(O),$=Object(r.useMemo)((()=>"hosts"===h?S:D),[h,S,D]),U=Object(r.useMemo)((()=>"hosts"===h?L:z),[h,L,z]),H=Object(r.useMemo)((()=>"hosts"===h?T:A),[h,T,A]),q=Object(r.useMemo)((()=>"hosts"===h?F:B),[h,F,B]),J=Object(r.useMemo)((()=>"hosts"===h?j:"k8s"===h?I:void 0),[h,I,j]),G=Object(r.useMemo)((()=>"hosts"===h?w:P),[h,w,P]),K=Object(r.useCallback)((e=>{s(e.target.value)}),[]),W=Object(r.useCallback)((e=>{v(e),y(e[0].id)}),[]),Q=Object(r.useCallback)((e=>{"hosts"===h?C(e):_(e)}),[C,_,h]);Object(r.useEffect)((()=>{G&&G.forEach((e=>{e.influencers.length>100&&d({metric:"metrics_ml_anomaly_detection_more_than_100_influencers"})}))}),[G,d]);let X=[{field:"startTime",name:R.i18n.translate("xpack.infra.ml.anomalyFlyout.columnTime",{defaultMessage:"Time"}),width:"15%",sortable:!0,textOnly:!0,truncateText:!0,render:e=>n.a.createElement(V.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})},{field:"jobId",name:R.i18n.translate("xpack.infra.ml.anomalyFlyout.columnJob",{defaultMessage:"Job"}),width:"25%",render:e=>e,"data-test-subj":"anomalyRow"},{field:"anomalyScore",name:R.i18n.translate("xpack.infra.ml.anomalyFlyout.columnSeverit",{defaultMessage:"Severity"}),width:"15%",sortable:!0,render:e=>n.a.createElement(Nn.a,{anomalyScore:e})},{field:"typical",name:R.i18n.translate("xpack.infra.ml.anomalyFlyout.columnSummary",{defaultMessage:"Summary"}),width:"15%",textOnly:!0,render:(e,t)=>n.a.createElement(Bn,{anomaly:t})},{field:"influencers",name:R.i18n.translate("xpack.infra.ml.anomalyFlyout.columnInfluencerName",{defaultMessage:"Node name"}),width:"20%",textOnly:!0,truncateText:!0,render:e=>e.join(",")},{name:R.i18n.translate("xpack.infra.ml.anomalyFlyout.columnActionsName",{defaultMessage:"Actions"}),width:"10%",actions:[{render:e=>n.a.createElement(Es,{jobId:e.jobId,type:e.type,influencerField:"metrics_hosts"===e.type?"host.name":"kubernetes.pod.uid",disableShowInInventory:e.influencers.length>100,influencers:e.influencers,startTime:e.startTime,closeFlyout:t})}]}];return X=a?X.filter((e=>!("field"in e)||"influencers"!==e.field)):X,Object(r.useEffect)((()=>{J&&J(void 0,i,a)}),[J,i,a]),n.a.createElement("div",null,n.a.createElement(N.EuiFlexGroup,null,n.a.createElement(N.EuiFlexItem,{grow:1},n.a.createElement(N.EuiSuperDatePicker,{start:l,end:c,showUpdateButton:!1,onTimeChange:M}))),!a&&n.a.createElement(N.EuiFlexGroup,{alignItems:"center"},n.a.createElement(N.EuiFlexItem,{grow:3},n.a.createElement(N.EuiFieldSearch,{fullWidth:!0,placeholder:R.i18n.translate("xpack.infra.ml.anomalyFlyout.searchPlaceholder",{defaultMessage:"Search"}),value:i,onChange:K,isClearable:!0})),n.a.createElement(N.EuiFlexItem,{grow:1},n.a.createElement(N.EuiComboBox,{placeholder:R.i18n.translate("xpack.infra.ml.anomalyFlyout.jobTypeSelect",{defaultMessage:"Select group"}),singleSelection:{asPlainText:!0},options:b,selectedOptions:E,onChange:W,isClearable:!1,"data-test-subj":"anomaliesComboBoxType"}))),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiBasicTable,{columns:X,items:G,sorting:{sort:g},onChange:e=>{var t,a;f(e.sort),Q({field:(null==e||null===(t=e.sort)||void 0===t?void 0:t.field)||"startTime",direction:(null==e||null===(a=e.sort)||void 0===a?void 0:a.direction)||"desc"})},hasActions:!0,loading:U,noItemsMessage:U?n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.anomalyTable.loading",defaultMessage:"Loading anomalies"}):n.a.createElement(vs,null)}),n.a.createElement(N.EuiSpacer,{size:"l"}),n.a.createElement(Rn,{fetchNextPage:H,fetchPreviousPage:q,page:$,isLoading:U}))},ks={id:"anomalies",name:R.i18n.translate("xpack.infra.nodeDetails.tabs.anomalies",{defaultMessage:"Anomalies"}),content:e=>{const{node:t,onClose:a}=e;return n.a.createElement(Va,null,n.a.createElement(xs,{closeFlyout:a,hostName:t.name}))}},Ms={id:"osquery",name:R.i18n.translate("xpack.infra.nodeDetails.tabs.osquery",{defaultMessage:"Osquery"}),content:e=>{const t=e.node.id,a=e.nodeType,i=Object(Q.b)(a),{sourceId:s}=Object(r.useContext)(ce.a.Context),{currentTimeRange:l}=qt(),{loading:o,metadata:c}=Zr(t,a,i.requiredMetrics,s,l),{services:{osquery:u}}=Object(Mt.b)(),d=null==u?void 0:u.OsqueryAction;return Object(r.useMemo)((()=>o||!d?n.a.createElement(Va,null,n.a.createElement(N.EuiLoadingContent,{lines:10})):n.a.createElement(Va,null,n.a.createElement(d,{metadata:c}))),[d,o,c])}},Os=(e,t,a)=>{if("host"===t&&a.ip)return{app:"uptime",hash:"/",search:{search:`host.ip:"${a.ip}"`}};const r=Object(ve.get)(e,["fields",t],"");return{app:"uptime",hash:"/",search:{search:`${r?r+":":""}"${a.id}"`}}},ws=({isOpen:e,node:t,nodeType:a,currentTime:i,options:s,onClose:l,openAlertFlyout:o})=>{var c;const u=[lr,mr,Wr,ln,ks,Ms],d=Object(Q.b)(a),m=i-1e3*d.metrics.defaultTimeRangeInSeconds,p=null===(c=Object(A.useKibana)().services.application)||void 0===c?void 0:c.capabilities,g=Object(r.useMemo)((()=>{var e;return Boolean(null==p||null===(e=p.infrastructure)||void 0===e?void 0:e.save)}),[p]),f=Object(r.useMemo)((()=>u.map((e=>{const r=e.content;return{...e,content:n.a.createElement(r,{onClose:l,node:t,nodeType:a,currentTime:i,options:s})}}))),[u,t,a,i,l,s]),[b,h]=Object(r.useState)(0),y=Object(Ve.b)({..._({nodeType:a,nodeId:t.id,from:m,to:i})}),E="host"===a?"host.hostname":d.fields.id,v=Object(Ve.b)({app:"apm",hash:"traces",search:{kuery:`${E}:"${t.id}"`}}),x=Object(Ve.b)(Os(s,a,t));return e?n.a.createElement(N.EuiPortal,null,n.a.createElement(N.EuiOutsideClickDetector,{onOutsideClick:l},n.a.createElement(Ss,null,n.a.createElement(js,null,n.a.createElement(N.EuiFlexGroup,{responsive:!1,gutterSize:"m"},n.a.createElement(Cs,{grow:!0},n.a.createElement(N.EuiTitle,{size:"xs"},n.a.createElement("h4",null,t.name))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiFlexGroup,{gutterSize:"m",responsive:!1},g&&n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButtonEmpty,{onClick:o,size:"xs",iconSide:"left",flush:"both",iconType:"bell"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.infra.nodeDetails.createAlertLink",defaultMessage:"Create inventory rule"}))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButtonEmpty,{size:"xs",iconSide:"left",iconType:"popout",href:y.href,flush:"both"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.infra.nodeDetails.openAsPage",defaultMessage:"Open as page"}))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButtonIcon,{size:"s",onClick:l,iconType:"cross"}))))),n.a.createElement(N.EuiSpacer,{size:"s"}),n.a.createElement(N.EuiTabs,{size:"s"},f.map(((e,t)=>n.a.createElement(N.EuiTab,{key:e.id,isSelected:t===b,onClick:()=>h(t)},e.name))),n.a.createElement(N.EuiTab,v,n.a.createElement(N.EuiIcon,{type:"popout"})," ",n.a.createElement(V.FormattedMessage,{id:"xpack.infra.infra.nodeDetails.apmTabLabel",defaultMessage:"APM"})),n.a.createElement(N.EuiTab,x,n.a.createElement(N.EuiIcon,{type:"popout"})," ",n.a.createElement(V.FormattedMessage,{id:"xpack.infra.infra.nodeDetails.updtimeTabLabel",defaultMessage:"Uptime"})))),f[b].content))):null},js=z.euiStyled.div`
  padding-top: ${e=>e.theme.eui.paddingSizes.m};
  padding-right: ${e=>e.theme.eui.paddingSizes.m};
  padding-left: ${e=>e.theme.eui.paddingSizes.m};
  background-color: ${e=>e.theme.eui.euiPageBackgroundColor};
  box-shadow: inset 0 -1px ${e=>e.theme.eui.euiBorderColor};
`,Ss=Object(z.euiStyled)(N.EuiPanel).attrs({paddingSize:"none"})`
  display: flex;
  flex-direction: column;
  position: absolute;
  right: 16px;
  top: ${266}px;
  width: 100%;
  max-width: 720px;
  z-index: 2;
  max-height: calc(100vh - ${282}px);
  overflow: hidden;

  @media (max-width: 752px) {
    border-radius: 0px !important;
    left: 0px;
    right: 0px;
    top: 97px;
    bottom: 0;
    max-height: calc(100vh - 97px);
    max-width: 100%;
  }
`,Cs=Object(z.euiStyled)(N.EuiFlexItem)`
  overflow: hidden;
  & h4 {
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
  }
`,Ts=({options:e,nodeType:t,filter:a,visible:i,setVisible:s})=>{const{triggersActionsUI:l}=Object(r.useContext)(Me.a),{inventoryPrefill:o}=Object(we.b)(),{customMetrics:c}=o,u=Object(r.useCallback)((()=>s(!1)),[s]),d=Object(r.useMemo)((()=>l&&l.getAddAlertFlyout({consumer:"infrastructure",onClose:u,canChangeTrigger:!1,alertTypeId:Oe.c,metadata:{options:e,nodeType:t,filter:a,customMetrics:c}})),[l,i]);return n.a.createElement(n.a.Fragment,null,i&&d)},Fs=({onClose:e})=>{const{inventoryPrefill:t}=Object(we.b)(),{nodeType:a,metric:r,filterQuery:i}=t;return n.a.createElement(Ts,{options:{metric:r},nodeType:a,filter:i,visible:!0,setVisible:e})},Ls=Object(z.withTheme)((({options:e,currentTime:t,node:a,nodeType:i})=>{var s,l,o;const[c,u]=Object(r.useState)(!1),d=Object(Q.b)(i),m=t-1e3*d.metrics.defaultTimeRangeInSeconds,p=null===(s=Object(A.useKibana)().services.application)||void 0===s?void 0:s.capabilities,g="host"===i?"host.hostname":d.fields.id,f=d.crosslinkSupport.details,b=d.crosslinkSupport.logs&&a.id&&(null==p||null===(l=p.logs)||void 0===l?void 0:l.show),h=d.crosslinkSupport.apm&&(null==p?void 0:p.apm)&&(null==p?void 0:p.apm.show),y=d.crosslinkSupport.uptime&&(["pod","container"].includes(i)||a.ip),E=null==p||null===(o=p.infrastructure)||void 0===o?void 0:o.save,v=Object(r.useMemo)((()=>{if("host"===i){if(a.ip)return{label:n.a.createElement(N.EuiCode,null,"host.ip"),value:a.ip}}else if(e.fields){const{id:t}=Object(Q.a)(i,e.fields);return{label:n.a.createElement(N.EuiCode,null,t),value:a.id}}return{label:"",value:""}}),[i,a.ip,a.id,e.fields]),x=Object(Ve.b)(Object(dr.b)({nodeType:i,nodeId:a.id,time:t})),k=Object(Ve.b)({..._({nodeType:i,nodeId:a.id,from:m,to:t})}),M=Object(Ve.b)({app:"apm",hash:"traces",search:{kuery:`${g}:"${a.id}"`}}),O=Object(Ve.b)(Os(e,i,a)),w={label:R.i18n.translate("xpack.infra.nodeContextMenu.viewLogsName",{defaultMessage:"{inventoryName} logs",values:{inventoryName:d.singularDisplayName}}),...x,"data-test-subj":"viewLogsContextMenuItem",isDisabled:!b},j={label:R.i18n.translate("xpack.infra.nodeContextMenu.viewMetricsName",{defaultMessage:"{inventoryName} metrics",values:{inventoryName:d.singularDisplayName}}),...k,isDisabled:!f},S={label:R.i18n.translate("xpack.infra.nodeContextMenu.viewAPMTraces",{defaultMessage:"{inventoryName} APM traces",values:{inventoryName:d.singularDisplayName}}),...M,"data-test-subj":"viewApmTracesContextMenuItem",isDisabled:!h},C={label:R.i18n.translate("xpack.infra.nodeContextMenu.viewUptimeLink",{defaultMessage:"{inventoryName} in Uptime",values:{inventoryName:d.singularDisplayName}}),...O,isDisabled:!y},T={label:R.i18n.translate("xpack.infra.nodeContextMenu.createRuleLink",{defaultMessage:"Create inventory rule"}),onClick:()=>{u(!0)},isDisabled:!E};return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{style:{maxWidth:300},"data-test-subj":"nodeContextMenu"},n.a.createElement(de.Section,null,n.a.createElement(de.SectionTitle,null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.nodeContextMenu.title",defaultMessage:"{inventoryName} details",values:{inventoryName:d.singularDisplayName}})),v.label&&n.a.createElement(de.SectionSubtitle,null,n.a.createElement("div",{style:{wordBreak:"break-all"}},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.nodeContextMenu.description",defaultMessage:"View details for {label} {value}",values:{label:v.label,value:v.value}}))),n.a.createElement(de.SectionLinks,null,n.a.createElement(de.SectionLink,ee()({"data-test-subj":"viewLogsContextMenuItem"},w)),n.a.createElement(de.SectionLink,j),n.a.createElement(de.SectionLink,ee()({"data-test-subj":"viewApmTracesContextMenuItem"},S)),n.a.createElement(de.SectionLink,C)),n.a.createElement(de.ActionMenuDivider,null),n.a.createElement(de.SectionLinks,null,n.a.createElement(de.SectionLink,ee()({iconType:"bell",color:"primary"},T))))),c&&n.a.createElement(Ts,{filter:e.fields?`${Object(Q.a)(i,e.fields).id}: "${a.id}"`:"",options:e,nodeType:i,setVisible:u,visible:c}))})),Ps={isPopoverOpen:!1,isOverlayOpen:!1,isAlertFlyoutVisible:!1};class node_Node extends n.a.PureComponent{constructor(...e){super(...e),va()(this,"state",Ps),va()(this,"openAlertFlyout",(()=>{this.setState({isOverlayOpen:!1,isAlertFlyoutVisible:!0})})),va()(this,"setAlertFlyoutVisible",(e=>{this.setState({isAlertFlyoutVisible:e})})),va()(this,"togglePopover",(()=>{const{nodeType:e}=this.props;"host"===e?this.toggleNewOverlay():this.setState((e=>({isPopoverOpen:!e.isPopoverOpen})))})),va()(this,"toggleNewOverlay",(()=>{this.setState((e=>({isPopoverOpen:!0!=!e.isOverlayOpen&&e.isPopoverOpen,isOverlayOpen:!e.isOverlayOpen})))})),va()(this,"closePopover",(()=>{this.state.isPopoverOpen&&this.setState({isPopoverOpen:!1})}))}render(){const{nodeType:e,node:t,options:a,squareSize:r,bounds:i,formatter:s,currentTime:l}=this.props,{isPopoverOpen:o,isAlertFlyoutVisible:c}=this.state,u=Object(ve.first)(t.metrics),d=r>70,m=r>30,p=u&&u.value||0,g=((e,t,a,r="rgba(217, 217, 217, 1)")=>{try{return Ie.f.is(e)?_a(Ba(e.rules,t,r)):Ie.a.is(e)?_a(Na(e.rules,t,a,r)):Ie.g.is(e)?_a(Aa(e.rules,t,a,r)):r}catch(e){return r}})(a.legend,p,i),f=s(p),b=R.i18n.translate("xpack.infra.node.ariaLabel",{defaultMessage:"{nodeName}, click to open menu",values:{nodeName:t.name}}),h=this.state.isOverlayOpen?{border:"solid 4px #000"}:void 0,y=n.a.createElement(N.EuiToolTip,{delay:"regular",position:"right",content:n.a.createElement(Ia,{currentTime:l,node:t,nodeType:e})},n.a.createElement(Is,{"data-test-subj":"nodeContainer",style:{width:r||0,height:r||0},onClick:this.togglePopover},n.a.createElement(Ds,{color:g,style:h},n.a.createElement(_s,{color:g},d?n.a.createElement(Rs,{"aria-label":b},n.a.createElement(Ns,{color:g},t.name),n.a.createElement(Bs,{color:g},f)):m&&n.a.createElement(Rs,{"aria-label":b},n.a.createElement(Ns,{color:g},"..."))))));return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiPopover,{button:y,isOpen:o,closePopover:this.closePopover,anchorPosition:"downCenter"},n.a.createElement(Ls,{node:t,nodeType:e,options:a,currentTime:l})),this.state.isOverlayOpen&&n.a.createElement(ws,{openAlertFlyout:this.openAlertFlyout,node:t,nodeType:e,isOpen:this.state.isOverlayOpen,options:a,currentTime:l,onClose:this.toggleNewOverlay}),c&&n.a.createElement(Ts,{filter:a.fields?`${Object(Q.a)(e,a.fields).id}: "${t.id}"`:"",options:a,nodeType:e,setVisible:this.setAlertFlyoutVisible,visible:c}))}}const Is=z.euiStyled.div`
  position: relative;
`,Ds=z.euiStyled.div`
  position: absolute;
  top: 4px;
  left: 4px;
  bottom: 4px;
  right: 4px;
  background-color: ${e=>Object(wa.darken)(.1,e.color)};
  border-radius: 3px;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
`,_s=z.euiStyled.div`
  cursor: pointer;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 2px;
  left: 0;
  border-radius: 3px;
  background-color: ${e=>e.color};
`,Rs=z.euiStyled.button`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  line-height: 1.2em;
  align-items: center;
  align-content: center;
  padding: 1em;
  overflow: hidden;
  flex-wrap: wrap;
  width: 100%;
  border: none;
  &:focus {
    outline: none !important;
    border: ${e=>{var t;return null===(t=e.theme)||void 0===t?void 0:t.eui.euiFocusRingSize}} solid
      ${e=>{var t;return null===(t=e.theme)||void 0===t?void 0:t.eui.euiFocusRingColor}};
    box-shadow: none;
  }
`,As=z.euiStyled.div`
  text-align: center;
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1 0 auto;
  color: ${e=>Object(wa.readableColor)(e.color)};
`,Bs=Object(z.euiStyled)(As)`
  font-weight: bold;
  font-size: 0.9em;
  line-height: 1.2em;
`,Ns=Object(z.euiStyled)(As)`
  font-size: 0.7em;
  margin-bottom: 0.7em;
`,Vs=({group:e,options:t,formatter:a,onDrilldown:r,isChild:i=!1,bounds:s,nodeType:l,currentTime:o})=>{const c=e.width>200?e.width:200;return n.a.createElement(zs,{style:{width:c}},n.a.createElement(group_name_GroupName,{group:e,onDrilldown:r,isChild:i,options:t}),n.a.createElement($s,null,e.width?e.nodes.map((r=>n.a.createElement(node_Node,{key:`${r.pathId}:${r.name}`,options:t,squareSize:e.squareSize,node:r,formatter:a,bounds:s,nodeType:l,currentTime:o}))):null))},zs=z.euiStyled.div`
  margin: 0 10px;
`,$s=z.euiStyled.div`
  display: flex;
  background-color: rgba(0, 0, 0, 0.05);
  flex-wrap: wrap;
  justify-content: center;
  padding: 20px 10px 10px;
  border-radius: 4px;
  border: 1px solid ${e=>e.theme.eui.euiBorderColor};
  box-shadow: 0 1px 7px rgba(0, 0, 0, 0.1);
`,Us=e=>n.a.createElement(Hs,null,n.a.createElement(group_name_GroupName,{group:e.group,onDrilldown:e.onDrilldown,options:e.options}),n.a.createElement(qs,null,e.group.groups.map((t=>n.a.createElement(Vs,{isChild:!0,key:t.id,onDrilldown:e.onDrilldown,options:e.options,group:t,formatter:e.formatter,bounds:e.bounds,nodeType:e.nodeType,currentTime:e.currentTime}))))),Hs=z.euiStyled.div`
  margin: 0 10px;
  width: 100%;
`,qs=z.euiStyled.div`
  display: flex;
  background-color: rgba(0, 0, 0, 0.05);
  flex-wrap: wrap;
  justify-content: center;
  padding: 20px 10px 10px;
  border-radius: 4px;
  border: 1px solid ${e=>e.theme.eui.euiBorderColor};
  box-shadow: 0 1px 7px rgba(0, 0, 0, 0.1);
`;function Js(e,t=1,a=1){const r=t/a,n=r>1.2?1.2:r,i=Math.ceil(Math.sqrt(e));return Math.ceil(i*n)}function Gs(e){return e?e.reduce(((e,t)=>pa(t)?t.groups.reduce(((e,t)=>t.nodes.length+e),e):ma(t)?t.nodes.length+e:e),0):0}const Ks=e=>Gs([e]);function Ws(e,t,a){if(0===e.length)return[];const r=pa(Object(ve.first)(e))?2:1,n=Gs(e),i=Math.round(function(e,t,a,r=1){const n=.55/(r>1?.7*r:1),i=e*n,s=t*n,l=Math.ceil(Math.sqrt(a*i/s));let o,c;o=Math.floor(l*s/i)*l<a?s/Math.ceil(l*s/i):i/l;const u=Math.ceil(Math.sqrt(a*s/i));c=Math.floor(u*i/s)*u<a?i/Math.ceil(i*u/s):s/u;const d=Math.max(o,c);return Math.min(Math.max(d,24),1/0)}(t,a,n,r)),s=function(e){return e?e.reduce(((e,t)=>pa(t)?t.groups.reduce(((e,t)=>ma(t)?e>t.nodes.length?e:t.nodes.length:e),e):ma(t)?e>t.nodes.length?e:t.nodes.length:e),0):0}(e);return Object(ve.sortBy)(e,Ks).reverse().map((e=>{if(pa(e)){const r=Js(s,t,a),n=e.groups,l=Object(ve.sortBy)(n,Ks).reverse().filter(ma).map((e=>({...e,count:e.nodes.length,columns:r,width:r*i,squareSize:i})));return{...e,groups:l,count:Gs([e]),squareSize:i}}if(ma(e)){const r=Js(Math.max(e.nodes.length,s),t,a);return{...e,count:e.nodes.length,squareSize:i,width:r*i}}return e}))}const Qs={name:e=>Object(ve.last)(e.path),value:e=>{const t=Object(ve.first)(e.metrics);return t&&t.value||0}},Xs=({nodes:e,options:t,currentTime:a,onFilter:r,formatter:i,bounds:s,nodeType:l,dataBounds:o,bottomMargin:c,staticHeight:u})=>{const d=ya(((e,t)=>{const a=Qs[e.by],r=Object(ve.sortBy)(t,a);return"desc"===e.direction?r.reverse():r})(t.sort,e));return n.a.createElement(da.a,{bounds:!0},(({measureRef:e,bounds:{width:o=0,height:m=0}})=>{const p=Ws(d,o,m);return n.a.createElement(Ys,{ref:t=>e(t),bottomMargin:c,"data-test-subj":"waffleMap",staticHeight:u},n.a.createElement(Zs,null,p.map((e=>pa(e)?n.a.createElement(Us,{onDrilldown:r,key:e.id,options:t,group:e,formatter:i,bounds:s,nodeType:l,currentTime:a}):ma(e)?n.a.createElement(Vs,{key:e.id,options:t,group:e,onDrilldown:r,formatter:i,isChild:!1,bounds:s,nodeType:l,currentTime:a}):void 0))))}))},Ys=z.euiStyled.div`
  flex: 1 0 0%;
  display: flex;
  justify-content: flex-start;
  flex-direction: column;
  overflow-x: hidden;
  overflow-y: auto;
  margin-bottom: ${e=>e.bottomMargin}px;
  ${e=>e.staticHeight&&"min-height: 300px;"}
`,Zs=z.euiStyled.div`
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: center;
  align-content: flex-start;
  padding: 10px;
`;var el=a(190),tl=a(175);const al=e=>{switch(e.length){case 3:return e.slice(0,2);case 2:return e.slice(0,1);default:return[]}},rl=e=>{const{nodes:t,options:a,formatter:i,currentTime:s,nodeType:l}=e,[o,c]=Object(r.useState)([]),u=Object(r.useCallback)((e=>()=>{c([...o,e])}),[o]),d=Object(r.useCallback)((e=>()=>{o.includes(e)&&c(o.filter((t=>t!==e)))}),[o]);Object(r.useEffect)((()=>{const e=document.getElementsByClassName(tl.a)[0];e instanceof HTMLElement&&(o.length>0?e.style.overflowY="hidden":e.style.overflowY="auto")}),[o]);const m=[{field:"name",name:R.i18n.translate("xpack.infra.tableView.columnName.name",{defaultMessage:"Name"}),sortable:!0,truncateText:!0,textOnly:!0,render:(e,t)=>{const r=t.node.id===e?`${e}`:`${e} (${t.node.id})`,i=[...t.node.path.map((e=>e.value)),t.node.name].join(":"),c=n.a.createElement(N.EuiToolTip,{content:r},n.a.createElement(N.EuiButtonEmpty,{onClick:u(i)},e));return n.a.createElement(N.EuiPopover,{button:c,isOpen:o.includes(i),closePopover:d(i),anchorPosition:"rightCenter"},n.a.createElement(Ls,{node:t.node,nodeType:l,currentTime:s,options:a}))}},...a.groupBy.map(((t,a)=>({field:`group_${a}`,name:Object(el.a)(t&&t.field||""),sortable:!0,truncateText:!0,textOnly:!0,render:a=>n.a.createElement(N.EuiToolTip,{content:"Set Filter"},n.a.createElement(N.EuiButtonEmpty,{onClick:()=>e.onFilter(`${t.field}:"${a}"`)},a))}))),{field:"value",name:R.i18n.translate("xpack.infra.tableView.columnName.last1m",{defaultMessage:"Last 1m"}),sortable:!0,truncateText:!0,dataType:"number",render:e=>n.a.createElement("span",null,i(e))},{field:"avg",name:R.i18n.translate("xpack.infra.tableView.columnName.avg",{defaultMessage:"Avg"}),sortable:!0,truncateText:!0,dataType:"number",render:e=>n.a.createElement("span",null,i(e))},{field:"max",name:R.i18n.translate("xpack.infra.tableView.columnName.max",{defaultMessage:"Max"}),sortable:!0,truncateText:!0,dataType:"number",render:e=>n.a.createElement("span",null,i(e))}],p=t.map((e=>{const t=Object(ve.last)(e.path),a=Object(ve.first)(e.metrics);return{name:t&&t.label||"unknown",...al(e.path).reduce(((e,t,a)=>({...e,[`group_${a}`]:t.label})),{}),value:a&&a.value||0,avg:a&&a.avg||0,max:a&&a.max||0,node:ba(e)}}));return n.a.createElement(N.EuiInMemoryTable,{pagination:!0,sorting:{sort:{field:"value",direction:"desc"}},items:p,columns:m})},nl=e=>{const t=e.map((e=>{const t=Object(ve.first)(e.metrics);return t&&t.value?t.value:0}));1===t.length&&t.unshift(0);const a=Object(ve.max)(t)||0,r=Object(ve.min)(t)||0;return{min:Object(ve.isFinite)(r)?r:0,max:Object(ve.isFinite)(a)?a:0}},il=({autoBounds:e,boundsOverride:t,loading:a,nodes:i,nodeType:s,reload:l,view:o,currentTime:c,options:u,formatter:d,onDrilldown:m,bottomMargin:p,topMargin:g,showLoading:f})=>{const b=Object(r.useCallback)((e=>{m({kind:"kuery",expression:e})}),[m]),h=!a&&i&&0===i.length;if(a&&f)return n.a.createElement(he.a,{height:"100%",width:"100%",text:R.i18n.translate("xpack.infra.waffle.loadingDataText",{defaultMessage:"Loading data"})});if(h)return n.a.createElement(be.a,{titleText:R.i18n.translate("xpack.infra.waffle.noDataTitle",{defaultMessage:"There is no data to display."}),bodyText:R.i18n.translate("xpack.infra.waffle.noDataDescription",{defaultMessage:"Try adjusting your time or filter."}),refetchText:R.i18n.translate("xpack.infra.waffle.checkNewDataButtonLabel",{defaultMessage:"Check for new data"}),onRefetch:()=>{l()},testString:"noMetricsDataPrompt"});const y=nl(i),E=e?y:t,v=["xs","s"].includes(Object(N.getBreakpoint)(window.innerWidth));return"table"===o?n.a.createElement(sl,null,n.a.createElement(rl,{nodeType:s,nodes:i,options:u,formatter:d,currentTime:c,onFilter:b})):n.a.createElement(ll,{top:g,positionStatic:v},n.a.createElement(Xs,{nodeType:s,nodes:i,options:u,formatter:d,currentTime:c,onFilter:b,bounds:E,dataBounds:y,bottomMargin:p,staticHeight:v}))},sl=z.euiStyled.div`
  padding: ${e=>e.theme.eui.paddingSizes.l};
`,ll=z.euiStyled.div`
  position: ${e=>e.positionStatic?"static":"absolute"};
  display: flex;
  top: ${e=>e.top}px;
  right: 0;
  bottom: 0;
  left: 0;
`;var ol=a(195),cl=a(196),ul=a(197),dl=a(192),ml=a(193),pl=a(194),gl=a(189);const fl={host:ol.a,container:cl.a,pod:ul.a,awsEC2:dl.a,awsS3:ml.a,awsRDS:pl.a,awsSQS:gl.a};var bl=a(233);const hl=b.type({value:b.string,name:b.string}),yl=b.type({accounts:b.array(hl),projects:b.array(b.string),regions:b.array(b.string)});b.type({sourceId:b.string,nodeType:Sa.c,currentTime:b.number});const El=({nodeType:e,currentTime:t})=>{const{sourceId:a}=Object(ce.b)(),{accounts:i,regions:s}=function(e,t,a){const{error:n,loading:i,response:s,makeRequest:l}=Object(br.a)("/api/infra/inventory/meta","POST",JSON.stringify({sourceId:e,nodeType:t,currentTime:a}),(e=>Object(h.pipe)(yl.decode(e),Object(y.fold)(Object(fr.c)(fr.a),E.identity))));return Object(r.useEffect)((()=>{l()}),[l]),{error:n,loading:i,accounts:s?s.accounts:[],regions:s?s.regions:[],makeRequest:l}}(a,e,t);return((e,t,a)=>n.a.createElement(bl.a,null,(r=>n.a.createElement(n.a.Fragment,null,n.a.createElement(e,ee()({},r,{accounts:t,regions:a})),n.a.createElement(N.EuiFlexItem,{grow:!0})))))((e=>{const t=null==fl?void 0:fl[e];if(!t)throw new Error(R.i18n.translate("xpack.infra.inventoryModels.findToolbar.error",{defaultMessage:"The toolbar you've attempted to find does not exist."}));return t})(e),i,s)},vl=({view:e,onChange:t})=>{const a=[{id:"map",label:R.i18n.translate("xpack.infra.viewSwitcher.mapViewLabel",{defaultMessage:"Map view"}),iconType:"grid"},{id:"table",label:R.i18n.translate("xpack.infra.viewSwitcher.tableViewLabel",{defaultMessage:"Table view"}),iconType:"visTable"}];return n.a.createElement(N.EuiButtonGroup,{legend:R.i18n.translate("xpack.infra.viewSwitcher.lenged",{defaultMessage:"Switch between table and map view"}),options:a,color:"primary",buttonSize:"m",idSelected:e,onChange:t,isIconOnly:!0})},xl=(e="cool",t=10)=>{switch(e){case"temperature":return Object(N.euiPaletteForTemperature)(t);case"status":return Object(N.euiPaletteForStatus)(t);case"warm":return Object(N.euiPaletteWarm)(t);case"positive":return Object(N.euiPalettePositive)(t);case"negative":return Object(N.euiPaletteNegative)(t);default:return Object(N.euiPaletteCool)(t)}},kl=(e="cool",t=10,a=!1)=>a?xl(e,t).reverse():xl(e,t),Ml=(e,t=10,a=!1)=>({type:"steppedGradient",rules:kl(e,t,a).map(((e,a)=>({color:e,value:(a+1)/t})))}),Ol=new RegExp("^([0-9\\.]*)\\s*("+["y","M","w","d","h","m","s","ms"].join("|")+")$"),wl={ms:.001,s:1,m:60,h:3600,d:86400,w:604800,M:2592e3,y:30758400},jl=e=>{const t=e.match(Ol);if(t)return parseFloat(t[1])*wl[t[2]];throw new Error("Invalid interval string format.")};var Sl=a(82);const Cl=86400;function Tl(e,t,a,n,i,s,l,o,c){const u=Object(r.useMemo)((()=>(e=>{if(e&&jl(e)<300)return"5m";return e})(o)),[o]),d=Object(r.useMemo)((()=>(e=>{if(e){const t=jl(e);return{timeLength:t<=900?Cl:t<=2100?259200:t<=9e3?604800:2592e3,intervalInSeconds:t}}return{timeLength:0,intervalInSeconds:0}})(u)),[u]),{timeLength:m,intervalInSeconds:p}=d,g=i+1e3*p,f=i-1e3*m,b={interval:null!=u?u:"",to:g,from:f,ignoreLookback:!0,forceInterval:!0},{error:v,loading:x,response:k,makeRequest:M}=Object(br.a)("/api/metrics/snapshot","POST",JSON.stringify({metrics:t,groupBy:null,nodeType:a,timerange:b,filterQuery:e,sourceId:n,accountId:s,region:l,includeTimeseries:!0}),(e=>Object(h.pipe)(Sl.g.decode(e),Object(y.fold)(Object(fr.c)(fr.a),E.identity)))),O=Object(r.useCallback)((()=>c?M():Promise.resolve()),[M,c]);Object(r.useEffect)((()=>{(async()=>{m&&await O()})()}),[O,m]);const w=k?Object(ve.first)(k.nodes.map((e=>{var t;return null===(t=Object(ve.first)(e.metrics))||void 0===t?void 0:t.timeseries}))):null;return{error:v&&v.message||null,loading:!o||x,timeseries:w,startTime:f,endTime:g,reload:M}}const Fl=({interval:e,yAxisFormatter:t,isVisible:a})=>{var i,s;const{sourceId:l,source:o}=Object(ce.b)(),{metric:c,nodeType:u,accountId:d,region:m}=Object(Pa.d)(),{currentTime:g,jumpToTime:f,stopAutoReload:b}=qt(),{filterQueryAsJson:h}=aa(),{loading:y,error:E,startTime:v,endTime:x,timeseries:k,reload:M}=Tl(h,[c],u,l,g,d,m,e,a),O={sourceId:"default",anomalyThreshold:(null==o?void 0:o.configuration.anomalyThreshold)||0,startTime:v,endTime:x,defaultSortOptions:{direction:"desc",field:"anomalyScore"},defaultPaginationOptions:{pageSize:100}},{metricsHostsAnomalies:w,getMetricsHostsAnomalies:j}=Pn(O),{metricsK8sAnomalies:S,getMetricsK8sAnomalies:C}=Cn(O),T=Object(r.useMemo)((()=>"host"===u?j:"pod"===u?C:void 0),[u,C,j]),F=Object(r.useMemo)((()=>"host"===u?w:"pod"===u?S:void 0),[u,w,S]),L=null===(i=Object(Fa.a)(c.type))||void 0===i?void 0:i.textLC,P=null===(s=Object(Fa.a)(c.type))||void 0===s?void 0:s.text,I={color:Le.a.color0,aggregation:"avg",label:P},D=Object(r.useMemo)((()=>{var e,t;if(!k)return()=>"";const a=null===(e=Object(ve.first)(k.rows))||void 0===e?void 0:e.timestamp,r=null===(t=Object(ve.last)(k.rows))||void 0===t?void 0:t.timestamp;return null==a||null==r?e=>`${e}`:Object(Ee.niceTimeFormatter)([a,r])}),[k]),_=Object(A.useUiSetting)("theme:darkMode"),R={headerFormatter:e=>p()(e.value).format("Y-MM-DD HH:mm:ss.SSS")},B=k?Object(Qe.a)(k,[I],!1):null,z=B?{max:1.1*B.max,min:B.min}:{max:0,min:0},$=Object(r.useCallback)((([[e]])=>{if(!Array.isArray(e)){const{x:t}=e;f(t),b()}}),[f,b]),U=Object(r.useMemo)((()=>{const e=c.type;return"memory"===e?"memory_usage":"rx"===e?"network_in":"tx"===e?"network_out":void 0}),[c]);if(Object(r.useEffect)((()=>{T&&U&&T(U)}),[T,U]),y)return n.a.createElement(Ll,null,n.a.createElement(Dl,null,n.a.createElement(N.EuiLoadingChart,{size:"xl"})));if(!y&&(E||!k))return n.a.createElement(Ll,null,n.a.createElement(N.EuiEmptyPrompt,{iconType:"visArea",title:n.a.createElement("h4",null,E?Rl:_l),actions:n.a.createElement(N.EuiButton,{color:"primary",fill:!0,onClick:M},E?Bl:Al)}));return n.a.createElement(Ll,null,n.a.createElement(Pl,null,n.a.createElement(N.EuiFlexItem,{grow:!0},n.a.createElement(N.EuiText,null,n.a.createElement("strong",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.inventoryTimeline.header",defaultMessage:"Average {metricLabel}",values:{metricLabel:L}})))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiFlexGroup,{alignItems:"center",responsive:!1},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiIcon,{color:Object(Le.b)(I.color),type:"dot"})),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiText,{size:"xs"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.inventoryTimeline.header",defaultMessage:"Average {metricLabel}",values:{metricLabel:L}}))))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},n.a.createElement(N.EuiFlexItem,{grow:!1,style:{backgroundColor:"#D36086",height:5,width:10}}),n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiText,{size:"xs"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.inventoryTimeline.legend.anomalyLabel",defaultMessage:"Anomaly detected"})))))))),n.a.createElement(Il,null,n.a.createElement(Ee.Chart,null,F&&n.a.createElement(Ee.RectAnnotation,{id:"anomalies",dataValues:(H=F.map((e=>[e.startTime,e.influencers])),H.map((e=>{const[t,a]=e;return{coordinates:{x0:t,x1:p()(t).add(15,"minutes").valueOf(),y0:null==B?void 0:B.min,y1:null==B?void 0:B.max},details:a.join(",")}}))),style:{fill:"#D36086"}}),n.a.createElement(ke.a,{type:ne.b.area,metric:I,id:"0",series:k,stack:!1}),n.a.createElement(Ee.Axis,{id:"timestamp",position:Ee.Position.Bottom,showOverlappingTicks:!0,tickFormat:D}),n.a.createElement(Ee.Axis,{id:"values",position:Ee.Position.Left,tickFormat:t,domain:z,ticks:6,showGridLines:!0}),n.a.createElement(Ee.Settings,{tooltip:R,theme:Ge(_),onElementClick:$}))));var H},Ll=z.euiStyled.div`
  background-color: ${e=>e.theme.eui.euiPageBackgroundColor};
  border-top: 1px solid ${e=>e.theme.eui.euiColorLightShade};
  height: 220px;
  width: 100%;
  padding: ${e=>e.theme.eui.paddingSizes.s} ${e=>e.theme.eui.paddingSizes.m};
  display: flex;
  flex-direction: column;
`,Pl=z.euiStyled.div`
  display: flex;
  width: 100%;
  padding: ${e=>e.theme.eui.paddingSizes.s} ${e=>e.theme.eui.paddingSizes.m};
  @media only screen and (max-width: 767px) {
      margin-top: 30px;
  }
`,Il=z.euiStyled.div`
  padding-left: ${e=>e.theme.eui.paddingSizes.xs};
  width: 100%;
  height: 100%;
`,Dl=z.euiStyled.div`
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
`,_l=R.i18n.translate("xpack.infra.inventoryTimeline.noHistoryDataTitle",{defaultMessage:"There is no historical data to display."}),Rl=R.i18n.translate("xpack.infra.inventoryTimeline.errorTitle",{defaultMessage:"Unable to show historical data."}),Al=R.i18n.translate("xpack.infra.inventoryTimeline.checkNewDataButtonLabel",{defaultMessage:"Check for new data"}),Bl=R.i18n.translate("xpack.infra.inventoryTimeline.retryButtonLabel",{defaultMessage:"Try again"}),Nl=R.i18n.translate("xpack.infra.showHistory",{defaultMessage:"Show history"}),Vl=R.i18n.translate("xpack.infra.hideHistory",{defaultMessage:"Hide history"}),zl=({measureRef:e,width:t,interval:a,formatter:i,children:s})=>{const{timelineOpen:l,changeTimelineOpen:o}=Object(Pa.d)(),[c,u]=Object(r.useState)(Boolean(l));Object(r.useEffect)((()=>{c!==l&&u(Boolean(l))}),[c,l]);const d=Object(de.useUiTracker)({app:"infra_metrics"}),m=Object(r.useCallback)((()=>{c||d({metric:"open_timeline_drawer__inventory"}),u(!c),o(!c)}),[c,d,o]);return n.a.createElement($l,{ref:c?e:null,isOpen:c,outerWidth:t},n.a.createElement(Ul,{ref:c?null:e},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(Hl,{"aria-expanded":c,iconType:c?"arrowDown":"arrowRight",onClick:m},c?Vl:Nl)),n.a.createElement(N.EuiFlexItem,{grow:!1,style:{position:"relative",minWidth:400,height:"16px"}},s),n.a.createElement(ql,null)),n.a.createElement(N.EuiFlexGroup,{style:{marginTop:0}},n.a.createElement(Fl,{isVisible:c,interval:a,yAxisFormatter:i})))},$l=z.euiStyled.div`
  padding: ${e=>e.theme.eui.paddingSizes.m} 0;
  position: fixed;
  bottom: 0;
  right: 0;
  transition: transform ${300}ms;
  transform: translateY(${e=>e.isOpen?0:"224px"});
  width: ${e=>e.outerWidth+34}px;
`,Ul=Object(z.euiStyled)(N.EuiFlexGroup).attrs({justifyContent:"spaceBetween",alignItems:"center"})`
 margin-bottom: 0;
 height: 48px;
`,Hl=Object(z.euiStyled)(N.EuiButtonEmpty).attrs({size:"s"})`
  width: 140px;
`,ql=Object(z.euiStyled)(N.EuiSpacer).attrs({size:"xs"})`
  width: 140px;
`,Jl=({legend:e,bounds:t,formatter:a})=>{const r=e.rules.reduce(((e,t)=>e<t.value?t.value:e),0),i={background:`linear-gradient(to right, ${e.rules.map((e=>{const t=e.value/r*100;return`${e.color} ${t}%`}))})`};return n.a.createElement(Gl,{style:i},e.rules.map(((e,t)=>(a,r)=>{const i=0===a.value?e.min:e.max*a.value,s={left:100*a.value+"%"},l=t(i);return n.a.createElement(Kl,{style:s,key:`legend-rule-${r}`},n.a.createElement(Wl,null),n.a.createElement(Ql,null,l))})(t,a)))},Gl=z.euiStyled.div`
  position: absolute;
  height: 10px;
  bottom: 0;
  left: 0;
  right: 40px;
`,Kl=z.euiStyled.div`
  position: absolute;
  bottom: 0;
  top: -18px;
`,Wl=z.euiStyled.div`
  position: absolute;
  background-color: ${e=>e.theme.eui.euiBorderColor};
  width: 1px;
  left: 0;
  top: 15px;
  bottom: 0;
  ${Kl}:first-child {
    top: 2px;
  }
  ${Kl}:last-child {
    top: 2px;
  }
`,Ql=z.euiStyled.div`
  position: absolute;
  font-size: 11px;
  text-align: center;
  top: 0;
  left: 0;
  white-space: nowrap;
  transform: translate(-50%, 0);
  ${Kl}:first-child & {
    padding-left: 5px;
    transform: translate(0, 0);
  }
  ${Kl}:last-child & {
    padding-right: 5px;
    transform: translate(-100%, 0);
  }
`,Xl=e=>({min:100*e.min,max:100*(e.max||1)}),Yl=({label:e,color:t})=>n.a.createElement(N.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiColorPickerSwatch,{color:t})),n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiText,{size:"xs"},n.a.createElement("strong",null,e)))),Zl=({steps:e,palette:t,reverse:a})=>{const r=kl(t,e,a);return n.a.createElement(to,null,r.map((e=>n.a.createElement(eo,{key:e,style:{backgroundColor:e}}))))},eo=z.euiStyled.div`
  width: 15px;
  height: 12px;
  flex: 0 0 auto;
  &:first-child {
    border-radius: ${e=>e.theme.eui.euiBorderRadius} 0 0 ${e=>e.theme.eui.euiBorderRadius};
  }
  &:last-child {
    border-radius: 0 ${e=>e.theme.eui.euiBorderRadius} ${e=>e.theme.eui.euiBorderRadius} 0;
`,to=z.euiStyled.div`
  display: flex;
`,ao=["temperature","status","cool","warm","positive","negative"].map((e=>({text:Ie.e[e],value:e}))),ro=({autoBounds:e,boundsOverride:t,onChange:a,dataBounds:i,options:s})=>{const[l,o]=Object(r.useState)(!1),[c,u]=Object(r.useState)(e),[d,m]=Object(r.useState)(s),[p,g]=Object(r.useState)(Xl(t));Object(r.useEffect)((()=>{c&&g(Xl(i))}),[e,i,c,a,s]);const f=n.a.createElement(N.EuiButtonIcon,{iconType:"controlsHorizontal",color:"text","aria-label":R.i18n.translate("xpack.infra.legendControls.buttonLabel",{defaultMessage:"configure legend"}),onClick:()=>o(!0)}),b=Object(r.useCallback)((e=>{const a=e.target.checked;u(a),a||g(Xl(t))}),[t]),h=Object(r.useCallback)((e=>{m((t=>({...t,reverseColors:e.target.checked})))}),[m]),y=Object(r.useCallback)((e=>{const t=parseFloat(e.currentTarget.value),a=t<=p.min?p.min+1:t>100?100:t;g({...p,max:a})}),[p]),E=Object(r.useCallback)((e=>{const t=parseFloat(e.currentTarget.value),a=t>=p.max?p.max-1:t<0?0:t;g({...p,min:a})}),[p]),v=Object(r.useCallback)((()=>{a({auto:c,bounds:{min:p.min/100,max:p.max/100},legend:d})}),[a,c,p,d]),x=Object(r.useCallback)((()=>{g(Xl(t)),u(e),m(s),o(!1)}),[e,t,s]),k=Object(r.useCallback)((e=>{const t=parseInt(e.target.value,10);m((e=>({...e,steps:t})))}),[m]),M=Object(r.useCallback)((e=>{const t=e.target.value;m((e=>({...e,palette:t})))}),[m]),O=c===e&&100*t.min===p.min&&100*t.max===p.max&&s.steps===d.steps&&s.reverseColors===d.reverseColors&&s.palette===d.palette,w=p.min<p.max,j=kl(d.palette,d.steps,d.reverseColors),S=w?[]:[R.i18n.translate("xpack.infra.legnedControls.boundRangeError",{defaultMessage:"Minimum must be smaller than the maximum"})];return n.a.createElement(no,null,n.a.createElement(N.EuiPopover,{isOpen:l,closePopover:x,id:"legendControls",button:f},n.a.createElement(N.EuiPopoverTitle,null,"Legend Options"),n.a.createElement(N.EuiForm,{style:{minWidth:400}},n.a.createElement(N.EuiFormRow,{display:"columnCompressed",label:R.i18n.translate("xpack.infra.legendControls.colorPaletteLabel",{defaultMessage:"Color palette"})},n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiSelect,{options:ao,value:d.palette,id:"palette",onChange:M,compressed:!0}),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(Zl,{palette:d.palette,steps:d.steps,reverse:d.reverseColors}))),n.a.createElement(N.EuiFormRow,{display:"columnCompressed",label:R.i18n.translate("xpack.infra.legendControls.stepsLabel",{defaultMessage:"Number of colors"})},n.a.createElement(N.EuiRange,{id:"steps",min:2,max:18,step:1,value:d.steps,onChange:k,showValue:!0,fullWidth:!0})),n.a.createElement(N.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:R.i18n.translate("xpack.infra.legendControls.reverseDirectionLabel",{defaultMessage:"Reverse direction"})},n.a.createElement(N.EuiSwitch,{showLabel:!1,name:"reverseColors",label:"reverseColors",checked:d.reverseColors,onChange:h,compressed:!0,style:{position:"relative",top:"8px"}})),n.a.createElement(N.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:R.i18n.translate("xpack.infra.legendControls.switchLabel",{defaultMessage:"Auto calculate range"})},n.a.createElement(N.EuiSwitch,{showLabel:!1,name:"bounds",label:"bounds",checked:c,onChange:b,compressed:!0,style:{position:"relative",top:"8px"}})),n.a.createElement(N.EuiFormRow,{fullWidth:!0,label:n.a.createElement(Yl,{color:Object(ve.first)(j),label:R.i18n.translate("xpack.infra.legendControls.minLabel",{defaultMessage:"Minimum"})}),isInvalid:!w,display:"columnCompressed",error:S},n.a.createElement("div",{style:{maxWidth:150}},n.a.createElement(N.EuiFieldNumber,{disabled:c,step:1,value:isNaN(p.min)?"":p.min,isInvalid:!w,name:"legendMin",onChange:E,append:"%",compressed:!0}))),n.a.createElement(N.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:n.a.createElement(Yl,{color:Object(ve.last)(j),label:R.i18n.translate("xpack.infra.legendControls.maxLabel",{defaultMessage:"Maxium"})}),isInvalid:!w,error:S},n.a.createElement("div",{style:{maxWidth:150}},n.a.createElement(N.EuiFieldNumber,{disabled:c,step:1,isInvalid:!w,value:isNaN(p.max)?"":p.max,name:"legendMax",onChange:y,append:"%",compressed:!0}))),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiFlexGroup,{justifyContent:"flexEnd",responsive:!1},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButtonEmpty,{type:"submit",size:"s",onClick:x},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.legendControls.cancelButton",defaultMessage:"Cancel"}))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButton,{type:"submit",size:"s",fill:!0,disabled:O||!w,onClick:v},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.legendControls.applyButton",defaultMessage:"Apply"})))))))},no=z.euiStyled.div`
  position: absolute;
  top: -20px;
  right: 6px;
  bottom: 0;
`,io={[Ie.c.gte]:">=",[Ie.c.gt]:">",[Ie.c.lte]:"<=",[Ie.c.lt]:"<",[Ie.c.eq]:"="},so=({legend:e,formatter:t})=>n.a.createElement(lo,null,e.rules.map((e=>(t,a)=>{const r=null!=t.label?t.label:`${io[t.operator]} ${e(t.value)}`,i={backgroundColor:Object(wa.darken)(.4,t.color)},s={backgroundColor:t.color};return n.a.createElement(oo,{key:`legend-step-${a}`},n.a.createElement(co,{style:i},n.a.createElement(uo,{style:s})),n.a.createElement(mo,null,r))})(t))),lo=z.euiStyled.div`
  display: flex;
  padding: 10px 40px 10px 10px;
`,oo=z.euiStyled.div`
  display: flex;
  margin-right: 20px
  align-items: center;
`,co=z.euiStyled.div`
  position: relative;
  width: 24px;
  height: 24px;
  flex: 0 0 auto;
  margin-right: 5px;
  border-radius: 3px;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
`,uo=z.euiStyled.div`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 2px;
  border-radius: 3px;
`,mo=z.euiStyled.div`
  font-size: 12px;
`,po=({legend:e,bounds:t,formatter:a})=>n.a.createElement(Eo,null,n.a.createElement(bo,null,n.a.createElement(go,{value:0,bounds:t,formatter:a}),n.a.createElement(go,{value:1,bounds:t,formatter:a})),n.a.createElement(yo,null,e.rules.map(((e,t)=>n.a.createElement(fo,{key:`step-${t}-${e.value}`,style:{backgroundColor:e.color}}))))),go=({value:e,bounds:t,formatter:a})=>{const r={left:100*e+"%"},i=a(0===e?t.min:t.max*e);return n.a.createElement(ho,{style:r},i)},fo=z.euiStyled.div`
  height: ${e=>e.theme.eui.paddingSizes.s};
  flex: 1 1 auto;
  &:first-child {
    border-radius: ${e=>e.theme.eui.euiBorderRadius} 0 0 ${e=>e.theme.eui.euiBorderRadius};
  }
  &:last-child {
    border-radius: 0 ${e=>e.theme.eui.euiBorderRadius} ${e=>e.theme.eui.euiBorderRadius} 0;
  }
`,bo=z.euiStyled.div`
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  top: -18px;
`,ho=z.euiStyled.div`
  position: absolute;
  font-size: 11px;
  text-align: center;
  top: 0;
  left: 0;
  white-space: nowrap;
  transform: translate(-50%, 0);
  &:first-child {
    padding-left: 5px;
    transform: translate(0, 0);
  }
  &:last-child {
    padding-right: 5px;
    transform: translate(-100%, 0);
  }
`,yo=z.euiStyled.div`
  display: flex;
  flex-direction; row;
  align-items: stretch;
  flex-grow: 1;
`,Eo=z.euiStyled.div`
  position: absolute;
  height: 10px;
  bottom: 0;
  left: 0;
  right: 40px;
`,vo=({dataBounds:e,legend:t,bounds:a,formatter:i})=>{const{changeBoundsOverride:s,changeAutoBounds:l,autoBounds:o,legend:c,changeLegend:u,boundsOverride:d}=Object(Pa.d)(),m=Object(r.useCallback)((e=>{s(e.bounds),l(e.auto),u(e.legend)}),[s,l,u]);return n.a.createElement(xo,null,n.a.createElement(ro,{options:null!=c?c:Pa.a,dataBounds:e,bounds:a,autoBounds:o,boundsOverride:d,onChange:m}),Ie.a.is(t)&&n.a.createElement(Jl,{formatter:i,legend:t,bounds:a}),Ie.f.is(t)&&n.a.createElement(so,{formatter:i,legend:t}),Ie.g.is(t)&&n.a.createElement(po,{formatter:i,bounds:a,legend:t}))},xo=z.euiStyled.div`
  position: absolute;
  bottom: 0px;
  left: 10px;
  right: 10px;
`,ko=n.a.memo((({shouldLoadDefault:e,currentView:t,reload:a,interval:i,nodes:s,loading:l})=>{var o,c,u,d;const[m,p]=Object(r.useState)(!0),{source:g}=Object(ce.b)(),{metric:f,groupBy:b,sort:h,nodeType:y,changeView:E,view:v,autoBounds:x,boundsOverride:k,legend:M}=Object(Pa.d)(),{currentTime:O,jumpToTime:w,isAutoReloading:j}=qt(),{applyFilterQuery:S}=aa(),C=null!==(o=null==M?void 0:M.palette)&&void 0!==o?o:Pa.a.palette,T=null!==(c=null==M?void 0:M.steps)&&void 0!==c?c:Pa.a.steps,F=null!==(u=null==M?void 0:M.reverseColors)&&void 0!==u?u:Pa.a.reverseColors,L={formatter:Ie.b.percent,formatTemplate:"{{value}}",legend:Ml(C,T,F),metric:f,sort:h,fields:null==g||null===(d=g.configuration)||void 0===d?void 0:d.fields,groupBy:b};ua()((()=>{l||w(Date.now())}),j?5e3:null);const P=nl(s),I=x?P:k,D=Object(r.useCallback)(Object(Ta.a)(L.metric),[L.metric]),{onViewChange:_}=ys();return Object(r.useEffect)((()=>{t&&_(t)}),[t,_]),Object(r.useEffect)((()=>{null==t&&e||a()}),[a,e]),Object(r.useEffect)((()=>{p(!0)}),[L.metric,y]),Object(r.useEffect)((()=>{const e=s&&s.length;p(!e)}),[s]),n.a.createElement(n.a.Fragment,null,n.a.createElement($.b,null,n.a.createElement(da.a,{bounds:!0},(({measureRef:e,bounds:{width:t=0}})=>n.a.createElement(Mo,{ref:e},n.a.createElement(da.a,{bounds:!0},(({measureRef:e,bounds:{height:r=0}})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,{ref:e},n.a.createElement(N.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center",gutterSize:"m"},n.a.createElement(El,{nodeType:y,currentTime:O}),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(vl,{view:v,onChange:E})))),n.a.createElement(da.a,{bounds:!0},(({measureRef:e,bounds:{height:o=0}})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(il,{nodes:s,options:L,nodeType:y,loading:l,showLoading:m,reload:a,onDrilldown:S,currentTime:O,view:v,autoBounds:x,boundsOverride:k,formatter:D,bottomMargin:o,topMargin:r}),"map"===v&&n.a.createElement(zl,{measureRef:e,interval:i,formatter:D,width:t},n.a.createElement(vo,{formatter:D,bounds:I,dataBounds:P,legend:L.legend})))))))))))))})),Mo=z.euiStyled.div`
  position: relative;
  flex: 1 1 auto;
`,Oo=z.euiStyled.div`
  padding: ${e=>`12px ${e.theme.eui.paddingSizes.m}`};
`,wo=e=>{const{shouldLoadDefault:t,currentView:a}=vt();return n.a.createElement(ko,ee()({shouldLoadDefault:t,currentView:a},e))};var jo=a(19);const So=()=>{const{viewState:e}=ys();return n.a.createElement(Ft,{viewState:e})},Co=({render:e})=>{const{sourceId:t}=Object(ce.b)(),{metric:a,groupBy:r,nodeType:n,accountId:i,region:s}=Object(Pa.d)(),{currentTime:l}=qt(),{filterQueryAsJson:o}=aa(),{loading:c,nodes:u,reload:d,interval:m}=Object(Ca.a)(o,[a],r,n,t,l,i,s,!1);return e({loading:c,nodes:u,reload:d,interval:m})},To=()=>{const{hasFailedLoadingSource:e,isLoading:t,loadSourceFailureMessage:a,loadSource:i,source:s,metricIndicesExist:l}=Object(r.useContext)(ce.a.Context);Object(de.useTrackPageview)({app:"infra_metrics",path:"inventory"}),Object(de.useTrackPageview)({app:"infra_metrics",path:"inventory",delay:15e3});const{source:o}=Object(Pa.d)();return fe([{text:ge.b}]),n.a.createElement(N.EuiErrorBoundary,null,n.a.createElement(te.a,{title:e=>R.i18n.translate("xpack.infra.infrastructureSnapshotPage.documentTitle",{defaultMessage:"{previousTitle} | Inventory",values:{previousTitle:e}})}),t&&!s?n.a.createElement(oa.a,null):l?n.a.createElement(n.a.Fragment,null,n.a.createElement(Fo,{className:jo.APP_WRAPPER_CLASS},n.a.createElement(Et,{shouldLoadDefault:"default"===o,viewType:"inventory-view",defaultViewState:hs},n.a.createElement(Ot,{hasData:l,pageHeader:{pageTitle:ge.b,rightSideItems:[n.a.createElement(So,null)]},pageBodyProps:{paddingSize:"none"}},n.a.createElement(Co,{render:({loading:e,nodes:t,reload:a,interval:r})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(na,{interval:r}),n.a.createElement(wo,{loading:e,nodes:t,reload:a,interval:r}))}))))):e?n.a.createElement(la,{errorMessage:a||"",retry:i}):n.a.createElement(Ot,{hasData:l,"data-test-subj":"noMetricsIndicesPrompt"}))},Fo=z.euiStyled.div`
  .euiPage .euiPageContentBody {
    display: flex;
    flex-direction: column;
    flex: 1 0 auto;
    width: 100%;
    height: 100%;
  }
`,Lo=b.intersection([b.type({timestamp:b.number}),b.partial({value:b.union([b.number,b.null])})]),Po=b.type({id:b.string,label:b.string,data:b.array(Lo)}),Io=b.intersection([b.partial({id:b.union([Sa.a,b.null])}),b.type({series:b.array(Po)})]),Do=b.type({metrics:b.array(Io)});b.intersection([b.type({nodeType:Sa.c,nodeId:b.string,metrics:b.array(Sa.a),timerange:Sl.a,sourceId:b.string}),b.partial({cloudId:b.union([b.string,b.null])})]);const _o=({loading:e,name:t,items:a})=>{const[i,s]=Object(r.useState)(!1),l=Object(r.useCallback)((()=>{s(!i)}),[i]),o=e?null:n.a.createElement(N.EuiSideNav,{items:a}),c=e?null:n.a.createElement(N.EuiSideNav,{items:a,mobileTitle:t,toggleOpenOnMobile:l,isOpenOnMobile:i});return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiHideFor,{sizes:["xs","s","m"]},n.a.createElement(N.EuiPageSideBar,{sticky:!0},o)),n.a.createElement(N.EuiShowFor,{sizes:["xs","s","m"]},n.a.createElement(N.EuiPageSideBar,null,c)))},Ro=e=>{const[t]=Object(We.a)(at.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),{onChangeTimeRange:a,onRefresh:i,currentTimeRange:s,isLiveStreaming:l,refreshInterval:o,setAutoReload:c,setRefreshInterval:u}=e,d=ct(t),m=Object(r.useCallback)((({start:e,end:t})=>{a({from:e,to:t,interval:">=1m"})}),[a]),p=Object(r.useCallback)((({isPaused:e,refreshInterval:t})=>{e?c(!1):(u(t),c(!0))}),[c,u]);return n.a.createElement(Ao,null,n.a.createElement(N.EuiSuperDatePicker,{start:s.from.toString(),end:s.to.toString(),isPaused:!l,refreshInterval:o||0,onTimeChange:m,onRefreshChange:p,onRefresh:i,commonlyUsedRanges:d}))},Ao=z.euiStyled.div`
  max-width: 750px;
`,Bo=n.a.createContext({items:[],addNavItem:e=>{}}),No=({children:e,metrics:t,navLabel:a,sectionLabel:i,onChangeRangeTime:s,isLiveStreaming:l,stopLiveStreaming:o})=>{const{addNavItem:c}=Object(r.useContext)(Bo),u=r.Children.toArray(e).reduce(((e,a)=>{var n;if(!Object(r.isValidElement)(a))return e;return null===(null!==(n=null==t?void 0:t.find((e=>e.id===a.props.id)))&&void 0!==n?n:null)?e:a.props.label?[...e,{id:a.props.id,name:a.props.label,onClick:()=>{const e=document.getElementById(a.props.id);e&&e.scrollIntoView()}}]:e}),[]),d=r.Children.map(e,(e=>Object(r.isValidElement)(e)?Object(r.cloneElement)(e,{metrics:t,onChangeRangeTime:s,isLiveStreaming:l,stopLiveStreaming:o}):null));return t&&u.length?(c({id:a,name:a,items:u}),n.a.createElement("div",null,n.a.createElement(N.EuiTitle,null,n.a.createElement("h1",null,i)),d)):null},Vo=({id:e,label:t,children:a,metrics:i,onChangeRangeTime:s,isLiveStreaming:l,stopLiveStreaming:o})=>{const c=Object(r.useMemo)((()=>null==i?void 0:i.find((t=>t.id===e))),[e,i]);if(!a||!c)return null;const u=r.Children.map(a,(t=>Object(r.isValidElement)(t)?Object(r.cloneElement)(t,{metric:c,id:e,onChangeRangeTime:s,isLiveStreaming:l,stopLiveStreaming:o}):null));return n.a.createElement("div",{style:{margin:"10px 0 16px 0"},id:e},t?n.a.createElement(N.EuiTitle,{size:"s"},n.a.createElement("h4",null,t)):null,u)};var zo=a(283),$o=a.n(zo);const Uo=e=>e.data.length<2,Ho=(e,t,a)=>e?Object(ve.get)(e,[t,"name"],a):a,qo=(e,t)=>{const a=e?Object(ve.get)(e,[t,"color"]):null;if(!a)return null;return new $o.a(a).hex().toString()},Jo=(e,t,a)=>{if(!e||!t)return"line";const r=Object(ve.get)(e,[a,"type"]);return Sa.b.is(r)?r:Sa.b.is(t)?t:"line"},Go=({id:e,metric:t,seriesOverrides:a,formatter:r,formatterTemplate:i})=>t&&e?n.a.createElement(N.EuiPageContentBody,null,n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(Ko,null,t.series.map((t=>{const s=Object(ve.last)(t.data);if(!s)return null;const l=((e="number",t="{{value}}",a={},r)=>n=>{if(null==n)return"";const i=Object(ve.get)(a,[r,"formatter"],e),s=Object(ve.get)(a,[r,"formatterTemplate"],t);return Object(jr.b)(i,s)(n)})(r,i,a,t.id)(s.value||0),o=Ho(a,t.id,t.id),c=Object(ve.max)(t.data.map((e=>e.value||0))),u=Object(ve.get)(a,[t.id,"gaugeMax"],c);return n.a.createElement(N.EuiFlexItem,{key:`${e}-${t.id}`,style:{margin:"0.4rem"}},n.a.createElement(N.EuiPanel,{style:{minWidth:"160px"}},n.a.createElement(N.EuiText,{style:{textAlign:"right"},size:"s"},o),n.a.createElement(N.EuiTitle,{size:"s"},n.a.createElement("h1",{style:{textAlign:"right",whiteSpace:"nowrap"}},l)),n.a.createElement(N.EuiProgress,{value:s.value||0,max:u,size:"s",color:"primary"})))}))),n.a.createElement(N.EuiSpacer,{size:"m"})):null,Ko=z.euiStyled.div`
  display: flex;
  flex-flow: row wrap;
  justify-content: space-evenly;
`,Wo=e=>"bar"===e.type?n.a.createElement(Xo,e):n.a.createElement(Qo,e),Qo=({id:e,color:t,series:a,name:r,type:i,stack:s})=>{const l={area:{opacity:1,visible:"area"===i},line:{strokeWidth:"area"===i?1:2,visible:!0}};return n.a.createElement(Ee.AreaSeries,{id:e,name:r,xScaleType:Ee.ScaleType.Time,yScaleType:Ee.ScaleType.Linear,xAccessor:"timestamp",yAccessors:["value"],data:a.data,areaSeriesStyle:l,color:t||void 0,stackAccessors:s?["timestamp"]:void 0})},Xo=({id:e,color:t,series:a,name:r,stack:i})=>{const s={rectBorder:{stroke:t||void 0,strokeWidth:1,visible:!0},rect:{opacity:1}};return n.a.createElement(Ee.BarSeries,{id:e,name:r,xScaleType:Ee.ScaleType.Time,yScaleType:Ee.ScaleType.Linear,xAccessor:"timestamp",yAccessors:["value"],data:a.data,barSeriesStyle:s,color:t||void 0,stackAccessors:i?["timestamp"]:void 0})},Yo=({title:e,body:t})=>n.a.createElement(N.EuiEmptyPrompt,{iconType:"stats",title:n.a.createElement("h3",null,e),body:n.a.createElement("p",null,t)}),Zo=({id:e,onChangeRangeTime:t,metric:a,stopLiveStreaming:i,isLiveStreaming:s,formatter:l,formatterTemplate:o,stacked:c,seriesOverrides:u,type:d})=>{const m=Object(A.useUiSetting)("theme:darkMode"),[g]=Object(We.a)("dateFormat"),f=Object(r.useCallback)(((e="number",t="{{value}}")=>a=>null!=a?Object(jr.b)(e,t)(a):"")(l,o),[l,o]),b=Object(r.useMemo)((()=>null!=a?Object(Ee.niceTimeFormatter)((e=>{if(e.series.some(Uo))return[0,0];const t=e.series.reduce(((e,t)=>{const a=Object(ve.first)(t.data),r=Object(ve.last)(t.data);return e.concat([a&&a.timestamp||0,r&&r.timestamp||0])}),[]);return[Object(ve.min)(t),Object(ve.max)(t)]})(a)):void 0),[a]),h=Object(r.useCallback)((({x:e})=>{if(!e)return;const[a,r]=e;t&&(s&&i&&i(),t({from:p()(a).toISOString(),to:p()(r).toISOString(),interval:">=1m"}))}),[t,s,i]),y={headerFormatter:Object(r.useCallback)((e=>p()(e.value).format(g||"Y-MM-DD HH:mm:ss.SSS")),[g])};return e?a?a.series.some(Uo)?n.a.createElement(Yo,{title:R.i18n.translate("xpack.infra.chartSection.notEnoughDataPointsToRenderTitle",{defaultMessage:"Not Enough Data"}),body:R.i18n.translate("xpack.infra.chartSection.notEnoughDataPointsToRenderText",{defaultMessage:"Not enough data points to render chart, try increasing the time range."})}):n.a.createElement(N.EuiPageContentBody,null,n.a.createElement("div",{className:"infrastructureChart",style:{height:250,marginBottom:16}},n.a.createElement(Ee.Chart,null,n.a.createElement(Ee.Axis,{id:"timestamp",position:Ee.Position.Bottom,showOverlappingTicks:!0,tickFormat:b}),n.a.createElement(Ee.Axis,{id:"values",position:Ee.Position.Left,tickFormat:f}),a&&a.series.map((t=>n.a.createElement(Wo,{key:`series-${e}-${t.id}`,id:`series-${e}-${t.id}`,series:t,name:Ho(u,t.id,t.id),type:Jo(u,d,t.id),color:qo(u,t.id),stack:c}))),n.a.createElement(Ee.Settings,{tooltip:y,onBrushEnd:h,theme:Je(m),showLegend:!0,showLegendExtra:!0,legendPosition:"right"})))):n.a.createElement(Yo,{title:R.i18n.translate("xpack.infra.chartSection.missingMetricDataText",{defaultMessage:"Missing Data"}),body:R.i18n.translate("xpack.infra.chartSection.missingMetricDataBody",{defaultMessage:"The data for this chart is missing."})}):null},ec=Object(z.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(No,{navLabel:"AWS",sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"AWS Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"awsOverview"},n.a.createElement(Go,{seriesOverrides:{"cpu-util":{name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.cpuUtilizationSeriesLabel",{defaultMessage:"CPU Utilization"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},"status-check-failed":{name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.statusCheckFailedLabel",{defaultMessage:"Status check failed"}),color:a.eui.euiColorFullShade},"packets-in":{name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.networkPacketsInLabel",{defaultMessage:"Packets (in)"}),color:a.eui.euiColorFullShade,formatter:"number"},"packets-out":{name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.networkPacketsOutLabel",{defaultMessage:"Packets (out)"}),color:a.eui.euiColorFullShade,formatter:"number"}}})),n.a.createElement(Vo,{id:"awsCpuUtilization",label:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.cpuUtilSection.sectionLabel",{defaultMessage:"CPU Utilization"})},n.a.createElement(Zo,{type:"area",formatter:"number",seriesOverrides:{"cpu-util":{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.cpuUtilSection.percentSeriesLabel",{defaultMessage:"percent"})}}})),n.a.createElement(Vo,{id:"awsNetworkBytes",label:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkBytesSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(Zo,{type:"area",formatter:"bits",formatterTemplate:"{{value}}/s",seriesOverrides:{tx:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkBytesSection.txSeriesLabel",{defaultMessage:"out"})},rx:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkBytesSection.rxSeriesLabel",{defaultMessage:"in"})}}})),n.a.createElement(Vo,{id:"awsNetworkPackets",label:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkPacketsSection.sectionLabel",{defaultMessage:"Network Packets (Average)"})},n.a.createElement(Zo,{type:"area",formatter:"number",seriesOverrides:{"packets-out":{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkPacketsSection.packetsOutSeriesLabel",{defaultMessage:"out"})},"packets-in":{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkPacketsSection.packetsInSeriesLabel",{defaultMessage:"in"})}}})),n.a.createElement(Vo,{id:"awsDiskioOps",label:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioOperationsSection.sectionLabel",{defaultMessage:"Disk I/O Operations"})},n.a.createElement(Zo,{type:"area",formatter:"number",seriesOverrides:{writes:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioOperationsSection.writesSeriesLabel",{defaultMessage:"writes"})},reads:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioOperationsSection.readsSeriesLabel",{defaultMessage:"reads"})}}})),n.a.createElement(Vo,{id:"awsDiskioBytes",label:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioBytesSection.sectionLabel",{defaultMessage:"Disk I/O Bytes"})},n.a.createElement(Zo,{type:"area",formatter:"number",seriesOverrides:{writes:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioBytesSection.writesSeriesLabel",{defaultMessage:"writes"})},reads:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioBytesSection.readsSeriesLabel",{defaultMessage:"reads"})}}})))))),tc=Object(z.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(No,{navLabel:"Nginx",sectionLabel:"Nginx",metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"nginxHits",label:R.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.hitsSection.sectionLabel",{defaultMessage:"Hits"})},n.a.createElement(Zo,{stacked:!0,type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{"200s":{color:a.eui.euiColorVis1},"300s":{color:a.eui.euiColorVis5},"400s":{color:a.eui.euiColorVis2},"500s":{color:a.eui.euiColorVis9}}})),n.a.createElement(Vo,{id:"nginxRequestRate",label:R.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.requestRateSection.sectionLabel",{defaultMessage:"Request Rate"})},n.a.createElement(Zo,{type:"area",formatter:"abbreviatedNumber",formatterTemplate:"{{value}}/s",seriesOverrides:{rate:{color:a.eui.euiColorVis1}}})),n.a.createElement(Vo,{id:"nginxActiveConnections",label:R.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.activeConnectionsSection.sectionLabel",{defaultMessage:"Active Connections"})},n.a.createElement(Zo,{type:"area",formatter:"abbreviatedNumber",seriesOverrides:{connections:{color:a.eui.euiColorVis1,type:"bar"}}})),n.a.createElement(Vo,{id:"nginxRequestsPerConnection",label:R.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.requestsPerConnectionsSection.sectionLabel",{defaultMessage:"Requests per Connections"})},n.a.createElement(Zo,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{reqPerConns:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.requestsPerConnectionsSection.reqsPerConnSeriesLabel",{defaultMessage:"reqs per conn"})}}})))))),ac=n.a.createContext(null),rc=[{field:"cloud.instance.id",label:R.i18n.translate("xpack.infra.nodeDetails.labels.instanceId",{defaultMessage:"Instance ID"})},{field:"cloud.provider",label:R.i18n.translate("xpack.infra.nodeDetails.labels.cloudProvider",{defaultMessage:"Cloud Provider"})},{field:"host.os.name",label:R.i18n.translate("xpack.infra.nodeDetails.labels.operatinSystem",{defaultMessage:"Operating System"})},{field:"host.os.kernel",label:R.i18n.translate("xpack.infra.nodeDetails.labels.kernelVersion",{defaultMessage:"Kernel Version"})},{field:"host.hostname",label:R.i18n.translate("xpack.infra.nodeDetails.labels.hostname",{defaultMessage:"Hostname"})},{field:"host.containerized",label:R.i18n.translate("xpack.infra.nodeDetails.labels.containerized",{defaultMessage:"Containerized"}),isBoolean:!0},{field:"cloud.project.id",label:R.i18n.translate("xpack.infra.nodeDetails.labels.projectId",{defaultMessage:"Project ID"})},{field:"cloud.availability_zone",label:R.i18n.translate("xpack.infra.nodeDetails.labels.availabilityZone",{defaultMessage:"Availability Zone"})},{field:"cloud.machine.type",label:R.i18n.translate("xpack.infra.nodeDetails.labels.machineType",{defaultMessage:"Machine Type"})},{field:"cloud.instance.name",label:R.i18n.translate("xpack.infra.nodeDetails.labels.instanceName",{defaultMessage:"Instance Name"})}],nc=e=>{const[t,a]=Object(r.useState)(!1),i=Object(r.useCallback)((()=>a(!t)),[t]),s=Object(r.useMemo)((()=>e.fields&&e.fields.length?e.fields.map((e=>{const t=rc.find((t=>t.field===e));if(t)return t})).filter((e=>e)):rc),[e.fields]),l=Object(r.useMemo)((()=>t?s:s.slice(0,4)),[s,t]),o=Object(r.useContext)(ac);return o?n.a.createElement(ic,null,s.length>4?n.a.createElement(sc,null,n.a.createElement(N.EuiButtonIcon,{iconType:t?"arrowUp":"arrowDown",onClick:i,"aria-label":R.i18n.translate("xpack.infra.nodeDetails.labels.showMoreDetails",{defaultMessage:"Show more details"})})):null,n.a.createElement(N.EuiFlexGrid,{columns:4,style:{flexGrow:1},gutterSize:"s"},l.map((e=>n.a.createElement(N.EuiFlexItem,{key:e.field,style:{minWidth:0}},n.a.createElement(N.EuiTitle,{size:"xs"},n.a.createElement("h5",null,(({field:e})=>{const t=rc.find((t=>t.field===e));return t?t.label:e})(e))),n.a.createElement(N.EuiText,null,((e,{field:t,isBoolean:a})=>a?Object(ve.get)(e.info,t,!1)?R.i18n.translate("xpack.infra.nodeDetails.yes",{defaultMessage:"Yes"}):R.i18n.translate("xpack.infra.nodeDetails.no",{defaultMessage:"No"}):Object(ve.get)(e.info,t,"--"))(o,e))))))):null},ic=z.euiStyled.div`
border-top: ${e=>e.theme.eui.euiBorderWidthThin} solid ${e=>e.theme.eui.euiBorderColor};
border-bottom: ${e=>e.theme.eui.euiBorderWidthThin} solid ${e=>e.theme.eui.euiBorderColor};
padding: ${e=>e.theme.eui.paddingSizes.m} 0;
margin-bottom: ${e=>e.theme.eui.paddingSizes.m};
display: flex;
`,sc=z.euiStyled.div`
flex-grow: 0;
margin-right: ${e=>e.theme.eui.paddingSizes.m};
min-width: 0px;
`,lc=Object(z.euiStyled)(N.EuiPageContent)`
  position: relative;
`,oc={host:Object(z.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(nc,{fields:["host.hostname","host.os.name","host.os.kernel","host.containerized","cloud.provider","cloud.availability_zone","cloud.machine.type","cloud.project.id","cloud.instance.id","cloud.instance.name"]}),n.a.createElement(lc,null,n.a.createElement(No,{navLabel:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.layoutLabel",{defaultMessage:"Host"}),sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Host Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"hostSystemOverview"},n.a.createElement(Go,{seriesOverrides:{cpu:{name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},load:{name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.loadSeriesLabel",{defaultMessage:"Load (5m)"}),color:a.eui.euiColorFullShade},memory:{name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.memoryCapacitySeriesLabel",{defaultMessage:"Memory Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},rx:{name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.inboundRXSeriesLabel",{defaultMessage:"Inbound (RX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"},tx:{name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.outboundTXSeriesLabel",{defaultMessage:"Outbound (TX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"}}})),n.a.createElement(Vo,{id:"hostCpuUsage",label:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(Zo,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{user:{color:a.eui.euiColorVis0},system:{color:a.eui.euiColorVis2},steal:{color:a.eui.euiColorVis9},irq:{color:a.eui.euiColorVis4},softirq:{color:a.eui.euiColorVis6},iowait:{color:a.eui.euiColorVis7},nice:{color:a.eui.euiColorVis5}}})),n.a.createElement(Vo,{id:"hostLoad",label:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.loadSection.sectionLabel",{defaultMessage:"Load"})},n.a.createElement(Zo,{seriesOverrides:{load_1m:{color:a.eui.euiColorVis0,name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.loadSection.oneMinuteSeriesLabel",{defaultMessage:"1m"})},load_5m:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.loadSection.fiveMinuteSeriesLabel",{defaultMessage:"5m"})},load_15m:{color:a.eui.euiColorVis3,name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.loadSection.fifteenMinuteSeriesLabel",{defaultMessage:"15m"})}}})),n.a.createElement(Vo,{id:"hostMemoryUsage",label:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.memoryUsageSection.sectionLabel",{defaultMessage:"Memory Usage"})},n.a.createElement(Zo,{stacked:!0,formatter:"bytes",type:"area",seriesOverrides:{used:{color:a.eui.euiColorVis2},free:{color:a.eui.euiColorVis0},cache:{color:a.eui.euiColorVis1}}})),n.a.createElement(Vo,{id:"hostNetworkTraffic",label:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(Zo,{formatter:"bits",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{rx:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.networkRxRateSeriesLabel",{defaultMessage:"in"})},tx:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.networkTxRateSeriesLabel",{defaultMessage:"out"})}}}))),n.a.createElement(No,{navLabel:"Kubernetes",sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Kubernetes Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"hostK8sOverview"},n.a.createElement(Go,{seriesOverrides:{cpucap:{name:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Capacity"}),color:"secondary",formatter:"percent",gaugeMax:1},load:{name:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.loadSeriesLabel",{defaultMessage:"Load (5m)"}),color:"secondary"},memorycap:{name:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.memoryUsageSeriesLabel",{defaultMessage:"Memory Capacity"}),color:"secondary",formatter:"percent",gaugeMax:1},podcap:{name:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.podCapacitySeriesLabel",{defaultMessage:"Pod Capacity"}),color:"secondary",formatter:"percent",gaugeMax:1},diskcap:{name:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.diskCapacitySeriesLabel",{defaultMessage:"Disk Capacity"}),color:"secondary",formatter:"percent",gaugeMax:1}}})),n.a.createElement(Vo,{id:"hostK8sCpuCap",label:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.nodeCpuCapacitySection.sectionLabel",{defaultMessage:"Node CPU Capacity"})},n.a.createElement(Zo,{formatter:"abbreviatedNumber",seriesOverrides:{capacity:{color:a.eui.euiColorVis2},used:{color:a.eui.euiColorVis1,type:"area"}}})),n.a.createElement(Vo,{id:"hostK8sMemoryCap",label:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.nodeMemoryCapacitySection.sectionLabel",{defaultMessage:"Node Memory Capacity"})},n.a.createElement(Zo,{formatter:"bytes",seriesOverrides:{capacity:{color:a.eui.euiColorVis2},used:{color:a.eui.euiColorVis1,type:"area"}}})),n.a.createElement(Vo,{id:"hostK8sDiskCap",label:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.nodeDiskCapacitySection.sectionLabel",{defaultMessage:"Node Disk Capacity"})},n.a.createElement(Zo,{formatter:"bytes",seriesOverrides:{capacity:{color:a.eui.euiColorVis2},used:{color:a.eui.euiColorVis1,type:"area"}}})),n.a.createElement(Vo,{id:"hostK8sPodCap",label:R.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.nodePodCapacitySection.sectionLabel",{defaultMessage:"Node Pod Capacity"})},n.a.createElement(Zo,{formatter:"number",seriesOverrides:{capacity:{color:a.eui.euiColorVis2},used:{color:a.eui.euiColorVis1,type:"area"}}}))),n.a.createElement(ec,{metrics:e,onChangeRangeTime:t}),n.a.createElement(tc,{metrics:e,onChangeRangeTime:t}))))),pod:Object(z.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(nc,null),n.a.createElement(lc,null,n.a.createElement(No,{navLabel:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.layoutLabel",{defaultMessage:"Pod"}),sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Pod Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"podOverview"},n.a.createElement(Go,{seriesOverrides:{cpu:{name:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},memory:{name:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.memoryUsageSeriesLabel",{defaultMessage:"Memory Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},rx:{name:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.inboundRXSeriesLabel",{defaultMessage:"Inbound (RX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"},tx:{name:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.outboundTXSeriesLabel",{defaultMessage:"Outbound (TX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"}}})),n.a.createElement(Vo,{id:"podCpuUsage",label:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(Zo,{formatter:"percent",type:"area",seriesOverrides:{cpu:{color:a.eui.euiColorVis1}}})),n.a.createElement(Vo,{id:"podMemoryUsage",label:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.memoryUsageSection.sectionLabel",{defaultMessage:"Memory Usage"})},n.a.createElement(Zo,{type:"area",formatter:"percent",seriesOverrides:{memory:{color:a.eui.euiColorVis1}}})),n.a.createElement(Vo,{id:"podNetworkTraffic",label:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.networkTrafficSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(Zo,{formatter:"bits",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{rx:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.networkTrafficSection.networkRxRateSeriesLabel",{defaultMessage:"in"})},tx:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.networkTrafficSection.networkTxRateSeriesLabel",{defaultMessage:"out"})}}}))),n.a.createElement(tc,{metrics:e,onChangeRangeTime:t}))))),container:Object(z.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(nc,null),n.a.createElement(lc,null,n.a.createElement(No,{navLabel:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.layoutLabel",{defaultMessage:"Container"}),sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Container Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"containerOverview"},n.a.createElement(Go,{seriesOverrides:{cpu:{name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},memory:{name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.memoryUsageSeriesLabel",{defaultMessage:"Memory Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},rx:{name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.inboundRXSeriesLabel",{defaultMessage:"Inbound (RX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"},tx:{name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.outboundTXSeriesLabel",{defaultMessage:"Outbound (TX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"}}})),n.a.createElement(Vo,{id:"containerCpuUsage",label:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(Zo,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{cpu:{color:a.eui.euiColorVis1}}})),n.a.createElement(Vo,{id:"containerMemory",label:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.memoryUsageSection.sectionLabel",{defaultMessage:"Memory Usage"})},n.a.createElement(Zo,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{memory:{color:a.eui.euiColorVis1}}})),n.a.createElement(Vo,{id:"containerNetworkTraffic",label:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.networkTrafficSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(Zo,{formatter:"bits",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{rx:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.networkTrafficSection.networkRxRateSeriesLabel",{defaultMessage:"in"})},tx:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.networkTrafficSection.networkTxRateSeriesLabel",{defaultMessage:"out"})}}})),n.a.createElement(Vo,{id:"containerDiskIOOps",label:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoOpsSection.sectionLabel",{defaultMessage:"Disk IO (Ops)"})},n.a.createElement(Zo,{type:"area",formatterTemplate:"{{value}}/s",formatter:"number",seriesOverrides:{read:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoOpsSection.readRateSeriesLabel",{defaultMessage:"reads"})},write:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoOpsSection.writeRateSeriesLabel",{defaultMessage:"writes"})}}})),n.a.createElement(Vo,{id:"containerDiskIOBytes",label:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoBytesSection.sectionLabel",{defaultMessage:"Disk IO (Bytes)"})},n.a.createElement(Zo,{type:"area",formatter:"bytes",formatterTemplate:"{{value}}/s",seriesOverrides:{read:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoBytesSection.readRateSeriesLabel",{defaultMessage:"reads"})},write:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoBytesSection.writeRateSeriesLabel",{defaultMessage:"writes"})}}}))))))),awsEC2:Object(z.withTheme)((({metrics:e,theme:t,onChangeRangeTime:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(nc,{fields:["cloud.instance.id","cloud.provider","cloud.availability_zone","cloud.machine.type","cloud.instance.name","cloud.project.id"]}),n.a.createElement(lc,null,n.a.createElement(No,{navLabel:"AWS EC2",sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Aws EC2 Overview"}),metrics:e,onChangeRangeTime:a},n.a.createElement(Vo,{id:"awsEC2CpuUtilization",label:R.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(Zo,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{total:{color:t.eui.euiColorVis1}}})),n.a.createElement(Vo,{id:"awsEC2NetworkTraffic",label:R.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.networkTrafficSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(Zo,{formatter:"bits",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{rx:{color:t.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.networkRxRateSeriesLabel",{defaultMessage:"in"})},tx:{color:t.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.networkTxRateSeriesLabel",{defaultMessage:"out"})}}})),n.a.createElement(Vo,{id:"awsEC2DiskIOBytes",label:R.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.diskIOBytesSection.sectionLabel",{defaultMessage:"Disk IO (Bytes)"})},n.a.createElement(Zo,{formatter:"bytes",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{write:{color:t.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.diskIOBytesSection.writeLabel",{defaultMessage:"writes"})},read:{color:t.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.diskIOBytesSection.readLabel",{defaultMessage:"reads"})}}}))))))),awsS3:Object(z.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(lc,null,n.a.createElement(No,{navLabel:"AWS S3",sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Aws S3 Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"awsS3BucketSize",label:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.bucketSize.sectionLabel",{defaultMessage:"Bucket Size"})},n.a.createElement(Zo,{type:"bar",formatter:"bytes",seriesOverrides:{bytes:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.bucketSize.chartLabel",{defaultMessage:"Total Bytes"})}}})),n.a.createElement(Vo,{id:"awsS3NumberOfObjects",label:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.numberOfObjects.sectionLabel",{defaultMessage:"Number of Objects"})},n.a.createElement(Zo,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{objects:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.numberOfObjects.chartLabel",{defaultMessage:"Objects"})}}})),n.a.createElement(Vo,{id:"awsS3TotalRequests",label:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.totalRequests.sectionLabel",{defaultMessage:"Total Requests"})},n.a.createElement(Zo,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{total:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.totalRequests.chartLabel",{defaultMessage:"Requests"})}}})),n.a.createElement(Vo,{id:"awsS3DownloadBytes",label:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.downloadBytes.sectionLabel",{defaultMessage:"Downloaded Bytes"})},n.a.createElement(Zo,{type:"bar",formatter:"bytes",seriesOverrides:{bytes:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.downloadBytes.chartLabel",{defaultMessage:"Bytes"})}}})),n.a.createElement(Vo,{id:"awsS3UploadBytes",label:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.uploadBytes.sectionLabel",{defaultMessage:"Uploaded Bytes"})},n.a.createElement(Zo,{type:"bar",formatter:"bytes",seriesOverrides:{bytes:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.uploadBytes.chartLabel",{defaultMessage:"Bytes"})}}}))))))),awsRDS:Object(z.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(lc,null,n.a.createElement(No,{navLabel:"AWS RDS",sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Aws RDS Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"awsRDSCpuTotal",label:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.cpuTotal.sectionLabel",{defaultMessage:"Total CPU Usage"})},n.a.createElement(Zo,{type:"area",formatter:"percent",seriesOverrides:{cpu:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.cpuTotal.chartLabel",{defaultMessage:"Total"})}}})),n.a.createElement(Vo,{id:"awsRDSConnections",label:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.connections.sectionLabel",{defaultMessage:"Connections"})},n.a.createElement(Zo,{type:"bar",formatter:"number",seriesOverrides:{connections:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.connections.chartLabel",{defaultMessage:"Connections"})}}})),n.a.createElement(Vo,{id:"awsRDSQueriesExecuted",label:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.queriesExecuted.sectionLabel",{defaultMessage:"Queries Executed"})},n.a.createElement(Zo,{type:"bar",formatter:"number",seriesOverrides:{queries:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.queriesExecuted.chartLabel",{defaultMessage:"Queries"})}}})),n.a.createElement(Vo,{id:"awsRDSActiveTransactions",label:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.activeTransactions.sectionLabel",{defaultMessage:"Transactions"})},n.a.createElement(Zo,{type:"bar",formatter:"number",seriesOverrides:{active:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.active.chartLabel",{defaultMessage:"Active"})},blocked:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.blocked.chartLabel",{defaultMessage:"Blocked"})}}})),n.a.createElement(Vo,{id:"awsRDSLatency",label:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.sectionLabel",{defaultMessage:"Latency"})},n.a.createElement(Zo,{type:"bar",stacked:!0,formatter:"highPercision",formatterTemplate:"{{value}} ms",seriesOverrides:{read:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.read.chartLabel",{defaultMessage:"Read"})},write:{color:a.eui.euiColorVis2,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.write.chartLabel",{defaultMessage:"Write"})},insert:{color:a.eui.euiColorVis0,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.insert.chartLabel",{defaultMessage:"Insert"})},update:{color:a.eui.euiColorVis7,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.update.chartLabel",{defaultMessage:"Update"})},commit:{color:a.eui.euiColorVis3,name:R.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.commit.chartLabel",{defaultMessage:"Commit"})}}}))))))),awsSQS:Object(z.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(lc,null,n.a.createElement(No,{navLabel:"AWS SQS",sectionLabel:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Aws SQS Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(Vo,{id:"awsSQSMessagesVisible",label:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesVisible.sectionLabel",{defaultMessage:"Messages Available"})},n.a.createElement(Zo,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{visible:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesVisible.chartLabel",{defaultMessage:"Available"})}}})),n.a.createElement(Vo,{id:"awsSQSMessagesDelayed",label:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesDelayed.sectionLabel",{defaultMessage:"Messages Delayed"})},n.a.createElement(Zo,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{delayed:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesDelayed.chartLabel",{defaultMessage:"Delayed"})}}})),n.a.createElement(Vo,{id:"awsSQSMessagesSent",label:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesSent.sectionLabel",{defaultMessage:"Messages Added"})},n.a.createElement(Zo,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{sent:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesSent.chartLabel",{defaultMessage:"Added"})}}})),n.a.createElement(Vo,{id:"awsSQSMessagesEmpty",label:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesEmpty.sectionLabel",{defaultMessage:"Messages Empty"})},n.a.createElement(Zo,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{sent:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesEmpty.chartLabel",{defaultMessage:"Empty"})}}})),n.a.createElement(Vo,{id:"awsSQSOldestMessage",label:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.oldestMessage.sectionLabel",{defaultMessage:"Oldest Message"})},n.a.createElement(Zo,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{oldest:{color:a.eui.euiColorVis1,name:R.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.oldestMessage.chartLabel",{defaultMessage:"Age"})}}})))))))},cc=({loading:e,refetch:t,type:a,metrics:r,onChangeRangeTime:i,isLiveStreaming:s,stopLiveStreaming:l})=>{if(e)return n.a.createElement(he.a,{height:"100vh",width:"auto",text:R.i18n.translate("xpack.infra.metrics.loadingNodeDataText",{defaultMessage:"Loading data"})});if(!e&&r&&0===r.length)return n.a.createElement(be.a,{titleText:R.i18n.translate("xpack.infra.metrics.emptyViewTitle",{defaultMessage:"There is no data to display."}),bodyText:R.i18n.translate("xpack.infra.metrics.emptyViewDescription",{defaultMessage:"Try adjusting your time or filter."}),refetchText:R.i18n.translate("xpack.infra.metrics.refetchButtonLabel",{defaultMessage:"Check for new data"}),onRefetch:t,testString:"metricsEmptyViewState"});const o=(e=>{const t=null==oc?void 0:oc[e];if(!t)throw new Error(R.i18n.translate("xpack.infra.inventoryModels.findLayout.error",{defaultMessage:"The layout you've attempted to find does not exist"}));return t})(a);return n.a.createElement(o,{metrics:r,onChangeRangeTime:i,isLiveStreaming:s,stopLiveStreaming:l})},uc=({"data-test-subj":e,app:t,children:a})=>{const r=Object(Ve.b)({app:t,pathname:"/settings"});return n.a.createElement(N.EuiButton,ee()({"data-test-subj":e,color:"primary"},r),a)},dc=({nodeName:e})=>{const t=Object(Ve.b)({app:"integrations",hash:"/browse"});return n.a.createElement(mc,{title:n.a.createElement("h2",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metrics.invalidNodeErrorTitle",defaultMessage:"Looks like {nodeName} isn't collecting any metrics data",values:{nodeName:e}})),body:n.a.createElement("p",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.metrics.invalidNodeErrorDescription",defaultMessage:"Double check your configuration"})),actions:n.a.createElement(N.EuiFlexGroup,null,n.a.createElement(N.EuiFlexItem,null,n.a.createElement(N.EuiButton,ee()({},t,{color:"primary",fill:!0}),n.a.createElement(V.FormattedMessage,{id:"xpack.infra.homePage.noMetricsIndicesInstructionsActionLabel",defaultMessage:"View setup instructions"}))),n.a.createElement(N.EuiFlexItem,null,n.a.createElement(uc,{app:"metrics","data-test-subj":"configureSourceButton"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.configureSourceActionLabel",defaultMessage:"Change source configuration"}))))})},mc=Object(z.euiStyled)(N.EuiEmptyPrompt)`
  align-self: center;
`,pc=({error:e,name:t})=>{var a;return n.a.createElement(n.a.Fragment,null,n.a.createElement(te.a,{title:e=>R.i18n.translate("xpack.infra.metricDetailPage.documentTitleError",{defaultMessage:"{previousTitle} | Uh oh",values:{previousTitle:e}})}),404===(null===(a=e.body)||void 0===a?void 0:a.statusCode)?n.a.createElement(dc,{nodeName:t}):n.a.createElement(q,{message:e.message}))},gc=e=>{const t=f.a.parse(e.from.toString()),a=f.a.parse(e.to.toString(),{roundUp:!0});return{...e,from:t&&t.valueOf()||p()().subtract(1,"hour").valueOf(),to:a&&a.valueOf()||p()().valueOf()}},fc=e=>{const{metricIndicesExist:t}=Object(r.useContext)(ce.a.Context),[a,i]=Object(r.useState)(gc(e.timeRange)),{metrics:s,loading:l,makeRequest:o,error:c}=function(e,t,a,r,n,i){const{error:s,loading:l,response:o,makeRequest:c}=Object(br.a)("/api/metrics/node_details","POST",JSON.stringify({metrics:e,nodeId:t,nodeType:a,timerange:n,cloudId:i,sourceId:r}),(e=>Object(h.pipe)(Do.decode(e),Object(y.fold)(Object(fr.c)(fr.a),E.identity))));return{error:s,loading:l,metrics:o?o.metrics:[],makeRequest:c}}(e.requiredMetrics,e.nodeId,e.nodeType,e.sourceId,a,e.cloudId),u=Object(r.useCallback)((()=>{i(gc(e.timeRange))}),[e.timeRange]);return Object(r.useEffect)((()=>{i(gc(e.timeRange))}),[e.timeRange]),Object(r.useEffect)((()=>{o()}),[o,a]),c?n.a.createElement(pc,{error:c,name:e.name}):n.a.createElement(Ot,{hasData:t,pageHeader:{pageTitle:e.name,rightSideItems:[n.a.createElement(Ro,{currentTimeRange:e.timeRange,isLiveStreaming:e.isAutoReloading,refreshInterval:e.refreshInterval,setRefreshInterval:e.setRefreshInterval,onChangeTimeRange:e.setTimeRange,setAutoReload:e.setAutoReload,onRefresh:u})]}},n.a.createElement(N.EuiFlexGroup,null,n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(_o,{loading:e.metadataLoading,name:e.name,items:e.sideNav})),n.a.createElement(N.EuiFlexItem,null,n.a.createElement(Bo.Provider,{value:{items:e.sideNav,addNavItem:e.addNavItem}},n.a.createElement(ac.Provider,{value:e.metadata},n.a.createElement(cc,{loading:!(s.length>0&&e.isAutoReloading)&&l,refetch:u,type:e.nodeType,metrics:s,onChangeRangeTime:e.setTimeRange,isLiveStreaming:e.isAutoReloading,stopLiveStreaming:()=>e.setAutoReload(!1)}))))))},bc=(hc=Object(z.withTheme)((({match:e})=>{const t=e.params.node,a=e.params.type,i=Object(Q.b)(a),{sourceId:s,metricIndicesExist:l}=Object(r.useContext)(ce.a.Context),{timeRange:o,parsedTimeRange:c,setTimeRange:u,refreshInterval:d,setRefreshInterval:m,isAutoReloading:p,setAutoReload:g,triggerRefresh:f}=P(),{name:b,filteredRequiredMetrics:h,loading:y,cloudId:E,metadata:v}=Zr(t,a,i.requiredMetrics,s,c),[x,k]=Object(r.useState)([]),M=n.a.useCallback((e=>{x.some((t=>t.id===e.id))||k([e,...x])}),[x]),O=Object(Ve.b)({app:"metrics",pathname:"/inventory"});return fe([{...O,text:ge.b},{text:b}]),y&&!h.length?n.a.createElement(Ot,{hasData:l},n.a.createElement(he.a,{height:"100vh",width:"100%",text:R.i18n.translate("xpack.infra.metrics.loadingNodeDataText",{defaultMessage:"Loading data"})})):n.a.createElement(n.a.Fragment,null,n.a.createElement(te.a,{title:R.i18n.translate("xpack.infra.metricDetailPage.documentTitle",{defaultMessage:"Infrastructure | Metrics | {name}",values:{name:b}})}),v?n.a.createElement(fc,{name:b,requiredMetrics:h,sourceId:s,timeRange:o,nodeType:a,nodeId:t,cloudId:E,metadataLoading:y,isAutoReloading:p,refreshInterval:d,sideNav:x,metadata:v,addNavItem:M,setRefreshInterval:m,setAutoReload:g,triggerRefresh:f,setTimeRange:u}):null)})),e=>n.a.createElement(N.EuiErrorBoundary,null,n.a.createElement(ce.a.Provider,{sourceId:"default"},n.a.createElement(L,null,n.a.createElement(hc,e)))));var hc,yc=a(29);const Ec=({containerFieldProps:e,hostFieldProps:t,isLoading:a,readOnly:r,podFieldProps:i,timestampFieldProps:s})=>{const l="host.name"===t.value,o="container.id"===e.value,c="kubernetes.pod.uid"===i.value,u="@timestamp"===s.value;return n.a.createElement(N.EuiForm,null,n.a.createElement(N.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.fieldsSectionTitle",defaultMessage:"Fields"}))),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiCallOut,{title:R.i18n.translate("xpack.infra.sourceConfiguration.deprecationNotice",{defaultMessage:"Deprecation Notice"}),color:"warning",iconType:"help"},n.a.createElement("p",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.deprecationMessage",defaultMessage:"Configuring these fields have been deprecated and will be removed in 8.0.0. This application is designed to work with {ecsLink}, you should adjust your indexing to use the {documentationLink}.",values:{documentationLink:n.a.createElement(N.EuiLink,{href:"https://www.elastic.co/guide/en/infrastructure/guide/7.4/infrastructure-metrics.html",target:"BLANK"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.documentedFields",defaultMessage:"documented fields"})),ecsLink:n.a.createElement(N.EuiLink,{href:"https://www.elastic.co/guide/en/ecs/current/index.html",target:"BLANK"},"ECS")}}))),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.timestampFieldLabel",defaultMessage:"Timestamp"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.timestampFieldDescription",defaultMessage:"Timestamp used to sort log entries"})},n.a.createElement(N.EuiFormRow,{error:s.error,fullWidth:!0,helpText:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.timestampFieldRecommendedValue",defaultMessage:"The recommended value is {defaultValue}",values:{defaultValue:n.a.createElement(N.EuiCode,null,"@timestamp")}}),isInvalid:s.isInvalid,label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.timestampFieldLabel",defaultMessage:"Timestamp"})},n.a.createElement(N.EuiFieldText,ee()({fullWidth:!0,disabled:a||u,readOnly:r,isLoading:a},s)))),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.containerFieldLabel",defaultMessage:"Container ID"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.containerFieldDescription",defaultMessage:"Field used to identify Docker containers"})},n.a.createElement(N.EuiFormRow,{error:e.error,fullWidth:!0,helpText:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.containerFieldRecommendedValue",defaultMessage:"The recommended value is {defaultValue}",values:{defaultValue:n.a.createElement(N.EuiCode,null,"container.id")}}),isInvalid:e.isInvalid,label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.containerFieldLabel",defaultMessage:"Container ID"})},n.a.createElement(N.EuiFieldText,ee()({fullWidth:!0,disabled:a||o,readOnly:r,isLoading:a},e)))),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.hostNameFieldLabel",defaultMessage:"Host name"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.hostNameFieldDescription",defaultMessage:"Field used to identify hosts"})},n.a.createElement(N.EuiFormRow,{error:t.error,fullWidth:!0,helpText:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.hostFieldDescription",defaultMessage:"The recommended value is {defaultValue}",values:{defaultValue:n.a.createElement(N.EuiCode,null,"host.name")}}),isInvalid:t.isInvalid,label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.hostFieldLabel",defaultMessage:"Host name"})},n.a.createElement(N.EuiFieldText,ee()({fullWidth:!0,disabled:a||l,readOnly:r,isLoading:a},t)))),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.podFieldLabel",defaultMessage:"Pod ID"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.podFieldDescription",defaultMessage:"Field used to identify Kubernetes pods"})},n.a.createElement(N.EuiFormRow,{error:i.error,fullWidth:!0,helpText:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.podFieldRecommendedValue",defaultMessage:"The recommended value is {defaultValue}",values:{defaultValue:n.a.createElement(N.EuiCode,null,"kubernetes.pod.uid")}}),isInvalid:i.isInvalid,label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.podFieldLabel",defaultMessage:"Pod ID"})},n.a.createElement(N.EuiFieldText,ee()({fullWidth:!0,disabled:a||c,readOnly:r,isLoading:a},i)))))},vc=({isLoading:e,readOnly:t,metricAliasFieldProps:a})=>n.a.createElement(N.EuiForm,null,n.a.createElement(N.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.indicesSectionTitle",defaultMessage:"Indices"}))),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.metricIndicesTitle",defaultMessage:"Metrics indices"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.metricIndicesDescription",defaultMessage:"Index pattern for matching indices that contain metrics data"})},n.a.createElement(N.EuiFormRow,{error:a.error,fullWidth:!0,helpText:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.metricIndicesRecommendedValue",defaultMessage:"The recommended value is {defaultValue}",values:{defaultValue:n.a.createElement(N.EuiCode,null,pe.d)}}),isInvalid:a.isInvalid,label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.metricIndicesLabel",defaultMessage:"Metrics indices"})},n.a.createElement(N.EuiFieldText,ee()({"data-test-subj":"metricIndicesInput",fullWidth:!0,disabled:e,readOnly:t,isLoading:e},a))))),xc=({isLoading:e,readOnly:t,anomalyThresholdFieldProps:a})=>n.a.createElement(N.EuiForm,null,n.a.createElement(N.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.mlSectionTitle",defaultMessage:"Machine Learning"}))),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.anomalyThresholdTitle",defaultMessage:"Anomaly Severity Threshold"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.anomalyThresholdDescription",defaultMessage:"Sets the minimum severity score required to show anomalies in the Metrics application."})},n.a.createElement(N.EuiFormRow,{error:a.error,fullWidth:!0,isInvalid:a.isInvalid,label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.anomalyThresholdLabel",defaultMessage:"Minimum severity score"})},n.a.createElement(N.EuiRange,ee()({min:0,max:100,"data-test-subj":"anomalyThresholdInput",showInput:!0,showTicks:!0,showRange:!0,tickInterval:20,"aria-label":"Minimum severity score",disabled:e,readOnly:t,isLoading:e},a))))),kc=({isLoading:e,readOnly:t,nameFieldProps:a})=>n.a.createElement(N.EuiForm,null,n.a.createElement(N.EuiTitle,{size:"s","data-test-subj":"sourceConfigurationNameSectionTitle"},n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.nameSectionTitle",defaultMessage:"Name"}))),n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.nameLabel",defaultMessage:"Name"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.nameDescription",defaultMessage:"A descriptive name for the source configuration"})},n.a.createElement(N.EuiFormRow,{error:a.error,fullWidth:!0,isInvalid:a.isInvalid,label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.nameLabel",defaultMessage:"Name"})},n.a.createElement(N.EuiFieldText,ee()({"data-test-subj":"nameInput",fullWidth:!0,disabled:e,readOnly:t,isLoading:e},a))))),Mc=({shouldAllowEdit:e})=>{fe([{text:ge.h}]);const{createSourceConfiguration:t,source:a,sourceExists:i,isLoading:s,isUninitialized:l,updateSourceConfiguration:o}=Object(r.useContext)(ce.a.Context),{indicesConfigurationProps:c,errors:u,resetForm:d,isFormDirty:m,isFormValid:p,formState:g,formStateChanges:f}=ft(a&&a.configuration),b=Object(r.useCallback)((async()=>{i?await o(f):await t(g),d()}),[i,o,t,d,g,f]),h=Object(r.useMemo)((()=>e&&a&&"internal"!==a.origin),[e,a]),{hasInfraMLCapabilities:y}=qn();return!s&&!l||a?null!=a&&a.configuration?n.a.createElement(Ot,{pageHeader:{pageTitle:ge.h},"data-test-subj":"sourceConfigurationContent",restrictWidth:!0},n.a.createElement(yc.b,{prompt:m?R.i18n.translate("xpack.infra.sourceConfiguration.unsavedFormPrompt",{defaultMessage:"Are you sure you want to leave? Changes will be lost"}):void 0}),n.a.createElement(N.EuiPanel,{paddingSize:"l",hasShadow:!1,hasBorder:!0},n.a.createElement(kc,{isLoading:s,nameFieldProps:c.name,readOnly:!h})),n.a.createElement(N.EuiSpacer,null),n.a.createElement(N.EuiPanel,{paddingSize:"l",hasShadow:!1,hasBorder:!0},n.a.createElement(vc,{isLoading:s,metricAliasFieldProps:c.metricAlias,readOnly:!h})),n.a.createElement(N.EuiSpacer,null),n.a.createElement(N.EuiPanel,{paddingSize:"l",hasShadow:!1,hasBorder:!0},n.a.createElement(Ec,{containerFieldProps:c.containerField,hostFieldProps:c.hostField,isLoading:s,podFieldProps:c.podField,readOnly:!h,timestampFieldProps:c.timestampField})),n.a.createElement(N.EuiSpacer,null),y&&n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiPanel,{paddingSize:"l",hasShadow:!1,hasBorder:!0},n.a.createElement(xc,{isLoading:s,readOnly:!h,anomalyThresholdFieldProps:c.anomalyThreshold})),n.a.createElement(N.EuiSpacer,null)),u.length>0?n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiCallOut,{color:"danger"},n.a.createElement("ul",null,u.map(((e,t)=>n.a.createElement("li",{key:t},e))))),n.a.createElement(N.EuiSpacer,{size:"m"})):null,n.a.createElement(N.EuiSpacer,{size:"m"}),n.a.createElement(N.EuiFlexGroup,null,h&&n.a.createElement(N.EuiFlexItem,null,s?n.a.createElement(N.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButton,{color:"primary",isLoading:!0,fill:!0},"Loading"))):n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButton,{"data-test-subj":"discardSettingsButton",color:"danger",iconType:"cross",isDisabled:s||!m,onClick:()=>{d()}},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.discardSettingsButtonLabel",defaultMessage:"Discard"}))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButton,{"data-test-subj":"applySettingsButton",color:"primary",isDisabled:!m||!p,fill:!0,onClick:b},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.sourceConfiguration.applySettingsButtonLabel",defaultMessage:"Apply"})))))))):null:n.a.createElement(oa.a,null)},Oc=()=>{var e,t;const a=null===(e=Object(A.useKibana)().services.application)||void 0===e?void 0:e.capabilities;return n.a.createElement(N.EuiErrorBoundary,null,n.a.createElement(Mc,{shouldAllowEdit:null==a||null===(t=a.infrastructure)||void 0===t?void 0:t.configureSource}))},wc=()=>{var e;const[t,a]=Object(r.useState)(!1),[i,s]=Object(r.useState)(null),l=null===(e=Object(A.useKibana)().services.application)||void 0===e?void 0:e.capabilities,o=Object(r.useMemo)((()=>{var e;return Boolean(null==l||null===(e=l.infrastructure)||void 0===e?void 0:e.save)}),[l]),c=Object(r.useCallback)((()=>s(null)),[s]),u=Object(r.useCallback)((()=>{a(!1)}),[a]),d=Object(r.useCallback)((()=>{a(!t)}),[a,t]),m=Object(r.useMemo)((()=>({id:1,title:R.i18n.translate("xpack.infra.alerting.infrastructureDropdownTitle",{defaultMessage:"Infrastructure rules"}),items:[{"data-test-subj":"inventory-alerts-create-rule",name:R.i18n.translate("xpack.infra.alerting.createInventoryRuleButton",{defaultMessage:"Create inventory rule"}),onClick:()=>{u(),s("inventory")}}]})),[s,u]),p=Object(r.useMemo)((()=>({id:2,title:R.i18n.translate("xpack.infra.alerting.metricsDropdownTitle",{defaultMessage:"Metrics rules"}),items:[{"data-test-subj":"metrics-threshold-alerts-create-rule",name:R.i18n.translate("xpack.infra.alerting.createThresholdRuleButton",{defaultMessage:"Create threshold rule"}),onClick:()=>{u(),s("threshold")}}]})),[s,u]),g=Object(Ve.b)({app:"management",pathname:"/insightsAndAlerting/triggersActions/alerts"}),f=Object(r.useMemo)((()=>({name:R.i18n.translate("xpack.infra.alerting.manageRules",{defaultMessage:"Manage rules"}),icon:"tableOfContents",onClick:g.onClick})),[g]),b=Object(r.useMemo)((()=>o?[{"data-test-subj":"inventory-alerts-menu-option",name:R.i18n.translate("xpack.infra.alerting.infrastructureDropdownMenu",{defaultMessage:"Infrastructure"}),panel:1},{"data-test-subj":"metrics-threshold-alerts-menu-option",name:R.i18n.translate("xpack.infra.alerting.metricsDropdownMenu",{defaultMessage:"Metrics"}),panel:2},f]:[f]),[o,f]),h=Object(r.useMemo)((()=>[{id:0,title:R.i18n.translate("xpack.infra.alerting.alertDropdownTitle",{defaultMessage:"Alerts and rules"}),items:b}].concat(o?[m,p]:[])),[m,p,b,o]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiPopover,{panelPaddingSize:"none",anchorPosition:"downLeft",button:n.a.createElement(N.EuiHeaderLink,{color:"text",iconSide:"right",iconType:"arrowDown",onClick:d,"data-test-subj":"infrastructure-alerts-and-rules"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.alerting.alertsButton",defaultMessage:"Alerts and rules"})),isOpen:t,closePopover:u},n.a.createElement(N.EuiContextMenu,{initialPanelId:0,panels:h,"data-test-subj":"metrics-alert-menu"})),n.a.createElement(jc,{visibleFlyoutType:i,onClose:c}))},jc=({visibleFlyoutType:e,onClose:t})=>{switch(e){case"inventory":return n.a.createElement(Fs,{onClose:t});case"threshold":return n.a.createElement(Se,{onClose:t});default:return null}};var Sc=a(211);const Cc=e=>{const[t]=Object(r.useState)((()=>p()())),{goHome:a}=e,[i,s]=Object(r.useState)(t.clone().subtract(4,"weeks")),[l,o]=Object(r.useState)(null),c=Xi(),u=ms(),[d,m]=Object(r.useState)(""),[g,f]=Object(r.useState)(""),b=Object(de.useUiTracker)({app:"infra_metrics"}),{createDerivedIndexPattern:h}=Object(J.a)({sourceId:"default"}),y=c.sourceConfiguration.indices,E=Object(r.useMemo)((()=>"kubernetes"===e.jobType?u.setupStatus:c.setupStatus),[e.jobType,u.setupStatus,c.setupStatus]),v=Object(r.useMemo)((()=>"kubernetes"===e.jobType?u.cleanUpAndSetUpModule:c.cleanUpAndSetUpModule),[e.jobType,u.cleanUpAndSetUpModule,c.cleanUpAndSetUpModule]),x=Object(r.useMemo)((()=>"kubernetes"===e.jobType?u.setUpModule:c.setUpModule),[e.jobType,u.setUpModule,c.setUpModule]),k=Object(r.useMemo)((()=>"kubernetes"===e.jobType?u.jobSummaries.length>0:c.jobSummaries.length>0),[e.jobType,u.jobSummaries,c.jobSummaries]),M=Object(r.useMemo)((()=>h()),[h]),O=Object(r.useCallback)((e=>{s(e)}),[]),w=Object(r.useCallback)((()=>{k?v(y,p()(i).toDate().getTime(),void 0,g,l?l[0]:void 0):x(y,p()(i).toDate().getTime(),void 0,g,l?l[0]:void 0)}),[v,g,x,k,y,l,i]),j=Object(r.useCallback)((e=>{m(e||""),f(Object(Wt.a)(e,M)||"")}),[M]),S=Object(r.useCallback)(Object(ve.debounce)(j,500),[j]),C=Object(r.useCallback)((e=>{o(e.map((e=>e.label)))}),[]);return Object(r.useEffect)((()=>{"kubernetes"===e.jobType&&o([ns])}),[e.jobType]),Object(r.useEffect)((()=>{"succeeded"===E.type&&("kubernetes"===e.jobType?(b({metric:"metrics_ml_anomaly_detection_k8s_enabled"}),!l||1===l.length&&l[0]===ns||b({metric:"metrics_ml_anomaly_detection_k8s_partition_changed"})):(b({metric:"metrics_ml_anomaly_detection_hosts_enabled"}),l&&b({metric:"metrics_ml_anomaly_detection_hosts_partition_changed"}),b({metric:"metrics_ml_anomaly_detection_hosts_enabled"})),a())}),[E,e.jobType,l,b,a]),n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiFlyoutHeader,null,n.a.createElement(N.EuiTitle,{size:"m"},n.a.createElement("h2",null,n.a.createElement(V.FormattedMessage,{defaultMessage:"Enable machine learning for {nodeType}",id:"xpack.infra.ml.aomalyFlyout.jobSetup.flyoutHeader",values:{nodeType:e.jobType}})))),n.a.createElement(N.EuiFlyoutBody,null,"pending"===E.type?n.a.createElement(N.EuiFlexGroup,{alignItems:"center"},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiLoadingSpinner,{size:"xl"})),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.loadingText",defaultMessage:"Creating ML job..."}))):"failed"===E.type?n.a.createElement(n.a.Fragment,null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.failureText",defaultMessage:"Something went wrong creating the necessary ML jobs."}),n.a.createElement(N.EuiSpacer,null),n.a.createElement(N.EuiButton,{fill:!0,onClick:w},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.tryAgainButton",defaultMessage:"Try again"}))):n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiText,null,n.a.createElement("p",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.description",defaultMessage:"Settings can not be changed once the jobs are created. You can recreate jobs anytime, however, the previously detected anomalies are removed."}))),n.a.createElement(N.EuiSpacer,{size:"l"}),n.a.createElement(N.EuiForm,null,n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.when.title",defaultMessage:"When does your model begin?"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.when.description",defaultMessage:"By default, machine learning jobs analyze the last 4 weeks of data and continue to run indefinitely."})},n.a.createElement(N.EuiFormRow,{label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.when.timePicker.label",defaultMessage:"Start date"})},n.a.createElement(Sc.a,{showTimeSelect:!0,selected:i,onChange:O,maxDate:t}))),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.partition.title",defaultMessage:"How do you want to partition your data?"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.partition.description",defaultMessage:"Partitions enable you to build independent models for groups of data that share similar behavior. For example, you can partition by machine type or cloud availability zone."})},n.a.createElement(N.EuiFormRow,{label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.partition.label",defaultMessage:"Partition field"}),display:"rowCompressed"},n.a.createElement(N.EuiComboBox,{placeholder:R.i18n.translate("xpack.infra.metricsExplorer.groupByLabel",{defaultMessage:"Everything"}),"aria-label":R.i18n.translate("xpack.infra.metricsExplorer.groupByAriaLabel",{defaultMessage:"Graph per"}),fullWidth:!0,singleSelection:!0,selectedOptions:l?l.map((e=>({label:e}))):void 0,options:M.fields.filter((e=>e.aggregatable&&"string"===e.type)).map((e=>({label:e.name}))),onChange:C,isClearable:!0}))),n.a.createElement(N.EuiDescribedFormGroup,{title:n.a.createElement("h3",null,n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.filter.title",defaultMessage:"Filter"})),description:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.filter.description",defaultMessage:"By default, machine learning jobs analyze all of your metric data."})},n.a.createElement(N.EuiFormRow,{display:"rowCompressed",label:n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.filter.label",defaultMessage:"Filter (optional)"})},n.a.createElement(rt.a,{derivedIndexPattern:M,onSubmit:j,onChange:S,value:d})))))),n.a.createElement(N.EuiFlyoutFooter,null,n.a.createElement(N.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButtonEmpty,{onClick:e.closeFlyout},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.cancelButton",defaultMessage:"Cancel"}))),n.a.createElement(N.EuiFlexItem,{grow:!1},n.a.createElement(N.EuiButton,{fill:!0,fullWidth:!1,onClick:w},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.enableButton",defaultMessage:"Enable jobs"}))))))};var Tc=a(172);const Fc=()=>{var e,t,a,i;const{hasInfraMLSetupCapabilities:s}=Un(),[l,o]=Object(r.useState)(!1),[c,u]=Object(r.useState)("home"),[d,m]=Object(r.useState)(null),{source:p}=Object(J.a)({sourceId:"default"}),{space:g}=Object(Tc.a)(),f=Object(r.useCallback)((()=>{u("home"),o(!0)}),[]),b=Object(r.useCallback)((e=>{u("setup"),m({jobType:e})}),[u]),h=Object(r.useCallback)((()=>{o(!1)}),[]);return null==(null==p?void 0:p.configuration.metricAlias)||null==g?null:n.a.createElement(n.a.Fragment,null,n.a.createElement(N.EuiHeaderLink,{color:"text",iconSide:"left",iconType:"inspect",onClick:f,"data-test-subj":"openAnomalyFlyoutButton"},n.a.createElement(V.FormattedMessage,{id:"xpack.infra.ml.anomalyDetectionButton",defaultMessage:"Anomaly detection"})),l&&n.a.createElement(Qi,{indexPattern:null!==(e=null==p?void 0:p.configuration.metricAlias)&&void 0!==e?e:"",sourceId:"default",spaceId:g.id,timestampField:null!==(t=null==p?void 0:p.configuration.fields.timestamp)&&void 0!==t?t:""},n.a.createElement(ds,{indexPattern:null!==(a=null==p?void 0:p.configuration.metricAlias)&&void 0!==a?a:"",sourceId:"default",spaceId:g.id,timestampField:null!==(i=null==p?void 0:p.configuration.fields.timestamp)&&void 0!==i?i:""},n.a.createElement(N.EuiFlyout,{onClose:h,"data-test-subj":"loadMLFlyout"},"home"===c&&n.a.createElement(ps,{hasSetupCapabilities:s,goToSetup:b,closeFlyout:h}),"setup"===c&&n.a.createElement(Cc,{goHome:f,closeFlyout:h,jobType:d.jobType})))))};var Lc=a(33);const Pc=R.i18n.translate("xpack.infra.metricsHeaderAddDataButtonLabel",{defaultMessage:"Add data"}),Ic=({match:e})=>{var t,a,i,s;const o=null===(t=Object(A.useKibana)().services.application)||void 0===t?void 0:t.capabilities,{setHeaderActionMenu:c}=Object(r.useContext)(Lc.a),u=R.i18n.translate("xpack.infra.metrics.settingsTabTitle",{defaultMessage:"Settings"}),d=Object(A.useKibana)();Object(re.a)(!(null!=o&&null!==(a=o.infrastructure)&&void 0!==a&&a.save));const m=Object(Ve.b)({app:"metrics",pathname:"settings"});return n.a.createElement(N.EuiErrorBoundary,null,n.a.createElement(ce.a.Provider,{sourceId:"default"},n.a.createElement(we.a,null,n.a.createElement(Pa.c,null,n.a.createElement(Ht,null,n.a.createElement(ta,null,n.a.createElement(Hn,null,n.a.createElement(te.a,{title:R.i18n.translate("xpack.infra.homePage.documentTitle",{defaultMessage:"Metrics"})}),n.a.createElement(ae.a,{feedbackLink:"https://discuss.elastic.co/c/metrics",appName:R.i18n.translate("xpack.infra.header.infrastructureHelpAppName",{defaultMessage:"Metrics"})}),c&&n.a.createElement(de.HeaderMenuPortal,{setHeaderActionMenu:c},n.a.createElement(N.EuiHeaderLinks,{gutterSize:"xs"},n.a.createElement(N.EuiHeaderLink,ee()({color:"text"},m),u),n.a.createElement(l.Route,{path:"/inventory",component:Fc}),n.a.createElement(wc,null),n.a.createElement(N.EuiHeaderLink,{href:null===(i=d.services)||void 0===i||null===(s=i.application)||void 0===s?void 0:s.getUrlForApp("/integrations/browse"),color:"primary",iconType:"indexOpen"},Pc))),n.a.createElement(l.Switch,null,n.a.createElement(l.Route,{path:"/inventory",component:To}),n.a.createElement(l.Route,{path:"/explorer",render:e=>n.a.createElement(ue,null,(({configuration:e,createDerivedIndexPattern:t})=>n.a.createElement(ne.c.Provider,null,n.a.createElement(le,null),e?n.a.createElement(Dc,{configuration:e,createDerivedIndexPattern:t}):n.a.createElement(oa.a,null))))}),n.a.createElement(l.Route,{path:"/detail/:type/:node",component:bc}),n.a.createElement(l.Route,{path:"/settings",component:Oc})))))))))},Dc=e=>{const{createDerivedIndexPattern:t,configuration:a}=e,{options:i}=Object(r.useContext)(ne.c.Context);return n.a.createElement(Et,{shouldLoadDefault:"default"===i.source,viewType:"metrics-explorer-view",defaultViewState:ne.a},n.a.createElement(Pt,ee()({derivedIndexPattern:t("metrics"),source:a},e)))};var _c=a(208),Rc=a(32);const Ac=(e,t,{element:a,history:r,setHeaderActionMenu:i})=>{const l=new o.Storage(window.localStorage);return Object(tl.b)(a,"infraMetricsPage"),s.a.render(n.a.createElement(Bc,{core:e,history:r,plugins:t,setHeaderActionMenu:i,storage:l}),a),()=>{s.a.unmountComponentAtNode(a)}},Bc=({core:e,history:t,plugins:a,setHeaderActionMenu:r,storage:i})=>{var s,o,u,d;const m=e.application.capabilities;return n.a.createElement(Rc.b,{core:e,plugins:a},n.a.createElement(Rc.a,{appName:"Metrics UI",setHeaderActionMenu:r,storage:i,triggersActionsUI:a.triggersActionsUi},n.a.createElement(l.Router,{history:t},n.a.createElement(l.Switch,null,n.a.createElement(l.Route,{path:"/link-to",component:Y}),(null==m||null===(s=m.infrastructure)||void 0===s?void 0:s.show)&&n.a.createElement(_c.a,{from:"/",exact:!0,to:"/inventory"}),(null==m||null===(o=m.infrastructure)||void 0===o?void 0:o.show)&&n.a.createElement(_c.a,{from:"/snapshot",exact:!0,to:"/inventory"}),(null==m||null===(u=m.infrastructure)||void 0===u?void 0:u.show)&&n.a.createElement(_c.a,{from:"/metrics-explorer",exact:!0,to:"/explorer"}),(null==m||null===(d=m.infrastructure)||void 0===d?void 0:d.show)&&n.a.createElement(l.Route,{path:"/",component:Ic}),n.a.createElement(l.Route,{component:c.a})))))}}}]);